{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\teacher\\\\AttendancePage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport { Box, Typography, Card, CardContent, Grid, Paper, Button, Divider, CircularProgress, List, ListItem, ListItemAvatar, ListItemText, Avatar, Chip, Dialog, DialogTitle, DialogContent, DialogActions, TextField, FormControl, InputLabel, Select, MenuItem, IconButton, Alert, AlertTitle, Tooltip } from \"@mui/material\";\nimport { CameraAlt, Check, Close, Edit, Refresh, Save, VerifiedUser, HourglassEmpty, ArrowBack, Info } from \"@mui/icons-material\";\nimport Webcam from \"react-webcam\";\nimport * as faceapi from \"face-api.js\";\nimport { getClassFaceFeatures, verifyAttendance, manualAttendance, setModelLoaded, setCameraReady, setDetectedFaces, setRecognizedStudents, clearRecognitionState } from \"../../redux/slices/faceRecognitionSlice\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\nconst AttendancePage = () => {\n  _s();\n  const {\n    classId,\n    sessionId\n  } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const videoRef = useRef(null);\n  const [intervalId, setIntervalId] = useState(null);\n  const [showLandmark, setShowLandmark] = useState(true);\n  const [landmarkIntervalId, setLandmarkIntervalId] = useState(null);\n  const [cameraMode, setCameraMode] = useState(\"face_recognition\");\n  const {\n    token\n  } = useSelector(state => state.auth);\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents,\n    isProcessing,\n    error\n  } = useSelector(state => state.faceRecognition);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isRecognizing, setIsRecognizing] = useState(false);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\"\n  });\n\n  // Các hằng số cấu hình được tối ưu\n  const RECOGNITION_THRESHOLD = 0.45; // Ngưỡng nhận diện được tối ưu\n  const DETECTION_THRESHOLD = 0.5; // Ngưỡng phát hiện khuôn mặt\n  const CONFIDENCE_THRESHOLD = 0.6; // Ngưỡng độ tin cậy để điểm danh\n  const AUTO_DETECT_INTERVAL = 1000; // Thời gian giữa các lần phát hiện (ms)\n  const ENABLE_DEBUG_LOGS = false; // Tắt log gỡ lỗi trong môi trường sản phẩm\n\n  // Thêm state mới để theo dõi số lần thử lại camera\n  const [cameraRetryCount, setCameraRetryCount] = useState(0);\n  const [lastDetectionTime, setLastDetectionTime] = useState(null);\n\n  // Thêm state theo dõi interval phát hiện landmarks\n  const [landmarkDetectionInterval, setLandmarkDetectionInterval] = useState(null);\n\n  // Load class info, session info và models\n  useEffect(() => {\n    const loadInitialData = async () => {\n      try {\n        setIsLoading(true);\n\n        // Lấy thông tin lớp học\n        const classPromise = axios.get(`${API_URL}/classes/teaching/${classId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n\n        // Lấy thông tin phiên điểm danh\n        const sessionPromise = axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n\n        // Lấy danh sách điểm danh\n        const logsPromise = axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n\n        // Chờ tất cả API calls hoàn thành\n        const [classResponse, sessionResponse, logsResponse] = await Promise.all([classPromise, sessionPromise, logsPromise]);\n        setClassInfo(classResponse.data.data);\n        setSessionInfo(sessionResponse.data.data);\n        setAttendanceLogs(logsResponse.data.data);\n\n        // Đã tải xong dữ liệu cơ bản\n        setIsLoading(false);\n\n        // Tải model nhận diện nếu chưa tải\n        if (!isModelLoaded) {\n          const modelLoaded = await loadFaceRecognitionModels();\n          if (modelLoaded) {\n            dispatch(setModelLoaded(true));\n          }\n        }\n        if (sessionResponse.data.data.status !== \"completed\") {\n          // Lấy đặc trưng khuôn mặt của sinh viên trong lớp\n          try {\n            await dispatch(getClassFaceFeatures(classId)).unwrap();\n          } catch (apiError) {\n            console.error(\"Lỗi khi lấy dữ liệu khuôn mặt:\", apiError);\n            enqueueSnackbar(\"Lỗi khi lấy dữ liệu khuôn mặt. Vui lòng kiểm tra lại.\", {\n              variant: \"error\"\n            });\n          }\n        }\n\n        // Khởi tạo thời gian phát hiện ban đầu\n        setLastDetectionTime(Date.now());\n      } catch (error) {\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        enqueueSnackbar(\"Lỗi khi tải dữ liệu\", {\n          variant: \"error\"\n        });\n        setIsLoading(false);\n      }\n    };\n    loadInitialData();\n\n    // Clean up\n    return () => {\n      if (intervalId) {\n        clearInterval(intervalId);\n      }\n\n      // Dừng landmark interval nếu đang chạy\n      if (landmarkIntervalId) {\n        clearInterval(landmarkIntervalId);\n      }\n\n      // Dừng camera stream nếu đang chạy\n      if (webcamRef.current && webcamRef.current.video && webcamRef.current.video.srcObject) {\n        const tracks = webcamRef.current.video.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      }\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      }\n      dispatch(clearRecognitionState());\n\n      // Reset các state theo dõi camera\n      setCameraRetryCount(0);\n      setLastDetectionTime(null);\n    };\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded, intervalId, landmarkIntervalId]);\n\n  // Hàm tối ưu để tải model nhận diện khuôn mặt\n  const loadFaceRecognitionModels = async () => {\n    try {\n      const MODEL_URL = \"/models\";\n\n      // Kiểm tra nhanh xem các models đã được tải chưa\n      if (faceapi.nets.tinyFaceDetector.isLoaded && faceapi.nets.faceLandmark68Net.isLoaded && faceapi.nets.faceRecognitionNet.isLoaded && faceapi.nets.ssdMobilenetv1.isLoaded) {\n        console.log(\"Các models đã được tải từ trước\");\n        dispatch(setModelLoaded(true));\n        return true;\n      }\n\n      // Hiển thị thông báo đang tải\n      enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n        variant: \"info\"\n      });\n\n      // Tải song song tất cả model và đợi đến khi hoàn tất\n      await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL), faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL)]);\n\n      // Kiểm tra xem tất cả model có thực sự được tải\n      const allModelsLoaded = faceapi.nets.tinyFaceDetector.isLoaded && faceapi.nets.faceLandmark68Net.isLoaded && faceapi.nets.faceRecognitionNet.isLoaded && faceapi.nets.ssdMobilenetv1.isLoaded;\n      if (!allModelsLoaded) {\n        console.warn(\"Một số model chưa được tải đầy đủ, thử lại sau 1s\");\n        // Đợi thêm 1 giây và kiểm tra lại\n        await new Promise(resolve => setTimeout(resolve, 1000));\n\n        // Kiểm tra lại sau khi đợi\n        const modelsLoadedAfterWait = faceapi.nets.tinyFaceDetector.isLoaded && faceapi.nets.faceLandmark68Net.isLoaded && faceapi.nets.faceRecognitionNet.isLoaded && faceapi.nets.ssdMobilenetv1.isLoaded;\n        if (!modelsLoadedAfterWait) {\n          throw new Error(\"Không thể tải đầy đủ các model sau khi thử lại\");\n        }\n      }\n\n      // Nếu đến đây tức là tất cả model đã được tải thành công\n      dispatch(setModelLoaded(true));\n      enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\n        variant: \"success\"\n      });\n      return true;\n    } catch (error) {\n      console.error(\"Lỗi khi tải mô hình:\", error);\n      enqueueSnackbar(\"Không thể tải mô hình nhận diện\", {\n        variant: \"error\"\n      });\n      return false;\n    }\n  };\n\n  // Hàm khởi tạo camera đã tối ưu\n  const initDirectCamera = async () => {\n    try {\n      var _webcamRef$current;\n      // Hiển thị thông báo đang khởi tạo\n      enqueueSnackbar(\"Đang khởi tạo camera...\", {\n        variant: \"info\"\n      });\n\n      // Tải model nếu chưa tải\n      if (!isModelLoaded) {\n        const modelLoaded = await loadFaceRecognitionModels();\n        if (!modelLoaded) {\n          enqueueSnackbar(\"Không thể tải mô hình nhận diện. Vui lòng thử lại.\", {\n            variant: \"error\"\n          });\n          return false;\n        }\n      }\n\n      // Đảm bảo model đã được tải đầy đủ\n      if (!faceapi.nets.tinyFaceDetector.isLoaded || !faceapi.nets.faceLandmark68Net.isLoaded || !faceapi.nets.faceRecognitionNet.isLoaded || !faceapi.nets.ssdMobilenetv1.isLoaded) {\n        console.warn(\"Phát hiện model chưa được tải đầy đủ, thử tải lại\");\n        await loadFaceRecognitionModels();\n      }\n\n      // Dừng stream cũ nếu có\n      const stopExistingStream = videoElement => {\n        if (videoElement !== null && videoElement !== void 0 && videoElement.srcObject) {\n          const tracks = videoElement.srcObject.getTracks();\n          tracks.forEach(track => track.stop());\n        }\n      };\n      stopExistingStream((_webcamRef$current = webcamRef.current) === null || _webcamRef$current === void 0 ? void 0 : _webcamRef$current.video);\n      stopExistingStream(videoRef.current);\n\n      // Cấu hình camera tối ưu\n      const constraints = {\n        video: {\n          width: {\n            ideal: 640,\n            min: 320\n          },\n          height: {\n            ideal: 480,\n            min: 240\n          },\n          facingMode: \"user\",\n          frameRate: {\n            ideal: 24,\n            min: 15\n          }\n        },\n        audio: false\n      };\n\n      // Truy cập camera\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia(constraints);\n\n        // Xử lý stream video\n        const setupVideoStream = videoElement => {\n          if (!videoElement) return false;\n          videoElement.srcObject = stream;\n          return true;\n        };\n\n        // Thiết lập stream cho webcam hoặc video element\n        let streamSetupSuccess = false;\n        if (webcamRef.current && webcamRef.current.video) {\n          streamSetupSuccess = setupVideoStream(webcamRef.current.video);\n\n          // Đảm bảo video đã được tải trước khi tiếp tục\n          if (streamSetupSuccess) {\n            await waitForVideoReady(webcamRef.current.video);\n          }\n        } else if (videoRef.current) {\n          streamSetupSuccess = setupVideoStream(videoRef.current);\n\n          // Đảm bảo video đã được tải trước khi tiếp tục\n          if (streamSetupSuccess) {\n            await waitForVideoReady(videoRef.current);\n          }\n        }\n        if (!streamSetupSuccess) {\n          throw new Error(\"Không thể thiết lập video stream\");\n        }\n\n        // Đánh dấu camera đã sẵn sàng\n        dispatch(setCameraReady(true));\n        setLastDetectionTime(Date.now());\n        setCameraRetryCount(0);\n\n        // Đợi thêm 1 giây trước khi bật hiển thị landmark\n        // để đảm bảo video đã ổn định\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        setShowLandmark(true);\n        startLandmarkDetection();\n        enqueueSnackbar(\"Đã kết nối camera thành công\", {\n          variant: \"success\"\n        });\n        return true;\n      } catch (err) {\n        console.error(\"Lỗi truy cập camera:\", err);\n\n        // Thử phương án thay thế nếu lỗi\n        if (cameraRetryCount < 2) {\n          try {\n            var _webcamRef$current2;\n            enqueueSnackbar(\"Đang thử kết nối với camera thay thế...\", {\n              variant: \"info\"\n            });\n            const altStream = await navigator.mediaDevices.getUserMedia({\n              video: true,\n              audio: false\n            });\n            if ((_webcamRef$current2 = webcamRef.current) !== null && _webcamRef$current2 !== void 0 && _webcamRef$current2.video) {\n              webcamRef.current.video.srcObject = altStream;\n              await waitForVideoReady(webcamRef.current.video);\n            } else if (videoRef.current) {\n              videoRef.current.srcObject = altStream;\n              await waitForVideoReady(videoRef.current);\n            }\n            dispatch(setCameraReady(true));\n            setLastDetectionTime(Date.now());\n            setCameraRetryCount(prev => prev + 1);\n            enqueueSnackbar(\"Đã kết nối camera thay thế\", {\n              variant: \"success\"\n            });\n            return true;\n          } catch (altErr) {\n            console.error(\"Không thể sử dụng camera thay thế:\", altErr);\n          }\n        }\n        enqueueSnackbar(`Không thể truy cập camera: ${err.message}`, {\n          variant: \"error\"\n        });\n        return false;\n      }\n    } catch (err) {\n      console.error(\"Lỗi khi khởi tạo camera:\", err);\n      enqueueSnackbar(`Lỗi: ${err.message}`, {\n        variant: \"error\"\n      });\n      return false;\n    }\n  };\n\n  // Hàm đợi video sẵn sàng\n  const waitForVideoReady = videoElement => {\n    return new Promise(resolve => {\n      if (!videoElement) {\n        resolve(false);\n        return;\n      }\n\n      // Nếu video đã sẵn sàng thì resolve ngay\n      if (videoElement.readyState >= 2) {\n        videoElement.play().catch(err => console.error(\"Lỗi khi play video:\", err));\n        resolve(true);\n        return;\n      }\n      const handleCanPlay = () => {\n        videoElement.play().catch(err => console.error(\"Lỗi khi play video:\", err));\n        resolve(true);\n      };\n      const handleError = () => {\n        console.error(\"Video không thể phát\");\n        resolve(false);\n      };\n\n      // Thiết lập các event listener\n      videoElement.addEventListener(\"canplay\", handleCanPlay, {\n        once: true\n      });\n      videoElement.addEventListener(\"loadeddata\", handleCanPlay, {\n        once: true\n      });\n      videoElement.addEventListener(\"error\", handleError, {\n        once: true\n      });\n\n      // Thiết lập timeout để tránh chờ vô hạn\n      const timeoutId = setTimeout(() => {\n        videoElement.removeEventListener(\"canplay\", handleCanPlay);\n        videoElement.removeEventListener(\"loadeddata\", handleCanPlay);\n        videoElement.removeEventListener(\"error\", handleError);\n        console.warn(\"Đã hết thời gian chờ video sẵn sàng\");\n\n        // Vẫn cố gắng phát video\n        videoElement.play().catch(err => console.error(\"Lỗi khi play video sau timeout:\", err));\n        resolve(false);\n      }, 5000); // 5 giây timeout\n\n      // Cleanup function\n      videoElement.addEventListener(\"canplay\", () => clearTimeout(timeoutId), {\n        once: true\n      });\n      videoElement.addEventListener(\"loadeddata\", () => clearTimeout(timeoutId), {\n        once: true\n      });\n      videoElement.addEventListener(\"error\", () => clearTimeout(timeoutId), {\n        once: true\n      });\n    });\n  };\n\n  // Bắt đầu phát hiện landmarks theo thời gian thực\n  const startLandmarkDetection = () => {\n    // Xóa interval cũ nếu có\n    if (landmarkDetectionInterval) {\n      clearInterval(landmarkDetectionInterval);\n    }\n\n    // Theo dõi frame trước đó để tránh xử lý các detection null liên tiếp\n    let lastValidDetections = null;\n    let invalidFrameCount = 0;\n    const MAX_INVALID_FRAMES = 5; // Số lượng frame không hợp lệ tối đa trước khi xóa canvas\n\n    // Tạo interval mới để cập nhật landmarks mỗi 150ms\n    const intervalId = setInterval(async () => {\n      if (cameraMode === \"face_recognition\" && showLandmark) {\n        var _webcamRef$current3;\n        // Kiểm tra trạng thái camera trước khi thực hiện phát hiện\n        const videoElement = isAutoMode ? videoRef.current : (_webcamRef$current3 = webcamRef.current) === null || _webcamRef$current3 === void 0 ? void 0 : _webcamRef$current3.video;\n\n        // Kiểm tra kỹ video element\n        if (!videoElement || videoElement.readyState !== 4 || videoElement.videoWidth === 0 || videoElement.videoHeight === 0 || !videoElement.srcObject || videoElement.srcObject.active === false) {\n          console.log(\"Video chưa sẵn sàng, bỏ qua phát hiện landmark\");\n          return;\n        }\n\n        // Thực hiện phát hiện khuôn mặt\n        try {\n          const canvasElement = canvasRef.current;\n          if (!canvasElement) return;\n          const detections = await handleDetectFaces(true);\n\n          // Kiểm tra kỹ detections\n          if (!detections || !Array.isArray(detections) || detections.length === 0) {\n            invalidFrameCount++;\n\n            // Nếu có quá nhiều frame không hợp lệ liên tiếp, xóa canvas\n            if (invalidFrameCount > MAX_INVALID_FRAMES) {\n              if (canvasElement && canvasElement.getContext) {\n                const ctx = canvasElement.getContext(\"2d\");\n                if (ctx) {\n                  ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n                }\n              }\n\n              // Có thể sử dụng kết quả hợp lệ cuối cùng\n              if (lastValidDetections && Array.isArray(lastValidDetections) && lastValidDetections.length > 0) {\n                console.log(\"Sử dụng kết quả phát hiện hợp lệ cuối cùng\");\n                try {\n                  // Hiển thị kết quả cũ an toàn\n                  drawFaceLandmarks(lastValidDetections, canvasElement, recognizedStudents);\n                } catch (error) {\n                  console.error(\"Lỗi khi vẽ last valid detections:\", error);\n                }\n              }\n            }\n            return;\n          }\n\n          // Reset bộ đếm khi có frame hợp lệ\n          invalidFrameCount = 0;\n\n          // Lưu trữ detections hợp lệ để sử dụng khi cần\n          // Lọc kỹ một lần nữa\n          const validDetections = detections.filter(detection => {\n            if (!detection || !detection.detection || !detection.detection._box) return false;\n            const box = detection.detection._box;\n            return box && typeof box._x === 'number' && !isNaN(box._x) && typeof box._y === 'number' && !isNaN(box._y) && typeof box._width === 'number' && !isNaN(box._width) && typeof box._height === 'number' && !isNaN(box._height);\n          });\n          if (validDetections.length > 0) {\n            lastValidDetections = validDetections;\n          }\n        } catch (error) {\n          console.error(\"Lỗi khi phát hiện landmarks:\", error);\n          // Tăng bộ đếm khi có lỗi\n          invalidFrameCount++;\n        }\n      }\n    }, 200); // Tăng lên 200ms để giảm tải CPU\n\n    setLandmarkDetectionInterval(intervalId);\n  };\n\n  // Dừng phát hiện landmarks theo thời gian thực\n  const stopLandmarkDetection = () => {\n    if (landmarkDetectionInterval) {\n      clearInterval(landmarkDetectionInterval);\n      setLandmarkDetectionInterval(null);\n    }\n  };\n\n  // Cập nhật useEffect để bắt đầu và dừng phát hiện landmarks khi camera hoặc chế độ thay đổi\n  useEffect(() => {\n    if (cameraMode === \"face_recognition\" && showLandmark) {\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n    }\n    return () => {\n      stopLandmarkDetection();\n    };\n  }, [cameraMode, showLandmark]);\n\n  // Cập nhật useEffect cho việc toggle showLandmark\n  useEffect(() => {\n    if (showLandmark && cameraMode === \"face_recognition\") {\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n    }\n  }, [showLandmark]);\n\n  // Hàm kiểm tra và đảm bảo camera hoạt động\n  const ensureCameraIsWorking = () => {\n    var _webcamRef$current4;\n    // Kiểm tra nếu camera chưa hoạt động và đã thử khởi động\n    if (!isCameraReady && cameraRetryCount === 0) {\n      console.log(\"[DEBUG] Camera chưa sẵn sàng, thử khởi động\");\n      setCameraRetryCount(1);\n      initDirectCamera();\n      return false;\n    }\n\n    // Kiểm tra stream của camera\n    const videoElement = isAutoMode ? videoRef.current : (_webcamRef$current4 = webcamRef.current) === null || _webcamRef$current4 === void 0 ? void 0 : _webcamRef$current4.video;\n    if (!videoElement || !videoElement.srcObject || videoElement.readyState !== 4) {\n      console.log(\"[DEBUG] Video stream không hoạt động, thử khởi động lại camera\");\n      if (cameraRetryCount < 3) {\n        setCameraRetryCount(prev => prev + 1);\n        initDirectCamera();\n        return false;\n      }\n    }\n    return true;\n  };\n\n  // Hàm vẽ landmarks đã được tối ưu với hiển thị thông tin sinh viên\n  const drawFaceLandmarks = (detections, canvas, recognizedStudents = []) => {\n    if (!canvas) return;\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Nếu detections là null hoặc trống, không vẽ gì\n    if (!detections || !Array.isArray(detections) || detections.length === 0) {\n      return;\n    }\n\n    // Lọc các phát hiện không hợp lệ\n    const validDetections = detections.filter(detection => {\n      if (!detection || !detection.detection || !detection.detection._box) return false;\n      const box = detection.detection._box;\n      return box && typeof box._x === \"number\" && !isNaN(box._x) && typeof box._y === \"number\" && !isNaN(box._y) && typeof box._width === \"number\" && !isNaN(box._width) && typeof box._height === \"number\" && !isNaN(box._height);\n    });\n\n    // Nếu không có detection hợp lệ sau khi lọc, thoát\n    if (validDetections.length === 0) {\n      return;\n    }\n    validDetections.forEach((detection, index) => {\n      try {\n        const {\n          _box: box\n        } = detection.detection || {};\n        const landmarks = detection.landmarks;\n        if (!box || !(landmarks !== null && landmarks !== void 0 && landmarks.positions) || !Array.isArray(landmarks.positions) || landmarks.positions.length === 0 || box._x == null || box._y == null || box._width == null || box._height == null || isNaN(box._x) || isNaN(box._y) || isNaN(box._width) || isNaN(box._height)) {\n          return;\n        }\n\n        // Vẽ hộp giới hạn khuôn mặt với viền gradient\n        const boxGradient = ctx.createLinearGradient(box._x, box._y, box._x + box._width, box._y + box._height);\n        boxGradient.addColorStop(0, \"#4CAF50\");\n        boxGradient.addColorStop(1, \"#2196F3\");\n        ctx.strokeStyle = boxGradient;\n        ctx.lineWidth = 3;\n        ctx.strokeRect(box._x, box._y, box._width, box._height);\n\n        // Tìm sinh viên đã được nhận diện tương ứng với detection này\n        const matchingStudent = recognizedStudents.find((student, idx) => idx === index);\n\n        // Tạo background cho text\n        const labelY = box._y - 10;\n        const labelText = matchingStudent ? `${matchingStudent.name} (${Math.round(matchingStudent.confidence * 100)}%)` : \"Đã phát hiện khuôn mặt\";\n        const textMetrics = ctx.measureText(labelText);\n        const textWidth = textMetrics.width + 10; // Thêm padding\n\n        // Vẽ background cho label\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n        ctx.fillRect(box._x, labelY - 20, textWidth, 24);\n\n        // Vẽ text tên và % nhận diện\n        ctx.fillStyle = \"#FFFFFF\";\n        ctx.font = \"14px Arial\";\n        ctx.fillText(labelText, box._x + 5, labelY - 4);\n        const points = landmarks.positions;\n        if (!points || !Array.isArray(points) || points.length < 68) return;\n\n        // Vẽ các điểm landmarks với alpha thấp hơn để không quá nổi bật\n        ctx.globalAlpha = 0.6;\n\n        // Hàm vẽ nhóm điểm\n        const drawPoints = (startIdx, endIdx, color) => {\n          ctx.fillStyle = color;\n          for (let i = startIdx; i <= endIdx; i++) {\n            var _points$i, _points$i2, _points$i3, _points$i4;\n            if (points[i] && ((_points$i = points[i]) === null || _points$i === void 0 ? void 0 : _points$i.x) != null && ((_points$i2 = points[i]) === null || _points$i2 === void 0 ? void 0 : _points$i2.y) != null && !isNaN((_points$i3 = points[i]) === null || _points$i3 === void 0 ? void 0 : _points$i3.x) && !isNaN((_points$i4 = points[i]) === null || _points$i4 === void 0 ? void 0 : _points$i4.y)) {\n              ctx.beginPath();\n              ctx.arc(points[i].x, points[i].y, 2, 0, 2 * Math.PI);\n              ctx.fill();\n            }\n          }\n        };\n\n        // Vẽ các điểm landmarks\n        drawPoints(36, 41, \"#FF5722\"); // Mắt trái (cam)\n        drawPoints(42, 47, \"#2196F3\"); // Mắt phải (xanh dương)\n        drawPoints(27, 35, \"#FFEB3B\"); // Mũi (vàng)\n        drawPoints(48, 67, \"#E91E63\"); // Miệng (hồng)\n        drawPoints(0, 26, \"#4CAF50\"); // Viền khuôn mặt (xanh lá)\n\n        // Kết nối các điểm để tạo đường viền rõ ràng hơn cho các bộ phận quan trọng\n        ctx.globalAlpha = 0.4;\n        ctx.lineWidth = 1;\n\n        // Hàm an toàn để vẽ đường viền\n        const drawLine = (points, indices) => {\n          var _points$firstIdx, _points$firstIdx2, _points$firstIdx3, _points$firstIdx4;\n          if (!points || indices.length < 2) return;\n\n          // Kiểm tra điểm đầu tiên\n          const firstIdx = indices[0];\n          if (!points[firstIdx] || ((_points$firstIdx = points[firstIdx]) === null || _points$firstIdx === void 0 ? void 0 : _points$firstIdx.x) == null || ((_points$firstIdx2 = points[firstIdx]) === null || _points$firstIdx2 === void 0 ? void 0 : _points$firstIdx2.y) == null || isNaN((_points$firstIdx3 = points[firstIdx]) === null || _points$firstIdx3 === void 0 ? void 0 : _points$firstIdx3.x) || isNaN((_points$firstIdx4 = points[firstIdx]) === null || _points$firstIdx4 === void 0 ? void 0 : _points$firstIdx4.y)) return;\n          ctx.beginPath();\n          ctx.moveTo(points[firstIdx].x, points[firstIdx].y);\n\n          // Vẽ đường đến các điểm còn lại\n          for (let i = 1; i < indices.length; i++) {\n            var _points$idx, _points$idx2, _points$idx3, _points$idx4;\n            const idx = indices[i];\n            if (points[idx] && ((_points$idx = points[idx]) === null || _points$idx === void 0 ? void 0 : _points$idx.x) != null && ((_points$idx2 = points[idx]) === null || _points$idx2 === void 0 ? void 0 : _points$idx2.y) != null && !isNaN((_points$idx3 = points[idx]) === null || _points$idx3 === void 0 ? void 0 : _points$idx3.x) && !isNaN((_points$idx4 = points[idx]) === null || _points$idx4 === void 0 ? void 0 : _points$idx4.y)) {\n              ctx.lineTo(points[idx].x, points[idx].y);\n            }\n          }\n\n          // Đóng đường đi nếu cần\n          if (indices.length > 2) {\n            ctx.lineTo(points[firstIdx].x, points[firstIdx].y);\n          }\n          ctx.stroke();\n        };\n\n        // Vẽ viền mắt trái\n        ctx.strokeStyle = \"#FF5722\";\n        drawLine(points, [36, 37, 38, 39, 40, 41, 36]);\n\n        // Vẽ viền mắt phải\n        ctx.strokeStyle = \"#2196F3\";\n        drawLine(points, [42, 43, 44, 45, 46, 47, 42]);\n\n        // Vẽ viền miệng ngoài\n        ctx.strokeStyle = \"#E91E63\";\n        drawLine(points, Array.from({\n          length: 12\n        }, (_, i) => i + 48));\n\n        // Vẽ viền miệng trong\n        ctx.strokeStyle = \"#E91E63\";\n        drawLine(points, Array.from({\n          length: 8\n        }, (_, i) => i + 60));\n\n        // Reset alpha\n        ctx.globalAlpha = 1.0;\n      } catch (error) {\n        console.error(\"Lỗi khi vẽ landmark cho detection:\", error);\n      }\n    });\n  };\n\n  // Tối ưu hàm phát hiện khuôn mặt với tích hợp hiển thị thông tin sinh viên\n  const handleDetectFaces = async (landmarkOnly = false) => {\n    var _webcamRef$current5;\n    if (cameraMode !== \"face_recognition\" || !faceapi || !canvasRef.current) return [];\n\n    // Xác định video element hiện tại\n    const videoElement = isAutoMode ? videoRef.current : (_webcamRef$current5 = webcamRef.current) === null || _webcamRef$current5 === void 0 ? void 0 : _webcamRef$current5.video;\n\n    // Kiểm tra video element kỹ hơn\n    if (!videoElement || videoElement.readyState !== 4 || videoElement.videoWidth === 0 || videoElement.videoHeight === 0 || !videoElement.srcObject || videoElement.srcObject.active === false) {\n      console.warn(\"Video chưa sẵn sàng hoặc không có kích thước hợp lệ\");\n      return [];\n    }\n    const canvasElement = canvasRef.current;\n    try {\n      // Kiểm tra xem canvas đã được khởi tạo chưa\n      if (!canvasElement) {\n        console.warn(\"Canvas chưa được khởi tạo\");\n        return [];\n      }\n\n      // Đặt kích thước canvas để khớp với video thực tế\n      const displaySize = {\n        width: videoElement.videoWidth,\n        height: videoElement.videoHeight\n      };\n      if (displaySize.width === 0 || displaySize.height === 0) {\n        console.warn(\"Kích thước video không hợp lệ:\", displaySize);\n        return [];\n      }\n\n      // Đảm bảo canvas có kích thước đúng\n      if (canvasElement.width !== displaySize.width || canvasElement.height !== displaySize.height) {\n        canvasElement.width = displaySize.width;\n        canvasElement.height = displaySize.height;\n      }\n\n      // Sử dụng TinyFaceDetector nhanh hơn để phát hiện khuôn mặt với landmarks\n      let detections = [];\n      try {\n        detections = await faceapi.detectAllFaces(videoElement, new faceapi.TinyFaceDetectorOptions({\n          scoreThreshold: DETECTION_THRESHOLD,\n          inputSize: 320\n        })).withFaceLandmarks();\n      } catch (detectionError) {\n        console.error(\"Lỗi khi phát hiện khuôn mặt:\", detectionError);\n        return [];\n      }\n\n      // Lọc bỏ các phát hiện không hợp lệ\n      detections = detections.filter(detection => {\n        var _detection$detection;\n        const box = (_detection$detection = detection.detection) === null || _detection$detection === void 0 ? void 0 : _detection$detection._box;\n        return box && typeof box._x === \"number\" && !isNaN(box._x) && typeof box._y === \"number\" && !isNaN(box._y) && typeof box._width === \"number\" && !isNaN(box._width) && typeof box._height === \"number\" && !isNaN(box._height);\n      });\n      if (detections.length === 0) {\n        console.log(\"Không phát hiện khuôn mặt hợp lệ\");\n        canvasElement.getContext(\"2d\").clearRect(0, 0, canvasElement.width, canvasElement.height);\n        return [];\n      }\n\n      // Xử lý resize an toàn\n      let resizedDetections = [];\n      try {\n        // Sử dụng phương pháp resize thủ công an toàn hơn\n        resizedDetections = detections.map(detection => {\n          try {\n            // Clone detection để không ảnh hưởng đến dữ liệu gốc\n            const clonedDetection = {\n              ...detection\n            };\n\n            // Nếu có box, resize box\n            if (clonedDetection.detection && clonedDetection.detection._box) {\n              const box = clonedDetection.detection._box;\n\n              // Kiểm tra box có hợp lệ không\n              if (typeof box._x !== \"number\" || isNaN(box._x) || typeof box._y !== \"number\" || isNaN(box._y) || typeof box._width !== \"number\" || isNaN(box._width) || typeof box._height !== \"number\" || isNaN(box._height)) {\n                return null;\n              }\n\n              // Không resize nếu kích thước giống nhau\n              if (canvasElement.width === videoElement.videoWidth && canvasElement.height === videoElement.videoHeight) {\n                return clonedDetection;\n              }\n\n              // Tính tỷ lệ resize\n              const scaleX = canvasElement.width / videoElement.videoWidth;\n              const scaleY = canvasElement.height / videoElement.videoHeight;\n\n              // Resize box thủ công\n              clonedDetection.detection._box = {\n                _x: box._x * scaleX,\n                _y: box._y * scaleY,\n                _width: box._width * scaleX,\n                _height: box._height * scaleY,\n                _score: box._score\n              };\n            }\n\n            // Nếu có landmarks, resize landmarks\n            if (clonedDetection.landmarks && clonedDetection.landmarks.positions) {\n              // Không resize nếu kích thước giống nhau\n              if (canvasElement.width === videoElement.videoWidth && canvasElement.height === videoElement.videoHeight) {\n                return clonedDetection;\n              }\n\n              // Tính tỷ lệ resize\n              const scaleX = canvasElement.width / videoElement.videoWidth;\n              const scaleY = canvasElement.height / videoElement.videoHeight;\n\n              // Resize positions thủ công\n              clonedDetection.landmarks.positions = clonedDetection.landmarks.positions.map(position => {\n                if (position && typeof position.x === \"number\" && typeof position.y === \"number\") {\n                  return {\n                    x: position.x * scaleX,\n                    y: position.y * scaleY\n                  };\n                }\n                return position;\n              });\n            }\n            return clonedDetection;\n          } catch (resizeError) {\n            console.error(\"Lỗi khi resize detection:\", resizeError);\n            return null;\n          }\n        }).filter(det => det !== null);\n      } catch (resizeError) {\n        console.error(\"Lỗi khi resize detections:\", resizeError);\n        resizedDetections = detections;\n      }\n\n      // Nếu chỉ cần vẽ landmarks, không cần trích xuất descriptor\n      if (landmarkOnly) {\n        if (resizedDetections.length > 0) {\n          // Vẽ landmarks với thông tin nhận diện nếu có\n          drawFaceLandmarks(resizedDetections, canvasElement, recognizedStudents);\n          return detections;\n        } else {\n          // Xóa canvas nếu không phát hiện khuôn mặt\n          canvasElement.getContext(\"2d\").clearRect(0, 0, canvasElement.width, canvasElement.height);\n          return [];\n        }\n      }\n\n      // Nếu cần nhận diện đầy đủ, trích xuất thêm descriptors\n      if (detections.length > 0) {\n        // Thêm descriptors\n        let finalDetections = [];\n        try {\n          var _finalDetections$;\n          finalDetections = await faceapi.detectAllFaces(videoElement, new faceapi.TinyFaceDetectorOptions({\n            scoreThreshold: DETECTION_THRESHOLD,\n            inputSize: 320\n          })).withFaceLandmarks().withFaceDescriptors();\n\n          // Lọc các kết quả không hợp lệ\n          finalDetections = finalDetections.filter(detection => {\n            var _detection$detection2;\n            const box = (_detection$detection2 = detection.detection) === null || _detection$detection2 === void 0 ? void 0 : _detection$detection2._box;\n            return box && typeof box._x === \"number\" && !isNaN(box._x) && typeof box._y === \"number\" && !isNaN(box._y) && typeof box._width === \"number\" && !isNaN(box._width) && typeof box._height === \"number\" && !isNaN(box._height) && detection.descriptor && detection.descriptor.length === 128;\n          });\n\n          // Nếu không có kết quả hoặc descriptor không hợp lệ, thử dùng SSD MobileNet\n          if ((finalDetections.length === 0 || !((_finalDetections$ = finalDetections[0]) !== null && _finalDetections$ !== void 0 && _finalDetections$.descriptor)) && faceapi.nets.ssdMobilenetv1.isLoaded) {\n            console.log(\"Thử dùng SSD MobileNet để trích xuất descriptors\");\n            finalDetections = await faceapi.detectAllFaces(videoElement, new faceapi.SsdMobilenetv1Options({\n              minConfidence: DETECTION_THRESHOLD\n            })).withFaceLandmarks().withFaceDescriptors();\n\n            // Lọc lại kết quả\n            finalDetections = finalDetections.filter(detection => {\n              var _detection$detection3;\n              const box = (_detection$detection3 = detection.detection) === null || _detection$detection3 === void 0 ? void 0 : _detection$detection3._box;\n              return box && typeof box._x === \"number\" && !isNaN(box._x) && typeof box._y === \"number\" && !isNaN(box._y) && typeof box._width === \"number\" && !isNaN(box._width) && typeof box._height === \"number\" && !isNaN(box._height) && detection.descriptor && detection.descriptor.length === 128;\n            });\n          }\n        } catch (error) {\n          console.error(\"Lỗi khi lấy mô tả khuôn mặt:\", error);\n          finalDetections = detections.filter(det => {\n            var _det$detection;\n            const box = (_det$detection = det.detection) === null || _det$detection === void 0 ? void 0 : _det$detection._box;\n            return box && box._x != null && box._y != null && box._width != null && box._height != null;\n          });\n        }\n        if (finalDetections.length > 0) {\n          // Resize an toàn finalDetections\n          let resizedFinalDetections = [];\n          try {\n            // Sử dụng phương pháp resize thủ công an toàn tương tự\n            resizedFinalDetections = finalDetections.map(detection => {\n              try {\n                const clonedDetection = {\n                  ...detection\n                };\n\n                // Resize box nếu cần\n                if (clonedDetection.detection && clonedDetection.detection._box) {\n                  const box = clonedDetection.detection._box;\n\n                  // Kiểm tra box có hợp lệ không\n                  if (typeof box._x !== \"number\" || isNaN(box._x) || typeof box._y !== \"number\" || isNaN(box._y) || typeof box._width !== \"number\" || isNaN(box._width) || typeof box._height !== \"number\" || isNaN(box._height)) {\n                    return null;\n                  }\n\n                  // Không resize nếu kích thước giống nhau\n                  if (canvasElement.width === videoElement.videoWidth && canvasElement.height === videoElement.videoHeight) {\n                    return clonedDetection;\n                  }\n\n                  // Tính tỷ lệ resize\n                  const scaleX = canvasElement.width / videoElement.videoWidth;\n                  const scaleY = canvasElement.height / videoElement.videoHeight;\n\n                  // Resize box thủ công\n                  clonedDetection.detection._box = {\n                    _x: box._x * scaleX,\n                    _y: box._y * scaleY,\n                    _width: box._width * scaleX,\n                    _height: box._height * scaleY,\n                    _score: box._score\n                  };\n                }\n\n                // Nếu có landmarks, resize landmarks\n                if (clonedDetection.landmarks && clonedDetection.landmarks.positions) {\n                  // Không resize nếu kích thước giống nhau\n                  if (canvasElement.width === videoElement.videoWidth && canvasElement.height === videoElement.videoHeight) {\n                    return clonedDetection;\n                  }\n\n                  // Tính tỷ lệ resize\n                  const scaleX = canvasElement.width / videoElement.videoWidth;\n                  const scaleY = canvasElement.height / videoElement.videoHeight;\n\n                  // Resize positions thủ công\n                  clonedDetection.landmarks.positions = clonedDetection.landmarks.positions.map(position => {\n                    if (position && typeof position.x === \"number\" && typeof position.y === \"number\") {\n                      return {\n                        x: position.x * scaleX,\n                        y: position.y * scaleY\n                      };\n                    }\n                    return position;\n                  });\n                }\n                return clonedDetection;\n              } catch (resizeError) {\n                console.error(\"Lỗi khi resize final detection:\", resizeError);\n                return null;\n              }\n            }).filter(det => det !== null);\n          } catch (resizeError) {\n            console.error(\"Lỗi khi resize finalDetections:\", resizeError);\n            resizedFinalDetections = finalDetections;\n          }\n\n          // Vẽ landmarks nếu được bật\n          if (showLandmark && resizedFinalDetections.length > 0) {\n            drawFaceLandmarks(resizedFinalDetections, canvasElement, recognizedStudents);\n          }\n\n          // Xử lý nhận diện\n          handleFaceDetection(finalDetections);\n          return finalDetections;\n        }\n      }\n\n      // Xóa canvas nếu không có kết quả\n      canvasElement.getContext(\"2d\").clearRect(0, 0, canvasElement.width, canvasElement.height);\n      return [];\n    } catch (error) {\n      console.error(\"Lỗi khi phát hiện khuôn mặt:\", error);\n      if (canvasElement) {\n        canvasElement.getContext(\"2d\").clearRect(0, 0, canvasElement.width, canvasElement.height);\n      }\n      return [];\n    }\n  };\n\n  // Hàm trích xuất descriptor từ sinh viên, tối ưu hoá và chỉ phải làm một lần\n  const extractStudentDescriptors = student => {\n    var _student$faceFeatures;\n    if (!student) return [];\n    const descriptors = [];\n\n    // Kiểm tra cấu trúc mới\n    if ((_student$faceFeatures = student.faceFeatures) !== null && _student$faceFeatures !== void 0 && _student$faceFeatures.descriptors) {\n      const featuresData = student.faceFeatures.descriptors;\n\n      // Duyệt qua tất cả cấu trúc lồng nhau để tìm mảng 128 phần tử\n      const findDescriptorsInArray = (arr, maxDepth = 3, depth = 0) => {\n        if (!Array.isArray(arr) || depth > maxDepth) return;\n        if (arr.length === 128 && arr.every(val => typeof val === \"number\")) {\n          descriptors.push(arr);\n          return;\n        }\n        for (const item of arr) {\n          if (Array.isArray(item)) {\n            findDescriptorsInArray(item, maxDepth, depth + 1);\n          }\n        }\n      };\n      findDescriptorsInArray(featuresData);\n    }\n\n    // Kiểm tra cấu trúc cũ\n    if (descriptors.length === 0 && student.faceDescriptors) {\n      const oldFeatures = student.faceDescriptors;\n      if (Array.isArray(oldFeatures)) {\n        // Trường hợp 1: mảng các descriptor\n        for (const item of oldFeatures) {\n          if (Array.isArray(item) && item.length === 128) {\n            descriptors.push(item);\n          }\n          // Trường hợp 2: mảng các object chứa descriptor\n          else if (typeof item === \"object\" && item !== null) {\n            // Tìm trong các thuộc tính của object\n            for (const key in item) {\n              const value = item[key];\n              if (Array.isArray(value) && value.length === 128 && value.every(v => typeof v === \"number\")) {\n                descriptors.push(value);\n              }\n              // Tìm trong thuộc tính descriptors\n              else if (key === \"descriptors\" && Array.isArray(value)) {\n                value.forEach(desc => {\n                  if (Array.isArray(desc) && desc.length === 128) {\n                    descriptors.push(desc);\n                  }\n                });\n              }\n            }\n          }\n        }\n      }\n    }\n    return descriptors;\n  };\n\n  // Xử lý phát hiện khuôn mặt\n  const handleFaceDetection = async detections => {\n    // Kiểm tra kết quả không hợp lệ trước khi tiếp tục\n    if (!detections || detections.length === 0) {\n      console.log(\"[DEBUG] Không phát hiện khuôn mặt\");\n      return;\n    }\n\n    // Lọc kết quả để đảm bảo tất cả đều hợp lệ\n    const validDetections = detections.filter(detection => {\n      var _detection$detection4;\n      // Kiểm tra detection có đầy đủ thông tin\n      const box = (_detection$detection4 = detection.detection) === null || _detection$detection4 === void 0 ? void 0 : _detection$detection4._box;\n      const descriptor = detection.descriptor;\n      return box && typeof box._x === \"number\" && !isNaN(box._x) && typeof box._y === \"number\" && !isNaN(box._y) && typeof box._width === \"number\" && !isNaN(box._width) && typeof box._height === \"number\" && !isNaN(box._height) && (descriptor ? Array.isArray(descriptor) && descriptor.length === 128 : true);\n    });\n    if (validDetections.length === 0) {\n      console.log(\"[DEBUG] Không có kết quả phát hiện hợp lệ sau khi lọc\");\n      return;\n    }\n    try {\n      // Cập nhật state với kết quả đã lọc\n      dispatch(setDetectedFaces(validDetections));\n\n      // Cập nhật thời gian phát hiện\n      setLastDetectionTime(Date.now());\n      if (ENABLE_DEBUG_LOGS) {\n        console.log(`[DEBUG] Đã phát hiện ${validDetections.length} khuôn mặt hợp lệ`);\n      }\n\n      // Xử lý nhận diện khuôn mặt nếu có sinh viên\n      if (classStudents && classStudents.length > 0) {\n        // Xử lý nhận diện khuôn mặt sẽ được thêm sau\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi xử lý khuôn mặt:\", error);\n    }\n  };\n\n  // Điểm danh thủ công\n  const openManualAttendanceDialog = student => {\n    if (!student) {\n      enqueueSnackbar(\"Không tìm thấy thông tin sinh viên\", {\n        variant: \"error\"\n      });\n      return;\n    }\n    setSelectedStudent(student);\n    setManualAttendanceData({\n      status: \"present\",\n      // Mặc định là có mặt\n      note: \"\"\n    });\n    setManualDialogOpen(true);\n  };\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n  };\n  const handleManualAttendanceChange = e => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value\n    });\n  };\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent) return;\n    try {\n      // Hiển thị thông báo đang xử lý\n      enqueueSnackbar(\"Đang xử lý điểm danh thủ công...\", {\n        variant: \"info\"\n      });\n\n      // Gọi API điểm danh thủ công\n      const result = await dispatch(manualAttendance({\n        sessionId,\n        studentId: selectedStudent._id,\n        status: manualAttendanceData.status,\n        note: manualAttendanceData.note\n      })).unwrap();\n\n      // Nếu điểm danh thành công\n      if (result !== null && result !== void 0 && result.data) {\n        // Cập nhật logs điểm danh hiệu quả hơn\n        setAttendanceLogs(prevLogs => {\n          // Lọc bỏ log cũ của sinh viên nếu có\n          const filteredLogs = prevLogs.filter(log => log.student_id._id !== selectedStudent._id);\n          // Thêm log mới\n          return [...filteredLogs, {\n            ...result.data,\n            student_id: selectedStudent\n          }];\n        });\n        enqueueSnackbar(`Đã điểm danh ${manualAttendanceData.status === \"present\" ? \"có mặt\" : manualAttendanceData.status === \"absent\" ? \"vắng mặt\" : manualAttendanceData.status === \"late\" ? \"đi trễ\" : \"về sớm\"} cho ${selectedStudent.full_name}`, {\n          variant: \"success\"\n        });\n\n        // Đóng dialog\n        handleManualDialogClose();\n\n        // Cập nhật thông tin phiên\n        fetchSessionInfo();\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(\"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Đánh dấu điểm danh từ nhận diện khuôn mặt\n  const markAttendance = async (studentId, faceDescriptor, confidence, imageBase64) => {\n    try {\n      // Hiển thị thông báo đang xử lý\n      enqueueSnackbar(\"Đang xử lý điểm danh...\", {\n        variant: \"info\"\n      });\n\n      // Gọi API điểm danh qua Redux\n      const result = await dispatch(verifyAttendance({\n        sessionId,\n        studentId,\n        faceDescriptor,\n        confidence,\n        imageBase64\n      })).unwrap();\n\n      // Nếu điểm danh thành công\n      if (result !== null && result !== void 0 && result.data) {\n        // Tìm thông tin sinh viên\n        const student = classStudents.find(s => s._id === studentId);\n        if (student) {\n          // Cập nhật logs điểm danh hiệu quả hơn\n          setAttendanceLogs(prevLogs => {\n            // Lọc bỏ log cũ của sinh viên nếu có\n            const filteredLogs = prevLogs.filter(log => log.student_id._id !== studentId);\n            // Thêm log mới\n            return [...filteredLogs, {\n              ...result.data,\n              student_id: student\n            }];\n          });\n          enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n            variant: \"success\"\n          });\n        }\n\n        // Cập nhật thông tin phiên một cách bất đồng bộ\n        fetchSessionInfo();\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n      enqueueSnackbar(\"Lỗi khi xác nhận điểm danh\", {\n        variant: \"error\"\n      });\n      return false;\n    }\n  };\n\n  // Kết thúc phiên điểm danh\n  const completeSession = async () => {\n    try {\n      // Hiển thị thông báo đang xử lý\n      enqueueSnackbar(\"Đang kết thúc phiên điểm danh...\", {\n        variant: \"info\"\n      });\n\n      // Gọi API kết thúc phiên\n      await axios.put(`${API_URL}/attendance/sessions/${sessionId}`, {\n        status: \"completed\"\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc thành công\", {\n        variant: \"success\"\n      });\n\n      // Chuyển hướng về trang lớp học\n      setTimeout(() => {\n        navigate(`/teacher/classes/${classId}`);\n      }, 1000);\n    } catch (error) {\n      console.error(\"Lỗi khi kết thúc phiên điểm danh:\", error);\n      enqueueSnackbar(\"Lỗi khi kết thúc phiên điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Làm mới danh sách điểm danh\n  const refreshAttendanceLogs = async () => {\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu điểm danh...\", {\n        variant: \"info\"\n      });\n\n      // Tải song song dữ liệu logs và thông tin phiên\n      const [logsResponse, sessionResponse] = await Promise.all([axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      })]);\n\n      // Cập nhật state\n      setAttendanceLogs(logsResponse.data.data);\n      setSessionInfo(sessionResponse.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu điểm danh\", {\n        variant: \"success\"\n      });\n    } catch (error) {\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(\"Lỗi khi làm mới dữ liệu điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Tối ưu hàm lấy thông tin phiên\n  const fetchSessionInfo = async () => {\n    try {\n      const sessionResponse = await axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setSessionInfo(sessionResponse.data.data);\n      return sessionResponse.data.data;\n    } catch (error) {\n      console.error(\"Lỗi khi lấy thông tin phiên:\", error);\n      return null;\n    }\n  };\n\n  // Tối ưu hàm xử lý nhận diện khuôn mặt\n  const captureAndRecognize = async () => {\n    try {\n      setIsRecognizing(true);\n      enqueueSnackbar(\"Đang nhận diện khuôn mặt...\", {\n        variant: \"info\"\n      });\n\n      // Kiểm tra camera\n      if (!ensureCameraIsWorking()) {\n        enqueueSnackbar(\"Camera không hoạt động, vui lòng khởi động lại\", {\n          variant: \"error\"\n        });\n        setIsRecognizing(false);\n        return;\n      }\n\n      // Phát hiện khuôn mặt\n      const detections = await handleDetectFaces(false);\n\n      // Lọc phát hiện không hợp lệ\n      const validDetections = detections.filter(detection => {\n        var _detection$detection5;\n        const box = (_detection$detection5 = detection.detection) === null || _detection$detection5 === void 0 ? void 0 : _detection$detection5._box;\n        const descriptor = detection.descriptor;\n        return box && typeof box._x === \"number\" && !isNaN(box._x) && typeof box._y === \"number\" && !isNaN(box._y) && typeof box._width === \"number\" && !isNaN(box._width) && typeof box._height === \"number\" && !isNaN(box._height) && descriptor && Array.isArray(descriptor) && descriptor.length === 128;\n      });\n\n      // Kiểm tra phát hiện khuôn mặt\n      if (!validDetections || validDetections.length === 0) {\n        enqueueSnackbar(\"Không phát hiện khuôn mặt hợp lệ nào trong hình\", {\n          variant: \"warning\"\n        });\n        setIsRecognizing(false);\n        return;\n      }\n\n      // Xử lý nhận diện với dữ liệu sinh viên\n      if (!classStudents || classStudents.length === 0) {\n        enqueueSnackbar(\"Không có dữ liệu sinh viên để so sánh\", {\n          variant: \"error\"\n        });\n        setIsRecognizing(false);\n        return;\n      }\n\n      // Chụp ảnh từ webcam an toàn\n      let imageBase64 = null;\n      try {\n        if (webcamRef.current) {\n          imageBase64 = webcamRef.current.getScreenshot();\n        }\n      } catch (err) {\n        console.error(\"Lỗi khi chụp ảnh từ webcam:\", err);\n        // Tiếp tục xử lý mà không có ảnh\n      }\n\n      // Lấy descriptor của khuôn mặt phát hiện được\n      const faceDescriptor = validDetections[0].descriptor;\n\n      // So sánh với dữ liệu sinh viên\n      const matchResults = [];\n\n      // Tạo một mảng promises để xử lý song song các tính toán\n      const comparePromises = classStudents.map(async student => {\n        // Trích xuất descriptors từ sinh viên\n        const studentDescriptors = extractStudentDescriptors(student);\n        if (studentDescriptors.length === 0) return null;\n\n        // Tính độ tương đồng tốt nhất\n        let bestMatch = 0;\n        for (const descriptor of studentDescriptors) {\n          try {\n            // Kiểm tra descriptor có hợp lệ không\n            if (!Array.isArray(descriptor) || descriptor.length !== 128 || descriptor.some(val => typeof val !== \"number\" || isNaN(val))) {\n              continue;\n            }\n            const distance = faceapi.euclideanDistance(faceDescriptor, descriptor);\n            const similarity = Math.max(0, 1 - distance);\n            bestMatch = Math.max(bestMatch, similarity);\n          } catch (error) {\n            // Bỏ qua lỗi và tiếp tục với descriptor tiếp theo\n          }\n        }\n        return {\n          studentId: student._id,\n          name: student.full_name,\n          confidence: bestMatch,\n          studentCode: student.student_code\n        };\n      });\n\n      // Đợi tất cả tính toán hoàn thành và lọc kết quả null\n      const results = (await Promise.all(comparePromises)).filter(result => result !== null);\n\n      // Sắp xếp kết quả theo độ tương đồng\n      results.sort((a, b) => b.confidence - a.confidence);\n      matchResults.push(...results);\n\n      // Lọc kết quả theo ngưỡng\n      const filteredResults = matchResults.filter(r => r.confidence > RECOGNITION_THRESHOLD);\n\n      // Cập nhật danh sách sinh viên được nhận diện\n      dispatch(setRecognizedStudents(filteredResults));\n\n      // Hiển thị kết quả\n      if (matchResults.length > 0) {\n        const topMatches = matchResults.slice(0, 3);\n        if (filteredResults.length > 0) {\n          const topMatch = filteredResults[0];\n          enqueueSnackbar(`Đã nhận diện: ${topMatch.name} (${Math.round(topMatch.confidence * 100)}%)`, {\n            variant: \"success\"\n          });\n\n          // Tự động điểm danh nếu độ tin cậy cao\n          if (topMatch.confidence > CONFIDENCE_THRESHOLD) {\n            handleMarkAttendance(topMatch.studentId, topMatch.confidence);\n          }\n        } else {\n          const matchDetails = topMatches.map(m => `${m.name}: ${(m.confidence * 100).toFixed(1)}%`).join(\", \");\n          enqueueSnackbar(`Không nhận diện được sinh viên nào vượt ngưỡng. Gần nhất: ${matchDetails}`, {\n            variant: \"warning\"\n          });\n        }\n      } else {\n        enqueueSnackbar(\"Không nhận diện được sinh viên nào\", {\n          variant: \"warning\"\n        });\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi nhận diện khuôn mặt:\", error);\n      enqueueSnackbar(`Lỗi khi nhận diện: ${error.message}`, {\n        variant: \"error\"\n      });\n    } finally {\n      setIsRecognizing(false);\n    }\n  };\n\n  // Tối ưu hàm đánh dấu điểm danh\n  const handleMarkAttendance = async (studentId, confidence) => {\n    // Kiểm tra xem sinh viên đã được điểm danh chưa\n    const isAlreadyAttended = attendanceLogs.some(log => log.student_id._id === studentId && log.status === \"present\");\n    if (isAlreadyAttended) return;\n    try {\n      var _webcamRef$current6;\n      // Chụp ảnh từ video element\n      const videoElement = isAutoMode ? videoRef.current : (_webcamRef$current6 = webcamRef.current) === null || _webcamRef$current6 === void 0 ? void 0 : _webcamRef$current6.video;\n      if (!videoElement) return;\n      let imageBase64 = null;\n\n      // Tạo ảnh chụp\n      if (!isAutoMode && webcamRef.current) {\n        imageBase64 = webcamRef.current.getScreenshot();\n      } else if (isAutoMode && videoElement) {\n        // Tạo canvas để chụp từ video\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = videoElement.videoWidth;\n        canvas.height = videoElement.videoHeight;\n        const ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(videoElement, 0, 0);\n        imageBase64 = canvas.toDataURL(\"image/jpeg\");\n      }\n\n      // Tìm sinh viên trong danh sách\n      const student = classStudents.find(s => s._id === studentId);\n      if (!student) return;\n\n      // Trích xuất descriptor\n      const descriptors = extractStudentDescriptors(student);\n      const descriptor = descriptors.length > 0 ? descriptors[0] : null;\n\n      // Gọi API điểm danh\n      await markAttendance(studentId, descriptor, confidence, imageBase64);\n    } catch (error) {\n      console.error(\"Lỗi khi đánh dấu điểm danh:\", error);\n      enqueueSnackbar(\"Lỗi khi đánh dấu điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Bật/tắt hiển thị landmark trên khuôn mặt\n  const toggleLandmarkDetection = () => {\n    const newState = !showLandmark;\n    setShowLandmark(newState);\n\n    // Bắt đầu hoặc dừng interval landmark detection\n    if (newState) {\n      startLandmarkDetection();\n    } else if (landmarkIntervalId) {\n      clearInterval(landmarkIntervalId);\n      setLandmarkIntervalId(null);\n\n      // Xóa canvas khi tắt landmarks\n      const canvasElement = canvasRef.current;\n      if (canvasElement) {\n        const ctx = canvasElement.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n      }\n    }\n  };\n\n  // Thêm hàm debug để kiểm tra cấu trúc dữ liệu khuôn mặt\n  const debugFaceFeatures = () => {\n    if (!classStudents || classStudents.length === 0) {\n      console.log(\"[DEBUG] Không có sinh viên nào để kiểm tra dữ liệu khuôn mặt\");\n      return;\n    }\n    classStudents.forEach((student, index) => {\n      console.log(`[DEBUG] Sinh viên #${index + 1}: ${student.full_name}`);\n\n      // Kiểm tra dữ liệu faceFeatures\n      if (student.faceFeatures) {\n        console.log(`  - Có dữ liệu faceFeatures`);\n\n        // Kiểm tra descriptors\n        if (student.faceFeatures.descriptors) {\n          console.log(`  - Có descriptors: ${student.faceFeatures.descriptors.length} nhóm`);\n          student.faceFeatures.descriptors.forEach((group, groupIndex) => {\n            if (Array.isArray(group)) {\n              console.log(`    - Nhóm #${groupIndex + 1}: ${group.length} descriptors`);\n              group.forEach((descriptor, descIndex) => {\n                if (Array.isArray(descriptor)) {\n                  console.log(`      - Descriptor #${descIndex + 1}: ${descriptor.length} phần tử`);\n                } else {\n                  console.log(`      - Descriptor #${descIndex + 1}: Không phải mảng`);\n                }\n              });\n            } else {\n              console.log(`    - Nhóm #${groupIndex + 1}: Không phải mảng`);\n            }\n          });\n        } else {\n          console.log(`  - Không có dữ liệu descriptors`);\n        }\n      } else {\n        console.log(`  - Không có dữ liệu faceFeatures`);\n      }\n\n      // Kiểm tra dữ liệu cũ (faceDescriptors)\n      if (student.faceDescriptors) {\n        console.log(`  - Có dữ liệu faceDescriptors (cấu trúc cũ): ${student.faceDescriptors.length} descriptors`);\n      }\n    });\n  };\n\n  // Tối ưu chế độ tự động điểm danh\n  const startAutoAttendance = () => {\n    // Dừng interval cũ nếu có\n    if (intervalId) {\n      clearInterval(intervalId);\n    }\n\n    // Hiển thị thông báo bắt đầu\n    enqueueSnackbar(\"Đã bật chế độ tự động điểm danh\", {\n      variant: \"success\"\n    });\n\n    // Thiết lập thời gian phát hiện ban đầu\n    setLastDetectionTime(Date.now());\n\n    // Khởi tạo interval mới để điểm danh tự động\n    const id = setInterval(async () => {\n      // Chỉ xử lý nếu camera đã sẵn sàng\n      if (isCameraReady) {\n        try {\n          // Phát hiện khuôn mặt\n          const detections = await handleDetectFaces(false);\n\n          // Nếu đã phát hiện khuôn mặt và có descriptor\n          if (detections && detections.length > 0 && detections[0].descriptor) {\n            // Nhận diện và điểm danh tự động\n            await processAutoRecognition(detections);\n          }\n        } catch (error) {\n          console.error(\"Lỗi trong quá trình điểm danh tự động:\", error);\n        }\n      }\n    }, AUTO_DETECT_INTERVAL);\n\n    // Lưu interval ID để có thể dừng sau này\n    setIntervalId(id);\n    setIsAutoMode(true);\n  };\n\n  // Hàm dừng chế độ tự động điểm danh\n  const stopAutoAttendance = () => {\n    if (intervalId) {\n      clearInterval(intervalId);\n      setIntervalId(null);\n    }\n    setIsAutoMode(false);\n    enqueueSnackbar(\"Đã tắt chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n  };\n\n  // Hàm xử lý nhận diện tự động\n  const processAutoRecognition = async detections => {\n    try {\n      var _webcamRef$current7;\n      // Lọc kết quả không hợp lệ\n      const validDetections = detections.filter(detection => {\n        var _detection$detection6;\n        const box = (_detection$detection6 = detection.detection) === null || _detection$detection6 === void 0 ? void 0 : _detection$detection6._box;\n        const descriptor = detection.descriptor;\n        return box && typeof box._x === \"number\" && !isNaN(box._x) && typeof box._y === \"number\" && !isNaN(box._y) && typeof box._width === \"number\" && !isNaN(box._width) && typeof box._height === \"number\" && !isNaN(box._height) && descriptor && Array.isArray(descriptor) && descriptor.length === 128;\n      });\n      if (validDetections.length === 0) {\n        console.warn(\"Không có khuôn mặt hợp lệ để nhận diện tự động\");\n        return;\n      }\n\n      // Lấy descriptor khuôn mặt đầu tiên được phát hiện\n      const faceDescriptor = validDetections[0].descriptor;\n\n      // Kiểm tra có lớp học và sinh viên không\n      if (!classStudents || classStudents.length === 0) {\n        return;\n      }\n\n      // Lấy ảnh từ camera\n      const videoElement = isAutoMode ? videoRef.current : (_webcamRef$current7 = webcamRef.current) === null || _webcamRef$current7 === void 0 ? void 0 : _webcamRef$current7.video;\n      if (!videoElement || videoElement.readyState !== 4) {\n        console.warn(\"Video chưa sẵn sàng để chụp\");\n        return;\n      }\n      let imageBase64 = null;\n      try {\n        // Chụp ảnh từ video element\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = videoElement.videoWidth;\n        canvas.height = videoElement.videoHeight;\n        if (canvas.width === 0 || canvas.height === 0) {\n          console.warn(\"Kích thước video không hợp lệ:\", canvas.width, canvas.height);\n          return;\n        }\n        const ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(videoElement, 0, 0);\n        imageBase64 = canvas.toDataURL(\"image/jpeg\");\n      } catch (err) {\n        console.error(\"Lỗi khi chụp ảnh từ video:\", err);\n        // Tiếp tục xử lý dù không có ảnh\n      }\n\n      // Tạo một mảng promises để xử lý song song các tính toán\n      const comparePromises = classStudents.map(async student => {\n        // Trích xuất descriptors từ sinh viên\n        const studentDescriptors = extractStudentDescriptors(student);\n        if (studentDescriptors.length === 0) return null;\n\n        // Tính độ tương đồng tốt nhất\n        let bestMatch = 0;\n        for (const descriptor of studentDescriptors) {\n          try {\n            // Kiểm tra descriptor có hợp lệ không\n            if (!Array.isArray(descriptor) || descriptor.length !== 128 || descriptor.some(val => typeof val !== \"number\" || isNaN(val))) {\n              continue;\n            }\n            const distance = faceapi.euclideanDistance(faceDescriptor, descriptor);\n            const similarity = Math.max(0, 1 - distance);\n            bestMatch = Math.max(bestMatch, similarity);\n          } catch (error) {\n            // Bỏ qua lỗi và tiếp tục với descriptor tiếp theo\n          }\n        }\n        return {\n          studentId: student._id,\n          name: student.full_name,\n          confidence: bestMatch,\n          studentCode: student.student_code\n        };\n      });\n\n      // Đợi tất cả tính toán hoàn thành và lọc kết quả null\n      const results = (await Promise.all(comparePromises)).filter(result => result !== null);\n\n      // Sắp xếp kết quả theo độ tương đồng\n      results.sort((a, b) => b.confidence - a.confidence);\n\n      // Lọc kết quả theo ngưỡng\n      const filteredResults = results.filter(r => r.confidence > RECOGNITION_THRESHOLD);\n\n      // Cập nhật danh sách sinh viên được nhận diện\n      dispatch(setRecognizedStudents(filteredResults));\n\n      // Nếu có kết quả vượt ngưỡng tin cậy, tự động điểm danh\n      if (filteredResults.length > 0) {\n        const topMatch = filteredResults[0];\n        if (topMatch.confidence > CONFIDENCE_THRESHOLD) {\n          // Kiểm tra sinh viên đã được điểm danh chưa\n          const isAlreadyAttended = attendanceLogs.some(log => log.student_id._id === topMatch.studentId && log.status === \"present\");\n          if (!isAlreadyAttended) {\n            // Đánh dấu điểm danh cho sinh viên\n            await handleMarkAttendance(topMatch.studentId, topMatch.confidence);\n\n            // Hiển thị thông báo thành công\n            enqueueSnackbar(`Đã tự động điểm danh cho ${topMatch.name} (${Math.round(topMatch.confidence * 100)}%)`, {\n              variant: \"success\"\n            });\n          }\n        }\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi xử lý nhận diện tự động:\", error);\n    }\n  };\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      minHeight: \"60vh\",\n      children: /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2161,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2155,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Lấy danh sách sinh viên vắng mặt\n  const getAbsentStudents = () => {\n    if (!classInfo || !classInfo.students || !attendanceLogs) return [];\n\n    // Tạo Set các ID sinh viên đã điểm danh để tăng tốc độ tìm kiếm\n    const presentStudentIds = new Set(attendanceLogs.filter(log => log.status === \"present\").map(log => log.student_id._id));\n\n    // Lọc ra sinh viên chưa điểm danh\n    return classInfo.students.filter(student => !presentStudentIds.has(student._id));\n  };\n  const absentStudents = getAbsentStudents();\n\n  // Điểm danh thủ công trong chế độ đơn giản\n  const showStudentList = () => {\n    if (!classInfo) {\n      enqueueSnackbar(\"Không có thông tin lớp học\", {\n        variant: \"error\"\n      });\n      return;\n    }\n\n    // Lấy danh sách sinh viên vắng mặt\n    const absentStudents = getAbsentStudents();\n    if (absentStudents.length === 0) {\n      enqueueSnackbar(\"Tất cả sinh viên đã được điểm danh\", {\n        variant: \"success\"\n      });\n      return;\n    }\n\n    // Mở dialog điểm danh thủ công với sinh viên đầu tiên trong danh sách\n    if (absentStudents.length > 0 && absentStudents[0]) {\n      openManualAttendanceDialog(absentStudents[0]);\n    }\n  };\n\n  // Tối ưu phần Webcam và Camera\n  const VideoDisplay = ({\n    isCameraReady,\n    isAutoMode,\n    webcamRef,\n    videoRef,\n    canvasRef,\n    onUserMedia,\n    onUserMediaError\n  }) => {\n    // Component con để xử lý hiển thị video\n    return /*#__PURE__*/_jsxDEV(Paper, {\n      elevation: 3,\n      sx: {\n        position: \"relative\",\n        width: \"100%\",\n        height: \"400px\",\n        display: \"flex\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        overflow: \"hidden\",\n        mb: 2,\n        borderRadius: \"8px\",\n        border: \"1px solid rgba(0, 0, 0, 0.12)\"\n      },\n      children: isCameraReady ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [isAutoMode ?\n        /*#__PURE__*/\n        // Video element cho chế độ tự động\n        _jsxDEV(\"video\", {\n          ref: videoRef,\n          style: {\n            position: \"absolute\",\n            width: \"100%\",\n            height: \"100%\",\n            objectFit: \"cover\"\n          },\n          autoPlay: true,\n          playsInline: true,\n          muted: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2239,\n          columnNumber: 15\n        }, this) :\n        /*#__PURE__*/\n        // Webcam component cho chế độ thủ công\n        _jsxDEV(Webcam, {\n          audio: false,\n          ref: webcamRef,\n          screenshotFormat: \"image/jpeg\",\n          width: 640,\n          height: 480,\n          videoConstraints: {\n            width: 640,\n            height: 480,\n            facingMode: \"user\"\n          },\n          style: {\n            position: \"absolute\",\n            width: \"100%\",\n            height: \"100%\",\n            objectFit: \"cover\"\n          },\n          onUserMedia: onUserMedia,\n          onUserMediaError: onUserMediaError\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2253,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n          ref: canvasRef,\n          style: {\n            position: \"absolute\",\n            top: 0,\n            left: 0,\n            width: \"100%\",\n            height: \"100%\",\n            objectFit: \"cover\",\n            zIndex: 10\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2276,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            position: \"absolute\",\n            bottom: 10,\n            right: 10,\n            backgroundColor: \"rgba(0,0,0,0.6)\",\n            color: \"white\",\n            padding: \"4px 8px\",\n            borderRadius: \"4px\",\n            fontSize: \"12px\",\n            display: \"flex\",\n            alignItems: \"center\",\n            zIndex: 20\n          },\n          children: isAutoMode ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                color: \"#4CAF50\",\n                marginRight: \"5px\"\n              },\n              children: \"\\u25CF\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2307,\n              columnNumber: 19\n            }, this), \"\\u0110ang t\\u1EF1 \\u0111\\u1ED9ng \\u0111i\\u1EC3m danh\"]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                color: \"#FFC107\",\n                marginRight: \"5px\"\n              },\n              children: \"\\u25CF\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2314,\n              columnNumber: 19\n            }, this), \"Ch\\u1EBF \\u0111\\u1ED9 th\\u1EE7 c\\xF4ng\"]\n          }, void 0, true)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2290,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(CameraLoadingPlaceholder, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2323,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2220,\n      columnNumber: 7\n    }, this);\n  };\n\n  // Tối ưu giao diện hiển thị danh sách sinh viên đã điểm danh\n  const PresentStudentsList = ({\n    attendanceLogs,\n    refreshAttendanceLogs,\n    totalStudents\n  }) => /*#__PURE__*/_jsxDEV(Card, {\n    sx: {\n      mb: 3,\n      borderRadius: \"10px\",\n      boxShadow: \"0 2px 8px rgba(0,0,0,0.08)\"\n    },\n    children: /*#__PURE__*/_jsxDEV(CardContent, {\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        mb: 2,\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          alignItems: \"center\",\n          children: [/*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              width: 10,\n              height: 10,\n              borderRadius: \"50%\",\n              backgroundColor: \"#4CAF50\",\n              mr: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2350,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"h6\",\n            children: [\"C\\xF3 m\\u1EB7t (\", attendanceLogs.filter(log => log.status === \"present\").length, \"/\", totalStudents, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2359,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2349,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n          title: \"L\\xE0m m\\u1EDBi danh s\\xE1ch \\u0111i\\u1EC3m danh\",\n          children: /*#__PURE__*/_jsxDEV(IconButton, {\n            size: \"small\",\n            onClick: refreshAttendanceLogs,\n            sx: {\n              backgroundColor: \"#f4f4f4\",\n              \"&:hover\": {\n                backgroundColor: \"#e0e0e0\"\n              }\n            },\n            children: /*#__PURE__*/_jsxDEV(Refresh, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2374,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2366,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2365,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2343,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          maxHeight: \"350px\",\n          overflow: \"auto\",\n          pr: 1\n        },\n        children: attendanceLogs.filter(log => log.status === \"present\").length === 0 ? /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            display: \"flex\",\n            flexDirection: \"column\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            py: 4,\n            color: \"text.secondary\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(HourglassEmpty, {\n            sx: {\n              fontSize: 40,\n              mb: 1,\n              opacity: 0.5\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2392,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body2\",\n            children: \"Ch\\u01B0a c\\xF3 sinh vi\\xEAn n\\xE0o \\u0111i\\u1EC3m danh\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2393,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2382,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(List, {\n          dense: true,\n          children: attendanceLogs.filter(log => log.status === \"present\").sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).map(log => /*#__PURE__*/_jsxDEV(Paper, {\n            elevation: 0,\n            sx: {\n              mb: 1,\n              borderRadius: \"8px\",\n              backgroundColor: \"#f9f9f9\",\n              overflow: \"hidden\"\n            },\n            children: /*#__PURE__*/_jsxDEV(ListItem, {\n              secondaryAction: /*#__PURE__*/_jsxDEV(Chip, {\n                size: \"small\",\n                icon: log.recognized ? /*#__PURE__*/_jsxDEV(VerifiedUser, {\n                  fontSize: \"small\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2419,\n                  columnNumber: 31\n                }, this) : null,\n                label: log.recognized ? \"Tự động\" : \"Thủ công\",\n                color: log.recognized ? \"success\" : \"primary\",\n                sx: {\n                  borderRadius: \"4px\",\n                  \"& .MuiChip-label\": {\n                    px: 1\n                  }\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2415,\n                columnNumber: 25\n              }, this),\n              children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                children: /*#__PURE__*/_jsxDEV(Avatar, {\n                  alt: log.student_id.full_name,\n                  src: log.student_id.avatar_url,\n                  sx: {\n                    border: \"2px solid #f0f0f0\",\n                    bgcolor: log.recognized ? \"#e8f5e9\" : \"#e3f2fd\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2432,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2431,\n                columnNumber: 23\n              }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                primary: /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  fontWeight: 500,\n                  children: log.student_id.full_name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2443,\n                  columnNumber: 27\n                }, this),\n                secondary: /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"caption\",\n                  color: \"text.secondary\",\n                  children: [new Date(log.timestamp).toLocaleTimeString(\"vi-VN\"), log.note && ` • ${log.note}`]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2448,\n                  columnNumber: 27\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2441,\n                columnNumber: 23\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2413,\n              columnNumber: 21\n            }, this)\n          }, log._id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2403,\n            columnNumber: 19\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2398,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2379,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2342,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 2335,\n    columnNumber: 5\n  }, this);\n\n  // Tối ưu giao diện hiển thị danh sách sinh viên vắng mặt\n  const AbsentStudentsList = ({\n    absentStudents,\n    onOpenManualAttendance,\n    totalStudents\n  }) => /*#__PURE__*/_jsxDEV(Card, {\n    sx: {\n      borderRadius: \"10px\",\n      boxShadow: \"0 2px 8px rgba(0,0,0,0.08)\"\n    },\n    children: /*#__PURE__*/_jsxDEV(CardContent, {\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        alignItems: \"center\",\n        mb: 2,\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            width: 10,\n            height: 10,\n            borderRadius: \"50%\",\n            backgroundColor: \"#f44336\",\n            mr: 1\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2477,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h6\",\n          children: [\"V\\u1EAFng m\\u1EB7t (\", absentStudents.length, \"/\", totalStudents, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2486,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2476,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          maxHeight: \"350px\",\n          overflow: \"auto\",\n          pr: 1\n        },\n        children: absentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            display: \"flex\",\n            flexDirection: \"column\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            py: 4,\n            color: \"text.secondary\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(Check, {\n            sx: {\n              fontSize: 40,\n              mb: 1,\n              opacity: 0.5\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2503,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body2\",\n            children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 \\u0111\\u01B0\\u1EE3c \\u0111i\\u1EC3m danh\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2504,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2493,\n          columnNumber: 13\n        }, this) : /*#__PURE__*/_jsxDEV(List, {\n          dense: true,\n          children: absentStudents.map(student => /*#__PURE__*/_jsxDEV(Paper, {\n            elevation: 0,\n            sx: {\n              mb: 1,\n              borderRadius: \"8px\",\n              backgroundColor: \"#f9f9f9\",\n              overflow: \"hidden\",\n              transition: \"all 0.2s\",\n              \"&:hover\": {\n                backgroundColor: \"#f0f0f0\"\n              }\n            },\n            children: /*#__PURE__*/_jsxDEV(ListItem, {\n              secondaryAction: /*#__PURE__*/_jsxDEV(Tooltip, {\n                title: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\",\n                children: /*#__PURE__*/_jsxDEV(IconButton, {\n                  edge: \"end\",\n                  onClick: () => onOpenManualAttendance(student),\n                  size: \"small\",\n                  sx: {\n                    backgroundColor: \"#e0e0e0\",\n                    \"&:hover\": {\n                      backgroundColor: \"#bdbdbd\"\n                    }\n                  },\n                  children: /*#__PURE__*/_jsxDEV(Edit, {\n                    fontSize: \"small\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 2537,\n                    columnNumber: 27\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2528,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2527,\n                columnNumber: 23\n              }, this),\n              children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                children: /*#__PURE__*/_jsxDEV(Avatar, {\n                  alt: student.full_name,\n                  src: student.avatar_url,\n                  sx: {\n                    border: \"2px solid #f0f0f0\",\n                    filter: \"grayscale(0.5)\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2543,\n                  columnNumber: 23\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2542,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                primary: /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  fontWeight: 500,\n                  children: student.full_name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2554,\n                  columnNumber: 25\n                }, this),\n                secondary: /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"caption\",\n                  color: \"text.secondary\",\n                  children: student.student_code\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2559,\n                  columnNumber: 25\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2552,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2525,\n              columnNumber: 19\n            }, this)\n          }, student._id, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2511,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2509,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2491,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2475,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 2472,\n    columnNumber: 5\n  }, this);\n\n  // Tối ưu dialog điểm danh thủ công\n  const ManualAttendanceDialog = ({\n    open,\n    onClose,\n    student,\n    attendanceData,\n    onAttendanceChange,\n    onSubmit\n  }) => /*#__PURE__*/_jsxDEV(Dialog, {\n    open: open,\n    onClose: onClose,\n    maxWidth: \"sm\",\n    fullWidth: true,\n    PaperProps: {\n      sx: {\n        borderRadius: \"12px\",\n        overflow: \"hidden\"\n      }\n    },\n    children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n      sx: {\n        bgcolor: \"#f5f5f5\",\n        py: 2\n      },\n      children: /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        fontWeight: 500,\n        children: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2596,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2595,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n      dividers: true,\n      children: /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          p: 1\n        },\n        children: [student && /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          alignItems: \"center\",\n          mb: 3,\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            src: student.avatar_url,\n            alt: student.full_name,\n            sx: {\n              width: 56,\n              height: 56,\n              mr: 2\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2604,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h6\",\n              gutterBottom: true,\n              children: student.full_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2610,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              color: \"text.secondary\",\n              children: [\"MSSV: \", student.student_code]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2613,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2609,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2603,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n          fullWidth: true,\n          margin: \"normal\",\n          children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n            children: \"Tr\\u1EA1ng th\\xE1i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2621,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Select, {\n            name: \"status\",\n            value: attendanceData.status,\n            onChange: onAttendanceChange,\n            label: \"Tr\\u1EA1ng th\\xE1i\",\n            children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"present\",\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: \"flex\",\n                  alignItems: \"center\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(Check, {\n                  sx: {\n                    color: \"#4CAF50\",\n                    mr: 1\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2630,\n                  columnNumber: 19\n                }, this), \"C\\xF3 m\\u1EB7t\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2629,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2628,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"absent\",\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: \"flex\",\n                  alignItems: \"center\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(Close, {\n                  sx: {\n                    color: \"#F44336\",\n                    mr: 1\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2636,\n                  columnNumber: 19\n                }, this), \"V\\u1EAFng m\\u1EB7t\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2635,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2634,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"late\",\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: \"flex\",\n                  alignItems: \"center\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(HourglassEmpty, {\n                  sx: {\n                    color: \"#FFC107\",\n                    mr: 1\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2642,\n                  columnNumber: 19\n                }, this), \"\\u0110i tr\\u1EC5\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2641,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2640,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"early_leave\",\n              children: /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  display: \"flex\",\n                  alignItems: \"center\"\n                },\n                children: [/*#__PURE__*/_jsxDEV(HourglassEmpty, {\n                  sx: {\n                    color: \"#FF9800\",\n                    mr: 1\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2648,\n                  columnNumber: 19\n                }, this), \"V\\u1EC1 s\\u1EDBm\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2647,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2646,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2622,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2620,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TextField, {\n          fullWidth: true,\n          margin: \"normal\",\n          name: \"note\",\n          label: \"Ghi ch\\xFA\",\n          value: attendanceData.note,\n          onChange: onAttendanceChange,\n          multiline: true,\n          rows: 2,\n          placeholder: \"Nh\\u1EADp ghi ch\\xFA (n\\u1EBFu c\\xF3)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2655,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2601,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2600,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n      sx: {\n        px: 3,\n        py: 2\n      },\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        onClick: onClose,\n        variant: \"outlined\",\n        startIcon: /*#__PURE__*/_jsxDEV(Close, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2669,\n          columnNumber: 65\n        }, this),\n        children: \"H\\u1EE7y\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2669,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        onClick: onSubmit,\n        variant: \"contained\",\n        color: \"primary\",\n        startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2676,\n          columnNumber: 22\n        }, this),\n        children: \"X\\xE1c nh\\u1EADn\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2672,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2668,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 2583,\n    columnNumber: 5\n  }, this);\n\n  // Tối ưu phần hiển thị camera placeholder với hướng dẫn rõ ràng hơn\n  const CameraLoadingPlaceholder = () => /*#__PURE__*/_jsxDEV(Box, {\n    display: \"flex\",\n    flexDirection: \"column\",\n    alignItems: \"center\",\n    py: 4,\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        width: 80,\n        height: 80,\n        borderRadius: \"50%\",\n        backgroundColor: \"#e3f2fd\",\n        display: \"flex\",\n        alignItems: \"center\",\n        justifyContent: \"center\",\n        mb: 3\n      },\n      children: /*#__PURE__*/_jsxDEV(CameraAlt, {\n        sx: {\n          fontSize: 40,\n          color: \"#2196f3\"\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2699,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2687,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h6\",\n      gutterBottom: true,\n      align: \"center\",\n      fontWeight: 500,\n      children: \"S\\u1EB5n s\\xE0ng \\u0111i\\u1EC3m danh\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2702,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"body2\",\n      color: \"textSecondary\",\n      align: \"center\",\n      paragraph: true,\n      sx: {\n        maxWidth: 400\n      },\n      children: \"Nh\\u1EA5n n\\xFAt b\\xEAn d\\u01B0\\u1EDBi \\u0111\\u1EC3 kh\\u1EDFi \\u0111\\u1ED9ng camera v\\xE0 b\\u1EAFt \\u0111\\u1EA7u qu\\xE1 tr\\xECnh \\u0111i\\u1EC3m danh\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2706,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Button, {\n      variant: \"contained\",\n      color: \"primary\",\n      size: \"large\",\n      onClick: initDirectCamera,\n      startIcon: /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2721,\n        columnNumber: 20\n      }, this),\n      sx: {\n        mt: 2,\n        mb: 3,\n        px: 3,\n        borderRadius: \"24px\"\n      },\n      children: \"B\\u1EAFt \\u0111\\u1EA7u \\u0111i\\u1EC3m danh\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 2716,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      variant: \"outlined\",\n      sx: {\n        maxWidth: 500\n      },\n      icon: /*#__PURE__*/_jsxDEV(Info, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2731,\n        columnNumber: 15\n      }, this),\n      children: [/*#__PURE__*/_jsxDEV(AlertTitle, {\n        children: \"L\\u01B0u \\xFD khi s\\u1EED d\\u1EE5ng camera\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2733,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body2\",\n        component: \"div\",\n        children: /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: [/*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u0110\\u1EA3m b\\u1EA3o b\\u1EA1n \\u0111\\xE3 c\\u1EA5p quy\\u1EC1n truy c\\u1EADp camera cho tr\\xECnh duy\\u1EC7t\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2736,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"\\u0110i\\u1EC1u ch\\u1EC9nh \\xE1nh s\\xE1ng \\u0111\\u1EA7y \\u0111\\u1EE7 \\u0111\\u1EC3 t\\u0103ng \\u0111\\u1ED9 ch\\xEDnh x\\xE1c nh\\u1EADn di\\u1EC7n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2737,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Camera s\\u1EBD t\\u1EF1 \\u0111\\u1ED9ng nh\\u1EADn di\\u1EC7n khu\\xF4n m\\u1EB7t trong ch\\u1EBF \\u0111\\u1ED9 t\\u1EF1 \\u0111\\u1ED9ng\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2738,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"C\\xF3 th\\u1EC3 \\u0111i\\u1EC3m danh th\\u1EE7 c\\xF4ng n\\u1EBFu g\\u1EB7p v\\u1EA5n \\u0111\\u1EC1 v\\u1EDBi camera\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2739,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n            children: \"Nh\\u1EA5n \\\"Ch\\u1EE5p & Nh\\u1EADn di\\u1EC7n\\\" \\u0111\\u1EC3 \\u0111i\\u1EC3m danh th\\u1EE7 c\\xF4ng t\\u1EEBng sinh vi\\xEAn\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2740,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2735,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2734,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        justifyContent: \"flex-end\",\n        mt: 1,\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"outlined\",\n          color: \"warning\",\n          size: \"small\",\n          onClick: showStudentList,\n          startIcon: /*#__PURE__*/_jsxDEV(Edit, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2751,\n            columnNumber: 24\n          }, this),\n          children: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2746,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2745,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2727,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 2686,\n    columnNumber: 5\n  }, this);\n\n  // Component hiển thị danh sách sinh viên đã nhận diện\n  const RecognizedStudentsList = ({\n    students,\n    onMarkAttendance\n  }) => {\n    if (students.length === 0) return null;\n    return /*#__PURE__*/_jsxDEV(Box, {\n      mt: 2,\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        display: \"flex\",\n        alignItems: \"center\",\n        mb: 1,\n        children: [/*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            width: 10,\n            height: 10,\n            borderRadius: \"50%\",\n            backgroundColor: \"#4CAF50\",\n            mr: 1\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2767,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          fontWeight: \"500\",\n          children: [\"\\u0110\\xE3 nh\\u1EADn di\\u1EC7n (\", students.length, \")\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2776,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2766,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        container: true,\n        spacing: 2,\n        children: students.map((student, index) => /*#__PURE__*/_jsxDEV(Grid, {\n          item: true,\n          xs: 6,\n          sm: 4,\n          md: 3,\n          children: /*#__PURE__*/_jsxDEV(Paper, {\n            elevation: 2,\n            sx: {\n              p: 1.5,\n              display: \"flex\",\n              flexDirection: \"column\",\n              alignItems: \"center\",\n              borderRadius: \"8px\",\n              transition: \"all 0.2s\",\n              \"&:hover\": {\n                transform: \"translateY(-3px)\",\n                boxShadow: \"0 4px 10px rgba(0,0,0,0.1)\"\n              }\n            },\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              fontWeight: \"500\",\n              align: \"center\",\n              noWrap: true,\n              children: student.name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2799,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                width: \"100%\",\n                mt: 1,\n                mb: 1,\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\"\n              },\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  width: \"100%\",\n                  height: 6,\n                  backgroundColor: \"#eee\",\n                  borderRadius: 3,\n                  position: \"relative\"\n                },\n                children: /*#__PURE__*/_jsxDEV(Box, {\n                  sx: {\n                    position: \"absolute\",\n                    left: 0,\n                    top: 0,\n                    height: \"100%\",\n                    width: `${Math.round(student.confidence * 100)}%`,\n                    backgroundColor: student.confidence > 0.7 ? \"#4CAF50\" : student.confidence > 0.6 ? \"#8BC34A\" : student.confidence > 0.5 ? \"#FFC107\" : \"#FF9800\",\n                    borderRadius: 3,\n                    transition: \"width 0.4s\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2827,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2818,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"caption\",\n                color: \"textSecondary\",\n                sx: {\n                  ml: 1,\n                  minWidth: \"36px\"\n                },\n                children: [Math.round(student.confidence * 100), \"%\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2847,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2808,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              size: \"small\",\n              variant: \"contained\",\n              color: \"primary\",\n              fullWidth: true,\n              onClick: () => onMarkAttendance(student.studentId, student.confidence),\n              startIcon: /*#__PURE__*/_jsxDEV(Check, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 2864,\n                columnNumber: 30\n              }, this),\n              sx: {\n                mt: 0.5\n              },\n              children: \"\\u0110i\\u1EC3m danh\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 2856,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 2784,\n            columnNumber: 15\n          }, this)\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2783,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2781,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2765,\n      columnNumber: 7\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      position: \"relative\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      mb: 2.5,\n      sx: {\n        borderBottom: \"1px solid #eaeaea\",\n        pb: 2\n      },\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          fontWeight: 500,\n          children: [\"\\u0110i\\u1EC3m Danh - \", classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2890,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          color: \"textSecondary\",\n          children: [\"Bu\\u1ED5i \", sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.session_number, \" -\", \" \", new Date(sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.date).toLocaleDateString(\"vi-VN\")]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2893,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 2889,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        startIcon: /*#__PURE__*/_jsxDEV(ArrowBack, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2900,\n          columnNumber: 22\n        }, this),\n        onClick: () => navigate(`/teacher/classes/${classId}`),\n        sx: {\n          borderRadius: \"8px\"\n        },\n        children: \"Quay l\\u1EA1i\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2898,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2879,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 3,\n      mt: 0.5,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 8,\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: \"0 2px 8px rgba(0,0,0,0.08)\",\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(CardContent, {\n            sx: {\n              bgcolor: \"#f8f9fa\",\n              borderBottom: \"1px solid #eaeaea\",\n              pb: 2\n            },\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(Box, {\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(CameraAlt, {\n                  fontSize: \"small\",\n                  sx: {\n                    color: \"#1976d2\",\n                    mr: 1\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2930,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"h6\",\n                  fontWeight: 500,\n                  children: \"Camera nh\\u1EADn di\\u1EC7n\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2934,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2929,\n                columnNumber: 17\n              }, this), isCameraReady && /*#__PURE__*/_jsxDEV(Box, {\n                children: [/*#__PURE__*/_jsxDEV(Chip, {\n                  label: isAutoMode ? \"Tự động đang bật\" : \"Tự động đang tắt\",\n                  color: isAutoMode ? \"success\" : \"default\",\n                  sx: {\n                    mr: 1,\n                    borderRadius: \"6px\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2940,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: isAutoMode ? \"outlined\" : \"contained\",\n                  color: isAutoMode ? \"error\" : \"primary\",\n                  onClick: () => {\n                    if (isAutoMode) {\n                      stopAutoAttendance();\n                    } else {\n                      startAutoAttendance();\n                    }\n                  },\n                  sx: {\n                    borderRadius: \"8px\"\n                  },\n                  children: isAutoMode ? \"Tắt tự động\" : \"Bật tự động\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 2947,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 2939,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 2924,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2917,\n            columnNumber: 13\n          }, this), isCameraReady ? /*#__PURE__*/_jsxDEV(VideoDisplay, {\n            isCameraReady: isCameraReady,\n            isAutoMode: isAutoMode,\n            webcamRef: webcamRef,\n            videoRef: videoRef,\n            canvasRef: canvasRef,\n            onUserMedia: stream => {\n              console.log(\"Camera đã được cấp quyền và khởi tạo\", stream.id);\n              setTimeout(() => {\n                if (webcamRef.current && webcamRef.current.video) {\n                  dispatch(setCameraReady(true));\n                  setLastDetectionTime(Date.now());\n                }\n              }, 500);\n            },\n            onUserMediaError: err => {\n              console.error(\"Lỗi khi truy cập camera:\", err);\n              enqueueSnackbar(`Không thể truy cập camera: ${err.name === \"NotAllowedError\" ? \"Bạn chưa cấp quyền truy cập camera\" : err.name === \"NotFoundError\" ? \"Không tìm thấy thiết bị camera\" : err.message || \"Lỗi không xác định\"}`, {\n                variant: \"error\"\n              });\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 2968,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(CameraLoadingPlaceholder, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 3001,\n            columnNumber: 15\n          }, this), isCameraReady && /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            px: 3,\n            py: 2,\n            bgcolor: \"#f8f9fa\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              onClick: captureAndRecognize,\n              startIcon: isRecognizing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 3017,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 3019,\n                columnNumber: 23\n              }, this),\n              disabled: !isCameraReady || isRecognizing || isAutoMode,\n              sx: {\n                borderRadius: \"8px\"\n              },\n              children: isRecognizing ? \"Đang nhận diện...\" : \"Chụp & Nhận diện\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 3012,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              children: [/*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                color: showLandmark ? \"success\" : \"info\",\n                onClick: toggleLandmarkDetection,\n                sx: {\n                  mr: 1,\n                  borderRadius: \"8px\"\n                },\n                children: showLandmark ? \"Tắt Landmark\" : \"Hiện Landmark\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 3029,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                color: \"primary\",\n                onClick: completeSession,\n                startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 3042,\n                  columnNumber: 32\n                }, this),\n                disabled: (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) === \"completed\",\n                sx: {\n                  borderRadius: \"8px\"\n                },\n                children: \"K\\u1EBFt th\\xFAc phi\\xEAn\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 3038,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 3028,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 3005,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            px: 3,\n            pb: 3,\n            children: /*#__PURE__*/_jsxDEV(RecognizedStudentsList, {\n              students: recognizedStudents,\n              onMarkAttendance: handleMarkAttendance\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 3054,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 3053,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 2910,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 2909,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 4,\n        children: [/*#__PURE__*/_jsxDEV(PresentStudentsList, {\n          attendanceLogs: attendanceLogs.filter(log => log.status === \"present\"),\n          refreshAttendanceLogs: refreshAttendanceLogs,\n          totalStudents: (classInfo === null || classInfo === void 0 ? void 0 : classInfo.students.length) || 0\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 3064,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(AbsentStudentsList, {\n          absentStudents: absentStudents,\n          onOpenManualAttendance: openManualAttendanceDialog,\n          totalStudents: (classInfo === null || classInfo === void 0 ? void 0 : classInfo.students.length) || 0\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 3073,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 3062,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 2908,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ManualAttendanceDialog, {\n      open: manualDialogOpen,\n      onClose: handleManualDialogClose,\n      student: selectedStudent,\n      attendanceData: manualAttendanceData,\n      onAttendanceChange: handleManualAttendanceChange,\n      onSubmit: handleManualAttendanceSubmit\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 3082,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 2878,\n    columnNumber: 5\n  }, this);\n};\n_s(AttendancePage, \"Xg9t9ghvWjubMUq4UK2NxGff3eQ=\", false, function () {\n  return [useParams, useNavigate, useDispatch, useSnackbar, useSelector, useSelector];\n});\n_c = AttendancePage;\nexport default AttendancePage;\nvar _c;\n$RefreshReg$(_c, \"AttendancePage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","useDispatch","useSelector","useSnackbar","Box","Typography","Card","CardContent","Grid","Paper","Button","Divider","CircularProgress","List","ListItem","ListItemAvatar","ListItemText","Avatar","Chip","Dialog","DialogTitle","DialogContent","DialogActions","TextField","FormControl","InputLabel","Select","MenuItem","IconButton","Alert","AlertTitle","Tooltip","CameraAlt","Check","Close","Edit","Refresh","Save","VerifiedUser","HourglassEmpty","ArrowBack","Info","Webcam","faceapi","getClassFaceFeatures","verifyAttendance","manualAttendance","setModelLoaded","setCameraReady","setDetectedFaces","setRecognizedStudents","clearRecognitionState","axios","jsxDEV","_jsxDEV","Fragment","_Fragment","API_URL","process","env","REACT_APP_API_URL","AttendancePage","_s","classId","sessionId","navigate","dispatch","enqueueSnackbar","webcamRef","canvasRef","videoRef","intervalId","setIntervalId","showLandmark","setShowLandmark","landmarkIntervalId","setLandmarkIntervalId","cameraMode","setCameraMode","token","state","auth","isModelLoaded","isCameraReady","detectedFaces","recognizedStudents","classStudents","isProcessing","error","faceRecognition","classInfo","setClassInfo","sessionInfo","setSessionInfo","attendanceLogs","setAttendanceLogs","isLoading","setIsLoading","isRecognizing","setIsRecognizing","isAutoMode","setIsAutoMode","selectedStudent","setSelectedStudent","manualDialogOpen","setManualDialogOpen","manualAttendanceData","setManualAttendanceData","status","note","RECOGNITION_THRESHOLD","DETECTION_THRESHOLD","CONFIDENCE_THRESHOLD","AUTO_DETECT_INTERVAL","ENABLE_DEBUG_LOGS","cameraRetryCount","setCameraRetryCount","lastDetectionTime","setLastDetectionTime","landmarkDetectionInterval","setLandmarkDetectionInterval","loadInitialData","classPromise","get","headers","Authorization","sessionPromise","logsPromise","classResponse","sessionResponse","logsResponse","Promise","all","data","modelLoaded","loadFaceRecognitionModels","unwrap","apiError","console","variant","Date","now","clearInterval","current","video","srcObject","tracks","getTracks","forEach","track","stop","MODEL_URL","nets","tinyFaceDetector","isLoaded","faceLandmark68Net","faceRecognitionNet","ssdMobilenetv1","log","loadFromUri","allModelsLoaded","warn","resolve","setTimeout","modelsLoadedAfterWait","Error","initDirectCamera","_webcamRef$current","stopExistingStream","videoElement","constraints","width","ideal","min","height","facingMode","frameRate","audio","stream","navigator","mediaDevices","getUserMedia","setupVideoStream","streamSetupSuccess","waitForVideoReady","startLandmarkDetection","err","_webcamRef$current2","altStream","prev","altErr","message","readyState","play","catch","handleCanPlay","handleError","addEventListener","once","timeoutId","removeEventListener","clearTimeout","lastValidDetections","invalidFrameCount","MAX_INVALID_FRAMES","setInterval","_webcamRef$current3","videoWidth","videoHeight","active","canvasElement","detections","handleDetectFaces","Array","isArray","length","getContext","ctx","clearRect","drawFaceLandmarks","validDetections","filter","detection","_box","box","_x","isNaN","_y","_width","_height","stopLandmarkDetection","ensureCameraIsWorking","_webcamRef$current4","canvas","index","landmarks","positions","boxGradient","createLinearGradient","addColorStop","strokeStyle","lineWidth","strokeRect","matchingStudent","find","student","idx","labelY","labelText","name","Math","round","confidence","textMetrics","measureText","textWidth","fillStyle","fillRect","font","fillText","points","globalAlpha","drawPoints","startIdx","endIdx","color","i","_points$i","_points$i2","_points$i3","_points$i4","x","y","beginPath","arc","PI","fill","drawLine","indices","_points$firstIdx","_points$firstIdx2","_points$firstIdx3","_points$firstIdx4","firstIdx","moveTo","_points$idx","_points$idx2","_points$idx3","_points$idx4","lineTo","stroke","from","_","landmarkOnly","_webcamRef$current5","displaySize","detectAllFaces","TinyFaceDetectorOptions","scoreThreshold","inputSize","withFaceLandmarks","detectionError","_detection$detection","resizedDetections","map","clonedDetection","scaleX","scaleY","_score","position","resizeError","det","finalDetections","_finalDetections$","withFaceDescriptors","_detection$detection2","descriptor","SsdMobilenetv1Options","minConfidence","_detection$detection3","_det$detection","resizedFinalDetections","handleFaceDetection","extractStudentDescriptors","_student$faceFeatures","descriptors","faceFeatures","featuresData","findDescriptorsInArray","arr","maxDepth","depth","every","val","push","item","faceDescriptors","oldFeatures","key","value","v","desc","_detection$detection4","openManualAttendanceDialog","handleManualDialogClose","handleManualAttendanceChange","e","target","handleManualAttendanceSubmit","result","studentId","_id","prevLogs","filteredLogs","student_id","full_name","fetchSessionInfo","markAttendance","faceDescriptor","imageBase64","s","completeSession","put","refreshAttendanceLogs","captureAndRecognize","_detection$detection5","getScreenshot","matchResults","comparePromises","studentDescriptors","bestMatch","some","distance","euclideanDistance","similarity","max","studentCode","student_code","results","sort","a","b","filteredResults","r","topMatches","slice","topMatch","handleMarkAttendance","matchDetails","m","toFixed","join","isAlreadyAttended","_webcamRef$current6","document","createElement","drawImage","toDataURL","toggleLandmarkDetection","newState","debugFaceFeatures","group","groupIndex","descIndex","startAutoAttendance","id","processAutoRecognition","stopAutoAttendance","_webcamRef$current7","_detection$detection6","display","justifyContent","alignItems","minHeight","children","fileName","_jsxFileName","lineNumber","columnNumber","getAbsentStudents","students","presentStudentIds","Set","has","absentStudents","showStudentList","VideoDisplay","onUserMedia","onUserMediaError","elevation","sx","overflow","mb","borderRadius","border","ref","style","objectFit","autoPlay","playsInline","muted","screenshotFormat","videoConstraints","top","left","zIndex","bottom","right","backgroundColor","padding","fontSize","marginRight","CameraLoadingPlaceholder","PresentStudentsList","totalStudents","boxShadow","mr","title","size","onClick","maxHeight","pr","flexDirection","py","opacity","dense","timestamp","secondaryAction","icon","recognized","label","px","alt","src","avatar_url","bgcolor","primary","fontWeight","secondary","toLocaleTimeString","AbsentStudentsList","onOpenManualAttendance","transition","edge","ManualAttendanceDialog","open","onClose","attendanceData","onAttendanceChange","onSubmit","maxWidth","fullWidth","PaperProps","dividers","p","gutterBottom","margin","onChange","multiline","rows","placeholder","startIcon","align","paragraph","mt","severity","component","RecognizedStudentsList","onMarkAttendance","container","spacing","xs","sm","md","transform","noWrap","ml","minWidth","borderBottom","pb","class_name","session_number","date","toLocaleDateString","disabled","_c","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/teacher/AttendancePage.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport {\n  Box,\n  Typography,\n  Card,\n  CardContent,\n  Grid,\n  Paper,\n  Button,\n  Divider,\n  CircularProgress,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Avatar,\n  Chip,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  IconButton,\n  Alert,\n  AlertTitle,\n  Tooltip,\n} from \"@mui/material\";\nimport {\n  CameraAlt,\n  Check,\n  Close,\n  Edit,\n  Refresh,\n  Save,\n  VerifiedUser,\n  HourglassEmpty,\n  ArrowBack,\n  Info,\n} from \"@mui/icons-material\";\nimport Webcam from \"react-webcam\";\nimport * as faceapi from \"face-api.js\";\nimport {\n  getClassFaceFeatures,\n  verifyAttendance,\n  manualAttendance,\n  setModelLoaded,\n  setCameraReady,\n  setDetectedFaces,\n  setRecognizedStudents,\n  clearRecognitionState,\n} from \"../../redux/slices/faceRecognitionSlice\";\nimport axios from \"axios\";\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\nconst AttendancePage = () => {\n  const { classId, sessionId } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const videoRef = useRef(null);\n  const [intervalId, setIntervalId] = useState(null);\n  const [showLandmark, setShowLandmark] = useState(true);\n  const [landmarkIntervalId, setLandmarkIntervalId] = useState(null);\n  const [cameraMode, setCameraMode] = useState(\"face_recognition\");\n\n  const { token } = useSelector((state) => state.auth);\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents,\n    isProcessing,\n    error,\n  } = useSelector((state) => state.faceRecognition);\n\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isRecognizing, setIsRecognizing] = useState(false);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\",\n  });\n\n  // Các hằng số cấu hình được tối ưu\n  const RECOGNITION_THRESHOLD = 0.45; // Ngưỡng nhận diện được tối ưu\n  const DETECTION_THRESHOLD = 0.5; // Ngưỡng phát hiện khuôn mặt\n  const CONFIDENCE_THRESHOLD = 0.6; // Ngưỡng độ tin cậy để điểm danh\n  const AUTO_DETECT_INTERVAL = 1000; // Thời gian giữa các lần phát hiện (ms)\n  const ENABLE_DEBUG_LOGS = false; // Tắt log gỡ lỗi trong môi trường sản phẩm\n\n  // Thêm state mới để theo dõi số lần thử lại camera\n  const [cameraRetryCount, setCameraRetryCount] = useState(0);\n  const [lastDetectionTime, setLastDetectionTime] = useState(null);\n\n  // Thêm state theo dõi interval phát hiện landmarks\n  const [landmarkDetectionInterval, setLandmarkDetectionInterval] =\n    useState(null);\n\n  // Load class info, session info và models\n  useEffect(() => {\n    const loadInitialData = async () => {\n      try {\n        setIsLoading(true);\n\n        // Lấy thông tin lớp học\n        const classPromise = axios.get(\n          `${API_URL}/classes/teaching/${classId}`,\n          {\n            headers: { Authorization: `Bearer ${token}` },\n          }\n        );\n\n        // Lấy thông tin phiên điểm danh\n        const sessionPromise = axios.get(\n          `${API_URL}/attendance/sessions/${sessionId}`,\n          {\n            headers: { Authorization: `Bearer ${token}` },\n          }\n        );\n\n        // Lấy danh sách điểm danh\n        const logsPromise = axios.get(\n          `${API_URL}/attendance/logs/${sessionId}`,\n          {\n            headers: { Authorization: `Bearer ${token}` },\n          }\n        );\n\n        // Chờ tất cả API calls hoàn thành\n        const [classResponse, sessionResponse, logsResponse] =\n          await Promise.all([classPromise, sessionPromise, logsPromise]);\n\n        setClassInfo(classResponse.data.data);\n        setSessionInfo(sessionResponse.data.data);\n        setAttendanceLogs(logsResponse.data.data);\n\n        // Đã tải xong dữ liệu cơ bản\n        setIsLoading(false);\n\n        // Tải model nhận diện nếu chưa tải\n        if (!isModelLoaded) {\n          const modelLoaded = await loadFaceRecognitionModels();\n          if (modelLoaded) {\n            dispatch(setModelLoaded(true));\n          }\n        }\n\n        if (sessionResponse.data.data.status !== \"completed\") {\n          // Lấy đặc trưng khuôn mặt của sinh viên trong lớp\n          try {\n            await dispatch(getClassFaceFeatures(classId)).unwrap();\n          } catch (apiError) {\n            console.error(\"Lỗi khi lấy dữ liệu khuôn mặt:\", apiError);\n            enqueueSnackbar(\n              \"Lỗi khi lấy dữ liệu khuôn mặt. Vui lòng kiểm tra lại.\",\n              { variant: \"error\" }\n            );\n          }\n        }\n\n        // Khởi tạo thời gian phát hiện ban đầu\n        setLastDetectionTime(Date.now());\n      } catch (error) {\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        enqueueSnackbar(\"Lỗi khi tải dữ liệu\", { variant: \"error\" });\n        setIsLoading(false);\n      }\n    };\n\n    loadInitialData();\n\n    // Clean up\n    return () => {\n      if (intervalId) {\n        clearInterval(intervalId);\n      }\n\n      // Dừng landmark interval nếu đang chạy\n      if (landmarkIntervalId) {\n        clearInterval(landmarkIntervalId);\n      }\n\n      // Dừng camera stream nếu đang chạy\n      if (\n        webcamRef.current &&\n        webcamRef.current.video &&\n        webcamRef.current.video.srcObject\n      ) {\n        const tracks = webcamRef.current.video.srcObject.getTracks();\n        tracks.forEach((track) => track.stop());\n      }\n\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach((track) => track.stop());\n      }\n\n      dispatch(clearRecognitionState());\n\n      // Reset các state theo dõi camera\n      setCameraRetryCount(0);\n      setLastDetectionTime(null);\n    };\n  }, [\n    classId,\n    sessionId,\n    token,\n    dispatch,\n    enqueueSnackbar,\n    isModelLoaded,\n    intervalId,\n    landmarkIntervalId,\n  ]);\n\n  // Hàm tối ưu để tải model nhận diện khuôn mặt\n  const loadFaceRecognitionModels = async () => {\n    try {\n      const MODEL_URL = \"/models\";\n\n      // Kiểm tra nhanh xem các models đã được tải chưa\n      if (\n        faceapi.nets.tinyFaceDetector.isLoaded &&\n        faceapi.nets.faceLandmark68Net.isLoaded &&\n        faceapi.nets.faceRecognitionNet.isLoaded &&\n        faceapi.nets.ssdMobilenetv1.isLoaded\n      ) {\n        console.log(\"Các models đã được tải từ trước\");\n        dispatch(setModelLoaded(true));\n        return true;\n      }\n\n      // Hiển thị thông báo đang tải\n      enqueueSnackbar(\"Đang tải mô hình nhận diện...\", { variant: \"info\" });\n\n      // Tải song song tất cả model và đợi đến khi hoàn tất\n      await Promise.all([\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\n        faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL),\n      ]);\n\n      // Kiểm tra xem tất cả model có thực sự được tải\n      const allModelsLoaded =\n        faceapi.nets.tinyFaceDetector.isLoaded &&\n        faceapi.nets.faceLandmark68Net.isLoaded &&\n        faceapi.nets.faceRecognitionNet.isLoaded &&\n        faceapi.nets.ssdMobilenetv1.isLoaded;\n\n      if (!allModelsLoaded) {\n        console.warn(\"Một số model chưa được tải đầy đủ, thử lại sau 1s\");\n        // Đợi thêm 1 giây và kiểm tra lại\n        await new Promise((resolve) => setTimeout(resolve, 1000));\n\n        // Kiểm tra lại sau khi đợi\n        const modelsLoadedAfterWait =\n          faceapi.nets.tinyFaceDetector.isLoaded &&\n          faceapi.nets.faceLandmark68Net.isLoaded &&\n          faceapi.nets.faceRecognitionNet.isLoaded &&\n          faceapi.nets.ssdMobilenetv1.isLoaded;\n\n        if (!modelsLoadedAfterWait) {\n          throw new Error(\"Không thể tải đầy đủ các model sau khi thử lại\");\n        }\n      }\n\n      // Nếu đến đây tức là tất cả model đã được tải thành công\n      dispatch(setModelLoaded(true));\n      enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\n        variant: \"success\",\n      });\n      return true;\n    } catch (error) {\n      console.error(\"Lỗi khi tải mô hình:\", error);\n      enqueueSnackbar(\"Không thể tải mô hình nhận diện\", { variant: \"error\" });\n      return false;\n    }\n  };\n\n  // Hàm khởi tạo camera đã tối ưu\n  const initDirectCamera = async () => {\n    try {\n      // Hiển thị thông báo đang khởi tạo\n      enqueueSnackbar(\"Đang khởi tạo camera...\", { variant: \"info\" });\n\n      // Tải model nếu chưa tải\n      if (!isModelLoaded) {\n        const modelLoaded = await loadFaceRecognitionModels();\n        if (!modelLoaded) {\n          enqueueSnackbar(\n            \"Không thể tải mô hình nhận diện. Vui lòng thử lại.\",\n            { variant: \"error\" }\n          );\n          return false;\n        }\n      }\n\n      // Đảm bảo model đã được tải đầy đủ\n      if (\n        !faceapi.nets.tinyFaceDetector.isLoaded ||\n        !faceapi.nets.faceLandmark68Net.isLoaded ||\n        !faceapi.nets.faceRecognitionNet.isLoaded ||\n        !faceapi.nets.ssdMobilenetv1.isLoaded\n      ) {\n        console.warn(\"Phát hiện model chưa được tải đầy đủ, thử tải lại\");\n        await loadFaceRecognitionModels();\n      }\n\n      // Dừng stream cũ nếu có\n      const stopExistingStream = (videoElement) => {\n        if (videoElement?.srcObject) {\n          const tracks = videoElement.srcObject.getTracks();\n          tracks.forEach((track) => track.stop());\n        }\n      };\n\n      stopExistingStream(webcamRef.current?.video);\n      stopExistingStream(videoRef.current);\n\n      // Cấu hình camera tối ưu\n      const constraints = {\n        video: {\n          width: { ideal: 640, min: 320 },\n          height: { ideal: 480, min: 240 },\n          facingMode: \"user\",\n          frameRate: { ideal: 24, min: 15 },\n        },\n        audio: false,\n      };\n\n      // Truy cập camera\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia(constraints);\n\n        // Xử lý stream video\n        const setupVideoStream = (videoElement) => {\n          if (!videoElement) return false;\n\n          videoElement.srcObject = stream;\n          return true;\n        };\n\n        // Thiết lập stream cho webcam hoặc video element\n        let streamSetupSuccess = false;\n        if (webcamRef.current && webcamRef.current.video) {\n          streamSetupSuccess = setupVideoStream(webcamRef.current.video);\n\n          // Đảm bảo video đã được tải trước khi tiếp tục\n          if (streamSetupSuccess) {\n            await waitForVideoReady(webcamRef.current.video);\n          }\n        } else if (videoRef.current) {\n          streamSetupSuccess = setupVideoStream(videoRef.current);\n\n          // Đảm bảo video đã được tải trước khi tiếp tục\n          if (streamSetupSuccess) {\n            await waitForVideoReady(videoRef.current);\n          }\n        }\n\n        if (!streamSetupSuccess) {\n          throw new Error(\"Không thể thiết lập video stream\");\n        }\n\n        // Đánh dấu camera đã sẵn sàng\n        dispatch(setCameraReady(true));\n        setLastDetectionTime(Date.now());\n        setCameraRetryCount(0);\n\n        // Đợi thêm 1 giây trước khi bật hiển thị landmark\n        // để đảm bảo video đã ổn định\n        await new Promise((resolve) => setTimeout(resolve, 1000));\n\n        setShowLandmark(true);\n        startLandmarkDetection();\n\n        enqueueSnackbar(\"Đã kết nối camera thành công\", { variant: \"success\" });\n        return true;\n      } catch (err) {\n        console.error(\"Lỗi truy cập camera:\", err);\n\n        // Thử phương án thay thế nếu lỗi\n        if (cameraRetryCount < 2) {\n          try {\n            enqueueSnackbar(\"Đang thử kết nối với camera thay thế...\", {\n              variant: \"info\",\n            });\n            const altStream = await navigator.mediaDevices.getUserMedia({\n              video: true,\n              audio: false,\n            });\n\n            if (webcamRef.current?.video) {\n              webcamRef.current.video.srcObject = altStream;\n              await waitForVideoReady(webcamRef.current.video);\n            } else if (videoRef.current) {\n              videoRef.current.srcObject = altStream;\n              await waitForVideoReady(videoRef.current);\n            }\n\n            dispatch(setCameraReady(true));\n            setLastDetectionTime(Date.now());\n            setCameraRetryCount((prev) => prev + 1);\n            enqueueSnackbar(\"Đã kết nối camera thay thế\", {\n              variant: \"success\",\n            });\n            return true;\n          } catch (altErr) {\n            console.error(\"Không thể sử dụng camera thay thế:\", altErr);\n          }\n        }\n\n        enqueueSnackbar(`Không thể truy cập camera: ${err.message}`, {\n          variant: \"error\",\n        });\n        return false;\n      }\n    } catch (err) {\n      console.error(\"Lỗi khi khởi tạo camera:\", err);\n      enqueueSnackbar(`Lỗi: ${err.message}`, { variant: \"error\" });\n      return false;\n    }\n  };\n\n  // Hàm đợi video sẵn sàng\n  const waitForVideoReady = (videoElement) => {\n    return new Promise((resolve) => {\n      if (!videoElement) {\n        resolve(false);\n        return;\n      }\n\n      // Nếu video đã sẵn sàng thì resolve ngay\n      if (videoElement.readyState >= 2) {\n        videoElement\n          .play()\n          .catch((err) => console.error(\"Lỗi khi play video:\", err));\n        resolve(true);\n        return;\n      }\n\n      const handleCanPlay = () => {\n        videoElement\n          .play()\n          .catch((err) => console.error(\"Lỗi khi play video:\", err));\n        resolve(true);\n      };\n\n      const handleError = () => {\n        console.error(\"Video không thể phát\");\n        resolve(false);\n      };\n\n      // Thiết lập các event listener\n      videoElement.addEventListener(\"canplay\", handleCanPlay, { once: true });\n      videoElement.addEventListener(\"loadeddata\", handleCanPlay, {\n        once: true,\n      });\n      videoElement.addEventListener(\"error\", handleError, { once: true });\n\n      // Thiết lập timeout để tránh chờ vô hạn\n      const timeoutId = setTimeout(() => {\n        videoElement.removeEventListener(\"canplay\", handleCanPlay);\n        videoElement.removeEventListener(\"loadeddata\", handleCanPlay);\n        videoElement.removeEventListener(\"error\", handleError);\n        console.warn(\"Đã hết thời gian chờ video sẵn sàng\");\n\n        // Vẫn cố gắng phát video\n        videoElement\n          .play()\n          .catch((err) =>\n            console.error(\"Lỗi khi play video sau timeout:\", err)\n          );\n        resolve(false);\n      }, 5000); // 5 giây timeout\n\n      // Cleanup function\n      videoElement.addEventListener(\"canplay\", () => clearTimeout(timeoutId), {\n        once: true,\n      });\n      videoElement.addEventListener(\n        \"loadeddata\",\n        () => clearTimeout(timeoutId),\n        { once: true }\n      );\n      videoElement.addEventListener(\"error\", () => clearTimeout(timeoutId), {\n        once: true,\n      });\n    });\n  };\n\n  // Bắt đầu phát hiện landmarks theo thời gian thực\n  const startLandmarkDetection = () => {\n    // Xóa interval cũ nếu có\n    if (landmarkDetectionInterval) {\n      clearInterval(landmarkDetectionInterval);\n    }\n\n    // Theo dõi frame trước đó để tránh xử lý các detection null liên tiếp\n    let lastValidDetections = null;\n    let invalidFrameCount = 0;\n    const MAX_INVALID_FRAMES = 5; // Số lượng frame không hợp lệ tối đa trước khi xóa canvas\n\n    // Tạo interval mới để cập nhật landmarks mỗi 150ms\n    const intervalId = setInterval(async () => {\n      if (cameraMode === \"face_recognition\" && showLandmark) {\n        // Kiểm tra trạng thái camera trước khi thực hiện phát hiện\n        const videoElement = isAutoMode\n          ? videoRef.current\n          : webcamRef.current?.video;\n\n        // Kiểm tra kỹ video element\n        if (\n          !videoElement ||\n          videoElement.readyState !== 4 ||\n          videoElement.videoWidth === 0 ||\n          videoElement.videoHeight === 0 ||\n          !videoElement.srcObject ||\n          videoElement.srcObject.active === false\n        ) {\n          console.log(\"Video chưa sẵn sàng, bỏ qua phát hiện landmark\");\n          return;\n        }\n\n        // Thực hiện phát hiện khuôn mặt\n        try {\n          const canvasElement = canvasRef.current;\n          if (!canvasElement) return;\n\n          const detections = await handleDetectFaces(true);\n          \n          // Kiểm tra kỹ detections\n          if (!detections || !Array.isArray(detections) || detections.length === 0) {\n            invalidFrameCount++;\n            \n            // Nếu có quá nhiều frame không hợp lệ liên tiếp, xóa canvas\n            if (invalidFrameCount > MAX_INVALID_FRAMES) {\n              if (canvasElement && canvasElement.getContext) {\n                const ctx = canvasElement.getContext(\"2d\");\n                if (ctx) {\n                  ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n                }\n              }\n              \n              // Có thể sử dụng kết quả hợp lệ cuối cùng\n              if (lastValidDetections && Array.isArray(lastValidDetections) && lastValidDetections.length > 0) {\n                console.log(\"Sử dụng kết quả phát hiện hợp lệ cuối cùng\");\n                try {\n                  // Hiển thị kết quả cũ an toàn\n                  drawFaceLandmarks(\n                    lastValidDetections,\n                    canvasElement,\n                    recognizedStudents\n                  );\n                } catch (error) {\n                  console.error(\"Lỗi khi vẽ last valid detections:\", error);\n                }\n              }\n            }\n            return;\n          }\n          \n          // Reset bộ đếm khi có frame hợp lệ\n          invalidFrameCount = 0;\n          \n          // Lưu trữ detections hợp lệ để sử dụng khi cần\n          // Lọc kỹ một lần nữa\n          const validDetections = detections.filter(detection => {\n            if (!detection || !detection.detection || !detection.detection._box) return false;\n            \n            const box = detection.detection._box;\n            return box && \n                  typeof box._x === 'number' && !isNaN(box._x) && \n                  typeof box._y === 'number' && !isNaN(box._y) && \n                  typeof box._width === 'number' && !isNaN(box._width) && \n                  typeof box._height === 'number' && !isNaN(box._height);\n          });\n          \n          if (validDetections.length > 0) {\n            lastValidDetections = validDetections;\n          }\n        } catch (error) {\n          console.error(\"Lỗi khi phát hiện landmarks:\", error);\n          // Tăng bộ đếm khi có lỗi\n          invalidFrameCount++;\n        }\n      }\n    }, 200); // Tăng lên 200ms để giảm tải CPU\n\n    setLandmarkDetectionInterval(intervalId);\n  };\n\n  // Dừng phát hiện landmarks theo thời gian thực\n  const stopLandmarkDetection = () => {\n    if (landmarkDetectionInterval) {\n      clearInterval(landmarkDetectionInterval);\n      setLandmarkDetectionInterval(null);\n    }\n  };\n\n  // Cập nhật useEffect để bắt đầu và dừng phát hiện landmarks khi camera hoặc chế độ thay đổi\n  useEffect(() => {\n    if (cameraMode === \"face_recognition\" && showLandmark) {\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n    }\n\n    return () => {\n      stopLandmarkDetection();\n    };\n  }, [cameraMode, showLandmark]);\n\n  // Cập nhật useEffect cho việc toggle showLandmark\n  useEffect(() => {\n    if (showLandmark && cameraMode === \"face_recognition\") {\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n    }\n  }, [showLandmark]);\n\n  // Hàm kiểm tra và đảm bảo camera hoạt động\n  const ensureCameraIsWorking = () => {\n    // Kiểm tra nếu camera chưa hoạt động và đã thử khởi động\n    if (!isCameraReady && cameraRetryCount === 0) {\n      console.log(\"[DEBUG] Camera chưa sẵn sàng, thử khởi động\");\n      setCameraRetryCount(1);\n      initDirectCamera();\n      return false;\n    }\n\n    // Kiểm tra stream của camera\n    const videoElement = isAutoMode\n      ? videoRef.current\n      : webcamRef.current?.video;\n\n    if (\n      !videoElement ||\n      !videoElement.srcObject ||\n      videoElement.readyState !== 4\n    ) {\n      console.log(\n        \"[DEBUG] Video stream không hoạt động, thử khởi động lại camera\"\n      );\n      if (cameraRetryCount < 3) {\n        setCameraRetryCount((prev) => prev + 1);\n        initDirectCamera();\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  // Hàm vẽ landmarks đã được tối ưu với hiển thị thông tin sinh viên\n  const drawFaceLandmarks = (detections, canvas, recognizedStudents = []) => {\n    if (!canvas) return;\n\n    const ctx = canvas.getContext(\"2d\");\n    if (!ctx) return;\n\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Nếu detections là null hoặc trống, không vẽ gì\n    if (!detections || !Array.isArray(detections) || detections.length === 0) {\n      return;\n    }\n\n    // Lọc các phát hiện không hợp lệ\n    const validDetections = detections.filter((detection) => {\n      if (!detection || !detection.detection || !detection.detection._box) return false;\n\n      const box = detection.detection._box;\n      return (\n        box &&\n        typeof box._x === \"number\" &&\n        !isNaN(box._x) &&\n        typeof box._y === \"number\" &&\n        !isNaN(box._y) &&\n        typeof box._width === \"number\" &&\n        !isNaN(box._width) &&\n        typeof box._height === \"number\" &&\n        !isNaN(box._height)\n      );\n    });\n\n    // Nếu không có detection hợp lệ sau khi lọc, thoát\n    if (validDetections.length === 0) {\n      return;\n    }\n\n    validDetections.forEach((detection, index) => {\n      try {\n        const { _box: box } = detection.detection || {};\n        const landmarks = detection.landmarks;\n\n        if (!box || \n            !landmarks?.positions || \n            !Array.isArray(landmarks.positions) || \n            landmarks.positions.length === 0 ||\n            box._x == null || \n            box._y == null ||\n            box._width == null ||\n            box._height == null ||\n            isNaN(box._x) ||\n            isNaN(box._y) ||\n            isNaN(box._width) ||\n            isNaN(box._height)\n        ) {\n          return;\n        }\n\n        // Vẽ hộp giới hạn khuôn mặt với viền gradient\n        const boxGradient = ctx.createLinearGradient(\n          box._x,\n          box._y,\n          box._x + box._width,\n          box._y + box._height\n        );\n        boxGradient.addColorStop(0, \"#4CAF50\");\n        boxGradient.addColorStop(1, \"#2196F3\");\n\n        ctx.strokeStyle = boxGradient;\n        ctx.lineWidth = 3;\n        ctx.strokeRect(box._x, box._y, box._width, box._height);\n\n        // Tìm sinh viên đã được nhận diện tương ứng với detection này\n        const matchingStudent = recognizedStudents.find(\n          (student, idx) => idx === index\n        );\n\n        // Tạo background cho text\n        const labelY = box._y - 10;\n        const labelText = matchingStudent\n          ? `${matchingStudent.name} (${Math.round(\n              matchingStudent.confidence * 100\n            )}%)`\n          : \"Đã phát hiện khuôn mặt\";\n\n        const textMetrics = ctx.measureText(labelText);\n        const textWidth = textMetrics.width + 10; // Thêm padding\n\n        // Vẽ background cho label\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n        ctx.fillRect(box._x, labelY - 20, textWidth, 24);\n\n        // Vẽ text tên và % nhận diện\n        ctx.fillStyle = \"#FFFFFF\";\n        ctx.font = \"14px Arial\";\n        ctx.fillText(labelText, box._x + 5, labelY - 4);\n\n        const points = landmarks.positions;\n        if (!points || !Array.isArray(points) || points.length < 68) return;\n\n        // Vẽ các điểm landmarks với alpha thấp hơn để không quá nổi bật\n        ctx.globalAlpha = 0.6;\n\n        // Hàm vẽ nhóm điểm\n        const drawPoints = (startIdx, endIdx, color) => {\n          ctx.fillStyle = color;\n          for (let i = startIdx; i <= endIdx; i++) {\n            if (\n              points[i] &&\n              points[i]?.x != null &&\n              points[i]?.y != null &&\n              !isNaN(points[i]?.x) &&\n              !isNaN(points[i]?.y)\n            ) {\n              ctx.beginPath();\n              ctx.arc(points[i].x, points[i].y, 2, 0, 2 * Math.PI);\n              ctx.fill();\n            }\n          }\n        };\n\n        // Vẽ các điểm landmarks\n        drawPoints(36, 41, \"#FF5722\"); // Mắt trái (cam)\n        drawPoints(42, 47, \"#2196F3\"); // Mắt phải (xanh dương)\n        drawPoints(27, 35, \"#FFEB3B\"); // Mũi (vàng)\n        drawPoints(48, 67, \"#E91E63\"); // Miệng (hồng)\n        drawPoints(0, 26, \"#4CAF50\"); // Viền khuôn mặt (xanh lá)\n\n        // Kết nối các điểm để tạo đường viền rõ ràng hơn cho các bộ phận quan trọng\n        ctx.globalAlpha = 0.4;\n        ctx.lineWidth = 1;\n\n        // Hàm an toàn để vẽ đường viền\n        const drawLine = (points, indices) => {\n          if (!points || indices.length < 2) return;\n\n          // Kiểm tra điểm đầu tiên\n          const firstIdx = indices[0];\n          if (\n            !points[firstIdx] ||\n            points[firstIdx]?.x == null ||\n            points[firstIdx]?.y == null ||\n            isNaN(points[firstIdx]?.x) ||\n            isNaN(points[firstIdx]?.y)\n          )\n            return;\n\n          ctx.beginPath();\n          ctx.moveTo(points[firstIdx].x, points[firstIdx].y);\n\n          // Vẽ đường đến các điểm còn lại\n          for (let i = 1; i < indices.length; i++) {\n            const idx = indices[i];\n            if (\n              points[idx] &&\n              points[idx]?.x != null &&\n              points[idx]?.y != null &&\n              !isNaN(points[idx]?.x) &&\n              !isNaN(points[idx]?.y)\n            ) {\n              ctx.lineTo(points[idx].x, points[idx].y);\n            }\n          }\n\n          // Đóng đường đi nếu cần\n          if (indices.length > 2) {\n            ctx.lineTo(points[firstIdx].x, points[firstIdx].y);\n          }\n\n          ctx.stroke();\n        };\n\n        // Vẽ viền mắt trái\n        ctx.strokeStyle = \"#FF5722\";\n        drawLine(points, [36, 37, 38, 39, 40, 41, 36]);\n\n        // Vẽ viền mắt phải\n        ctx.strokeStyle = \"#2196F3\";\n        drawLine(points, [42, 43, 44, 45, 46, 47, 42]);\n\n        // Vẽ viền miệng ngoài\n        ctx.strokeStyle = \"#E91E63\";\n        drawLine(\n          points,\n          Array.from({ length: 12 }, (_, i) => i + 48)\n        );\n\n        // Vẽ viền miệng trong\n        ctx.strokeStyle = \"#E91E63\";\n        drawLine(\n          points,\n          Array.from({ length: 8 }, (_, i) => i + 60)\n        );\n\n        // Reset alpha\n        ctx.globalAlpha = 1.0;\n      } catch (error) {\n        console.error(\"Lỗi khi vẽ landmark cho detection:\", error);\n      }\n    });\n  };\n\n  // Tối ưu hàm phát hiện khuôn mặt với tích hợp hiển thị thông tin sinh viên\n  const handleDetectFaces = async (landmarkOnly = false) => {\n    if (cameraMode !== \"face_recognition\" || !faceapi || !canvasRef.current)\n      return [];\n\n    // Xác định video element hiện tại\n    const videoElement = isAutoMode\n      ? videoRef.current\n      : webcamRef.current?.video;\n\n    // Kiểm tra video element kỹ hơn\n    if (\n      !videoElement ||\n      videoElement.readyState !== 4 ||\n      videoElement.videoWidth === 0 ||\n      videoElement.videoHeight === 0 ||\n      !videoElement.srcObject ||\n      videoElement.srcObject.active === false\n    ) {\n      console.warn(\"Video chưa sẵn sàng hoặc không có kích thước hợp lệ\");\n      return [];\n    }\n\n    const canvasElement = canvasRef.current;\n\n    try {\n      // Kiểm tra xem canvas đã được khởi tạo chưa\n      if (!canvasElement) {\n        console.warn(\"Canvas chưa được khởi tạo\");\n        return [];\n      }\n\n      // Đặt kích thước canvas để khớp với video thực tế\n      const displaySize = {\n        width: videoElement.videoWidth,\n        height: videoElement.videoHeight,\n      };\n\n      if (displaySize.width === 0 || displaySize.height === 0) {\n        console.warn(\"Kích thước video không hợp lệ:\", displaySize);\n        return [];\n      }\n\n      // Đảm bảo canvas có kích thước đúng\n      if (\n        canvasElement.width !== displaySize.width ||\n        canvasElement.height !== displaySize.height\n      ) {\n        canvasElement.width = displaySize.width;\n        canvasElement.height = displaySize.height;\n      }\n\n      // Sử dụng TinyFaceDetector nhanh hơn để phát hiện khuôn mặt với landmarks\n      let detections = [];\n      try {\n        detections = await faceapi\n          .detectAllFaces(\n            videoElement,\n            new faceapi.TinyFaceDetectorOptions({\n              scoreThreshold: DETECTION_THRESHOLD,\n              inputSize: 320,\n            })\n          )\n          .withFaceLandmarks();\n      } catch (detectionError) {\n        console.error(\"Lỗi khi phát hiện khuôn mặt:\", detectionError);\n        return [];\n      }\n\n      // Lọc bỏ các phát hiện không hợp lệ\n      detections = detections.filter((detection) => {\n        const box = detection.detection?._box;\n        return (\n          box &&\n          typeof box._x === \"number\" &&\n          !isNaN(box._x) &&\n          typeof box._y === \"number\" &&\n          !isNaN(box._y) &&\n          typeof box._width === \"number\" &&\n          !isNaN(box._width) &&\n          typeof box._height === \"number\" &&\n          !isNaN(box._height)\n        );\n      });\n\n      if (detections.length === 0) {\n        console.log(\"Không phát hiện khuôn mặt hợp lệ\");\n        canvasElement\n          .getContext(\"2d\")\n          .clearRect(0, 0, canvasElement.width, canvasElement.height);\n        return [];\n      }\n\n      // Xử lý resize an toàn\n      let resizedDetections = [];\n      try {\n        // Sử dụng phương pháp resize thủ công an toàn hơn\n        resizedDetections = detections\n          .map((detection) => {\n            try {\n              // Clone detection để không ảnh hưởng đến dữ liệu gốc\n              const clonedDetection = { ...detection };\n\n              // Nếu có box, resize box\n              if (clonedDetection.detection && clonedDetection.detection._box) {\n                const box = clonedDetection.detection._box;\n\n                // Kiểm tra box có hợp lệ không\n                if (\n                  typeof box._x !== \"number\" ||\n                  isNaN(box._x) ||\n                  typeof box._y !== \"number\" ||\n                  isNaN(box._y) ||\n                  typeof box._width !== \"number\" ||\n                  isNaN(box._width) ||\n                  typeof box._height !== \"number\" ||\n                  isNaN(box._height)\n                ) {\n                  return null;\n                }\n\n                // Không resize nếu kích thước giống nhau\n                if (\n                  canvasElement.width === videoElement.videoWidth &&\n                  canvasElement.height === videoElement.videoHeight\n                ) {\n                  return clonedDetection;\n                }\n\n                // Tính tỷ lệ resize\n                const scaleX = canvasElement.width / videoElement.videoWidth;\n                const scaleY = canvasElement.height / videoElement.videoHeight;\n\n                // Resize box thủ công\n                clonedDetection.detection._box = {\n                  _x: box._x * scaleX,\n                  _y: box._y * scaleY,\n                  _width: box._width * scaleX,\n                  _height: box._height * scaleY,\n                  _score: box._score,\n                };\n              }\n\n              // Nếu có landmarks, resize landmarks\n              if (\n                clonedDetection.landmarks &&\n                clonedDetection.landmarks.positions\n              ) {\n                // Không resize nếu kích thước giống nhau\n                if (\n                  canvasElement.width === videoElement.videoWidth &&\n                  canvasElement.height === videoElement.videoHeight\n                ) {\n                  return clonedDetection;\n                }\n\n                // Tính tỷ lệ resize\n                const scaleX = canvasElement.width / videoElement.videoWidth;\n                const scaleY = canvasElement.height / videoElement.videoHeight;\n\n                // Resize positions thủ công\n                clonedDetection.landmarks.positions =\n                  clonedDetection.landmarks.positions.map((position) => {\n                    if (\n                      position &&\n                      typeof position.x === \"number\" &&\n                      typeof position.y === \"number\"\n                    ) {\n                      return {\n                        x: position.x * scaleX,\n                        y: position.y * scaleY,\n                      };\n                    }\n                    return position;\n                  });\n              }\n\n              return clonedDetection;\n            } catch (resizeError) {\n              console.error(\"Lỗi khi resize detection:\", resizeError);\n              return null;\n            }\n          })\n          .filter((det) => det !== null);\n      } catch (resizeError) {\n        console.error(\"Lỗi khi resize detections:\", resizeError);\n        resizedDetections = detections;\n      }\n\n      // Nếu chỉ cần vẽ landmarks, không cần trích xuất descriptor\n      if (landmarkOnly) {\n        if (resizedDetections.length > 0) {\n          // Vẽ landmarks với thông tin nhận diện nếu có\n          drawFaceLandmarks(\n            resizedDetections,\n            canvasElement,\n            recognizedStudents\n          );\n          return detections;\n        } else {\n          // Xóa canvas nếu không phát hiện khuôn mặt\n          canvasElement\n            .getContext(\"2d\")\n            .clearRect(0, 0, canvasElement.width, canvasElement.height);\n          return [];\n        }\n      }\n\n      // Nếu cần nhận diện đầy đủ, trích xuất thêm descriptors\n      if (detections.length > 0) {\n        // Thêm descriptors\n        let finalDetections = [];\n        try {\n          finalDetections = await faceapi\n            .detectAllFaces(\n              videoElement,\n              new faceapi.TinyFaceDetectorOptions({\n                scoreThreshold: DETECTION_THRESHOLD,\n                inputSize: 320,\n              })\n            )\n            .withFaceLandmarks()\n            .withFaceDescriptors();\n\n          // Lọc các kết quả không hợp lệ\n          finalDetections = finalDetections.filter((detection) => {\n            const box = detection.detection?._box;\n            return (\n              box &&\n              typeof box._x === \"number\" &&\n              !isNaN(box._x) &&\n              typeof box._y === \"number\" &&\n              !isNaN(box._y) &&\n              typeof box._width === \"number\" &&\n              !isNaN(box._width) &&\n              typeof box._height === \"number\" &&\n              !isNaN(box._height) &&\n              detection.descriptor &&\n              detection.descriptor.length === 128\n            );\n          });\n\n          // Nếu không có kết quả hoặc descriptor không hợp lệ, thử dùng SSD MobileNet\n          if (\n            (finalDetections.length === 0 || !finalDetections[0]?.descriptor) &&\n            faceapi.nets.ssdMobilenetv1.isLoaded\n          ) {\n            console.log(\"Thử dùng SSD MobileNet để trích xuất descriptors\");\n            finalDetections = await faceapi\n              .detectAllFaces(\n                videoElement,\n                new faceapi.SsdMobilenetv1Options({\n                  minConfidence: DETECTION_THRESHOLD,\n                })\n              )\n              .withFaceLandmarks()\n              .withFaceDescriptors();\n\n            // Lọc lại kết quả\n            finalDetections = finalDetections.filter((detection) => {\n              const box = detection.detection?._box;\n              return (\n                box &&\n                typeof box._x === \"number\" &&\n                !isNaN(box._x) &&\n                typeof box._y === \"number\" &&\n                !isNaN(box._y) &&\n                typeof box._width === \"number\" &&\n                !isNaN(box._width) &&\n                typeof box._height === \"number\" &&\n                !isNaN(box._height) &&\n                detection.descriptor &&\n                detection.descriptor.length === 128\n              );\n            });\n          }\n        } catch (error) {\n          console.error(\"Lỗi khi lấy mô tả khuôn mặt:\", error);\n          finalDetections = detections.filter((det) => {\n            const box = det.detection?._box;\n            return (\n              box &&\n              box._x != null &&\n              box._y != null &&\n              box._width != null &&\n              box._height != null\n            );\n          });\n        }\n\n        if (finalDetections.length > 0) {\n          // Resize an toàn finalDetections\n          let resizedFinalDetections = [];\n          try {\n            // Sử dụng phương pháp resize thủ công an toàn tương tự\n            resizedFinalDetections = finalDetections\n              .map((detection) => {\n                try {\n                  const clonedDetection = { ...detection };\n\n                  // Resize box nếu cần\n                  if (\n                    clonedDetection.detection &&\n                    clonedDetection.detection._box\n                  ) {\n                    const box = clonedDetection.detection._box;\n\n                    // Kiểm tra box có hợp lệ không\n                    if (\n                      typeof box._x !== \"number\" ||\n                      isNaN(box._x) ||\n                      typeof box._y !== \"number\" ||\n                      isNaN(box._y) ||\n                      typeof box._width !== \"number\" ||\n                      isNaN(box._width) ||\n                      typeof box._height !== \"number\" ||\n                      isNaN(box._height)\n                    ) {\n                      return null;\n                    }\n\n                    // Không resize nếu kích thước giống nhau\n                    if (\n                      canvasElement.width === videoElement.videoWidth &&\n                      canvasElement.height === videoElement.videoHeight\n                    ) {\n                      return clonedDetection;\n                    }\n\n                    // Tính tỷ lệ resize\n                    const scaleX =\n                      canvasElement.width / videoElement.videoWidth;\n                    const scaleY =\n                      canvasElement.height / videoElement.videoHeight;\n\n                    // Resize box thủ công\n                    clonedDetection.detection._box = {\n                      _x: box._x * scaleX,\n                      _y: box._y * scaleY,\n                      _width: box._width * scaleX,\n                      _height: box._height * scaleY,\n                      _score: box._score,\n                    };\n                  }\n\n                  // Nếu có landmarks, resize landmarks\n                  if (\n                    clonedDetection.landmarks &&\n                    clonedDetection.landmarks.positions\n                  ) {\n                    // Không resize nếu kích thước giống nhau\n                    if (\n                      canvasElement.width === videoElement.videoWidth &&\n                      canvasElement.height === videoElement.videoHeight\n                    ) {\n                      return clonedDetection;\n                    }\n\n                    // Tính tỷ lệ resize\n                    const scaleX =\n                      canvasElement.width / videoElement.videoWidth;\n                    const scaleY =\n                      canvasElement.height / videoElement.videoHeight;\n\n                    // Resize positions thủ công\n                    clonedDetection.landmarks.positions =\n                      clonedDetection.landmarks.positions.map((position) => {\n                        if (\n                          position &&\n                          typeof position.x === \"number\" &&\n                          typeof position.y === \"number\"\n                        ) {\n                          return {\n                            x: position.x * scaleX,\n                            y: position.y * scaleY,\n                          };\n                        }\n                        return position;\n                      });\n                  }\n\n                  return clonedDetection;\n                } catch (resizeError) {\n                  console.error(\"Lỗi khi resize final detection:\", resizeError);\n                  return null;\n                }\n              })\n              .filter((det) => det !== null);\n          } catch (resizeError) {\n            console.error(\"Lỗi khi resize finalDetections:\", resizeError);\n            resizedFinalDetections = finalDetections;\n          }\n\n          // Vẽ landmarks nếu được bật\n          if (showLandmark && resizedFinalDetections.length > 0) {\n            drawFaceLandmarks(\n              resizedFinalDetections,\n              canvasElement,\n              recognizedStudents\n            );\n          }\n\n          // Xử lý nhận diện\n          handleFaceDetection(finalDetections);\n          return finalDetections;\n        }\n      }\n\n      // Xóa canvas nếu không có kết quả\n      canvasElement\n        .getContext(\"2d\")\n        .clearRect(0, 0, canvasElement.width, canvasElement.height);\n      return [];\n    } catch (error) {\n      console.error(\"Lỗi khi phát hiện khuôn mặt:\", error);\n      if (canvasElement) {\n        canvasElement\n          .getContext(\"2d\")\n          .clearRect(0, 0, canvasElement.width, canvasElement.height);\n      }\n      return [];\n    }\n  };\n\n  // Hàm trích xuất descriptor từ sinh viên, tối ưu hoá và chỉ phải làm một lần\n  const extractStudentDescriptors = (student) => {\n    if (!student) return [];\n\n    const descriptors = [];\n\n    // Kiểm tra cấu trúc mới\n    if (student.faceFeatures?.descriptors) {\n      const featuresData = student.faceFeatures.descriptors;\n\n      // Duyệt qua tất cả cấu trúc lồng nhau để tìm mảng 128 phần tử\n      const findDescriptorsInArray = (arr, maxDepth = 3, depth = 0) => {\n        if (!Array.isArray(arr) || depth > maxDepth) return;\n\n        if (arr.length === 128 && arr.every((val) => typeof val === \"number\")) {\n          descriptors.push(arr);\n          return;\n        }\n\n        for (const item of arr) {\n          if (Array.isArray(item)) {\n            findDescriptorsInArray(item, maxDepth, depth + 1);\n          }\n        }\n      };\n\n      findDescriptorsInArray(featuresData);\n    }\n\n    // Kiểm tra cấu trúc cũ\n    if (descriptors.length === 0 && student.faceDescriptors) {\n      const oldFeatures = student.faceDescriptors;\n\n      if (Array.isArray(oldFeatures)) {\n        // Trường hợp 1: mảng các descriptor\n        for (const item of oldFeatures) {\n          if (Array.isArray(item) && item.length === 128) {\n            descriptors.push(item);\n          }\n          // Trường hợp 2: mảng các object chứa descriptor\n          else if (typeof item === \"object\" && item !== null) {\n            // Tìm trong các thuộc tính của object\n            for (const key in item) {\n              const value = item[key];\n\n              if (\n                Array.isArray(value) &&\n                value.length === 128 &&\n                value.every((v) => typeof v === \"number\")\n              ) {\n                descriptors.push(value);\n              }\n              // Tìm trong thuộc tính descriptors\n              else if (key === \"descriptors\" && Array.isArray(value)) {\n                value.forEach((desc) => {\n                  if (Array.isArray(desc) && desc.length === 128) {\n                    descriptors.push(desc);\n                  }\n                });\n              }\n            }\n          }\n        }\n      }\n    }\n\n    return descriptors;\n  };\n\n  // Xử lý phát hiện khuôn mặt\n  const handleFaceDetection = async (detections) => {\n    // Kiểm tra kết quả không hợp lệ trước khi tiếp tục\n    if (!detections || detections.length === 0) {\n      console.log(\"[DEBUG] Không phát hiện khuôn mặt\");\n      return;\n    }\n\n    // Lọc kết quả để đảm bảo tất cả đều hợp lệ\n    const validDetections = detections.filter((detection) => {\n      // Kiểm tra detection có đầy đủ thông tin\n      const box = detection.detection?._box;\n      const descriptor = detection.descriptor;\n\n      return (\n        box &&\n        typeof box._x === \"number\" &&\n        !isNaN(box._x) &&\n        typeof box._y === \"number\" &&\n        !isNaN(box._y) &&\n        typeof box._width === \"number\" &&\n        !isNaN(box._width) &&\n        typeof box._height === \"number\" &&\n        !isNaN(box._height) &&\n        (descriptor\n          ? Array.isArray(descriptor) && descriptor.length === 128\n          : true)\n      );\n    });\n\n    if (validDetections.length === 0) {\n      console.log(\"[DEBUG] Không có kết quả phát hiện hợp lệ sau khi lọc\");\n      return;\n    }\n\n    try {\n      // Cập nhật state với kết quả đã lọc\n      dispatch(setDetectedFaces(validDetections));\n\n      // Cập nhật thời gian phát hiện\n      setLastDetectionTime(Date.now());\n\n      if (ENABLE_DEBUG_LOGS) {\n        console.log(\n          `[DEBUG] Đã phát hiện ${validDetections.length} khuôn mặt hợp lệ`\n        );\n      }\n\n      // Xử lý nhận diện khuôn mặt nếu có sinh viên\n      if (classStudents && classStudents.length > 0) {\n        // Xử lý nhận diện khuôn mặt sẽ được thêm sau\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi xử lý khuôn mặt:\", error);\n    }\n  };\n\n  // Điểm danh thủ công\n  const openManualAttendanceDialog = (student) => {\n    if (!student) {\n      enqueueSnackbar(\"Không tìm thấy thông tin sinh viên\", {\n        variant: \"error\",\n      });\n      return;\n    }\n\n    setSelectedStudent(student);\n    setManualAttendanceData({\n      status: \"present\", // Mặc định là có mặt\n      note: \"\",\n    });\n    setManualDialogOpen(true);\n  };\n\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n  };\n\n  const handleManualAttendanceChange = (e) => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent) return;\n\n    try {\n      // Hiển thị thông báo đang xử lý\n      enqueueSnackbar(\"Đang xử lý điểm danh thủ công...\", { variant: \"info\" });\n\n      // Gọi API điểm danh thủ công\n      const result = await dispatch(\n        manualAttendance({\n          sessionId,\n          studentId: selectedStudent._id,\n          status: manualAttendanceData.status,\n          note: manualAttendanceData.note,\n        })\n      ).unwrap();\n\n      // Nếu điểm danh thành công\n      if (result?.data) {\n        // Cập nhật logs điểm danh hiệu quả hơn\n        setAttendanceLogs((prevLogs) => {\n          // Lọc bỏ log cũ của sinh viên nếu có\n          const filteredLogs = prevLogs.filter(\n            (log) => log.student_id._id !== selectedStudent._id\n          );\n          // Thêm log mới\n          return [\n            ...filteredLogs,\n            {\n              ...result.data,\n              student_id: selectedStudent,\n            },\n          ];\n        });\n\n        enqueueSnackbar(\n          `Đã điểm danh ${\n            manualAttendanceData.status === \"present\"\n              ? \"có mặt\"\n              : manualAttendanceData.status === \"absent\"\n              ? \"vắng mặt\"\n              : manualAttendanceData.status === \"late\"\n              ? \"đi trễ\"\n              : \"về sớm\"\n          } cho ${selectedStudent.full_name}`,\n          { variant: \"success\" }\n        );\n\n        // Đóng dialog\n        handleManualDialogClose();\n\n        // Cập nhật thông tin phiên\n        fetchSessionInfo();\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(\"Lỗi khi điểm danh thủ công\", { variant: \"error\" });\n    }\n  };\n\n  // Đánh dấu điểm danh từ nhận diện khuôn mặt\n  const markAttendance = async (\n    studentId,\n    faceDescriptor,\n    confidence,\n    imageBase64\n  ) => {\n    try {\n      // Hiển thị thông báo đang xử lý\n      enqueueSnackbar(\"Đang xử lý điểm danh...\", { variant: \"info\" });\n\n      // Gọi API điểm danh qua Redux\n      const result = await dispatch(\n        verifyAttendance({\n          sessionId,\n          studentId,\n          faceDescriptor,\n          confidence,\n          imageBase64,\n        })\n      ).unwrap();\n\n      // Nếu điểm danh thành công\n      if (result?.data) {\n        // Tìm thông tin sinh viên\n        const student = classStudents.find((s) => s._id === studentId);\n\n        if (student) {\n          // Cập nhật logs điểm danh hiệu quả hơn\n          setAttendanceLogs((prevLogs) => {\n            // Lọc bỏ log cũ của sinh viên nếu có\n            const filteredLogs = prevLogs.filter(\n              (log) => log.student_id._id !== studentId\n            );\n            // Thêm log mới\n            return [\n              ...filteredLogs,\n              {\n                ...result.data,\n                student_id: student,\n              },\n            ];\n          });\n\n          enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n            variant: \"success\",\n          });\n        }\n\n        // Cập nhật thông tin phiên một cách bất đồng bộ\n        fetchSessionInfo();\n        return true;\n      }\n      return false;\n    } catch (error) {\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n      enqueueSnackbar(\"Lỗi khi xác nhận điểm danh\", { variant: \"error\" });\n      return false;\n    }\n  };\n\n  // Kết thúc phiên điểm danh\n  const completeSession = async () => {\n    try {\n      // Hiển thị thông báo đang xử lý\n      enqueueSnackbar(\"Đang kết thúc phiên điểm danh...\", { variant: \"info\" });\n\n      // Gọi API kết thúc phiên\n      await axios.put(\n        `${API_URL}/attendance/sessions/${sessionId}`,\n        { status: \"completed\" },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc thành công\", {\n        variant: \"success\",\n      });\n\n      // Chuyển hướng về trang lớp học\n      setTimeout(() => {\n        navigate(`/teacher/classes/${classId}`);\n      }, 1000);\n    } catch (error) {\n      console.error(\"Lỗi khi kết thúc phiên điểm danh:\", error);\n      enqueueSnackbar(\"Lỗi khi kết thúc phiên điểm danh\", { variant: \"error\" });\n    }\n  };\n\n  // Làm mới danh sách điểm danh\n  const refreshAttendanceLogs = async () => {\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu điểm danh...\", { variant: \"info\" });\n\n      // Tải song song dữ liệu logs và thông tin phiên\n      const [logsResponse, sessionResponse] = await Promise.all([\n        axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n        axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n      ]);\n\n      // Cập nhật state\n      setAttendanceLogs(logsResponse.data.data);\n      setSessionInfo(sessionResponse.data.data);\n\n      enqueueSnackbar(\"Đã làm mới dữ liệu điểm danh\", { variant: \"success\" });\n    } catch (error) {\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(\"Lỗi khi làm mới dữ liệu điểm danh\", {\n        variant: \"error\",\n      });\n    }\n  };\n\n  // Tối ưu hàm lấy thông tin phiên\n  const fetchSessionInfo = async () => {\n    try {\n      const sessionResponse = await axios.get(\n        `${API_URL}/attendance/sessions/${sessionId}`,\n        {\n          headers: { Authorization: `Bearer ${token}` },\n        }\n      );\n      setSessionInfo(sessionResponse.data.data);\n      return sessionResponse.data.data;\n    } catch (error) {\n      console.error(\"Lỗi khi lấy thông tin phiên:\", error);\n      return null;\n    }\n  };\n\n  // Tối ưu hàm xử lý nhận diện khuôn mặt\n  const captureAndRecognize = async () => {\n    try {\n      setIsRecognizing(true);\n      enqueueSnackbar(\"Đang nhận diện khuôn mặt...\", { variant: \"info\" });\n\n      // Kiểm tra camera\n      if (!ensureCameraIsWorking()) {\n        enqueueSnackbar(\"Camera không hoạt động, vui lòng khởi động lại\", {\n          variant: \"error\",\n        });\n        setIsRecognizing(false);\n        return;\n      }\n\n      // Phát hiện khuôn mặt\n      const detections = await handleDetectFaces(false);\n\n      // Lọc phát hiện không hợp lệ\n      const validDetections = detections.filter((detection) => {\n        const box = detection.detection?._box;\n        const descriptor = detection.descriptor;\n        return (\n          box &&\n          typeof box._x === \"number\" &&\n          !isNaN(box._x) &&\n          typeof box._y === \"number\" &&\n          !isNaN(box._y) &&\n          typeof box._width === \"number\" &&\n          !isNaN(box._width) &&\n          typeof box._height === \"number\" &&\n          !isNaN(box._height) &&\n          descriptor &&\n          Array.isArray(descriptor) &&\n          descriptor.length === 128\n        );\n      });\n\n      // Kiểm tra phát hiện khuôn mặt\n      if (!validDetections || validDetections.length === 0) {\n        enqueueSnackbar(\"Không phát hiện khuôn mặt hợp lệ nào trong hình\", {\n          variant: \"warning\",\n        });\n        setIsRecognizing(false);\n        return;\n      }\n\n      // Xử lý nhận diện với dữ liệu sinh viên\n      if (!classStudents || classStudents.length === 0) {\n        enqueueSnackbar(\"Không có dữ liệu sinh viên để so sánh\", {\n          variant: \"error\",\n        });\n        setIsRecognizing(false);\n        return;\n      }\n\n      // Chụp ảnh từ webcam an toàn\n      let imageBase64 = null;\n      try {\n        if (webcamRef.current) {\n          imageBase64 = webcamRef.current.getScreenshot();\n        }\n      } catch (err) {\n        console.error(\"Lỗi khi chụp ảnh từ webcam:\", err);\n        // Tiếp tục xử lý mà không có ảnh\n      }\n\n      // Lấy descriptor của khuôn mặt phát hiện được\n      const faceDescriptor = validDetections[0].descriptor;\n\n      // So sánh với dữ liệu sinh viên\n      const matchResults = [];\n\n      // Tạo một mảng promises để xử lý song song các tính toán\n      const comparePromises = classStudents.map(async (student) => {\n        // Trích xuất descriptors từ sinh viên\n        const studentDescriptors = extractStudentDescriptors(student);\n\n        if (studentDescriptors.length === 0) return null;\n\n        // Tính độ tương đồng tốt nhất\n        let bestMatch = 0;\n        for (const descriptor of studentDescriptors) {\n          try {\n            // Kiểm tra descriptor có hợp lệ không\n            if (\n              !Array.isArray(descriptor) ||\n              descriptor.length !== 128 ||\n              descriptor.some((val) => typeof val !== \"number\" || isNaN(val))\n            ) {\n              continue;\n            }\n\n            const distance = faceapi.euclideanDistance(\n              faceDescriptor,\n              descriptor\n            );\n            const similarity = Math.max(0, 1 - distance);\n            bestMatch = Math.max(bestMatch, similarity);\n          } catch (error) {\n            // Bỏ qua lỗi và tiếp tục với descriptor tiếp theo\n          }\n        }\n\n        return {\n          studentId: student._id,\n          name: student.full_name,\n          confidence: bestMatch,\n          studentCode: student.student_code,\n        };\n      });\n\n      // Đợi tất cả tính toán hoàn thành và lọc kết quả null\n      const results = (await Promise.all(comparePromises)).filter(\n        (result) => result !== null\n      );\n\n      // Sắp xếp kết quả theo độ tương đồng\n      results.sort((a, b) => b.confidence - a.confidence);\n      matchResults.push(...results);\n\n      // Lọc kết quả theo ngưỡng\n      const filteredResults = matchResults.filter(\n        (r) => r.confidence > RECOGNITION_THRESHOLD\n      );\n\n      // Cập nhật danh sách sinh viên được nhận diện\n      dispatch(setRecognizedStudents(filteredResults));\n\n      // Hiển thị kết quả\n      if (matchResults.length > 0) {\n        const topMatches = matchResults.slice(0, 3);\n\n        if (filteredResults.length > 0) {\n          const topMatch = filteredResults[0];\n          enqueueSnackbar(\n            `Đã nhận diện: ${topMatch.name} (${Math.round(\n              topMatch.confidence * 100\n            )}%)`,\n            { variant: \"success\" }\n          );\n\n          // Tự động điểm danh nếu độ tin cậy cao\n          if (topMatch.confidence > CONFIDENCE_THRESHOLD) {\n            handleMarkAttendance(topMatch.studentId, topMatch.confidence);\n          }\n        } else {\n          const matchDetails = topMatches\n            .map((m) => `${m.name}: ${(m.confidence * 100).toFixed(1)}%`)\n            .join(\", \");\n\n          enqueueSnackbar(\n            `Không nhận diện được sinh viên nào vượt ngưỡng. Gần nhất: ${matchDetails}`,\n            { variant: \"warning\" }\n          );\n        }\n      } else {\n        enqueueSnackbar(\"Không nhận diện được sinh viên nào\", {\n          variant: \"warning\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi nhận diện khuôn mặt:\", error);\n      enqueueSnackbar(`Lỗi khi nhận diện: ${error.message}`, {\n        variant: \"error\",\n      });\n    } finally {\n      setIsRecognizing(false);\n    }\n  };\n\n  // Tối ưu hàm đánh dấu điểm danh\n  const handleMarkAttendance = async (studentId, confidence) => {\n    // Kiểm tra xem sinh viên đã được điểm danh chưa\n    const isAlreadyAttended = attendanceLogs.some(\n      (log) => log.student_id._id === studentId && log.status === \"present\"\n    );\n\n    if (isAlreadyAttended) return;\n\n    try {\n      // Chụp ảnh từ video element\n      const videoElement = isAutoMode\n        ? videoRef.current\n        : webcamRef.current?.video;\n      if (!videoElement) return;\n\n      let imageBase64 = null;\n\n      // Tạo ảnh chụp\n      if (!isAutoMode && webcamRef.current) {\n        imageBase64 = webcamRef.current.getScreenshot();\n      } else if (isAutoMode && videoElement) {\n        // Tạo canvas để chụp từ video\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = videoElement.videoWidth;\n        canvas.height = videoElement.videoHeight;\n        const ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(videoElement, 0, 0);\n        imageBase64 = canvas.toDataURL(\"image/jpeg\");\n      }\n\n      // Tìm sinh viên trong danh sách\n      const student = classStudents.find((s) => s._id === studentId);\n      if (!student) return;\n\n      // Trích xuất descriptor\n      const descriptors = extractStudentDescriptors(student);\n      const descriptor = descriptors.length > 0 ? descriptors[0] : null;\n\n      // Gọi API điểm danh\n      await markAttendance(studentId, descriptor, confidence, imageBase64);\n    } catch (error) {\n      console.error(\"Lỗi khi đánh dấu điểm danh:\", error);\n      enqueueSnackbar(\"Lỗi khi đánh dấu điểm danh\", { variant: \"error\" });\n    }\n  };\n\n  // Bật/tắt hiển thị landmark trên khuôn mặt\n  const toggleLandmarkDetection = () => {\n    const newState = !showLandmark;\n    setShowLandmark(newState);\n\n    // Bắt đầu hoặc dừng interval landmark detection\n    if (newState) {\n      startLandmarkDetection();\n    } else if (landmarkIntervalId) {\n      clearInterval(landmarkIntervalId);\n      setLandmarkIntervalId(null);\n\n      // Xóa canvas khi tắt landmarks\n      const canvasElement = canvasRef.current;\n      if (canvasElement) {\n        const ctx = canvasElement.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n      }\n    }\n  };\n\n  // Thêm hàm debug để kiểm tra cấu trúc dữ liệu khuôn mặt\n  const debugFaceFeatures = () => {\n    if (!classStudents || classStudents.length === 0) {\n      console.log(\n        \"[DEBUG] Không có sinh viên nào để kiểm tra dữ liệu khuôn mặt\"\n      );\n      return;\n    }\n\n    classStudents.forEach((student, index) => {\n      console.log(`[DEBUG] Sinh viên #${index + 1}: ${student.full_name}`);\n\n      // Kiểm tra dữ liệu faceFeatures\n      if (student.faceFeatures) {\n        console.log(`  - Có dữ liệu faceFeatures`);\n\n        // Kiểm tra descriptors\n        if (student.faceFeatures.descriptors) {\n          console.log(\n            `  - Có descriptors: ${student.faceFeatures.descriptors.length} nhóm`\n          );\n\n          student.faceFeatures.descriptors.forEach((group, groupIndex) => {\n            if (Array.isArray(group)) {\n              console.log(\n                `    - Nhóm #${groupIndex + 1}: ${group.length} descriptors`\n              );\n\n              group.forEach((descriptor, descIndex) => {\n                if (Array.isArray(descriptor)) {\n                  console.log(\n                    `      - Descriptor #${descIndex + 1}: ${\n                      descriptor.length\n                    } phần tử`\n                  );\n                } else {\n                  console.log(\n                    `      - Descriptor #${descIndex + 1}: Không phải mảng`\n                  );\n                }\n              });\n            } else {\n              console.log(`    - Nhóm #${groupIndex + 1}: Không phải mảng`);\n            }\n          });\n        } else {\n          console.log(`  - Không có dữ liệu descriptors`);\n        }\n      } else {\n        console.log(`  - Không có dữ liệu faceFeatures`);\n      }\n\n      // Kiểm tra dữ liệu cũ (faceDescriptors)\n      if (student.faceDescriptors) {\n        console.log(\n          `  - Có dữ liệu faceDescriptors (cấu trúc cũ): ${student.faceDescriptors.length} descriptors`\n        );\n      }\n    });\n  };\n\n  // Tối ưu chế độ tự động điểm danh\n  const startAutoAttendance = () => {\n    // Dừng interval cũ nếu có\n    if (intervalId) {\n      clearInterval(intervalId);\n    }\n\n    // Hiển thị thông báo bắt đầu\n    enqueueSnackbar(\"Đã bật chế độ tự động điểm danh\", {\n      variant: \"success\",\n    });\n\n    // Thiết lập thời gian phát hiện ban đầu\n    setLastDetectionTime(Date.now());\n\n    // Khởi tạo interval mới để điểm danh tự động\n    const id = setInterval(async () => {\n      // Chỉ xử lý nếu camera đã sẵn sàng\n      if (isCameraReady) {\n        try {\n          // Phát hiện khuôn mặt\n          const detections = await handleDetectFaces(false);\n\n          // Nếu đã phát hiện khuôn mặt và có descriptor\n          if (detections && detections.length > 0 && detections[0].descriptor) {\n            // Nhận diện và điểm danh tự động\n            await processAutoRecognition(detections);\n          }\n        } catch (error) {\n          console.error(\"Lỗi trong quá trình điểm danh tự động:\", error);\n        }\n      }\n    }, AUTO_DETECT_INTERVAL);\n\n    // Lưu interval ID để có thể dừng sau này\n    setIntervalId(id);\n    setIsAutoMode(true);\n  };\n\n  // Hàm dừng chế độ tự động điểm danh\n  const stopAutoAttendance = () => {\n    if (intervalId) {\n      clearInterval(intervalId);\n      setIntervalId(null);\n    }\n    setIsAutoMode(false);\n    enqueueSnackbar(\"Đã tắt chế độ tự động điểm danh\", {\n      variant: \"info\",\n    });\n  };\n\n  // Hàm xử lý nhận diện tự động\n  const processAutoRecognition = async (detections) => {\n    try {\n      // Lọc kết quả không hợp lệ\n      const validDetections = detections.filter((detection) => {\n        const box = detection.detection?._box;\n        const descriptor = detection.descriptor;\n\n        return (\n          box &&\n          typeof box._x === \"number\" &&\n          !isNaN(box._x) &&\n          typeof box._y === \"number\" &&\n          !isNaN(box._y) &&\n          typeof box._width === \"number\" &&\n          !isNaN(box._width) &&\n          typeof box._height === \"number\" &&\n          !isNaN(box._height) &&\n          descriptor &&\n          Array.isArray(descriptor) &&\n          descriptor.length === 128\n        );\n      });\n\n      if (validDetections.length === 0) {\n        console.warn(\"Không có khuôn mặt hợp lệ để nhận diện tự động\");\n        return;\n      }\n\n      // Lấy descriptor khuôn mặt đầu tiên được phát hiện\n      const faceDescriptor = validDetections[0].descriptor;\n\n      // Kiểm tra có lớp học và sinh viên không\n      if (!classStudents || classStudents.length === 0) {\n        return;\n      }\n\n      // Lấy ảnh từ camera\n      const videoElement = isAutoMode\n        ? videoRef.current\n        : webcamRef.current?.video;\n      if (!videoElement || videoElement.readyState !== 4) {\n        console.warn(\"Video chưa sẵn sàng để chụp\");\n        return;\n      }\n\n      let imageBase64 = null;\n      try {\n        // Chụp ảnh từ video element\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = videoElement.videoWidth;\n        canvas.height = videoElement.videoHeight;\n\n        if (canvas.width === 0 || canvas.height === 0) {\n          console.warn(\n            \"Kích thước video không hợp lệ:\",\n            canvas.width,\n            canvas.height\n          );\n          return;\n        }\n\n        const ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(videoElement, 0, 0);\n        imageBase64 = canvas.toDataURL(\"image/jpeg\");\n      } catch (err) {\n        console.error(\"Lỗi khi chụp ảnh từ video:\", err);\n        // Tiếp tục xử lý dù không có ảnh\n      }\n\n      // Tạo một mảng promises để xử lý song song các tính toán\n      const comparePromises = classStudents.map(async (student) => {\n        // Trích xuất descriptors từ sinh viên\n        const studentDescriptors = extractStudentDescriptors(student);\n\n        if (studentDescriptors.length === 0) return null;\n\n        // Tính độ tương đồng tốt nhất\n        let bestMatch = 0;\n        for (const descriptor of studentDescriptors) {\n          try {\n            // Kiểm tra descriptor có hợp lệ không\n            if (\n              !Array.isArray(descriptor) ||\n              descriptor.length !== 128 ||\n              descriptor.some((val) => typeof val !== \"number\" || isNaN(val))\n            ) {\n              continue;\n            }\n\n            const distance = faceapi.euclideanDistance(\n              faceDescriptor,\n              descriptor\n            );\n            const similarity = Math.max(0, 1 - distance);\n            bestMatch = Math.max(bestMatch, similarity);\n          } catch (error) {\n            // Bỏ qua lỗi và tiếp tục với descriptor tiếp theo\n          }\n        }\n\n        return {\n          studentId: student._id,\n          name: student.full_name,\n          confidence: bestMatch,\n          studentCode: student.student_code,\n        };\n      });\n\n      // Đợi tất cả tính toán hoàn thành và lọc kết quả null\n      const results = (await Promise.all(comparePromises)).filter(\n        (result) => result !== null\n      );\n\n      // Sắp xếp kết quả theo độ tương đồng\n      results.sort((a, b) => b.confidence - a.confidence);\n\n      // Lọc kết quả theo ngưỡng\n      const filteredResults = results.filter(\n        (r) => r.confidence > RECOGNITION_THRESHOLD\n      );\n\n      // Cập nhật danh sách sinh viên được nhận diện\n      dispatch(setRecognizedStudents(filteredResults));\n\n      // Nếu có kết quả vượt ngưỡng tin cậy, tự động điểm danh\n      if (filteredResults.length > 0) {\n        const topMatch = filteredResults[0];\n\n        if (topMatch.confidence > CONFIDENCE_THRESHOLD) {\n          // Kiểm tra sinh viên đã được điểm danh chưa\n          const isAlreadyAttended = attendanceLogs.some(\n            (log) =>\n              log.student_id._id === topMatch.studentId &&\n              log.status === \"present\"\n          );\n\n          if (!isAlreadyAttended) {\n            // Đánh dấu điểm danh cho sinh viên\n            await handleMarkAttendance(topMatch.studentId, topMatch.confidence);\n\n            // Hiển thị thông báo thành công\n            enqueueSnackbar(\n              `Đã tự động điểm danh cho ${topMatch.name} (${Math.round(\n                topMatch.confidence * 100\n              )}%)`,\n              { variant: \"success\" }\n            );\n          }\n        }\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi xử lý nhận diện tự động:\", error);\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <Box\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        minHeight=\"60vh\"\n      >\n        <CircularProgress />\n      </Box>\n    );\n  }\n\n  // Lấy danh sách sinh viên vắng mặt\n  const getAbsentStudents = () => {\n    if (!classInfo || !classInfo.students || !attendanceLogs) return [];\n\n    // Tạo Set các ID sinh viên đã điểm danh để tăng tốc độ tìm kiếm\n    const presentStudentIds = new Set(\n      attendanceLogs\n        .filter((log) => log.status === \"present\")\n        .map((log) => log.student_id._id)\n    );\n\n    // Lọc ra sinh viên chưa điểm danh\n    return classInfo.students.filter(\n      (student) => !presentStudentIds.has(student._id)\n    );\n  };\n\n  const absentStudents = getAbsentStudents();\n\n  // Điểm danh thủ công trong chế độ đơn giản\n  const showStudentList = () => {\n    if (!classInfo) {\n      enqueueSnackbar(\"Không có thông tin lớp học\", { variant: \"error\" });\n      return;\n    }\n\n    // Lấy danh sách sinh viên vắng mặt\n    const absentStudents = getAbsentStudents();\n\n    if (absentStudents.length === 0) {\n      enqueueSnackbar(\"Tất cả sinh viên đã được điểm danh\", {\n        variant: \"success\",\n      });\n      return;\n    }\n\n    // Mở dialog điểm danh thủ công với sinh viên đầu tiên trong danh sách\n    if (absentStudents.length > 0 && absentStudents[0]) {\n      openManualAttendanceDialog(absentStudents[0]);\n    }\n  };\n\n  // Tối ưu phần Webcam và Camera\n  const VideoDisplay = ({\n    isCameraReady,\n    isAutoMode,\n    webcamRef,\n    videoRef,\n    canvasRef,\n    onUserMedia,\n    onUserMediaError,\n  }) => {\n    // Component con để xử lý hiển thị video\n    return (\n      <Paper\n        elevation={3}\n        sx={{\n          position: \"relative\",\n          width: \"100%\",\n          height: \"400px\",\n          display: \"flex\",\n          justifyContent: \"center\",\n          alignItems: \"center\",\n          overflow: \"hidden\",\n          mb: 2,\n          borderRadius: \"8px\",\n          border: \"1px solid rgba(0, 0, 0, 0.12)\",\n        }}\n      >\n        {isCameraReady ? (\n          <>\n            {isAutoMode ? (\n              // Video element cho chế độ tự động\n              <video\n                ref={videoRef}\n                style={{\n                  position: \"absolute\",\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\",\n                }}\n                autoPlay\n                playsInline\n                muted\n              />\n            ) : (\n              // Webcam component cho chế độ thủ công\n              <Webcam\n                audio={false}\n                ref={webcamRef}\n                screenshotFormat=\"image/jpeg\"\n                width={640}\n                height={480}\n                videoConstraints={{\n                  width: 640,\n                  height: 480,\n                  facingMode: \"user\",\n                }}\n                style={{\n                  position: \"absolute\",\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\",\n                }}\n                onUserMedia={onUserMedia}\n                onUserMediaError={onUserMediaError}\n              />\n            )}\n\n            {/* Canvas cho hiển thị landmarks */}\n            <canvas\n              ref={canvasRef}\n              style={{\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                objectFit: \"cover\",\n                zIndex: 10,\n              }}\n            />\n\n            {/* Chỉ báo chế độ */}\n            <Box\n              sx={{\n                position: \"absolute\",\n                bottom: 10,\n                right: 10,\n                backgroundColor: \"rgba(0,0,0,0.6)\",\n                color: \"white\",\n                padding: \"4px 8px\",\n                borderRadius: \"4px\",\n                fontSize: \"12px\",\n                display: \"flex\",\n                alignItems: \"center\",\n                zIndex: 20,\n              }}\n            >\n              {isAutoMode ? (\n                <>\n                  <span style={{ color: \"#4CAF50\", marginRight: \"5px\" }}>\n                    ●\n                  </span>\n                  Đang tự động điểm danh\n                </>\n              ) : (\n                <>\n                  <span style={{ color: \"#FFC107\", marginRight: \"5px\" }}>\n                    ●\n                  </span>\n                  Chế độ thủ công\n                </>\n              )}\n            </Box>\n          </>\n        ) : (\n          <CameraLoadingPlaceholder />\n        )}\n      </Paper>\n    );\n  };\n\n  // Tối ưu giao diện hiển thị danh sách sinh viên đã điểm danh\n  const PresentStudentsList = ({\n    attendanceLogs,\n    refreshAttendanceLogs,\n    totalStudents,\n  }) => (\n    <Card\n      sx={{\n        mb: 3,\n        borderRadius: \"10px\",\n        boxShadow: \"0 2px 8px rgba(0,0,0,0.08)\",\n      }}\n    >\n      <CardContent>\n        <Box\n          display=\"flex\"\n          justifyContent=\"space-between\"\n          alignItems=\"center\"\n          mb={2}\n        >\n          <Box display=\"flex\" alignItems=\"center\">\n            <Box\n              sx={{\n                width: 10,\n                height: 10,\n                borderRadius: \"50%\",\n                backgroundColor: \"#4CAF50\",\n                mr: 1,\n              }}\n            />\n            <Typography variant=\"h6\">\n              Có mặt (\n              {attendanceLogs.filter((log) => log.status === \"present\").length}/\n              {totalStudents})\n            </Typography>\n          </Box>\n          <Tooltip title=\"Làm mới danh sách điểm danh\">\n            <IconButton\n              size=\"small\"\n              onClick={refreshAttendanceLogs}\n              sx={{\n                backgroundColor: \"#f4f4f4\",\n                \"&:hover\": { backgroundColor: \"#e0e0e0\" },\n              }}\n            >\n              <Refresh />\n            </IconButton>\n          </Tooltip>\n        </Box>\n\n        <Box sx={{ maxHeight: \"350px\", overflow: \"auto\", pr: 1 }}>\n          {attendanceLogs.filter((log) => log.status === \"present\").length ===\n          0 ? (\n            <Box\n              sx={{\n                display: \"flex\",\n                flexDirection: \"column\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                py: 4,\n                color: \"text.secondary\",\n              }}\n            >\n              <HourglassEmpty sx={{ fontSize: 40, mb: 1, opacity: 0.5 }} />\n              <Typography variant=\"body2\">\n                Chưa có sinh viên nào điểm danh\n              </Typography>\n            </Box>\n          ) : (\n            <List dense>\n              {attendanceLogs\n                .filter((log) => log.status === \"present\")\n                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))\n                .map((log) => (\n                  <Paper\n                    key={log._id}\n                    elevation={0}\n                    sx={{\n                      mb: 1,\n                      borderRadius: \"8px\",\n                      backgroundColor: \"#f9f9f9\",\n                      overflow: \"hidden\",\n                    }}\n                  >\n                    <ListItem\n                      secondaryAction={\n                        <Chip\n                          size=\"small\"\n                          icon={\n                            log.recognized ? (\n                              <VerifiedUser fontSize=\"small\" />\n                            ) : null\n                          }\n                          label={log.recognized ? \"Tự động\" : \"Thủ công\"}\n                          color={log.recognized ? \"success\" : \"primary\"}\n                          sx={{\n                            borderRadius: \"4px\",\n                            \"& .MuiChip-label\": { px: 1 },\n                          }}\n                        />\n                      }\n                    >\n                      <ListItemAvatar>\n                        <Avatar\n                          alt={log.student_id.full_name}\n                          src={log.student_id.avatar_url}\n                          sx={{\n                            border: \"2px solid #f0f0f0\",\n                            bgcolor: log.recognized ? \"#e8f5e9\" : \"#e3f2fd\",\n                          }}\n                        />\n                      </ListItemAvatar>\n                      <ListItemText\n                        primary={\n                          <Typography variant=\"body2\" fontWeight={500}>\n                            {log.student_id.full_name}\n                          </Typography>\n                        }\n                        secondary={\n                          <Typography variant=\"caption\" color=\"text.secondary\">\n                            {new Date(log.timestamp).toLocaleTimeString(\n                              \"vi-VN\"\n                            )}\n                            {log.note && ` • ${log.note}`}\n                          </Typography>\n                        }\n                      />\n                    </ListItem>\n                  </Paper>\n                ))}\n            </List>\n          )}\n        </Box>\n      </CardContent>\n    </Card>\n  );\n\n  // Tối ưu giao diện hiển thị danh sách sinh viên vắng mặt\n  const AbsentStudentsList = ({\n    absentStudents,\n    onOpenManualAttendance,\n    totalStudents,\n  }) => (\n    <Card\n      sx={{ borderRadius: \"10px\", boxShadow: \"0 2px 8px rgba(0,0,0,0.08)\" }}\n    >\n      <CardContent>\n        <Box display=\"flex\" alignItems=\"center\" mb={2}>\n          <Box\n            sx={{\n              width: 10,\n              height: 10,\n              borderRadius: \"50%\",\n              backgroundColor: \"#f44336\",\n              mr: 1,\n            }}\n          />\n          <Typography variant=\"h6\">\n            Vắng mặt ({absentStudents.length}/{totalStudents})\n          </Typography>\n        </Box>\n\n        <Box sx={{ maxHeight: \"350px\", overflow: \"auto\", pr: 1 }}>\n          {absentStudents.length === 0 ? (\n            <Box\n              sx={{\n                display: \"flex\",\n                flexDirection: \"column\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                py: 4,\n                color: \"text.secondary\",\n              }}\n            >\n              <Check sx={{ fontSize: 40, mb: 1, opacity: 0.5 }} />\n              <Typography variant=\"body2\">\n                Tất cả sinh viên đã được điểm danh\n              </Typography>\n            </Box>\n          ) : (\n            <List dense>\n              {absentStudents.map((student) => (\n                <Paper\n                  key={student._id}\n                  elevation={0}\n                  sx={{\n                    mb: 1,\n                    borderRadius: \"8px\",\n                    backgroundColor: \"#f9f9f9\",\n                    overflow: \"hidden\",\n                    transition: \"all 0.2s\",\n                    \"&:hover\": {\n                      backgroundColor: \"#f0f0f0\",\n                    },\n                  }}\n                >\n                  <ListItem\n                    secondaryAction={\n                      <Tooltip title=\"Điểm danh thủ công\">\n                        <IconButton\n                          edge=\"end\"\n                          onClick={() => onOpenManualAttendance(student)}\n                          size=\"small\"\n                          sx={{\n                            backgroundColor: \"#e0e0e0\",\n                            \"&:hover\": { backgroundColor: \"#bdbdbd\" },\n                          }}\n                        >\n                          <Edit fontSize=\"small\" />\n                        </IconButton>\n                      </Tooltip>\n                    }\n                  >\n                    <ListItemAvatar>\n                      <Avatar\n                        alt={student.full_name}\n                        src={student.avatar_url}\n                        sx={{\n                          border: \"2px solid #f0f0f0\",\n                          filter: \"grayscale(0.5)\",\n                        }}\n                      />\n                    </ListItemAvatar>\n                    <ListItemText\n                      primary={\n                        <Typography variant=\"body2\" fontWeight={500}>\n                          {student.full_name}\n                        </Typography>\n                      }\n                      secondary={\n                        <Typography variant=\"caption\" color=\"text.secondary\">\n                          {student.student_code}\n                        </Typography>\n                      }\n                    />\n                  </ListItem>\n                </Paper>\n              ))}\n            </List>\n          )}\n        </Box>\n      </CardContent>\n    </Card>\n  );\n\n  // Tối ưu dialog điểm danh thủ công\n  const ManualAttendanceDialog = ({\n    open,\n    onClose,\n    student,\n    attendanceData,\n    onAttendanceChange,\n    onSubmit,\n  }) => (\n    <Dialog\n      open={open}\n      onClose={onClose}\n      maxWidth=\"sm\"\n      fullWidth\n      PaperProps={{\n        sx: {\n          borderRadius: \"12px\",\n          overflow: \"hidden\",\n        },\n      }}\n    >\n      <DialogTitle sx={{ bgcolor: \"#f5f5f5\", py: 2 }}>\n        <Typography variant=\"h6\" fontWeight={500}>\n          Điểm danh thủ công\n        </Typography>\n      </DialogTitle>\n      <DialogContent dividers>\n        <Box sx={{ p: 1 }}>\n          {student && (\n            <Box display=\"flex\" alignItems=\"center\" mb={3}>\n              <Avatar\n                src={student.avatar_url}\n                alt={student.full_name}\n                sx={{ width: 56, height: 56, mr: 2 }}\n              />\n              <Box>\n                <Typography variant=\"h6\" gutterBottom>\n                  {student.full_name}\n                </Typography>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  MSSV: {student.student_code}\n                </Typography>\n              </Box>\n            </Box>\n          )}\n\n          <FormControl fullWidth margin=\"normal\">\n            <InputLabel>Trạng thái</InputLabel>\n            <Select\n              name=\"status\"\n              value={attendanceData.status}\n              onChange={onAttendanceChange}\n              label=\"Trạng thái\"\n            >\n              <MenuItem value=\"present\">\n                <Box sx={{ display: \"flex\", alignItems: \"center\" }}>\n                  <Check sx={{ color: \"#4CAF50\", mr: 1 }} />\n                  Có mặt\n                </Box>\n              </MenuItem>\n              <MenuItem value=\"absent\">\n                <Box sx={{ display: \"flex\", alignItems: \"center\" }}>\n                  <Close sx={{ color: \"#F44336\", mr: 1 }} />\n                  Vắng mặt\n                </Box>\n              </MenuItem>\n              <MenuItem value=\"late\">\n                <Box sx={{ display: \"flex\", alignItems: \"center\" }}>\n                  <HourglassEmpty sx={{ color: \"#FFC107\", mr: 1 }} />\n                  Đi trễ\n                </Box>\n              </MenuItem>\n              <MenuItem value=\"early_leave\">\n                <Box sx={{ display: \"flex\", alignItems: \"center\" }}>\n                  <HourglassEmpty sx={{ color: \"#FF9800\", mr: 1 }} />\n                  Về sớm\n                </Box>\n              </MenuItem>\n            </Select>\n          </FormControl>\n\n          <TextField\n            fullWidth\n            margin=\"normal\"\n            name=\"note\"\n            label=\"Ghi chú\"\n            value={attendanceData.note}\n            onChange={onAttendanceChange}\n            multiline\n            rows={2}\n            placeholder=\"Nhập ghi chú (nếu có)\"\n          />\n        </Box>\n      </DialogContent>\n      <DialogActions sx={{ px: 3, py: 2 }}>\n        <Button onClick={onClose} variant=\"outlined\" startIcon={<Close />}>\n          Hủy\n        </Button>\n        <Button\n          onClick={onSubmit}\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<Save />}\n        >\n          Xác nhận\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n\n  // Tối ưu phần hiển thị camera placeholder với hướng dẫn rõ ràng hơn\n  const CameraLoadingPlaceholder = () => (\n    <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\" py={4}>\n      <Box\n        sx={{\n          width: 80,\n          height: 80,\n          borderRadius: \"50%\",\n          backgroundColor: \"#e3f2fd\",\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          mb: 3,\n        }}\n      >\n        <CameraAlt sx={{ fontSize: 40, color: \"#2196f3\" }} />\n      </Box>\n\n      <Typography variant=\"h6\" gutterBottom align=\"center\" fontWeight={500}>\n        Sẵn sàng điểm danh\n      </Typography>\n\n      <Typography\n        variant=\"body2\"\n        color=\"textSecondary\"\n        align=\"center\"\n        paragraph\n        sx={{ maxWidth: 400 }}\n      >\n        Nhấn nút bên dưới để khởi động camera và bắt đầu quá trình điểm danh\n      </Typography>\n\n      <Button\n        variant=\"contained\"\n        color=\"primary\"\n        size=\"large\"\n        onClick={initDirectCamera}\n        startIcon={<CameraAlt />}\n        sx={{ mt: 2, mb: 3, px: 3, borderRadius: \"24px\" }}\n      >\n        Bắt đầu điểm danh\n      </Button>\n\n      <Alert\n        severity=\"info\"\n        variant=\"outlined\"\n        sx={{ maxWidth: 500 }}\n        icon={<Info />}\n      >\n        <AlertTitle>Lưu ý khi sử dụng camera</AlertTitle>\n        <Typography variant=\"body2\" component=\"div\">\n          <ul>\n            <li>Đảm bảo bạn đã cấp quyền truy cập camera cho trình duyệt</li>\n            <li>Điều chỉnh ánh sáng đầy đủ để tăng độ chính xác nhận diện</li>\n            <li>Camera sẽ tự động nhận diện khuôn mặt trong chế độ tự động</li>\n            <li>Có thể điểm danh thủ công nếu gặp vấn đề với camera</li>\n            <li>\n              Nhấn \"Chụp & Nhận diện\" để điểm danh thủ công từng sinh viên\n            </li>\n          </ul>\n        </Typography>\n        <Box display=\"flex\" justifyContent=\"flex-end\" mt={1}>\n          <Button\n            variant=\"outlined\"\n            color=\"warning\"\n            size=\"small\"\n            onClick={showStudentList}\n            startIcon={<Edit />}\n          >\n            Điểm danh thủ công\n          </Button>\n        </Box>\n      </Alert>\n    </Box>\n  );\n\n  // Component hiển thị danh sách sinh viên đã nhận diện\n  const RecognizedStudentsList = ({ students, onMarkAttendance }) => {\n    if (students.length === 0) return null;\n\n    return (\n      <Box mt={2}>\n        <Box display=\"flex\" alignItems=\"center\" mb={1}>\n          <Box\n            sx={{\n              width: 10,\n              height: 10,\n              borderRadius: \"50%\",\n              backgroundColor: \"#4CAF50\",\n              mr: 1,\n            }}\n          />\n          <Typography variant=\"subtitle1\" fontWeight=\"500\">\n            Đã nhận diện ({students.length})\n          </Typography>\n        </Box>\n\n        <Grid container spacing={2}>\n          {students.map((student, index) => (\n            <Grid item xs={6} sm={4} md={3} key={index}>\n              <Paper\n                elevation={2}\n                sx={{\n                  p: 1.5,\n                  display: \"flex\",\n                  flexDirection: \"column\",\n                  alignItems: \"center\",\n                  borderRadius: \"8px\",\n                  transition: \"all 0.2s\",\n                  \"&:hover\": {\n                    transform: \"translateY(-3px)\",\n                    boxShadow: \"0 4px 10px rgba(0,0,0,0.1)\",\n                  },\n                }}\n              >\n                <Typography\n                  variant=\"body2\"\n                  fontWeight=\"500\"\n                  align=\"center\"\n                  noWrap\n                >\n                  {student.name}\n                </Typography>\n\n                <Box\n                  sx={{\n                    width: \"100%\",\n                    mt: 1,\n                    mb: 1,\n                    display: \"flex\",\n                    alignItems: \"center\",\n                    justifyContent: \"center\",\n                  }}\n                >\n                  <Box\n                    sx={{\n                      width: \"100%\",\n                      height: 6,\n                      backgroundColor: \"#eee\",\n                      borderRadius: 3,\n                      position: \"relative\",\n                    }}\n                  >\n                    <Box\n                      sx={{\n                        position: \"absolute\",\n                        left: 0,\n                        top: 0,\n                        height: \"100%\",\n                        width: `${Math.round(student.confidence * 100)}%`,\n                        backgroundColor:\n                          student.confidence > 0.7\n                            ? \"#4CAF50\"\n                            : student.confidence > 0.6\n                            ? \"#8BC34A\"\n                            : student.confidence > 0.5\n                            ? \"#FFC107\"\n                            : \"#FF9800\",\n                        borderRadius: 3,\n                        transition: \"width 0.4s\",\n                      }}\n                    />\n                  </Box>\n                  <Typography\n                    variant=\"caption\"\n                    color=\"textSecondary\"\n                    sx={{ ml: 1, minWidth: \"36px\" }}\n                  >\n                    {Math.round(student.confidence * 100)}%\n                  </Typography>\n                </Box>\n\n                <Button\n                  size=\"small\"\n                  variant=\"contained\"\n                  color=\"primary\"\n                  fullWidth\n                  onClick={() =>\n                    onMarkAttendance(student.studentId, student.confidence)\n                  }\n                  startIcon={<Check />}\n                  sx={{ mt: 0.5 }}\n                >\n                  Điểm danh\n                </Button>\n              </Paper>\n            </Grid>\n          ))}\n        </Grid>\n      </Box>\n    );\n  };\n\n  return (\n    <Box sx={{ position: \"relative\" }}>\n      <Box\n        display=\"flex\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        mb={2.5}\n        sx={{\n          borderBottom: \"1px solid #eaeaea\",\n          pb: 2,\n        }}\n      >\n        <Box>\n          <Typography variant=\"h5\" fontWeight={500}>\n            Điểm Danh - {classInfo?.class_name}\n          </Typography>\n          <Typography variant=\"subtitle1\" color=\"textSecondary\">\n            Buổi {sessionInfo?.session_number} -{\" \"}\n            {new Date(sessionInfo?.date).toLocaleDateString(\"vi-VN\")}\n          </Typography>\n        </Box>\n        <Button\n          variant=\"outlined\"\n          startIcon={<ArrowBack />}\n          onClick={() => navigate(`/teacher/classes/${classId}`)}\n          sx={{ borderRadius: \"8px\" }}\n        >\n          Quay lại\n        </Button>\n      </Box>\n\n      <Grid container spacing={3} mt={0.5}>\n        <Grid item xs={12} md={8}>\n          <Card\n            sx={{\n              borderRadius: \"10px\",\n              boxShadow: \"0 2px 8px rgba(0,0,0,0.08)\",\n              overflow: \"hidden\",\n            }}\n          >\n            <CardContent\n              sx={{\n                bgcolor: \"#f8f9fa\",\n                borderBottom: \"1px solid #eaeaea\",\n                pb: 2,\n              }}\n            >\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n              >\n                <Box display=\"flex\" alignItems=\"center\">\n                  <CameraAlt\n                    fontSize=\"small\"\n                    sx={{ color: \"#1976d2\", mr: 1 }}\n                  />\n                  <Typography variant=\"h6\" fontWeight={500}>\n                    Camera nhận diện\n                  </Typography>\n                </Box>\n                {isCameraReady && (\n                  <Box>\n                    <Chip\n                      label={\n                        isAutoMode ? \"Tự động đang bật\" : \"Tự động đang tắt\"\n                      }\n                      color={isAutoMode ? \"success\" : \"default\"}\n                      sx={{ mr: 1, borderRadius: \"6px\" }}\n                    />\n                    <Button\n                      variant={isAutoMode ? \"outlined\" : \"contained\"}\n                      color={isAutoMode ? \"error\" : \"primary\"}\n                      onClick={() => {\n                        if (isAutoMode) {\n                          stopAutoAttendance();\n                        } else {\n                          startAutoAttendance();\n                        }\n                      }}\n                      sx={{ borderRadius: \"8px\" }}\n                    >\n                      {isAutoMode ? \"Tắt tự động\" : \"Bật tự động\"}\n                    </Button>\n                  </Box>\n                )}\n              </Box>\n            </CardContent>\n\n            {/* Sử dụng component VideoDisplay hoặc CameraLoadingPlaceholder */}\n            {isCameraReady ? (\n              <VideoDisplay\n                isCameraReady={isCameraReady}\n                isAutoMode={isAutoMode}\n                webcamRef={webcamRef}\n                videoRef={videoRef}\n                canvasRef={canvasRef}\n                onUserMedia={(stream) => {\n                  console.log(\n                    \"Camera đã được cấp quyền và khởi tạo\",\n                    stream.id\n                  );\n                  setTimeout(() => {\n                    if (webcamRef.current && webcamRef.current.video) {\n                      dispatch(setCameraReady(true));\n                      setLastDetectionTime(Date.now());\n                    }\n                  }, 500);\n                }}\n                onUserMediaError={(err) => {\n                  console.error(\"Lỗi khi truy cập camera:\", err);\n                  enqueueSnackbar(\n                    `Không thể truy cập camera: ${\n                      err.name === \"NotAllowedError\"\n                        ? \"Bạn chưa cấp quyền truy cập camera\"\n                        : err.name === \"NotFoundError\"\n                        ? \"Không tìm thấy thiết bị camera\"\n                        : err.message || \"Lỗi không xác định\"\n                    }`,\n                    { variant: \"error\" }\n                  );\n                }}\n              />\n            ) : (\n              <CameraLoadingPlaceholder />\n            )}\n\n            {isCameraReady && (\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                px={3}\n                py={2}\n                bgcolor=\"#f8f9fa\"\n              >\n                <Button\n                  variant=\"outlined\"\n                  onClick={captureAndRecognize}\n                  startIcon={\n                    isRecognizing ? (\n                      <CircularProgress size={20} color=\"inherit\" />\n                    ) : (\n                      <CameraAlt />\n                    )\n                  }\n                  disabled={!isCameraReady || isRecognizing || isAutoMode}\n                  sx={{ borderRadius: \"8px\" }}\n                >\n                  {isRecognizing ? \"Đang nhận diện...\" : \"Chụp & Nhận diện\"}\n                </Button>\n\n                <Box>\n                  <Button\n                    variant=\"outlined\"\n                    color={showLandmark ? \"success\" : \"info\"}\n                    onClick={toggleLandmarkDetection}\n                    sx={{ mr: 1, borderRadius: \"8px\" }}\n                  >\n                    {showLandmark ? \"Tắt Landmark\" : \"Hiện Landmark\"}\n                  </Button>\n\n                  <Button\n                    variant=\"contained\"\n                    color=\"primary\"\n                    onClick={completeSession}\n                    startIcon={<Save />}\n                    disabled={sessionInfo?.status === \"completed\"}\n                    sx={{ borderRadius: \"8px\" }}\n                  >\n                    Kết thúc phiên\n                  </Button>\n                </Box>\n              </Box>\n            )}\n\n            {/* Sử dụng component RecognizedStudentsList */}\n            <Box px={3} pb={3}>\n              <RecognizedStudentsList\n                students={recognizedStudents}\n                onMarkAttendance={handleMarkAttendance}\n              />\n            </Box>\n          </Card>\n        </Grid>\n\n        <Grid item xs={12} md={4}>\n          {/* Sử dụng component PresentStudentsList */}\n          <PresentStudentsList\n            attendanceLogs={attendanceLogs.filter(\n              (log) => log.status === \"present\"\n            )}\n            refreshAttendanceLogs={refreshAttendanceLogs}\n            totalStudents={classInfo?.students.length || 0}\n          />\n\n          {/* Sử dụng component AbsentStudentsList */}\n          <AbsentStudentsList\n            absentStudents={absentStudents}\n            onOpenManualAttendance={openManualAttendanceDialog}\n            totalStudents={classInfo?.students.length || 0}\n          />\n        </Grid>\n      </Grid>\n\n      {/* Sử dụng component ManualAttendanceDialog */}\n      <ManualAttendanceDialog\n        open={manualDialogOpen}\n        onClose={handleManualDialogClose}\n        student={selectedStudent}\n        attendanceData={manualAttendanceData}\n        onAttendanceChange={handleManualAttendanceChange}\n        onSubmit={handleManualAttendanceSubmit}\n      />\n    </Box>\n  );\n};\n\nexport default AttendancePage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\teacher\\\\CameraTestPage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { Box, Typography, Button, Alert, Paper, Grid, CircularProgress } from \"@mui/material\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst CameraTestPage = () => {\n  _s();\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [error, setError] = useState(null);\n  const [isCameraReady, setIsCameraReady] = useState(false);\n  const [isSupported, setIsSupported] = useState(true);\n  const [permissionState, setPermissionState] = useState(\"chưa kiểm tra\");\n  const [cameraStream, setCameraStream] = useState(null);\n  const [mediaDevices, setMediaDevices] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [capturedImage, setCapturedImage] = useState(null);\n\n  // Kiểm tra hỗ trợ\n  useEffect(() => {\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n      console.error(\"MediaDevices API không được hỗ trợ\");\n      setIsSupported(false);\n      setError(\"Trình duyệt không hỗ trợ API camera\");\n    }\n\n    // Liệt kê các thiết bị media\n    if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\n      navigator.mediaDevices.enumerateDevices().then(devices => {\n        const videoDevices = devices.filter(device => device.kind === \"videoinput\");\n        setMediaDevices(videoDevices);\n      }).catch(err => {\n        console.error(\"Lỗi khi liệt kê thiết bị:\", err);\n      });\n    }\n    return () => {\n      // Cleanup\n      if (cameraStream) {\n        cameraStream.getTracks().forEach(track => {\n          track.stop();\n        });\n      }\n    };\n  }, []);\n\n  // Kiểm tra quyền camera\n  const checkCameraPermission = async () => {\n    try {\n      const result = await navigator.permissions.query({\n        name: \"camera\"\n      });\n      setPermissionState(result.state);\n\n      // Lắng nghe sự thay đổi trạng thái\n      result.onchange = () => {\n        setPermissionState(result.state);\n      };\n    } catch (err) {\n      console.log(\"Không thể truy vấn quyền camera:\", err);\n    }\n  };\n\n  // Khởi tạo camera\n  const startCamera = async () => {\n    try {\n      setError(null);\n      setIsLoading(true);\n      const constraints = {\n        video: {\n          width: {\n            ideal: 640\n          },\n          height: {\n            ideal: 480\n          },\n          facingMode: \"user\"\n        },\n        audio: false\n      };\n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\n      setCameraStream(stream);\n      if (videoRef.current) {\n        // Thử cách 1: Set srcObject\n        videoRef.current.srcObject = stream;\n\n        // Thêm event listeners cho video element\n        videoRef.current.onloadedmetadata = () => {};\n        videoRef.current.onloadeddata = () => {};\n        videoRef.current.onplay = () => {};\n        videoRef.current.onerror = e => {\n          console.error(\"Lỗi video element:\", e);\n        };\n        try {\n          await videoRef.current.play();\n        } catch (playErr) {\n          console.error(\"Lỗi khi phát video:\", playErr);\n        }\n        setIsCameraReady(true);\n        await checkCameraPermission();\n      } else {\n        console.error(\"videoRef.current không tồn tại\");\n      }\n    } catch (err) {\n      console.error(\"Lỗi khi truy cập camera:\", err);\n      setError(`Lỗi: ${err.name} - ${err.message}`);\n      setIsCameraReady(false);\n      await checkCameraPermission();\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Chụp ảnh từ camera\n  const captureImage = () => {\n    if (videoRef.current && isCameraReady) {\n      const canvas = document.createElement(\"canvas\");\n      canvas.width = videoRef.current.videoWidth;\n      canvas.height = videoRef.current.videoHeight;\n      const ctx = canvas.getContext(\"2d\");\n\n      // Vẽ video frame hiện tại vào canvas\n      ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\n\n      // Chuyển đổi canvas thành data URL\n      const dataUrl = canvas.toDataURL(\"image/jpeg\");\n      setCapturedImage(dataUrl);\n    }\n  };\n\n  // Dừng camera\n  const stopCamera = () => {\n    if (cameraStream) {\n      cameraStream.getTracks().forEach(track => {\n        track.stop();\n      });\n      setCameraStream(null);\n    }\n    if (videoRef.current) {\n      videoRef.current.srcObject = null;\n    }\n    setIsCameraReady(false);\n    setCapturedImage(null);\n  };\n\n  // Kiểm tra hỗ trợ\n  const getBrowserInfo = () => {\n    const userAgent = navigator.userAgent;\n    const browserInfo = {\n      userAgent,\n      isChrome: userAgent.indexOf(\"Chrome\") > -1,\n      isFirefox: userAgent.indexOf(\"Firefox\") > -1,\n      isSafari: userAgent.indexOf(\"Safari\") > -1 && userAgent.indexOf(\"Chrome\") === -1,\n      isEdge: userAgent.indexOf(\"Edg\") > -1,\n      hasMediaDevices: !!navigator.mediaDevices,\n      hasGetUserMedia: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)\n    };\n    return browserInfo;\n  };\n  const browserInfo = getBrowserInfo();\n\n  // Thử cách khác để bật camera\n  const tryAlternativeCamera = async () => {\n    try {\n      setError(null);\n      setIsLoading(true);\n\n      // Tạo một video element mới\n      const testVideo = document.createElement(\"video\");\n      testVideo.autoplay = true;\n      testVideo.muted = true;\n      testVideo.playsInline = true;\n\n      // Yêu cầu stream với các thiết lập tối thiểu\n      const minimalStream = await navigator.mediaDevices.getUserMedia({\n        video: true,\n        audio: false\n      });\n      setCameraStream(minimalStream);\n\n      // Gắn stream vào video element\n      testVideo.srcObject = minimalStream;\n\n      // Chờ video element sẵn sàng\n      await new Promise(resolve => {\n        testVideo.onloadedmetadata = () => {\n          testVideo.play().then(resolve).catch(e => {\n            console.error(\"Lỗi khi phát video tối thiểu:\", e);\n            resolve();\n          });\n        };\n      });\n\n      // Gắn stream vào video element trong DOM\n      if (videoRef.current) {\n        videoRef.current.srcObject = minimalStream;\n        setIsCameraReady(true);\n      }\n    } catch (err) {\n      console.error(\"Lỗi khi thử cách thay thế:\", err);\n      setError(`Lỗi cách thay thế: ${err.name} - ${err.message}`);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      p: 4,\n      maxWidth: 800,\n      mx: \"auto\"\n    },\n    children: [/*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h4\",\n      gutterBottom: true,\n      children: \"Ki\\u1EC3m Tra Camera\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Paper, {\n      sx: {\n        p: 2,\n        mb: 3\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        gutterBottom: true,\n        children: \"Th\\xF4ng tin tr\\xECnh duy\\u1EC7t:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 239,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"pre\", {\n        style: {\n          overflowX: \"auto\",\n          backgroundColor: \"#f5f5f5\",\n          p: 2\n        },\n        children: JSON.stringify(browserInfo, null, 2)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        children: [\"Tr\\u1EA1ng th\\xE1i quy\\u1EC1n camera: \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: permissionState\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 36\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 9\n      }, this), mediaDevices.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n        mt: 2,\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h6\",\n          gutterBottom: true,\n          children: [\"Thi\\u1EBFt b\\u1ECB camera ph\\xE1t hi\\u1EC7n (\", mediaDevices.length, \"):\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 251,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n          children: mediaDevices.map((device, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n            children: [device.label || `Camera ${index + 1}`, \" (ID:\", \" \", device.deviceId.substring(0, 8), \"...)\"]\n          }, device.deviceId, true, {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 17\n          }, this))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 254,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        mb: 3\n      },\n      children: [/*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        onClick: startCamera,\n        disabled: !isSupported || isCameraReady || isLoading,\n        sx: {\n          mr: 2\n        },\n        children: isLoading ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          size: 24\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 274,\n          columnNumber: 24\n        }, this) : \"Bật Camera\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        color: \"secondary\",\n        onClick: tryAlternativeCamera,\n        disabled: !isSupported || isCameraReady || isLoading,\n        sx: {\n          mr: 2\n        },\n        children: \"Th\\u1EED C\\xE1ch Kh\\xE1c\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        color: \"error\",\n        onClick: stopCamera,\n        disabled: !isCameraReady || isLoading,\n        children: \"T\\u1EAFt Camera\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 9\n      }, this), isCameraReady && /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        color: \"info\",\n        onClick: captureImage,\n        sx: {\n          ml: 2\n        },\n        children: \"Ch\\u1EE5p \\u1EA3nh\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"error\",\n      sx: {\n        mb: 3\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 2,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: capturedImage ? 6 : 12,\n        children: /*#__PURE__*/_jsxDEV(Paper, {\n          elevation: 3,\n          sx: {\n            width: \"100%\",\n            height: \"400px\",\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            backgroundColor: \"#f0f0f0\",\n            overflow: \"hidden\",\n            position: \"relative\"\n          },\n          children: isCameraReady ? /*#__PURE__*/_jsxDEV(_Fragment, {\n            children: [/*#__PURE__*/_jsxDEV(\"video\", {\n              ref: videoRef,\n              autoPlay: true,\n              playsInline: true,\n              muted: true,\n              style: {\n                width: \"100%\",\n                height: \"100%\",\n                objectFit: \"cover\"\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 331,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              style: {\n                display: \"none\",\n                position: \"absolute\",\n                top: 0,\n                left: 0\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 338,\n              columnNumber: 17\n            }, this), isLoading && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                right: 0,\n                bottom: 0,\n                display: \"flex\",\n                alignItems: \"center\",\n                justifyContent: \"center\",\n                backgroundColor: \"rgba(0,0,0,0.3)\"\n              },\n              children: /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 361,\n                columnNumber: 21\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 348,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true) : /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body1\",\n            align: \"center\",\n            children: isLoading ? /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              flexDirection: \"column\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                sx: {\n                  mb: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 373,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                children: \"\\u0110ang kh\\u1EDFi t\\u1EA1o camera...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 374,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 368,\n              columnNumber: 19\n            }, this) : isSupported ? \"Nhấn 'Bật Camera' để bắt đầu\" : \"Trình duyệt không hỗ trợ camera\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 9\n      }, this), capturedImage && /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 6,\n        children: /*#__PURE__*/_jsxDEV(Paper, {\n          elevation: 3,\n          sx: {\n            width: \"100%\",\n            height: \"400px\",\n            display: \"flex\",\n            justifyContent: \"center\",\n            alignItems: \"center\",\n            backgroundColor: \"#f0f0f0\",\n            overflow: \"hidden\"\n          },\n          children: /*#__PURE__*/_jsxDEV(\"img\", {\n            src: capturedImage,\n            alt: \"\\u1EA2nh ch\\u1EE5p t\\u1EEB camera\",\n            style: {\n              maxWidth: \"100%\",\n              maxHeight: \"100%\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 400,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 388,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"body2\",\n      sx: {\n        mt: 2,\n        color: \"text.secondary\"\n      },\n      children: \"* N\\u1EBFu camera kh\\xF4ng ho\\u1EA1t \\u0111\\u1ED9ng, h\\xE3y ki\\u1EC3m tra c\\xE0i \\u0111\\u1EB7t quy\\u1EC1n trong tr\\xECnh duy\\u1EC7t v\\xE0 \\u0111\\u1EA3m b\\u1EA3o kh\\xF4ng c\\xF3 \\u1EE9ng d\\u1EE5ng n\\xE0o kh\\xE1c \\u0111ang s\\u1EED d\\u1EE5ng camera.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Paper, {\n      sx: {\n        p: 2,\n        mt: 3\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        gutterBottom: true,\n        children: \"L\\u1ED7i th\\u01B0\\u1EDDng g\\u1EB7p v\\xE0 c\\xE1ch kh\\u1EAFc ph\\u1EE5c:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 416,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n        children: [/*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"NotAllowedError:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 421,\n            columnNumber: 13\n          }, this), \" B\\u1EA1n c\\u1EA7n c\\u1EA5p quy\\u1EC1n truy c\\u1EADp camera trong tr\\xECnh duy\\u1EC7t\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"NotReadableError/TrackStartError:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 425,\n            columnNumber: 13\n          }, this), \" Camera \\u0111ang \\u0111\\u01B0\\u1EE3c s\\u1EED d\\u1EE5ng b\\u1EDFi \\u1EE9ng d\\u1EE5ng kh\\xE1c\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 424,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"OverconstrainedError:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 429,\n            columnNumber: 13\n          }, this), \" Kh\\xF4ng c\\xF3 camera n\\xE0o \\u0111\\xE1p \\u1EE9ng y\\xEAu c\\u1EA7u (th\\u1EED v\\u1EDBi c\\xE0i \\u0111\\u1EB7t \\u0111\\u01A1n gi\\u1EA3n h\\u01A1n)\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 428,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Kh\\xF4ng th\\u1EA5y feed video:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 433,\n            columnNumber: 13\n          }, this), \" Th\\u1EED l\\xE0m m\\u1EDBi trang, t\\u1EAFt c\\xE1c ph\\u1EA7n m\\u1EDF r\\u1ED9ng c\\u1EE7a tr\\xECnh duy\\u1EC7t, ho\\u1EB7c s\\u1EED d\\u1EE5ng tr\\xECnh duy\\u1EC7t kh\\xE1c\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 419,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 233,\n    columnNumber: 5\n  }, this);\n};\n_s(CameraTestPage, \"p6KjCR+2HhpDdWwRRjZEAYt4xf0=\");\n_c = CameraTestPage;\nexport default CameraTestPage;\nvar _c;\n$RefreshReg$(_c, \"CameraTestPage\");","map":{"version":3,"names":["React","useEffect","useRef","useState","Box","Typography","Button","Alert","Paper","Grid","CircularProgress","jsxDEV","_jsxDEV","Fragment","_Fragment","CameraTestPage","_s","videoRef","canvasRef","error","setError","isCameraReady","setIsCameraReady","isSupported","setIsSupported","permissionState","setPermissionState","cameraStream","setCameraStream","mediaDevices","setMediaDevices","isLoading","setIsLoading","capturedImage","setCapturedImage","navigator","getUserMedia","console","enumerateDevices","then","devices","videoDevices","filter","device","kind","catch","err","getTracks","forEach","track","stop","checkCameraPermission","result","permissions","query","name","state","onchange","log","startCamera","constraints","video","width","ideal","height","facingMode","audio","stream","current","srcObject","onloadedmetadata","onloadeddata","onplay","onerror","e","play","playErr","message","captureImage","canvas","document","createElement","videoWidth","videoHeight","ctx","getContext","drawImage","dataUrl","toDataURL","stopCamera","getBrowserInfo","userAgent","browserInfo","isChrome","indexOf","isFirefox","isSafari","isEdge","hasMediaDevices","hasGetUserMedia","tryAlternativeCamera","testVideo","autoplay","muted","playsInline","minimalStream","Promise","resolve","sx","p","maxWidth","mx","children","variant","gutterBottom","fileName","_jsxFileName","lineNumber","columnNumber","mb","style","overflowX","backgroundColor","JSON","stringify","length","mt","map","index","label","deviceId","substring","color","onClick","disabled","mr","size","ml","severity","container","spacing","item","xs","md","elevation","display","justifyContent","alignItems","overflow","position","ref","autoPlay","objectFit","top","left","right","bottom","align","flexDirection","src","alt","maxHeight","_c","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/teacher/CameraTestPage.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport {\r\n  Box,\r\n  Typography,\r\n  Button,\r\n  Alert,\r\n  Paper,\r\n  Grid,\r\n  CircularProgress,\r\n} from \"@mui/material\";\r\n\r\nconst CameraTestPage = () => {\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const [error, setError] = useState(null);\r\n  const [isCameraReady, setIsCameraReady] = useState(false);\r\n  const [isSupported, setIsSupported] = useState(true);\r\n  const [permissionState, setPermissionState] = useState(\"chưa kiểm tra\");\r\n  const [cameraStream, setCameraStream] = useState(null);\r\n  const [mediaDevices, setMediaDevices] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [capturedImage, setCapturedImage] = useState(null);\r\n\r\n  // Kiểm tra hỗ trợ\r\n  useEffect(() => {\r\n    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\r\n      console.error(\"MediaDevices API không được hỗ trợ\");\r\n      setIsSupported(false);\r\n      setError(\"Trình duyệt không hỗ trợ API camera\");\r\n    }\r\n\r\n    // Liệt kê các thiết bị media\r\n    if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {\r\n      navigator.mediaDevices\r\n        .enumerateDevices()\r\n        .then((devices) => {\r\n          const videoDevices = devices.filter(\r\n            (device) => device.kind === \"videoinput\"\r\n          );\r\n          setMediaDevices(videoDevices);\r\n        })\r\n        .catch((err) => {\r\n          console.error(\"Lỗi khi liệt kê thiết bị:\", err);\r\n        });\r\n    }\r\n\r\n    return () => {\r\n      // Cleanup\r\n      if (cameraStream) {\r\n        cameraStream.getTracks().forEach((track) => {\r\n          track.stop();\r\n        });\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Kiểm tra quyền camera\r\n  const checkCameraPermission = async () => {\r\n    try {\r\n      const result = await navigator.permissions.query({ name: \"camera\" });\r\n      setPermissionState(result.state);\r\n\r\n      // Lắng nghe sự thay đổi trạng thái\r\n      result.onchange = () => {\r\n        setPermissionState(result.state);\r\n      };\r\n    } catch (err) {\r\n      console.log(\"Không thể truy vấn quyền camera:\", err);\r\n    }\r\n  };\r\n\r\n  // Khởi tạo camera\r\n  const startCamera = async () => {\r\n    try {\r\n      setError(null);\r\n      setIsLoading(true);\r\n\r\n      const constraints = {\r\n        video: {\r\n          width: { ideal: 640 },\r\n          height: { ideal: 480 },\r\n          facingMode: \"user\",\r\n        },\r\n        audio: false,\r\n      };\r\n\r\n      const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n\r\n      setCameraStream(stream);\r\n\r\n      if (videoRef.current) {\r\n        // Thử cách 1: Set srcObject\r\n        videoRef.current.srcObject = stream;\r\n\r\n        // Thêm event listeners cho video element\r\n        videoRef.current.onloadedmetadata = () => {};\r\n\r\n        videoRef.current.onloadeddata = () => {};\r\n\r\n        videoRef.current.onplay = () => {};\r\n\r\n        videoRef.current.onerror = (e) => {\r\n          console.error(\"Lỗi video element:\", e);\r\n        };\r\n\r\n        try {\r\n          await videoRef.current.play();\r\n        } catch (playErr) {\r\n          console.error(\"Lỗi khi phát video:\", playErr);\r\n        }\r\n\r\n        setIsCameraReady(true);\r\n        await checkCameraPermission();\r\n      } else {\r\n        console.error(\"videoRef.current không tồn tại\");\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Lỗi khi truy cập camera:\", err);\r\n      setError(`Lỗi: ${err.name} - ${err.message}`);\r\n      setIsCameraReady(false);\r\n      await checkCameraPermission();\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  // Chụp ảnh từ camera\r\n  const captureImage = () => {\r\n    if (videoRef.current && isCameraReady) {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n\r\n      // Vẽ video frame hiện tại vào canvas\r\n      ctx.drawImage(videoRef.current, 0, 0, canvas.width, canvas.height);\r\n\r\n      // Chuyển đổi canvas thành data URL\r\n      const dataUrl = canvas.toDataURL(\"image/jpeg\");\r\n      setCapturedImage(dataUrl);\r\n    }\r\n  };\r\n\r\n  // Dừng camera\r\n  const stopCamera = () => {\r\n    if (cameraStream) {\r\n      cameraStream.getTracks().forEach((track) => {\r\n        track.stop();\r\n      });\r\n\r\n      setCameraStream(null);\r\n    }\r\n\r\n    if (videoRef.current) {\r\n      videoRef.current.srcObject = null;\r\n    }\r\n\r\n    setIsCameraReady(false);\r\n    setCapturedImage(null);\r\n  };\r\n\r\n  // Kiểm tra hỗ trợ\r\n  const getBrowserInfo = () => {\r\n    const userAgent = navigator.userAgent;\r\n    const browserInfo = {\r\n      userAgent,\r\n      isChrome: userAgent.indexOf(\"Chrome\") > -1,\r\n      isFirefox: userAgent.indexOf(\"Firefox\") > -1,\r\n      isSafari:\r\n        userAgent.indexOf(\"Safari\") > -1 && userAgent.indexOf(\"Chrome\") === -1,\r\n      isEdge: userAgent.indexOf(\"Edg\") > -1,\r\n      hasMediaDevices: !!navigator.mediaDevices,\r\n      hasGetUserMedia: !!(\r\n        navigator.mediaDevices && navigator.mediaDevices.getUserMedia\r\n      ),\r\n    };\r\n\r\n    return browserInfo;\r\n  };\r\n\r\n  const browserInfo = getBrowserInfo();\r\n\r\n  // Thử cách khác để bật camera\r\n  const tryAlternativeCamera = async () => {\r\n    try {\r\n      setError(null);\r\n      setIsLoading(true);\r\n\r\n      // Tạo một video element mới\r\n      const testVideo = document.createElement(\"video\");\r\n      testVideo.autoplay = true;\r\n      testVideo.muted = true;\r\n      testVideo.playsInline = true;\r\n\r\n      // Yêu cầu stream với các thiết lập tối thiểu\r\n      const minimalStream = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: false,\r\n      });\r\n\r\n      setCameraStream(minimalStream);\r\n\r\n      // Gắn stream vào video element\r\n      testVideo.srcObject = minimalStream;\r\n\r\n      // Chờ video element sẵn sàng\r\n      await new Promise((resolve) => {\r\n        testVideo.onloadedmetadata = () => {\r\n          testVideo\r\n            .play()\r\n            .then(resolve)\r\n            .catch((e) => {\r\n              console.error(\"Lỗi khi phát video tối thiểu:\", e);\r\n              resolve();\r\n            });\r\n        };\r\n      });\r\n\r\n      // Gắn stream vào video element trong DOM\r\n      if (videoRef.current) {\r\n        videoRef.current.srcObject = minimalStream;\r\n        setIsCameraReady(true);\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Lỗi khi thử cách thay thế:\", err);\r\n      setError(`Lỗi cách thay thế: ${err.name} - ${err.message}`);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box sx={{ p: 4, maxWidth: 800, mx: \"auto\" }}>\r\n      <Typography variant=\"h4\" gutterBottom>\r\n        Kiểm Tra Camera\r\n      </Typography>\r\n\r\n      <Paper sx={{ p: 2, mb: 3 }}>\r\n        <Typography variant=\"h6\" gutterBottom>\r\n          Thông tin trình duyệt:\r\n        </Typography>\r\n        <pre style={{ overflowX: \"auto\", backgroundColor: \"#f5f5f5\", p: 2 }}>\r\n          {JSON.stringify(browserInfo, null, 2)}\r\n        </pre>\r\n        <Typography>\r\n          Trạng thái quyền camera: <strong>{permissionState}</strong>\r\n        </Typography>\r\n\r\n        {mediaDevices.length > 0 && (\r\n          <Box mt={2}>\r\n            <Typography variant=\"h6\" gutterBottom>\r\n              Thiết bị camera phát hiện ({mediaDevices.length}):\r\n            </Typography>\r\n            <ul>\r\n              {mediaDevices.map((device, index) => (\r\n                <li key={device.deviceId}>\r\n                  {device.label || `Camera ${index + 1}`} (ID:{\" \"}\r\n                  {device.deviceId.substring(0, 8)}...)\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          </Box>\r\n        )}\r\n      </Paper>\r\n\r\n      <Box sx={{ mb: 3 }}>\r\n        <Button\r\n          variant=\"contained\"\r\n          color=\"primary\"\r\n          onClick={startCamera}\r\n          disabled={!isSupported || isCameraReady || isLoading}\r\n          sx={{ mr: 2 }}\r\n        >\r\n          {isLoading ? <CircularProgress size={24} /> : \"Bật Camera\"}\r\n        </Button>\r\n\r\n        <Button\r\n          variant=\"outlined\"\r\n          color=\"secondary\"\r\n          onClick={tryAlternativeCamera}\r\n          disabled={!isSupported || isCameraReady || isLoading}\r\n          sx={{ mr: 2 }}\r\n        >\r\n          Thử Cách Khác\r\n        </Button>\r\n\r\n        <Button\r\n          variant=\"outlined\"\r\n          color=\"error\"\r\n          onClick={stopCamera}\r\n          disabled={!isCameraReady || isLoading}\r\n        >\r\n          Tắt Camera\r\n        </Button>\r\n\r\n        {isCameraReady && (\r\n          <Button\r\n            variant=\"outlined\"\r\n            color=\"info\"\r\n            onClick={captureImage}\r\n            sx={{ ml: 2 }}\r\n          >\r\n            Chụp ảnh\r\n          </Button>\r\n        )}\r\n      </Box>\r\n\r\n      {error && (\r\n        <Alert severity=\"error\" sx={{ mb: 3 }}>\r\n          {error}\r\n        </Alert>\r\n      )}\r\n\r\n      <Grid container spacing={2}>\r\n        <Grid item xs={12} md={capturedImage ? 6 : 12}>\r\n          <Paper\r\n            elevation={3}\r\n            sx={{\r\n              width: \"100%\",\r\n              height: \"400px\",\r\n              display: \"flex\",\r\n              justifyContent: \"center\",\r\n              alignItems: \"center\",\r\n              backgroundColor: \"#f0f0f0\",\r\n              overflow: \"hidden\",\r\n              position: \"relative\",\r\n            }}\r\n          >\r\n            {isCameraReady ? (\r\n              <>\r\n                <video\r\n                  ref={videoRef}\r\n                  autoPlay\r\n                  playsInline\r\n                  muted\r\n                  style={{ width: \"100%\", height: \"100%\", objectFit: \"cover\" }}\r\n                />\r\n                <canvas\r\n                  ref={canvasRef}\r\n                  style={{\r\n                    display: \"none\",\r\n                    position: \"absolute\",\r\n                    top: 0,\r\n                    left: 0,\r\n                  }}\r\n                />\r\n                {isLoading && (\r\n                  <Box\r\n                    sx={{\r\n                      position: \"absolute\",\r\n                      top: 0,\r\n                      left: 0,\r\n                      right: 0,\r\n                      bottom: 0,\r\n                      display: \"flex\",\r\n                      alignItems: \"center\",\r\n                      justifyContent: \"center\",\r\n                      backgroundColor: \"rgba(0,0,0,0.3)\",\r\n                    }}\r\n                  >\r\n                    <CircularProgress />\r\n                  </Box>\r\n                )}\r\n              </>\r\n            ) : (\r\n              <Typography variant=\"body1\" align=\"center\">\r\n                {isLoading ? (\r\n                  <Box\r\n                    display=\"flex\"\r\n                    flexDirection=\"column\"\r\n                    alignItems=\"center\"\r\n                  >\r\n                    <CircularProgress sx={{ mb: 2 }} />\r\n                    <Typography>Đang khởi tạo camera...</Typography>\r\n                  </Box>\r\n                ) : isSupported ? (\r\n                  \"Nhấn 'Bật Camera' để bắt đầu\"\r\n                ) : (\r\n                  \"Trình duyệt không hỗ trợ camera\"\r\n                )}\r\n              </Typography>\r\n            )}\r\n          </Paper>\r\n        </Grid>\r\n\r\n        {capturedImage && (\r\n          <Grid item xs={12} md={6}>\r\n            <Paper\r\n              elevation={3}\r\n              sx={{\r\n                width: \"100%\",\r\n                height: \"400px\",\r\n                display: \"flex\",\r\n                justifyContent: \"center\",\r\n                alignItems: \"center\",\r\n                backgroundColor: \"#f0f0f0\",\r\n                overflow: \"hidden\",\r\n              }}\r\n            >\r\n              <img\r\n                src={capturedImage}\r\n                alt=\"Ảnh chụp từ camera\"\r\n                style={{ maxWidth: \"100%\", maxHeight: \"100%\" }}\r\n              />\r\n            </Paper>\r\n          </Grid>\r\n        )}\r\n      </Grid>\r\n\r\n      <Typography variant=\"body2\" sx={{ mt: 2, color: \"text.secondary\" }}>\r\n        * Nếu camera không hoạt động, hãy kiểm tra cài đặt quyền trong trình\r\n        duyệt và đảm bảo không có ứng dụng nào khác đang sử dụng camera.\r\n      </Typography>\r\n\r\n      <Paper sx={{ p: 2, mt: 3 }}>\r\n        <Typography variant=\"h6\" gutterBottom>\r\n          Lỗi thường gặp và cách khắc phục:\r\n        </Typography>\r\n        <ul>\r\n          <li>\r\n            <strong>NotAllowedError:</strong> Bạn cần cấp quyền truy cập camera\r\n            trong trình duyệt\r\n          </li>\r\n          <li>\r\n            <strong>NotReadableError/TrackStartError:</strong> Camera đang được\r\n            sử dụng bởi ứng dụng khác\r\n          </li>\r\n          <li>\r\n            <strong>OverconstrainedError:</strong> Không có camera nào đáp ứng\r\n            yêu cầu (thử với cài đặt đơn giản hơn)\r\n          </li>\r\n          <li>\r\n            <strong>Không thấy feed video:</strong> Thử làm mới trang, tắt các\r\n            phần mở rộng của trình duyệt, hoặc sử dụng trình duyệt khác\r\n          </li>\r\n        </ul>\r\n      </Paper>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default CameraTestPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
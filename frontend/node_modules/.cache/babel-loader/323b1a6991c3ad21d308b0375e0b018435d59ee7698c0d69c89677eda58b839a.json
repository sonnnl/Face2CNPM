{"ast":null,"code":"import React,{useState,useEffect,createElement as _createElement}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useSnackbar}from\"notistack\";import axios from\"axios\";import{Box,Typography,Paper,Button,IconButton,TextField,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,TablePagination,Dialog,DialogActions,DialogContent,DialogContentText,DialogTitle,Grid,Tooltip,CircularProgress,InputAdornment,Tabs,Tab,FormControl,InputLabel,Select,MenuItem,Chip,Autocomplete,Collapse,Card,CardContent,FormHelperText,List,ListItem,ListItemAvatar,ListItemText,ListItemSecondaryAction,Avatar,Alert}from\"@mui/material\";import{Add,Delete,Edit,Search,Refresh,School,People,Dashboard,FilterList,Person,PersonAdd,AccessTime,Check,Close}from\"@mui/icons-material\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||\"http://localhost:5000/api\";const ClassesPage=()=>{var _studentApprovalDialo;const dispatch=useDispatch();const{enqueueSnackbar}=useSnackbar();const{token}=useSelector(state=>state.auth);// State\nconst[tabValue,setTabValue]=useState(0);const[classes,setClasses]=useState([]);const[searchTerm,setSearchTerm]=useState(\"\");const[isLoading,setIsLoading]=useState(false);// Pagination state\nconst[page,setPage]=useState(0);const[rowsPerPage,setRowsPerPage]=useState(10);const[totalCount,setTotalCount]=useState(0);// State cho danh sách lớp chính riêng biệt\nconst[mainClasses,setMainClasses]=useState([]);// Lookup data states\nconst[departments,setDepartments]=useState([]);const[teachers,setTeachers]=useState([]);const[students,setStudents]=useState([]);const[subjects,setSubjects]=useState([]);const[semesters,setSemesters]=useState([]);// Dialog states\nconst[dialogOpen,setDialogOpen]=useState(false);const[dialogMode,setDialogMode]=useState(\"create\");const[selectedClass,setSelectedClass]=useState(null);const[deleteDialogOpen,setDeleteDialogOpen]=useState(false);// Main Class Form Data\nconst[mainClassForm,setMainClassForm]=useState({name:\"\",code:\"\",department_id:\"\",advisor_id:\"\",students:[]});// Teaching Class Form Data\nconst[teachingClassForm,setTeachingClassForm]=useState({class_name:\"\",class_code:\"\",subject_id:\"\",semester_id:\"\",teacher_id:\"\",main_class_id:\"\",selected_students:[],description:\"\"});// State nâng cao\nconst[filterOptions,setFilterOptions]=useState({department:\"\",teacher:\"\",course:\"\",semester:\"\"});// Thêm states cho thống kê\nconst[stats,setStats]=useState({mainClasses:0,teachingClasses:0,students:0,teachers:0});// Thêm state cho lỗi validation\nconst[formErrors,setFormErrors]=useState({main:{name:false,code:false},teaching:{class_name:false,class_code:false,subject_id:false,semester_id:false}});// State cho tìm kiếm và phân trang\nconst[search,setSearch]=useState(\"\");const[deleteDialog,setDeleteDialog]=useState({open:false,item:null});const[studentApprovalDialog,setStudentApprovalDialog]=useState({open:false,classItem:null,tabValue:0,pendingStudents:[],approvedStudents:[],loading:false,rejectDialog:{open:false,studentId:null,reason:\"\"}});// Load data on mount and when pagination/search changes\nuseEffect(()=>{loadClasses();},[page,rowsPerPage,tabValue]);useEffect(()=>{loadLookupData();loadMainClasses();},[]);useEffect(()=>{loadStats();},[]);const loadLookupData=async()=>{try{setIsLoading(true);// Load teachers với tham số tìm kiếm nâng cao\nconst teachersResponse=await axios.get(`${API_URL}/users?role=teacher&status=approved&limit=200&sort=full_name`,{headers:{Authorization:`Bearer ${token}`}});setTeachers(teachersResponse.data.data||[]);// Load departments\nconst departmentsResponse=await axios.get(`${API_URL}/departments?limit=100`,{headers:{Authorization:`Bearer ${token}`}});setDepartments(departmentsResponse.data.data||[]);// Load students\nconst studentsResponse=await axios.get(`${API_URL}/users?role=student&status=approved&limit=200&sort=full_name`,{headers:{Authorization:`Bearer ${token}`}});setStudents(studentsResponse.data.data||[]);// Load subjects\nconst subjectsResponse=await axios.get(`${API_URL}/subjects?limit=200&sort=name`,{headers:{Authorization:`Bearer ${token}`}});setSubjects(subjectsResponse.data.data||[]);// Load semesters\nconst semestersResponse=await axios.get(`${API_URL}/semesters?limit=100`,{headers:{Authorization:`Bearer ${token}`}});setSemesters(semestersResponse.data.data||[]);setIsLoading(false);}catch(error){console.error(\"Lỗi khi tải dữ liệu tham chiếu:\",error);enqueueSnackbar(\"Lỗi khi tải dữ liệu tham chiếu\",{variant:\"error\"});setIsLoading(false);}};const loadClasses=async()=>{try{setIsLoading(true);const endpoint=tabValue===0?\"classes/main\":\"classes/teaching\";// Xây dựng query params với bộ lọc\nlet queryParams=`page=${page+1}&limit=${rowsPerPage}&search=${searchTerm}`;if(tabValue===0&&filterOptions.department){queryParams+=`&department_id=${filterOptions.department}`;}if(tabValue===0&&filterOptions.teacher){queryParams+=`&advisor_id=${filterOptions.teacher}`;}if(tabValue===1&&filterOptions.course){queryParams+=`&subject_id=${filterOptions.course}`;}if(tabValue===1&&filterOptions.teacher){queryParams+=`&teacher_id=${filterOptions.teacher}`;}if(tabValue===1&&filterOptions.semester){queryParams+=`&semester=${filterOptions.semester}`;}const response=await axios.get(`${API_URL}/${endpoint}?${queryParams}`,{headers:{Authorization:`Bearer ${token}`}});setClasses(response.data.data||[]);setTotalCount(response.data.totalCount||0);setIsLoading(false);}catch(error){console.error(\"Lỗi khi tải danh sách lớp:\",error);enqueueSnackbar(\"Lỗi khi tải danh sách lớp\",{variant:\"error\"});setIsLoading(false);}};const handleSearch=()=>{setPage(0);loadClasses();};const handleTabChange=(event,newValue)=>{setTabValue(newValue);setPage(0);setSearchTerm(\"\");};const handleChangePage=(event,newPage)=>{setPage(newPage);};const handleChangeRowsPerPage=event=>{setRowsPerPage(parseInt(event.target.value,10));setPage(0);};// Thêm hàm xử lý lọc\nconst handleFilterChange=e=>{const{name,value}=e.target;setFilterOptions({...filterOptions,[name]:value});};// Thêm hàm áp dụng bộ lọc\nconst applyFilters=()=>{setPage(0);loadClasses();};// Thêm hàm xóa bộ lọc\nconst clearFilters=()=>{setFilterOptions({department:\"\",teacher:\"\",course:\"\",semester:\"\"});setSearchTerm(\"\");setPage(0);loadClasses();};// Dialog handlers\nconst openDialog=function(mode){let classItem=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setDialogMode(mode);if(tabValue===0){// Main Class\nif(mode===\"edit\"&&classItem){var _classItem$department,_classItem$advisor_id,_classItem$students;setMainClassForm({name:classItem.name,code:classItem.class_code,department_id:((_classItem$department=classItem.department_id)===null||_classItem$department===void 0?void 0:_classItem$department._id)||\"\",advisor_id:((_classItem$advisor_id=classItem.advisor_id)===null||_classItem$advisor_id===void 0?void 0:_classItem$advisor_id._id)||\"\",students:((_classItem$students=classItem.students)===null||_classItem$students===void 0?void 0:_classItem$students.map(s=>s._id))||[]});}else{setMainClassForm({name:\"\",code:\"\",department_id:\"\",advisor_id:\"\",students:[]});}}else{// Teaching Class - cần tải danh sách lớp chính trước\nloadMainClasses();if(mode===\"edit\"&&classItem){var _classItem$subject_id,_classItem$course_id,_classItem$semester_i,_classItem$teacher_id,_classItem$main_class,_classItem$students2;setTeachingClassForm({class_name:classItem.class_name||classItem.name,class_code:classItem.class_code,subject_id:((_classItem$subject_id=classItem.subject_id)===null||_classItem$subject_id===void 0?void 0:_classItem$subject_id._id)||((_classItem$course_id=classItem.course_id)===null||_classItem$course_id===void 0?void 0:_classItem$course_id._id)||\"\",semester_id:((_classItem$semester_i=classItem.semester_id)===null||_classItem$semester_i===void 0?void 0:_classItem$semester_i._id)||\"\",teacher_id:((_classItem$teacher_id=classItem.teacher_id)===null||_classItem$teacher_id===void 0?void 0:_classItem$teacher_id._id)||\"\",main_class_id:((_classItem$main_class=classItem.main_class_id)===null||_classItem$main_class===void 0?void 0:_classItem$main_class._id)||\"\",selected_students:((_classItem$students2=classItem.students)===null||_classItem$students2===void 0?void 0:_classItem$students2.map(s=>s._id))||[],description:classItem.description||\"\"});}else{setTeachingClassForm({class_name:\"\",class_code:\"\",subject_id:\"\",semester_id:\"\",teacher_id:\"\",main_class_id:\"\",selected_students:[],description:\"\"});}}setSelectedClass(classItem);setDialogOpen(true);};// Cập nhật hàm handleMainClassFormChange để có validation\nconst handleMainClassFormChange=e=>{const{name,value}=e.target;setMainClassForm({...mainClassForm,[name]:value});// Xóa lỗi khi người dùng nhập liệu\nif(name in formErrors.main&&value.trim()!==\"\"){setFormErrors({...formErrors,main:{...formErrors.main,[name]:false}});}};// Cập nhật hàm handleTeachingClassFormChange để có validation\nconst handleTeachingClassFormChange=e=>{const{name,value}=e.target;setTeachingClassForm({...teachingClassForm,[name]:value});// Xóa lỗi khi người dùng nhập liệu\nif(name in formErrors.teaching&&value.trim()!==\"\"){setFormErrors({...formErrors,teaching:{...formErrors.teaching,[name]:false}});}};// Thêm hàm validateMainClassForm\nconst validateMainClassForm=()=>{const errors={name:mainClassForm.name.trim()===\"\",code:mainClassForm.code.trim()===\"\"};setFormErrors({...formErrors,main:errors});return!Object.values(errors).some(Boolean);};// Thêm hàm validateTeachingClassForm\nconst validateTeachingClassForm=()=>{const errors={class_name:teachingClassForm.class_name.trim()===\"\",class_code:teachingClassForm.class_code.trim()===\"\",subject_id:teachingClassForm.subject_id===\"\",semester_id:teachingClassForm.semester_id===\"\"};setFormErrors({...formErrors,teaching:errors});return!Object.values(errors).some(Boolean);};// Cập nhật hàm handleFormSubmit để tải lại danh sách lớp chính sau khi thêm/sửa\nconst handleFormSubmit=async()=>{try{let isValid=false;if(tabValue===0){isValid=validateMainClassForm();if(!isValid){enqueueSnackbar(\"Vui lòng điền đầy đủ thông tin bắt buộc\",{variant:\"error\"});return;}// Main class\nif(dialogMode===\"create\"){await axios.post(`${API_URL}/classes/main`,mainClassForm,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Tạo lớp chính mới thành công\",{variant:\"success\"});}else{await axios.put(`${API_URL}/classes/main/${selectedClass._id}`,mainClassForm,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Cập nhật lớp chính thành công\",{variant:\"success\"});}// Tải lại danh sách lớp chính sau khi cập nhật\nloadMainClasses();}else{isValid=validateTeachingClassForm();if(!isValid){enqueueSnackbar(\"Vui lòng điền đầy đủ thông tin bắt buộc\",{variant:\"error\"});return;}// Teaching class\nif(dialogMode===\"create\"){await axios.post(`${API_URL}/classes/teaching`,teachingClassForm,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Tạo lớp giảng dạy mới thành công\",{variant:\"success\"});}else{await axios.put(`${API_URL}/classes/teaching/${selectedClass._id}`,teachingClassForm,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Cập nhật lớp giảng dạy thành công\",{variant:\"success\"});}}setDialogOpen(false);loadClasses();loadStats();// Cập nhật lại thống kê sau khi thao tác\n}catch(error){var _error$response,_error$response$data;console.error(\"Lỗi khi thao tác với lớp học:\",error);enqueueSnackbar(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||\"Lỗi khi thao tác với lớp học\",{variant:\"error\"});}};// Mở hộp thoại xóa\nconst openDeleteDialog=classItem=>{setDeleteDialog({open:true,item:classItem});};// Mở hộp thoại quản lý sinh viên\nconst openStudentApproval=async classItem=>{try{setStudentApprovalDialog({...studentApprovalDialog,open:true,classItem:classItem,loading:true});// Lấy danh sách sinh viên chờ duyệt\nconst pendingResponse=await axios.get(`${API_URL}/classes/main/${classItem._id}/pending-students`,{headers:{Authorization:`Bearer ${token}`}});// Lấy danh sách sinh viên đã được duyệt\nconst approvedResponse=await axios.get(`${API_URL}/classes/main/${classItem._id}/approved-students`,{headers:{Authorization:`Bearer ${token}`}});setStudentApprovalDialog({...studentApprovalDialog,open:true,classItem:classItem,pendingStudents:pendingResponse.data.data||[],approvedStudents:approvedResponse.data.data||[],loading:false});}catch(error){console.error(\"Lỗi khi tải dữ liệu sinh viên:\",error);enqueueSnackbar(\"Lỗi khi tải dữ liệu sinh viên\",{variant:\"error\"});setStudentApprovalDialog({...studentApprovalDialog,loading:false});}};// Đóng hộp thoại quản lý sinh viên\nconst closeStudentApproval=()=>{setStudentApprovalDialog({open:false,classItem:null,tabValue:0,pendingStudents:[],approvedStudents:[],loading:false,rejectDialog:{open:false,studentId:null,reason:\"\"}});};// Xử lý thay đổi tab trong quản lý sinh viên\nconst handleApprovalTabChange=(event,newValue)=>{setStudentApprovalDialog({...studentApprovalDialog,tabValue:newValue});};// Phê duyệt sinh viên\nconst handleApproveStudent=async studentId=>{try{const{classItem}=studentApprovalDialog;await axios.put(`${API_URL}/classes/main/${classItem._id}/approve-student/${studentId}`,{},{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Phê duyệt sinh viên thành công\",{variant:\"success\"});// Cập nhật lại danh sách\nopenStudentApproval(classItem);}catch(error){var _error$response2,_error$response2$data;console.error(\"Lỗi khi phê duyệt sinh viên:\",error);enqueueSnackbar(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||\"Lỗi khi phê duyệt sinh viên\",{variant:\"error\"});}};// Mở dialog từ chối sinh viên\nconst openRejectDialog=studentId=>{setStudentApprovalDialog({...studentApprovalDialog,rejectDialog:{open:true,studentId,reason:\"\"}});};// Đóng dialog từ chối sinh viên\nconst closeRejectDialog=()=>{setStudentApprovalDialog({...studentApprovalDialog,rejectDialog:{open:false,studentId:null,reason:\"\"}});};// Từ chối sinh viên\nconst handleRejectStudent=async()=>{try{const{classItem,rejectDialog}=studentApprovalDialog;await axios.put(`${API_URL}/classes/main/${classItem._id}/reject-student/${rejectDialog.studentId}`,{reason:rejectDialog.reason},{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Đã từ chối sinh viên\",{variant:\"success\"});closeRejectDialog();// Cập nhật lại danh sách\nopenStudentApproval(classItem);}catch(error){var _error$response3,_error$response3$data;console.error(\"Lỗi khi từ chối sinh viên:\",error);enqueueSnackbar(((_error$response3=error.response)===null||_error$response3===void 0?void 0:(_error$response3$data=_error$response3.data)===null||_error$response3$data===void 0?void 0:_error$response3$data.message)||\"Lỗi khi từ chối sinh viên\",{variant:\"error\"});}};// Xử lý thay đổi lý do từ chối\nconst handleRejectReasonChange=e=>{setStudentApprovalDialog({...studentApprovalDialog,rejectDialog:{...studentApprovalDialog.rejectDialog,reason:e.target.value}});};// Xử lý xóa lớp\nconst handleDeleteClass=async()=>{try{const endpoint=tabValue===0?\"classes/main\":\"classes/teaching\";await axios.delete(`${API_URL}/${endpoint}/${selectedClass._id}`,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(`Xóa ${tabValue===0?\"lớp chính\":\"lớp giảng dạy\"} thành công`,{variant:\"success\"});setDeleteDialogOpen(false);loadClasses();if(tabValue===0){loadMainClasses();// Tải lại danh sách lớp chính nếu xóa lớp chính\n}loadStats();// Cập nhật lại thống kê sau khi thao tác\n}catch(error){var _error$response4,_error$response4$data;console.error(`Lỗi khi xóa ${tabValue===0?\"lớp chính\":\"lớp giảng dạy\"}:`,error);enqueueSnackbar(((_error$response4=error.response)===null||_error$response4===void 0?void 0:(_error$response4$data=_error$response4.data)===null||_error$response4$data===void 0?void 0:_error$response4$data.message)||`Lỗi khi xóa ${tabValue===0?\"lớp chính\":\"lớp giảng dạy\"}`,{variant:\"error\"});}};// Cập nhật hàm loadStats để sử dụng API endpoint mới\nconst loadStats=async()=>{try{const mainClassResponse=await axios.get(`${API_URL}/classes/main/statistics`,{headers:{Authorization:`Bearer ${token}`}});const teachingClassResponse=await axios.get(`${API_URL}/classes/teaching/statistics`,{headers:{Authorization:`Bearer ${token}`}});const userStatsResponse=await axios.get(`${API_URL}/users/stats`,{headers:{Authorization:`Bearer ${token}`}});setStats({mainClasses:mainClassResponse.data.totalCount||0,teachingClasses:teachingClassResponse.data.totalCount||0,students:userStatsResponse.data.approvedStudents||0,teachers:userStatsResponse.data.approvedTeachers||0});}catch(error){console.error(\"Lỗi khi tải thống kê:\",error);// Tiếp tục hiển thị giao diện ngay cả khi không thể tải thống kê\n}};// Thêm lại hàm handleStudentSelection bị xóa nhầm\nconst handleStudentSelection=(event,newValue)=>{if(tabValue===0){setMainClassForm({...mainClassForm,students:newValue.map(student=>student._id)});}else{setTeachingClassForm({...teachingClassForm,selected_students:newValue.map(student=>student._id)});}};// Thêm hàm tải danh sách lớp chính\nconst loadMainClasses=async()=>{try{const response=await axios.get(`${API_URL}/classes/main?all=true&sort=name`,{headers:{Authorization:`Bearer ${token}`}});setMainClasses(response.data.data||[]);}catch(error){console.error(\"Lỗi khi tải danh sách lớp chính:\",error);enqueueSnackbar(\"Không thể tải danh sách lớp chính\",{variant:\"error\"});}};// Render main class table\nconst renderMainClassesTable=()=>/*#__PURE__*/_jsxs(TableContainer,{component:Paper,sx:{boxShadow:2},children:[/*#__PURE__*/_jsxs(Table,{sx:{minWidth:650},children:[/*#__PURE__*/_jsx(TableHead,{sx:{bgcolor:\"#f5f5f5\"},children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"T\\xEAn l\\u1EDBp\"}),/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"M\\xE3 l\\u1EDBp\"}),/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"Khoa\"}),/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"Gi\\xE1o vi\\xEAn ch\\u1EE7 nhi\\u1EC7m\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",sx:{fontWeight:\"bold\"},children:\"S\\u1ED1 l\\u01B0\\u1EE3ng SV\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",sx:{fontWeight:\"bold\"},children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:isLoading?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"center\",p:3},children:/*#__PURE__*/_jsx(CircularProgress,{size:30})})})}):classes.length===0?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:/*#__PURE__*/_jsxs(Box,{sx:{py:3},children:[/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y l\\u1EDBp h\\u1ECDc n\\xE0o\"}),/*#__PURE__*/_jsx(Button,{variant:\"text\",color:\"primary\",onClick:clearFilters,sx:{mt:1},children:\"X\\xF3a b\\u1ED9 l\\u1ECDc\"})]})})}):classes.map(classItem=>{var _classItem$department2,_classItem$advisor_id2,_classItem$students3,_classItem$students4;return/*#__PURE__*/_jsxs(TableRow,{hover:true,sx:{\"&:hover\":{bgcolor:\"rgba(0, 0, 0, 0.04)\"}},children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:classItem.name})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{label:classItem.class_code,size:\"small\",color:\"primary\",variant:\"outlined\"})}),/*#__PURE__*/_jsx(TableCell,{children:(_classItem$department2=classItem.department_id)!==null&&_classItem$department2!==void 0&&_classItem$department2.name?/*#__PURE__*/_jsx(Chip,{label:classItem.department_id.name,size:\"small\",sx:{bgcolor:\"#e3f2fd\"}}):/*#__PURE__*/_jsx(Chip,{label:\"Ch\\u01B0a ph\\xE2n khoa\",size:\"small\",variant:\"outlined\",color:\"default\"})}),/*#__PURE__*/_jsx(TableCell,{children:(_classItem$advisor_id2=classItem.advisor_id)!==null&&_classItem$advisor_id2!==void 0&&_classItem$advisor_id2.full_name?/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:classItem.advisor_id.full_name}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",children:classItem.advisor_id.email||\"\"})]}):/*#__PURE__*/_jsx(Chip,{label:\"Ch\\u01B0a ph\\xE2n c\\xF4ng\",size:\"small\",color:\"warning\",variant:\"outlined\"})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(Chip,{label:((_classItem$students3=classItem.students)===null||_classItem$students3===void 0?void 0:_classItem$students3.length)||0,color:((_classItem$students4=classItem.students)===null||_classItem$students4===void 0?void 0:_classItem$students4.length)>0?\"success\":\"default\",size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"flex-end\",children:[/*#__PURE__*/_jsx(Tooltip,{title:\"S\\u1EEDa l\\u1EDBp\",children:/*#__PURE__*/_jsx(IconButton,{color:\"primary\",onClick:()=>openDialog(\"edit\",classItem),size:\"small\",sx:{mx:0.5},children:/*#__PURE__*/_jsx(Edit,{fontSize:\"small\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"X\\xF3a l\\u1EDBp\",children:/*#__PURE__*/_jsx(IconButton,{color:\"error\",onClick:()=>openDeleteDialog(classItem),size:\"small\",sx:{mx:0.5},children:/*#__PURE__*/_jsx(Delete,{fontSize:\"small\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"Qu\\u1EA3n l\\xFD sinh vi\\xEAn\",children:/*#__PURE__*/_jsx(IconButton,{color:\"info\",onClick:()=>openStudentApproval(classItem),size:\"small\",sx:{mx:0.5},children:/*#__PURE__*/_jsx(People,{fontSize:\"small\"})})})]})})]},classItem._id);})})]}),/*#__PURE__*/_jsx(TablePagination,{rowsPerPageOptions:[5,10,25,50],component:\"div\",count:totalCount,rowsPerPage:rowsPerPage,page:page,onPageChange:handleChangePage,onRowsPerPageChange:handleChangeRowsPerPage,labelRowsPerPage:\"D\\xF2ng m\\u1ED7i trang:\",labelDisplayedRows:_ref=>{let{from,to,count}=_ref;return`${from}-${to} trên ${count}`;}})]});// Render teaching class table\nconst renderTeachingClassesTable=()=>/*#__PURE__*/_jsxs(TableContainer,{component:Paper,sx:{boxShadow:2},children:[/*#__PURE__*/_jsxs(Table,{sx:{minWidth:650},children:[/*#__PURE__*/_jsx(TableHead,{sx:{bgcolor:\"#f5f5f5\"},children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"T\\xEAn l\\u1EDBp\"}),/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"M\\xF4n h\\u1ECDc\"}),/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"K\\u1EF3 h\\u1ECDc\"}),/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"Gi\\xE1o vi\\xEAn\"}),/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"L\\u1EDBp ch\\xEDnh\"}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",sx:{fontWeight:\"bold\"},children:\"S\\u1ED1 l\\u01B0\\u1EE3ng SV\"}),/*#__PURE__*/_jsx(TableCell,{sx:{fontWeight:\"bold\"},children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",sx:{fontWeight:\"bold\"},children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:isLoading?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:7,align:\"center\",children:/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"center\",p:3},children:/*#__PURE__*/_jsx(CircularProgress,{size:30})})})}):classes.length===0?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:7,align:\"center\",children:/*#__PURE__*/_jsxs(Box,{sx:{py:3},children:[/*#__PURE__*/_jsx(Typography,{color:\"textSecondary\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y l\\u1EDBp h\\u1ECDc n\\xE0o\"}),/*#__PURE__*/_jsx(Button,{variant:\"text\",color:\"primary\",onClick:clearFilters,sx:{mt:1},children:\"X\\xF3a b\\u1ED9 l\\u1ECDc\"})]})})}):classes.map(classItem=>{var _classItem$subject_id2,_classItem$course_id2,_classItem$subject_id3,_classItem$course_id3,_classItem$subject_id4,_classItem$course_id4,_classItem$teacher_id2,_classItem$main_class2,_classItem$students5,_classItem$students6;return/*#__PURE__*/_jsxs(TableRow,{hover:true,sx:{\"&:hover\":{bgcolor:\"rgba(0, 0, 0, 0.04)\"}},children:[/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:classItem.class_name})}),/*#__PURE__*/_jsx(TableCell,{children:(_classItem$subject_id2=classItem.subject_id)!==null&&_classItem$subject_id2!==void 0&&_classItem$subject_id2.name||(_classItem$course_id2=classItem.course_id)!==null&&_classItem$course_id2!==void 0&&_classItem$course_id2.name?/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:((_classItem$subject_id3=classItem.subject_id)===null||_classItem$subject_id3===void 0?void 0:_classItem$subject_id3.name)||((_classItem$course_id3=classItem.course_id)===null||_classItem$course_id3===void 0?void 0:_classItem$course_id3.name)}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",children:((_classItem$subject_id4=classItem.subject_id)===null||_classItem$subject_id4===void 0?void 0:_classItem$subject_id4.code)||((_classItem$course_id4=classItem.course_id)===null||_classItem$course_id4===void 0?void 0:_classItem$course_id4.code)||\"\"})]}):/*#__PURE__*/_jsx(Chip,{label:\"N/A\",size:\"small\",variant:\"outlined\"})}),/*#__PURE__*/_jsx(TableCell,{children:classItem.semester_id?/*#__PURE__*/_jsx(Chip,{label:classItem.semester_id.name,size:\"small\",color:\"info\",variant:\"outlined\"}):/*#__PURE__*/_jsx(Chip,{label:\"Kh\\xF4ng x\\xE1c \\u0111\\u1ECBnh\",size:\"small\",variant:\"outlined\",color:\"default\"})}),/*#__PURE__*/_jsx(TableCell,{children:(_classItem$teacher_id2=classItem.teacher_id)!==null&&_classItem$teacher_id2!==void 0&&_classItem$teacher_id2.full_name?/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:classItem.teacher_id.full_name}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"textSecondary\",children:classItem.teacher_id.email||\"\"})]}):/*#__PURE__*/_jsx(Chip,{label:\"Ch\\u01B0a ph\\xE2n c\\xF4ng\",size:\"small\",color:\"warning\",variant:\"outlined\"})}),/*#__PURE__*/_jsx(TableCell,{children:(_classItem$main_class2=classItem.main_class_id)!==null&&_classItem$main_class2!==void 0&&_classItem$main_class2.name?/*#__PURE__*/_jsx(Chip,{label:classItem.main_class_id.name,size:\"small\",sx:{bgcolor:\"#e3f2fd\"}}):/*#__PURE__*/_jsx(Chip,{label:\"Kh\\xF4ng c\\xF3\",size:\"small\",variant:\"outlined\",color:\"default\"})}),/*#__PURE__*/_jsx(TableCell,{align:\"center\",children:/*#__PURE__*/_jsx(Chip,{label:((_classItem$students5=classItem.students)===null||_classItem$students5===void 0?void 0:_classItem$students5.length)||0,color:((_classItem$students6=classItem.students)===null||_classItem$students6===void 0?void 0:_classItem$students6.length)>0?\"success\":\"default\",size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{children:classItem.status===\"đang học\"?/*#__PURE__*/_jsx(Chip,{label:\"\\u0110ang h\\u1ECDc\",size:\"small\",color:\"success\",variant:\"outlined\"}):classItem.status===\"đã kết thúc\"?/*#__PURE__*/_jsx(Chip,{label:\"\\u0110\\xE3 k\\u1EBFt th\\xFAc\",size:\"small\",color:\"default\",variant:\"outlined\"}):/*#__PURE__*/_jsx(Chip,{label:\"Ch\\u01B0a b\\u1EAFt \\u0111\\u1EA7u\",size:\"small\",color:\"primary\",variant:\"outlined\"})}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"flex-end\",children:[/*#__PURE__*/_jsx(Tooltip,{title:\"S\\u1EEDa l\\u1EDBp\",children:/*#__PURE__*/_jsx(IconButton,{color:\"primary\",onClick:()=>openDialog(\"edit\",classItem),size:\"small\",sx:{mx:0.5},children:/*#__PURE__*/_jsx(Edit,{fontSize:\"small\"})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"X\\xF3a l\\u1EDBp\",children:/*#__PURE__*/_jsx(IconButton,{color:\"error\",onClick:()=>openDeleteDialog(classItem),size:\"small\",sx:{mx:0.5},children:/*#__PURE__*/_jsx(Delete,{fontSize:\"small\"})})})]})})]},classItem._id);})})]}),/*#__PURE__*/_jsx(TablePagination,{rowsPerPageOptions:[5,10,25,50],component:\"div\",count:totalCount,rowsPerPage:rowsPerPage,page:page,onPageChange:handleChangePage,onRowsPerPageChange:handleChangeRowsPerPage,labelRowsPerPage:\"D\\xF2ng m\\u1ED7i trang:\",labelDisplayedRows:_ref2=>{let{from,to,count}=_ref2;return`${from}-${to} trên ${count}`;}})]});// Render main class form dialog\nconst renderMainClassFormDialog=()=>/*#__PURE__*/_jsxs(Dialog,{open:dialogOpen&&tabValue===0,onClose:()=>setDialogOpen(false),maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:dialogMode===\"create\"?\"Thêm lớp chính mới\":\"Sửa lớp chính\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mt:1},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{name:\"name\",label:\"T\\xEAn l\\u1EDBp\",fullWidth:true,required:true,value:mainClassForm.name,onChange:handleMainClassFormChange,error:formErrors.main.name,helperText:formErrors.main.name?\"Tên lớp không được để trống\":\"\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{name:\"code\",label:\"M\\xE3 l\\u1EDBp\",fullWidth:true,required:true,value:mainClassForm.code,onChange:handleMainClassFormChange,error:formErrors.main.code,helperText:formErrors.main.code?\"Mã lớp không được để trống\":\"Nhập đầy đủ mã lớp (VD: D22CQCN02-N)\",placeholder:\"VD: D22CQCN02-N\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Khoa\"}),/*#__PURE__*/_jsx(Select,{name:\"department_id\",value:mainClassForm.department_id,onChange:handleMainClassFormChange,label:\"Khoa\",children:departments.map(dept=>/*#__PURE__*/_jsx(MenuItem,{value:dept._id,children:dept.name},dept._id))})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(Autocomplete,{id:\"advisor-select\",options:teachers,getOptionLabel:option=>`${option.full_name} ${option.email?`(${option.email})`:\"\"}`,value:teachers.find(t=>t._id===mainClassForm.advisor_id)||null,onChange:(event,newValue)=>{setMainClassForm({...mainClassForm,advisor_id:(newValue===null||newValue===void 0?void 0:newValue._id)||\"\"});},renderInput:params=>/*#__PURE__*/_jsx(TextField,{...params,label:\"Gi\\xE1o vi\\xEAn ch\\u1EE7 nhi\\u1EC7m\",variant:\"outlined\",fullWidth:true,helperText:\"Quan tr\\u1ECDng: M\\u1ED7i l\\u1EDBp c\\u1EA7n c\\xF3 m\\u1ED9t gi\\xE1o vi\\xEAn ch\\u1EE7 nhi\\u1EC7m\"}),renderOption:(props,option)=>/*#__PURE__*/_jsx(\"li\",{...props,children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:option.full_name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:option.email})]})})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(Autocomplete,{multiple:true,options:students,getOptionLabel:option=>`${option.full_name} (${option.student_code||option.email})`,value:students.filter(student=>mainClassForm.students.includes(student._id)),onChange:handleStudentSelection,filterSelectedOptions:true,autoHighlight:true,disableCloseOnSelect:true,limitTags:3,renderInput:params=>/*#__PURE__*/_jsx(TextField,{...params,label:\"Ch\\u1ECDn sinh vi\\xEAn\",placeholder:\"T\\xECm sinh vi\\xEAn theo t\\xEAn ho\\u1EB7c m\\xE3 sinh vi\\xEAn\",helperText:`Đã chọn ${mainClassForm.students.length} sinh viên`}),renderTags:(value,getTagProps)=>value.map((option,index)=>/*#__PURE__*/_createElement(Chip,{label:`${option.full_name} (${option.student_code||option.email})`,...getTagProps({index}),key:option._id,size:\"small\"})),renderOption:(props,option,_ref3)=>{let{selected}=_ref3;return/*#__PURE__*/_jsx(\"li\",{...props,children:/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",flexDirection:\"column\"},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:option.full_name}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:option.student_code||option.email})]})});}})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDialogOpen(false),children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{onClick:handleFormSubmit,variant:\"contained\",color:\"primary\",disabled:!mainClassForm.name||!mainClassForm.code,children:dialogMode===\"create\"?\"Tạo mới\":\"Cập nhật\"})]})]});// Render teaching class form dialog\nconst renderTeachingClassFormDialog=()=>/*#__PURE__*/_jsxs(Dialog,{open:dialogOpen&&tabValue===1,onClose:()=>setDialogOpen(false),maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:dialogMode===\"create\"?\"Thêm lớp giảng dạy mới\":\"Sửa lớp giảng dạy\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mt:1},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{name:\"class_name\",label:\"T\\xEAn l\\u1EDBp\",fullWidth:true,required:true,value:teachingClassForm.class_name,onChange:handleTeachingClassFormChange,error:formErrors.teaching.class_name,helperText:formErrors.teaching.class_name?\"Tên lớp không được để trống\":\"\"})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{name:\"class_code\",label:\"M\\xE3 l\\u1EDBp\",fullWidth:true,required:true,value:teachingClassForm.class_code,onChange:handleTeachingClassFormChange,placeholder:\"VD: IT4060.TH01.N22\",helperText:\"M\\xE3 \\u0111\\u1ECBnh danh c\\u1EE7a l\\u1EDBp h\\u1ECDc ph\\u1EA7n\",error:formErrors.teaching.class_code})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,required:true,error:formErrors.teaching.subject_id,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"M\\xF4n h\\u1ECDc\"}),/*#__PURE__*/_jsx(Select,{name:\"subject_id\",value:teachingClassForm.subject_id,onChange:handleTeachingClassFormChange,label:\"M\\xF4n h\\u1ECDc\",children:subjects.map(subject=>/*#__PURE__*/_jsxs(MenuItem,{value:subject._id,children:[subject.name,\" (\",subject.code,\")\"]},subject._id))}),formErrors.teaching.subject_id&&/*#__PURE__*/_jsx(FormHelperText,{children:\"Vui l\\xF2ng ch\\u1ECDn m\\xF4n h\\u1ECDc\"})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(Autocomplete,{id:\"teacher-select\",options:teachers,getOptionLabel:option=>`${option.full_name} ${option.email?`(${option.email})`:\"\"}`,value:teachers.find(t=>t._id===teachingClassForm.teacher_id)||null,onChange:(event,newValue)=>{setTeachingClassForm({...teachingClassForm,teacher_id:(newValue===null||newValue===void 0?void 0:newValue._id)||\"\"});},renderInput:params=>/*#__PURE__*/_jsx(TextField,{...params,label:\"Gi\\xE1o vi\\xEAn\",variant:\"outlined\",fullWidth:true}),renderOption:(props,option)=>/*#__PURE__*/_jsx(\"li\",{...props,children:/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:option.full_name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:option.email})]})})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,required:true,error:formErrors.teaching.semester_id,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"K\\u1EF3 h\\u1ECDc\"}),/*#__PURE__*/_jsx(Select,{name:\"semester_id\",value:teachingClassForm.semester_id,onChange:handleTeachingClassFormChange,label:\"K\\u1EF3 h\\u1ECDc\",children:semesters.map(semester=>/*#__PURE__*/_jsxs(MenuItem,{value:semester._id,children:[semester.name,\" (\",semester.year,\")\"]},semester._id))}),formErrors.teaching.semester_id&&/*#__PURE__*/_jsx(FormHelperText,{children:\"Vui l\\xF2ng ch\\u1ECDn k\\u1EF3 h\\u1ECDc\"})]})}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:12,sm:12,children:[/*#__PURE__*/_jsx(Autocomplete,{id:\"main-class-select\",options:mainClasses,getOptionLabel:option=>`${option.name} (${option.class_code})`,value:mainClasses.find(cls=>cls._id===teachingClassForm.main_class_id)||null,onChange:(event,newValue)=>{setTeachingClassForm({...teachingClassForm,main_class_id:(newValue===null||newValue===void 0?void 0:newValue._id)||\"\"});},renderInput:params=>/*#__PURE__*/_jsx(TextField,{...params,label:\"L\\u1EDBp ch\\xEDnh\",fullWidth:true}),renderOption:(props,option)=>/*#__PURE__*/_jsx(\"li\",{...props,children:/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",flexDirection:\"column\"},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:option.name}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:option.class_code})]})})}),/*#__PURE__*/_jsx(FormHelperText,{children:\"Li\\xEAn k\\u1EBFt v\\u1EDBi l\\u1EDBp ch\\xEDnh. Sinh vi\\xEAn t\\u1EEB m\\u1ECDi l\\u1EDBp \\u0111\\u1EC1u c\\xF3 th\\u1EC3 tham gia l\\u1EDBp gi\\u1EA3ng d\\u1EA1y n\\xE0y.\"})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(Autocomplete,{multiple:true,options:students,getOptionLabel:option=>`${option.full_name} (${option.student_code||option.email})`,value:students.filter(student=>teachingClassForm.selected_students.includes(student._id)),onChange:handleStudentSelection,filterSelectedOptions:true,autoHighlight:true,disableCloseOnSelect:true,limitTags:3,renderInput:params=>/*#__PURE__*/_jsx(TextField,{...params,label:\"Ch\\u1ECDn sinh vi\\xEAn\",placeholder:\"T\\xECm sinh vi\\xEAn theo t\\xEAn ho\\u1EB7c m\\xE3 sinh vi\\xEAn\",helperText:`Đã chọn ${teachingClassForm.selected_students.length} sinh viên`}),renderTags:(value,getTagProps)=>value.map((option,index)=>/*#__PURE__*/_createElement(Chip,{label:`${option.full_name} (${option.student_code||option.email})`,...getTagProps({index}),key:option._id,size:\"small\"})),renderOption:(props,option,_ref4)=>{let{selected}=_ref4;return/*#__PURE__*/_jsx(\"li\",{...props,children:/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",flexDirection:\"column\"},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",children:option.full_name}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",color:\"text.secondary\",children:option.student_code||option.email})]})});}})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{name:\"description\",label:\"M\\xF4 t\\u1EA3\",fullWidth:true,multiline:true,rows:3,value:teachingClassForm.description,onChange:handleTeachingClassFormChange})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDialogOpen(false),children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{onClick:handleFormSubmit,variant:\"contained\",color:\"primary\",disabled:!teachingClassForm.class_name||!teachingClassForm.class_code||!teachingClassForm.subject_id||!teachingClassForm.semester_id,children:dialogMode===\"create\"?\"Tạo mới\":\"Cập nhật\"})]})]});// Thêm component hiển thị thống kê\nconst renderStatCards=()=>/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mb:3},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(Card,{sx:{borderLeft:\"4px solid #3f51b5\",boxShadow:2,height:\"100%\",display:\"flex\",flexDirection:\"column\"},children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"L\\u1EDBp ch\\xEDnh\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:stats.mainClasses})]}),/*#__PURE__*/_jsx(Box,{sx:{flexGrow:1}}),/*#__PURE__*/_jsxs(Box,{sx:{p:1.5,bgcolor:\"rgba(63, 81, 181, 0.08)\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",cursor:\"pointer\"},onClick:()=>{setTabValue(0);clearFilters();},children:[/*#__PURE__*/_jsx(School,{fontSize:\"small\",sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Xem t\\u1EA5t c\\u1EA3 l\\u1EDBp ch\\xEDnh\"})]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(Card,{sx:{borderLeft:\"4px solid #f50057\",boxShadow:2,height:\"100%\",display:\"flex\",flexDirection:\"column\"},children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"L\\u1EDBp gi\\u1EA3ng d\\u1EA1y\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:stats.teachingClasses})]}),/*#__PURE__*/_jsx(Box,{sx:{flexGrow:1}}),/*#__PURE__*/_jsxs(Box,{sx:{p:1.5,bgcolor:\"rgba(245, 0, 87, 0.08)\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",cursor:\"pointer\"},onClick:()=>{setTabValue(1);clearFilters();},children:[/*#__PURE__*/_jsx(People,{fontSize:\"small\",sx:{mr:1}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",children:\"Xem t\\u1EA5t c\\u1EA3 l\\u1EDBp gi\\u1EA3ng d\\u1EA1y\"})]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{sx:{borderLeft:\"4px solid #4caf50\",boxShadow:2,height:\"100%\"},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"Sinh vi\\xEAn\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:stats.students}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",sx:{mt:1},children:\"T\\u1ED5ng s\\u1ED1 sinh vi\\xEAn \\u0111\\xE3 ph\\xEA duy\\u1EC7t\"})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(Card,{sx:{borderLeft:\"4px solid #ff9800\",boxShadow:2,height:\"100%\"},children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textSecondary\",gutterBottom:true,children:\"Gi\\xE1o vi\\xEAn\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",children:stats.teachers}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",sx:{mt:1},children:\"T\\u1ED5ng s\\u1ED1 gi\\xE1o vi\\xEAn \\u0111\\xE3 ph\\xEA duy\\u1EC7t\"})]})})})]});// Thêm component hiển thị thẻ thông tin khi không có dữ liệu\nconst renderEmptyState=()=>/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",flexDirection:\"column\",alignItems:\"center\",justifyContent:\"center\",py:5,px:2,bgcolor:\"#f5f5f5\",borderRadius:2},children:[/*#__PURE__*/_jsx(Box,{sx:{mb:2},children:tabValue===0?/*#__PURE__*/_jsx(School,{sx:{fontSize:60,color:\"#3f51b5\"}}):/*#__PURE__*/_jsx(People,{sx:{fontSize:60,color:\"#f50057\"}})}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:tabValue===0?\"Chưa có lớp chính nào\":\"Chưa có lớp giảng dạy nào\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",align:\"center\",sx:{mb:3},children:tabValue===0?\"Lớp chính dùng để quản lý danh sách sinh viên theo khóa học và khoa phòng. Mỗi lớp chính có một giáo viên chủ nhiệm.\":\"Lớp giảng dạy dùng để quản lý các môn học cụ thể. Mỗi lớp giảng dạy có một giáo viên giảng dạy và có thể liên kết với lớp chính.\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>openDialog(\"create\"),children:tabValue===0?\"Tạo lớp chính mới\":\"Tạo lớp giảng dạy mới\"})]});return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Qu\\u1EA3n l\\xFD l\\u1EDBp h\\u1ECDc\"}),renderStatCards(),/*#__PURE__*/_jsx(Paper,{sx:{mb:3},children:/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:handleTabChange,indicatorColor:\"primary\",textColor:\"primary\",variant:\"fullWidth\",children:[/*#__PURE__*/_jsx(Tab,{label:\"L\\u1EDBp ch\\xEDnh\",icon:/*#__PURE__*/_jsx(School,{}),iconPosition:\"start\"}),/*#__PURE__*/_jsx(Tab,{label:\"L\\u1EDBp gi\\u1EA3ng d\\u1EA1y\",icon:/*#__PURE__*/_jsx(People,{}),iconPosition:\"start\"})]})}),/*#__PURE__*/_jsxs(Paper,{sx:{p:2,mb:3},children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexDirection:{xs:\"column\",sm:\"row\"},alignItems:{sm:\"center\"},justifyContent:\"space-between\",gap:2,mb:2,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,flexGrow:1,children:[/*#__PURE__*/_jsx(TextField,{label:`Tìm kiếm ${tabValue===0?\"lớp chính\":\"lớp giảng dạy\"}`,variant:\"outlined\",size:\"small\",fullWidth:true,value:searchTerm,onChange:e=>setSearchTerm(e.target.value),onKeyPress:e=>e.key===\"Enter\"&&handleSearch(),InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(Search,{})})}}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleSearch,startIcon:/*#__PURE__*/_jsx(Search,{}),children:\"T\\xECm\"})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",gap:2,children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(Refresh,{}),onClick:loadClasses,children:\"L\\xE0m m\\u1EDBi\"}),/*#__PURE__*/_jsxs(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>openDialog(\"create\"),children:[\"Th\\xEAm \",tabValue===0?\"lớp chính\":\"lớp giảng dạy\"]})]})]}),/*#__PURE__*/_jsx(Collapse,{in:true,children:/*#__PURE__*/_jsxs(Box,{sx:{p:1,border:\"1px solid #e0e0e0\",borderRadius:1,mt:1},children:[/*#__PURE__*/_jsx(Typography,{variant:\"subtitle2\",gutterBottom:true,children:\"B\\u1ED9 l\\u1ECDc n\\xE2ng cao\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[tabValue===0?/*#__PURE__*/// Bộ lọc cho lớp chính\n_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,size:\"small\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Khoa/B\\u1ED9 m\\xF4n\"}),/*#__PURE__*/_jsxs(Select,{name:\"department\",value:filterOptions.department,onChange:handleFilterChange,label:\"Khoa/B\\u1ED9 m\\xF4n\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"T\\u1EA5t c\\u1EA3\"}),departments.map(dept=>/*#__PURE__*/_jsx(MenuItem,{value:dept._id,children:dept.name},dept._id))]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,size:\"small\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Gi\\xE1o vi\\xEAn ch\\u1EE7 nhi\\u1EC7m\"}),/*#__PURE__*/_jsxs(Select,{name:\"teacher\",value:filterOptions.teacher,onChange:handleFilterChange,label:\"Gi\\xE1o vi\\xEAn ch\\u1EE7 nhi\\u1EC7m\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"T\\u1EA5t c\\u1EA3\"}),teachers.map(teacher=>/*#__PURE__*/_jsx(MenuItem,{value:teacher._id,children:teacher.full_name},teacher._id))]})]})})]}):/*#__PURE__*/// Bộ lọc cho lớp giảng dạy\n_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,size:\"small\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"M\\xF4n h\\u1ECDc\"}),/*#__PURE__*/_jsxs(Select,{name:\"course\",value:filterOptions.course,onChange:handleFilterChange,label:\"M\\xF4n h\\u1ECDc\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"T\\u1EA5t c\\u1EA3\"}),subjects.map(subject=>/*#__PURE__*/_jsx(MenuItem,{value:subject._id,children:subject.name},subject._id))]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,size:\"small\",children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Gi\\xE1o vi\\xEAn\"}),/*#__PURE__*/_jsxs(Select,{name:\"teacher\",value:filterOptions.teacher,onChange:handleFilterChange,label:\"Gi\\xE1o vi\\xEAn\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"T\\u1EA5t c\\u1EA3\"}),teachers.map(teacher=>/*#__PURE__*/_jsx(MenuItem,{value:teacher._id,children:teacher.full_name},teacher._id))]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,size:\"small\",label:\"H\\u1ECDc k\\u1EF3\",name:\"semester\",value:filterOptions.semester,onChange:handleFilterChange})})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,md:3,children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",gap:1,children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"primary\",fullWidth:true,onClick:applyFilters,children:\"\\xC1p d\\u1EE5ng\"}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",color:\"inherit\",onClick:clearFilters,children:\"X\\xF3a l\\u1ECDc\"})]})})]})]})})]}),isLoading?/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"center\",py:8},children:/*#__PURE__*/_jsx(CircularProgress,{})}):classes.length===0&&searchTerm===\"\"&&!filterOptions.department&&!filterOptions.teacher&&!filterOptions.course&&!filterOptions.semester?renderEmptyState():tabValue===0?renderMainClassesTable():renderTeachingClassesTable(),tabValue===0?renderMainClassFormDialog():renderTeachingClassFormDialog(),/*#__PURE__*/_jsxs(Dialog,{open:deleteDialog.open,onClose:()=>setDeleteDialog({...deleteDialog,open:false}),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"X\\xE1c nh\\u1EADn x\\xF3a\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsx(DialogContentText,{children:tabValue===0?\"Bạn có chắc chắn muốn xóa lớp chính này? Hành động này không thể hoàn tác.\":\"Bạn có chắc chắn muốn xóa lớp giảng dạy này? Hành động này không thể hoàn tác.\"})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDeleteDialog({...deleteDialog,open:false}),color:\"inherit\",children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{onClick:handleDeleteClass,color:\"error\",autoFocus:true,children:\"X\\xF3a\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:studentApprovalDialog.open,onClose:closeStudentApproval,maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsxs(DialogTitle,{children:[\"Qu\\u1EA3n l\\xFD sinh vi\\xEAn - \",(_studentApprovalDialo=studentApprovalDialog.classItem)===null||_studentApprovalDialo===void 0?void 0:_studentApprovalDialo.name]}),/*#__PURE__*/_jsx(DialogContent,{children:studentApprovalDialog.loading?/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"center\",p:3},children:/*#__PURE__*/_jsx(CircularProgress,{})}):/*#__PURE__*/_jsxs(Box,{sx:{width:\"100%\"},children:[/*#__PURE__*/_jsxs(Tabs,{value:studentApprovalDialog.tabValue,onChange:handleApprovalTabChange,indicatorColor:\"primary\",textColor:\"primary\",centered:true,children:[/*#__PURE__*/_jsx(Tab,{label:/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(AccessTime,{sx:{mr:1}}),\"Sinh vi\\xEAn ch\\u1EDD duy\\u1EC7t\",\" \",studentApprovalDialog.pendingStudents.length>0&&/*#__PURE__*/_jsx(Chip,{label:studentApprovalDialog.pendingStudents.length,color:\"error\",size:\"small\",sx:{ml:1}})]})}),/*#__PURE__*/_jsx(Tab,{label:/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(School,{sx:{mr:1}}),\"Sinh vi\\xEAn c\\u1EE7a l\\u1EDBp\"]})})]}),/*#__PURE__*/_jsxs(Box,{sx:{p:2},children:[studentApprovalDialog.tabValue===0&&/*#__PURE__*/_jsx(_Fragment,{children:studentApprovalDialog.pendingStudents.length===0?/*#__PURE__*/_jsx(Alert,{severity:\"info\",children:\"Kh\\xF4ng c\\xF3 sinh vi\\xEAn n\\xE0o \\u0111ang ch\\u1EDD ph\\xEA duy\\u1EC7t\"}):/*#__PURE__*/_jsx(List,{children:studentApprovalDialog.pendingStudents.map(student=>{var _student$school_info;return/*#__PURE__*/_jsxs(ListItem,{sx:{mb:1,border:\"1px solid #e0e0e0\",borderRadius:1},children:[/*#__PURE__*/_jsx(ListItemAvatar,{children:/*#__PURE__*/_jsx(Avatar,{children:student.full_name.charAt(0).toUpperCase()})}),/*#__PURE__*/_jsx(ListItemText,{primary:/*#__PURE__*/_jsxs(Box,{sx:{display:\"flex\",alignItems:\"center\"},children:[student.full_name,/*#__PURE__*/_jsx(Chip,{label:\"Ch\\u1EDD duy\\u1EC7t\",color:\"warning\",size:\"small\",sx:{ml:1}})]}),secondary:/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"Email: \",student.email]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"MSSV:\",\" \",((_student$school_info=student.school_info)===null||_student$school_info===void 0?void 0:_student$school_info.student_code)||\"Chưa có\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"Ng\\xE0y \\u0111\\u0103ng k\\xFD:\",\" \",new Date(student.created_at).toLocaleDateString()]})]})}),/*#__PURE__*/_jsxs(ListItemSecondaryAction,{children:[/*#__PURE__*/_jsx(IconButton,{edge:\"end\",color:\"success\",onClick:()=>handleApproveStudent(student._id),title:\"Ph\\xEA duy\\u1EC7t\",children:/*#__PURE__*/_jsx(Check,{})}),/*#__PURE__*/_jsx(IconButton,{edge:\"end\",color:\"error\",onClick:()=>openRejectDialog(student._id),title:\"T\\u1EEB ch\\u1ED1i\",sx:{ml:1},children:/*#__PURE__*/_jsx(Close,{})})]})]},student._id);})})}),studentApprovalDialog.tabValue===1&&/*#__PURE__*/_jsx(_Fragment,{children:studentApprovalDialog.approvedStudents.length===0?/*#__PURE__*/_jsx(Alert,{severity:\"info\",children:\"Ch\\u01B0a c\\xF3 sinh vi\\xEAn n\\xE0o trong l\\u1EDBp\"}):/*#__PURE__*/_jsx(TableContainer,{children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"H\\u1ECD t\\xEAn\"}),/*#__PURE__*/_jsx(TableCell,{children:\"MSSV\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Email\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Tr\\u1EA1ng th\\xE1i\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:studentApprovalDialog.approvedStudents.map(student=>{var _student$school_info2;return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:student.full_name}),/*#__PURE__*/_jsx(TableCell,{children:((_student$school_info2=student.school_info)===null||_student$school_info2===void 0?void 0:_student$school_info2.student_code)||\"Chưa có\"}),/*#__PURE__*/_jsx(TableCell,{children:student.email}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Chip,{label:\"\\u0110\\xE3 ph\\xEA duy\\u1EC7t\",color:\"success\",size:\"small\"})})]},student._id);})})]})})})]})]})}),/*#__PURE__*/_jsx(DialogActions,{children:/*#__PURE__*/_jsx(Button,{onClick:closeStudentApproval,color:\"primary\",children:\"\\u0110\\xF3ng\"})})]}),studentApprovalDialog.rejectDialog.open&&/*#__PURE__*/_jsxs(Dialog,{open:studentApprovalDialog.rejectDialog.open,onClose:closeRejectDialog,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"T\\u1EEB ch\\u1ED1i sinh vi\\xEAn\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",paragraph:true,children:\"B\\u1EA1n c\\xF3 ch\\u1EAFc mu\\u1ED1n t\\u1EEB ch\\u1ED1i sinh vi\\xEAn n\\xE0y?\"}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,multiline:true,rows:3,label:\"L\\xFD do t\\u1EEB ch\\u1ED1i\",placeholder:\"Nh\\u1EADp l\\xFD do t\\u1EEB ch\\u1ED1i \\u0111\\u1EC3 th\\xF4ng b\\xE1o cho sinh vi\\xEAn\",value:studentApprovalDialog.rejectDialog.reason,onChange:handleRejectReasonChange,variant:\"outlined\",sx:{mt:2}})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:closeRejectDialog,color:\"inherit\",children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{onClick:handleRejectStudent,color:\"error\",variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Close,{}),children:\"T\\u1EEB ch\\u1ED1i\"})]})]})]});};export default ClassesPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
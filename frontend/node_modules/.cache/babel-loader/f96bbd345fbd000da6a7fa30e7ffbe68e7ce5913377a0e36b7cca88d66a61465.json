{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\teacher\\\\AttendancePage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, lazy, Suspense, useCallback } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport { Box, Typography, Card, CardContent, Grid, Paper, Button, Divider, CircularProgress, List, ListItem, ListItemAvatar, ListItemText, Avatar, Chip, Dialog, DialogTitle, DialogContent, DialogActions, TextField, FormControl, InputLabel, Select, MenuItem, IconButton, Alert, AlertTitle, Tooltip, Stepper, Step, StepLabel, StepContent } from \"@mui/material\";\nimport { CameraAlt, Check, Close, Edit, Refresh, Save, VerifiedUser, HourglassEmpty, ArrowBack, Info, VideocamOff, PlayCircleOutline, StopCircleOutlined, Visibility, VisibilityOff } from \"@mui/icons-material\";\nimport { setModelLoaded as setFaceRecModelLoaded,\n// Rename to avoid conflict\nsetCameraReady as setFaceRecCameraReady,\n// Rename to avoid conflict\nsetDetectedFaces, setRecognizedStudents, clearRecognitionState, getClassFaceFeatures,\n// Correct thunk action name\nverifyAttendance, manualAttendance } from \"../../redux/slices/faceRecognitionSlice\"; // Fixed relative import path\n\n// Lazy load Webcam\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Webcam = /*#__PURE__*/lazy(_c = () => import(\"react-webcam\"));\n_c2 = Webcam;\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (faceapi.nets.tinyFaceDetector.isLoaded && faceapi.nets.faceLandmark68Net.isLoaded && faceapi.nets.faceRecognitionNet.isLoaded\n    // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null\n    });\n    await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\n      variant: \"success\"\n    });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = student => {\n  var _student$faceFeatures, _student$faceFeatures2;\n  if (!student || !((_student$faceFeatures = student.faceFeatures) !== null && _student$faceFeatures !== void 0 && _student$faceFeatures.descriptors) && !student.faceDescriptors) {\n    return [];\n  }\n  const descriptors = [];\n  const rawDescriptors = ((_student$faceFeatures2 = student.faceFeatures) === null || _student$faceFeatures2 === void 0 ? void 0 : _student$faceFeatures2.descriptors) || student.faceDescriptors || [];\n  const findDescriptors = data => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every(n => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n  findDescriptors(rawDescriptors);\n  return descriptors.filter(d => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  _s();\n  var _classInfo$students, _classInfo$students2;\n  const {\n    classId,\n    sessionId\n  } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\"\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const {\n    token\n  } = useSelector(state => state.auth);\n\n  // Access faceRecognition state directly\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents,\n    // Assuming slice holds the relevant class students\n    isProcessing,\n    error: faceRecError // Get error state\n  } = useSelector(state => state.faceRecognition);\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([axios.get(`${API_URL}/classes/teaching/${classId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        })]);\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Nếu phiên đã hoàn thành, không cần tải mô hình nhận dạng\n        const isSessionCompleted = (loadedSessionInfo === null || loadedSessionInfo === void 0 ? void 0 : loadedSessionInfo.status) === \"completed\";\n        if (isSessionCompleted) {\n          // Không cần tải mô hình và đặc trưng khuôn mặt nếu phiên đã hoàn thành\n          setIsLoading(false);\n          return;\n        }\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          // Capture the return value indicating success/failure\n          const modelsLoadedSuccessfully = await loadFaceRecognitionModels(dispatch, enqueueSnackbar);\n          // Check if model loading failed using the return value\n          if (!modelsLoadedSuccessfully) {\n            // Use the return value here\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n          // No need to check isModelLoaded from state again here\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if (!isSessionCompleted && isModelLoaded) {\n          await dispatch(getClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        var _error$response, _error$response$data;\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, {\n          variant: \"error\"\n        });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      var _webcamRef$current, _webcamRef$current$vi, _webcamRef$current$vi2;\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      (_webcamRef$current = webcamRef.current) === null || _webcamRef$current === void 0 ? void 0 : (_webcamRef$current$vi = _webcamRef$current.video) === null || _webcamRef$current$vi === void 0 ? void 0 : (_webcamRef$current$vi2 = _webcamRef$current$vi.srcObject) === null || _webcamRef$current$vi2 === void 0 ? void 0 : _webcamRef$current$vi2.getTracks().forEach(track => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(stream => {\n    console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n    dispatch(setFaceRecCameraReady(true));\n    setComponentError(null); // Clear camera errors\n  }, [dispatch]);\n  const handleUserMediaError = useCallback(error => {\n    console.error(\"Lỗi khi truy cập camera:\", error);\n    const errMsg = `Không thể truy cập camera: ${error.name === \"NotAllowedError\" ? \"Bạn chưa cấp quyền truy cập camera\" : error.name === \"NotFoundError\" ? \"Không tìm thấy thiết bị camera\" : error.message || \"Lỗi không xác định\"}`;\n    enqueueSnackbar(errMsg, {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecCameraReady(false));\n    setComponentError(errMsg);\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback((detections, recognizedData = []) => {\n    var _webcamRef$current2;\n    if (!canvasRef.current || !((_webcamRef$current2 = webcamRef.current) !== null && _webcamRef$current2 !== void 0 && _webcamRef$current2.video)) return;\n    const video = webcamRef.current.video;\n    const canvas = canvasRef.current;\n    const displaySize = {\n      width: video.videoWidth,\n      height: video.videoHeight\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n    const resizedDetections = faceapi.resizeResults(detections, displaySize);\n    const ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    resizedDetections.forEach((detection, i) => {\n      // Validate detection and box before drawing\n      if (!detection || !detection.detection || !detection.detection.box) {\n        console.warn(\"Skipping drawing for invalid detection object:\", detection);\n        return; // Skip this detection\n      }\n      const box = detection.detection.box;\n\n      // Further validate box properties\n      if (box.x == null || box.y == null || box.width == null || box.height == null || box.width <= 0 || box.height <= 0) {\n        console.warn(\"Skipping drawing for invalid box properties:\", box);\n        return; // Skip this detection\n      }\n      const landmarks = detection.landmarks;\n      const recognized = recognizedData.find(rec => rec.detectionIndex === i); // Match recognition result\n\n      // Draw box\n      const boxColor = recognized ? recognized.confidence > CONFIDENCE_THRESHOLD ? \"#4CAF50\" : \"#FFC107\" : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n      ctx.strokeStyle = boxColor;\n      ctx.lineWidth = 2;\n      ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n      // Draw label background\n      const label = recognized ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)` : \"Đang nhận diện...\";\n      const textWidth = ctx.measureText(label).width;\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n      ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n      // Draw label text\n      ctx.fillStyle = \"#FFFFFF\";\n      ctx.font = \"14px Arial\";\n      ctx.fillText(label, box.x + 5, box.y - 5);\n\n      // Draw landmarks if enabled\n      if (showLandmarks && landmarks) {\n        faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n      }\n    });\n  }, [showLandmarks]); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(async (recognize = true) => {\n    var _webcamRef$current3;\n    if (!isCameraReady || !((_webcamRef$current3 = webcamRef.current) !== null && _webcamRef$current3 !== void 0 && _webcamRef$current3.video) || webcamRef.current.video.readyState !== 4 || !isModelLoaded) {\n      return null; // Return null if detection can't proceed\n    }\n    const video = webcamRef.current.video;\n    try {\n      let faceData;\n      if (recognize) {\n        // Detect faces, landmarks, and descriptors for recognition\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks().withFaceDescriptors();\n      } else {\n        // Only detect faces and landmarks (for drawing)\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks();\n      }\n      dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n      if (!faceData || faceData.length === 0) {\n        // Clear canvas if no faces detected\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        }\n        dispatch(setRecognizedStudents([])); // Clear recognized students\n        return null;\n      }\n\n      // --- Recognition Logic (if recognize === true) ---\n      let recognizedData = [];\n      if (recognize && classStudents && classStudents.length > 0) {\n        const labeledDescriptors = classStudents.map(student => {\n          const descriptors = extractStudentDescriptors(student);\n          if (descriptors.length > 0) {\n            return new faceapi.LabeledFaceDescriptors(student._id, descriptors); // Use student ID as label\n          }\n          return null;\n        }).filter(ld => ld !== null); // Filter out students with no descriptors\n\n        if (labeledDescriptors.length > 0) {\n          const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, RECOGNITION_THRESHOLD);\n          recognizedData = faceData.map((fd, index) => {\n            const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n            const student = classStudents.find(s => s._id === bestMatch.label); // Find student by ID label\n            return {\n              detectionIndex: index,\n              // Link recognition to detection\n              studentId: student === null || student === void 0 ? void 0 : student._id,\n              name: (student === null || student === void 0 ? void 0 : student.full_name) || \"Không rõ\",\n              confidence: 1 - bestMatch.distance,\n              // Convert distance to confidence-like score\n              isUnknown: bestMatch.label === \"unknown\"\n            };\n          }).filter(r => !r.isUnknown); // Filter out unknown matches\n\n          dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n        } else {\n          dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n        }\n      }\n\n      // Draw landmarks and boxes with recognition info\n      drawLandmarks(faceData, recognizedData);\n      return {\n        detections: faceData,\n        recognized: recognizedData\n      }; // Return both detection and recognition results\n    } catch (error) {\n      console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n      enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n        variant: \"error\"\n      });\n      // Clear canvas on error\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n      dispatch(setDetectedFaces([]));\n      dispatch(setRecognizedStudents([]));\n      return null;\n    }\n  }, [isCameraReady, isModelLoaded, classStudents, drawLandmarks, dispatch, enqueueSnackbar]);\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort((a, b) => b.confidence - a.confidence)[0];\n      enqueueSnackbar(`Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(1)}%)`, {\n        variant: \"info\"\n      });\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence >= CONFIDENCE_THRESHOLD) {\n        var _result$detections$to;\n        // Find the corresponding descriptor\n        const descriptor = (_result$detections$to = result.detections[topMatch.detectionIndex]) === null || _result$detections$to === void 0 ? void 0 : _result$detections$to.descriptor;\n        if (descriptor) {\n          handleMarkAttendance(topMatch.studentId, topMatch.confidence, descriptor);\n        } else {\n          console.warn(\"Không tìm thấy descriptor cho top match\", topMatch);\n          enqueueSnackbar(\"Lỗi: Không thể lấy đặc trưng khuôn mặt để điểm danh.\", {\n            variant: \"warning\"\n          });\n        }\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\", {\n        variant: \"warning\"\n      });\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", {\n        variant: \"warning\"\n      });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = student => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({\n      status: \"present\",\n      note: \"\"\n    }); // Reset form\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change\n  const handleManualAttendanceChange = e => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n    try {\n      const result = await dispatch(manualAttendance({\n        sessionId,\n        studentId: selectedStudent._id,\n        status: manualAttendanceData.status,\n        note: manualAttendanceData.note\n      })).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id;\n          return ((_log$student_id = log.student_id) === null || _log$student_id === void 0 ? void 0 : _log$student_id._id) === selectedStudent._id;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: selectedStudent\n        }; // Use the selected student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh thủ công cho ${selectedStudent.full_name}`, {\n        variant: \"success\"\n      });\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(async (studentId, confidence, faceDescriptor) => {\n    if (!studentId || isProcessing) return;\n\n    // Check if student already marked present\n    const isAlreadyPresent = attendanceLogs.some(log => {\n      var _log$student_id2;\n      return ((_log$student_id2 = log.student_id) === null || _log$student_id2 === void 0 ? void 0 : _log$student_id2._id) === studentId && log.status === \"present\";\n    });\n    if (isAlreadyPresent) {\n      // console.log(`Student ${studentId} already marked present.`);\n      return; // Don't mark again if already present\n    }\n    const student = classStudents.find(s => s._id === studentId);\n    if (!student) {\n      console.warn(\"Student not found for marking attendance:\", studentId);\n      return;\n    }\n\n    // Capture image for proof (optional, but good practice)\n    let imageBase64 = null;\n    try {\n      if (webcamRef.current) {\n        imageBase64 = webcamRef.current.getScreenshot({\n          width: 320,\n          height: 240\n        }); // Smaller screenshot\n      }\n    } catch (screenshotError) {\n      console.error(\"Error taking screenshot:\", screenshotError);\n      // Proceed without image if screenshot fails\n    }\n    try {\n      const result = await dispatch(verifyAttendance({\n        sessionId,\n        studentId,\n        faceDescriptor,\n        // Pass the received descriptor\n        confidence,\n        imageBase64,\n        recognized: true // Mark as recognized by the system\n      })).unwrap();\n\n      // Update local attendance logs\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id3;\n          return ((_log$student_id3 = log.student_id) === null || _log$student_id3 === void 0 ? void 0 : _log$student_id3._id) === studentId;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: student\n        }; // Use the found student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n        variant: \"success\"\n      });\n    } catch (error) {\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  }, [dispatch, sessionId, classStudents, attendanceLogs, isProcessing, enqueueSnackbar]); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (!isCameraReady || !isModelLoaded || !classStudents || classStudents.length === 0) {\n      enqueueSnackbar(\"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\", {\n        variant: \"warning\"\n      });\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach(rec => {\n          // Check if confidence meets or exceeds the threshold\n          if (rec.confidence >= CONFIDENCE_THRESHOLD && rec.studentId) {\n            var _result$detections$re;\n            // Find the corresponding descriptor\n            const descriptor = (_result$detections$re = result.detections[rec.detectionIndex]) === null || _result$detections$re === void 0 ? void 0 : _result$detections$re.descriptor;\n            if (descriptor) {\n              handleMarkAttendance(rec.studentId, rec.confidence, descriptor); // Attempt to mark attendance\n            } else {\n              console.warn(\"Không tìm thấy descriptor cho recognized student trong auto mode\", rec);\n            }\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [isCameraReady, isModelLoaded, classStudents, detectAndRecognizeFaces, handleMarkAttendance, enqueueSnackbar]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      // Lấy danh sách sinh viên vắng mặt từ UI\n      const absentStudentIds = absentStudents.map(student => student._id);\n      enqueueSnackbar(\"Đang kết thúc phiên...\", {\n        variant: \"info\"\n      });\n      await axios.put(`${API_URL}/attendance/sessions/${sessionId}`, {\n        status: \"completed\",\n        students_absent: absentStudentIds\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", {\n        variant: \"success\"\n      });\n      setSessionInfo(prev => ({\n        ...prev,\n        status: \"completed\"\n      }));\n      stopAutoAttendance();\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || \"Lỗi khi kết thúc phiên\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", {\n        variant: \"info\"\n      });\n      const [logsRes, sessionRes] = await Promise.all([axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      })]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", {\n        variant: \"success\"\n      });\n    } catch (error) {\n      var _error$response3, _error$response3$data;\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || \"Lỗi khi làm mới dữ liệu\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const toggleLandmarks = () => {\n    setShowLandmarks(prev => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(log => log.status === \"present\");\n  const absentStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students = classInfo.students) === null || _classInfo$students === void 0 ? void 0 : _classInfo$students.filter(student => !attendanceLogs.some(log => {\n    var _log$student_id4;\n    return ((_log$student_id4 = log.student_id) === null || _log$student_id4 === void 0 ? void 0 : _log$student_id4._id) === student._id && (log.status === \"present\" || log.status === \"late\");\n  }) // Consider late as not absent\n  )) || [];\n  const totalStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students2 = classInfo.students) === null || _classInfo$students2 === void 0 ? void 0 : _classInfo$students2.length) || 0;\n  const sessionCompleted = (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      minHeight: \"80vh\",\n      children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 888,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        sx: {\n          ml: 2\n        },\n        children: \"\\u0110ang t\\u1EA3i d\\u1EEF li\\u1EC7u \\u0111i\\u1EC3m danh...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 889,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 882,\n      columnNumber: 7\n    }, this);\n  }\n  if (componentError && !isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 3\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        action: /*#__PURE__*/_jsxDEV(Button, {\n          color: \"inherit\",\n          size: \"small\",\n          onClick: () => window.location.reload(),\n          children: \"T\\u1EA3i l\\u1EA1i trang\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 900,\n          columnNumber: 13\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(AlertTitle, {\n          children: \"\\u0110\\xE3 x\\u1EA3y ra l\\u1ED7i\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 909,\n          columnNumber: 11\n        }, this), componentError]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 897,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 896,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      p: {\n        xs: 1,\n        sm: 2,\n        md: 3\n      }\n    },\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      mb: 2.5,\n      pb: 2,\n      borderBottom: \"1px solid #eaeaea\",\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          fontWeight: 500,\n          children: [\"\\u0110i\\u1EC3m Danh - \", classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 928,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          color: \"textSecondary\",\n          children: [\"Bu\\u1ED5i \", sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.session_number, \" -\", \" \", sessionInfo !== null && sessionInfo !== void 0 && sessionInfo.date ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\") : \"N/A\", /*#__PURE__*/_jsxDEV(Chip, {\n            label: (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) || \"N/A\",\n            color: sessionCompleted ? \"default\" : \"success\",\n            size: \"small\",\n            sx: {\n              ml: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 936,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 931,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 927,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        startIcon: /*#__PURE__*/_jsxDEV(ArrowBack, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 946,\n          columnNumber: 22\n        }, this),\n        onClick: () => navigate(`/teacher/classes/${classId}`),\n        children: \"Quay l\\u1EA1i l\\u1EDBp\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 944,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 919,\n      columnNumber: 7\n    }, this), sessionCompleted && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      sx: {\n        mb: 2\n      },\n      children: \"Phi\\xEAn \\u0111i\\u1EC3m danh n\\xE0y \\u0111\\xE3 k\\u1EBFt th\\xFAc. B\\u1EA1n ch\\u1EC9 c\\xF3 th\\u1EC3 xem l\\u1EA1i k\\u1EBFt qu\\u1EA3.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 954,\n      columnNumber: 9\n    }, this), faceRecError && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"warning\",\n      sx: {\n        mb: 2\n      },\n      children: [\"L\\u1ED7i t\\u1EEB h\\u1EC7 th\\u1ED1ng nh\\u1EADn di\\u1EC7n: \", faceRecError]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 960,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 3,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 8,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3,\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(CardContent, {\n            sx: {\n              bgcolor: \"#f8f9fa\",\n              borderBottom: \"1px solid #eaeaea\",\n              p: 2\n            },\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 500,\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(CameraAlt, {\n                  sx: {\n                    mr: 1,\n                    color: \"primary.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 987,\n                  columnNumber: 19\n                }, this), \" Camera\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 981,\n                columnNumber: 17\n              }, this), !sessionCompleted && isModelLoaded &&\n              /*#__PURE__*/\n              // Show controls only if session active and model loaded\n              _jsxDEV(Box, {\n                children: [/*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: isAutoMode ? \"Dừng chế độ tự động\" : \"Bắt đầu chế độ tự động\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: isAutoMode ? stopAutoAttendance : startAutoAttendance,\n                    color: isAutoMode ? \"error\" : \"primary\",\n                    disabled: !isCameraReady,\n                    children: isAutoMode ? /*#__PURE__*/_jsxDEV(StopCircleOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1009,\n                      columnNumber: 29\n                    }, this) : /*#__PURE__*/_jsxDEV(PlayCircleOutline, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1011,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 999,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 992,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: toggleLandmarks,\n                    color: \"secondary\",\n                    disabled: !isCameraReady || isAutoMode,\n                    children: showLandmarks ? /*#__PURE__*/_jsxDEV(VisibilityOff, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1023,\n                      columnNumber: 44\n                    }, this) : /*#__PURE__*/_jsxDEV(Visibility, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1023,\n                      columnNumber: 64\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1018,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1015,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 991,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 976,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 969,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              position: \"relative\",\n              width: \"100%\",\n              aspectRatio: \"640 / 480\",\n              backgroundColor: \"#000\",\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\"\n            },\n            children: [sessionCompleted ? /*#__PURE__*/_jsxDEV(Box, {\n              textAlign: \"center\",\n              color: \"white\",\n              p: 4,\n              children: [/*#__PURE__*/_jsxDEV(Info, {\n                sx: {\n                  fontSize: 60,\n                  mb: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1045,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Phi\\xEAn \\u0111i\\u1EC3m danh \\u0111\\xE3 k\\u1EBFt th\\xFAc\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1046,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                mt: 1,\n                children: \"B\\u1EA1n c\\xF3 th\\u1EC3 xem k\\u1EBFt qu\\u1EA3 \\u0111i\\u1EC3m danh \\u1EDF danh s\\xE1ch b\\xEAn ph\\u1EA3i\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1049,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1044,\n              columnNumber: 17\n            }, this) : !isModelLoaded ? /*#__PURE__*/_jsxDEV(Box, {\n              textAlign: \"center\",\n              color: \"white\",\n              children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1055,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                children: \"\\u0110ang t\\u1EA3i m\\xF4 h\\xECnh nh\\u1EADn di\\u1EC7n...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1056,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1054,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Suspense, {\n              fallback: /*#__PURE__*/_jsxDEV(Box, {\n                textAlign: \"center\",\n                color: \"white\",\n                children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                  color: \"inherit\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1062,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  children: \"\\u0110ang kh\\u1EDFi t\\u1EA1o camera...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1063,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1061,\n                columnNumber: 21\n              }, this),\n              children: /*#__PURE__*/_jsxDEV(Webcam, {\n                audio: false,\n                ref: webcamRef,\n                screenshotFormat: \"image/jpeg\",\n                width: \"100%\",\n                height: \"100%\",\n                videoConstraints: {\n                  width: 640,\n                  height: 480,\n                  facingMode: \"user\"\n                },\n                style: {\n                  display: \"block\",\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\"\n                },\n                onUserMedia: handleUserMedia,\n                onUserMediaError: handleUserMediaError\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1067,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1059,\n              columnNumber: 17\n            }, this), !sessionCompleted && /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              style: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                zIndex: 10\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1095,\n              columnNumber: 17\n            }, this), (!isCameraReady || (componentError === null || componentError === void 0 ? void 0 : componentError.includes(\"camera\"))) && !sessionCompleted && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                backgroundColor: \"rgba(0,0,0,0.7)\",\n                display: \"flex\",\n                flexDirection: \"column\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                color: \"white\",\n                zIndex: 20\n              },\n              children: [/*#__PURE__*/_jsxDEV(VideocamOff, {\n                sx: {\n                  fontSize: 60,\n                  mb: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1127,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Camera kh\\xF4ng kh\\u1EA3 d\\u1EE5ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1128,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mt: 1,\n                  px: 2,\n                  textAlign: \"center\"\n                },\n                children: componentError || \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1129,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                color: \"inherit\",\n                sx: {\n                  mt: 2\n                },\n                onClick: () => window.location.reload(),\n                children: \"Th\\u1EED l\\u1EA1i\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1136,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1111,\n              columnNumber: 19\n            }, this), isAutoMode && isCameraReady && /*#__PURE__*/_jsxDEV(Chip, {\n              label: \"\\u0110ang t\\u1EF1 \\u0111\\u1ED9ng \\u0111i\\u1EC3m danh\",\n              color: \"success\",\n              size: \"small\",\n              sx: {\n                position: \"absolute\",\n                bottom: 10,\n                right: 10,\n                zIndex: 15\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1148,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1032,\n            columnNumber: 13\n          }, this), !sessionCompleted && isCameraReady && isModelLoaded && /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            p: 2,\n            bgcolor: \"#f8f9fa\",\n            borderTop: \"1px solid #eaeaea\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              onClick: handleManualCapture,\n              startIcon: isProcessing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1176,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1178,\n                columnNumber: 23\n              }, this),\n              disabled: isProcessing || isAutoMode,\n              children: \"Ch\\u1EE5p & Nh\\u1EADn di\\u1EC7n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1171,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"secondary\",\n              onClick: completeSession,\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1189,\n                columnNumber: 30\n              }, this),\n              disabled: isProcessing,\n              children: \"K\\u1EBFt th\\xFAc phi\\xEAn\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1185,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1164,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 968,\n          columnNumber: 11\n        }, this), recognizedStudents.length > 0 && !isAutoMode && /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mt: 2,\n            borderRadius: \"10px\",\n            boxShadow: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              fontWeight: \"500\",\n              mb: 1,\n              children: \"\\u0110\\xE3 nh\\u1EADn di\\u1EC7n g\\u1EA7n \\u0111\\xE2y\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1202,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacing: 1,\n              children: recognizedStudents.slice(0, 4).map((rec, index // Show max 4\n              ) => /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 6,\n                sm: 3,\n                children: /*#__PURE__*/_jsxDEV(Paper, {\n                  elevation: 0,\n                  sx: {\n                    p: 1,\n                    textAlign: \"center\",\n                    border: \"1px solid #eee\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"caption\",\n                    display: \"block\",\n                    noWrap: true,\n                    children: rec.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1225,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Chip, {\n                    label: `${(rec.confidence * 100).toFixed(0)}%`,\n                    size: \"small\",\n                    color: rec.confidence > CONFIDENCE_THRESHOLD ? \"success\" : \"warning\",\n                    sx: {\n                      mt: 0.5\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1228,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1217,\n                  columnNumber: 25\n                }, this)\n              }, `${rec.studentId}-${index}`, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1211,\n                columnNumber: 23\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1205,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1201,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1200,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 967,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 4,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mb: 3,\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(Check, {\n                  sx: {\n                    mr: 1,\n                    color: \"success.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1260,\n                  columnNumber: 19\n                }, this), \" C\\xF3 m\\u1EB7t (\", presentStudents.length, \"/\", totalStudents, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1259,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                title: \"L\\xE0m m\\u1EDBi danh s\\xE1ch\",\n                children: /*#__PURE__*/_jsxDEV(IconButton, {\n                  size: \"small\",\n                  onClick: refreshAttendanceLogs,\n                  disabled: isProcessing,\n                  children: /*#__PURE__*/_jsxDEV(Refresh, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1269,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1264,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1263,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1253,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1273,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: presentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                align: \"center\",\n                sx: {\n                  py: 2\n                },\n                children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 c\\xF3 m\\u1EB7t.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1276,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(List, {\n                dense: true,\n                children: presentStudents.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)) // Sort by time desc\n                .map(log => {\n                  var _log$student_id5;\n                  return (\n                    /*#__PURE__*/\n                    // Simplified ListItem for debugging\n                    _jsxDEV(ListItem, {\n                      children: /*#__PURE__*/_jsxDEV(ListItemText, {\n                        primary: ((_log$student_id5 = log.student_id) === null || _log$student_id5 === void 0 ? void 0 : _log$student_id5.full_name) || `Log ID: ${log._id} (Tên bị thiếu)`,\n                        secondary: `Trạng thái: ${log.status} - ${new Date(log.timestamp).toLocaleTimeString(\"vi-VN\")}`\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1293,\n                        columnNumber: 27\n                      }, this)\n                    }, log._id, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1292,\n                      columnNumber: 25\n                    }, this)\n                  );\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1285,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1274,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1252,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1251,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h6\",\n              display: \"flex\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Close, {\n                sx: {\n                  mr: 1,\n                  color: \"error.main\"\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1319,\n                columnNumber: 17\n              }, this), \" V\\u1EAFng m\\u1EB7t (\", absentStudents.length, \"/\", totalStudents, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1313,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1322,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: absentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                align: \"center\",\n                sx: {\n                  py: 2\n                },\n                children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 c\\xF3 m\\u1EB7t.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1325,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(List, {\n                dense: true,\n                children: absentStudents.map(student =>\n                /*#__PURE__*/\n                // Keep absent list detailed for now\n                _jsxDEV(ListItem, {\n                  disablePadding: true,\n                  sx: {\n                    mb: 0.5\n                  },\n                  secondaryAction: !sessionCompleted ? /*#__PURE__*/_jsxDEV(Tooltip, {\n                    title: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\",\n                    children: /*#__PURE__*/_jsxDEV(IconButton, {\n                      edge: \"end\",\n                      size: \"small\",\n                      onClick: () => openManualAttendanceDialog(student),\n                      disabled: isProcessing,\n                      children: /*#__PURE__*/_jsxDEV(Edit, {\n                        fontSize: \"small\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1352,\n                        columnNumber: 33\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1344,\n                      columnNumber: 31\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1343,\n                    columnNumber: 29\n                  }, this) : null,\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    variant: \"outlined\",\n                    sx: {\n                      width: \"100%\",\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      p: 0.5,\n                      borderRadius: \"4px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                      sx: {\n                        minWidth: 45\n                      },\n                      children: /*#__PURE__*/_jsxDEV(Avatar, {\n                        alt: student.full_name,\n                        src: student.avatar_url,\n                        sx: {\n                          width: 32,\n                          height: 32\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1369,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1368,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                      primary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"body2\",\n                        noWrap: true,\n                        children: student.full_name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1377,\n                        columnNumber: 31\n                      }, this),\n                      secondary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"caption\",\n                        color: \"text.secondary\",\n                        children: student.student_code\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1382,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1375,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1358,\n                    columnNumber: 25\n                  }, this)\n                }, student._id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1337,\n                  columnNumber: 23\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1334,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1323,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1312,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1311,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1249,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 965,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: manualDialogOpen,\n      onClose: handleManualDialogClose,\n      maxWidth: \"xs\",\n      fullWidth: true,\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1408,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [selectedStudent && /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          alignItems: \"center\",\n          mb: 2,\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            src: selectedStudent.avatar_url,\n            alt: selectedStudent.full_name,\n            sx: {\n              width: 48,\n              height: 48,\n              mr: 2\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1412,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              children: selectedStudent.full_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1418,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              color: \"text.secondary\",\n              children: [\"MSSV: \", selectedStudent.student_code]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1421,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1417,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1411,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n          fullWidth: true,\n          margin: \"normal\",\n          children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n            children: \"Tr\\u1EA1ng th\\xE1i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1428,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Select, {\n            name: \"status\",\n            value: manualAttendanceData.status,\n            onChange: handleManualAttendanceChange,\n            label: \"Tr\\u1EA1ng th\\xE1i\",\n            children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"present\",\n              children: \"C\\xF3 m\\u1EB7t\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1435,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"absent\",\n              children: \"V\\u1EAFng m\\u1EB7t\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1436,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"late\",\n              children: \"\\u0110i tr\\u1EC5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1437,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"early_leave\",\n              children: \"V\\u1EC1 s\\u1EDBm\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1438,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1429,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1427,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TextField, {\n          fullWidth: true,\n          margin: \"normal\",\n          name: \"note\",\n          label: \"Ghi ch\\xFA (t\\xF9y ch\\u1ECDn)\",\n          value: manualAttendanceData.note,\n          onChange: handleManualAttendanceChange,\n          multiline: true,\n          rows: 2\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1441,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1409,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualDialogClose,\n          children: \"H\\u1EE7y\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1453,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualAttendanceSubmit,\n          variant: \"contained\",\n          color: \"primary\",\n          disabled: isProcessing,\n          children: \"X\\xE1c nh\\u1EADn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1454,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1452,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1402,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 917,\n    columnNumber: 5\n  }, this);\n};\n_s(AttendancePage, \"ORIzqp/hsJvgl/xMWwFDwVJkKrg=\", false, function () {\n  return [useParams, useNavigate, useDispatch, useSnackbar, useSelector, useSelector];\n});\n_c3 = AttendancePage;\nexport default AttendancePage;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"Webcam$lazy\");\n$RefreshReg$(_c2, \"Webcam\");\n$RefreshReg$(_c3, \"AttendancePage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","lazy","Suspense","useCallback","useParams","useNavigate","useDispatch","useSelector","useSnackbar","axios","faceapi","Box","Typography","Card","CardContent","Grid","Paper","Button","Divider","CircularProgress","List","ListItem","ListItemAvatar","ListItemText","Avatar","Chip","Dialog","DialogTitle","DialogContent","DialogActions","TextField","FormControl","InputLabel","Select","MenuItem","IconButton","Alert","AlertTitle","Tooltip","Stepper","Step","StepLabel","StepContent","CameraAlt","Check","Close","Edit","Refresh","Save","VerifiedUser","HourglassEmpty","ArrowBack","Info","VideocamOff","PlayCircleOutline","StopCircleOutlined","Visibility","VisibilityOff","setModelLoaded","setFaceRecModelLoaded","setCameraReady","setFaceRecCameraReady","setDetectedFaces","setRecognizedStudents","clearRecognitionState","getClassFaceFeatures","verifyAttendance","manualAttendance","jsxDEV","_jsxDEV","Webcam","_c","_c2","API_URL","process","env","REACT_APP_API_URL","RECOGNITION_THRESHOLD","DETECTION_THRESHOLD","CONFIDENCE_THRESHOLD","AUTO_DETECT_INTERVAL","FACE_DETECTION_OPTIONS","TinyFaceDetectorOptions","scoreThreshold","inputSize","MODEL_URL","loadFaceRecognitionModels","dispatch","enqueueSnackbar","nets","tinyFaceDetector","isLoaded","faceLandmark68Net","faceRecognitionNet","variant","autoHideDuration","Promise","all","loadFromUri","error","console","extractStudentDescriptors","student","_student$faceFeatures","_student$faceFeatures2","faceFeatures","descriptors","faceDescriptors","rawDescriptors","findDescriptors","data","Array","isArray","length","every","n","push","Float32Array","forEach","Object","values","filter","d","AttendancePage","_s","_classInfo$students","_classInfo$students2","classId","sessionId","navigate","webcamRef","canvasRef","autoModeIntervalRef","landmarkIntervalRef","isLoading","setIsLoading","classInfo","setClassInfo","sessionInfo","setSessionInfo","attendanceLogs","setAttendanceLogs","isAutoMode","setIsAutoMode","showLandmarks","setShowLandmarks","manualDialogOpen","setManualDialogOpen","selectedStudent","setSelectedStudent","manualAttendanceData","setManualAttendanceData","status","note","componentError","setComponentError","token","state","auth","isModelLoaded","isCameraReady","detectedFaces","recognizedStudents","classStudents","isProcessing","faceRecError","faceRecognition","loadData","classRes","sessionRes","logsRes","get","headers","Authorization","loadedSessionInfo","isSessionCompleted","modelsLoadedSuccessfully","Error","unwrap","_error$response","_error$response$data","errMsg","response","message","_webcamRef$current","_webcamRef$current$vi","_webcamRef$current$vi2","clearInterval","current","video","srcObject","getTracks","track","stop","startLandmarkDetection","stopLandmarkDetection","ctx","getContext","clearRect","width","height","handleUserMedia","stream","log","id","handleUserMediaError","name","drawLandmarks","detections","recognizedData","_webcamRef$current2","canvas","displaySize","videoWidth","videoHeight","matchDimensions","resizedDetections","resizeResults","detection","i","box","warn","x","y","landmarks","recognized","find","rec","detectionIndex","boxColor","confidence","strokeStyle","lineWidth","strokeRect","label","toFixed","textWidth","measureText","fillStyle","fillRect","font","fillText","draw","drawFaceLandmarks","detectAndRecognizeFaces","recognize","_webcamRef$current3","readyState","faceData","detectAllFaces","withFaceLandmarks","withFaceDescriptors","labeledDescriptors","map","LabeledFaceDescriptors","_id","ld","faceMatcher","FaceMatcher","fd","index","bestMatch","findBestMatch","descriptor","s","studentId","full_name","distance","isUnknown","r","handleManualCapture","result","topMatch","sort","a","b","_result$detections$to","handleMarkAttendance","openManualAttendanceDialog","handleManualDialogClose","handleManualAttendanceChange","e","target","value","handleManualAttendanceSubmit","prevLogs","existingLogIndex","findIndex","_log$student_id","student_id","newLog","updatedLogs","faceDescriptor","isAlreadyPresent","some","_log$student_id2","imageBase64","getScreenshot","screenshotError","_log$student_id3","startAutoAttendance","stopAutoAttendance","setInterval","_result$detections$re","completeSession","absentStudentIds","absentStudents","put","students_absent","prev","_error$response2","_error$response2$data","refreshAttendanceLogs","_error$response3","_error$response3$data","toggleLandmarks","presentStudents","students","_log$student_id4","totalStudents","sessionCompleted","display","justifyContent","alignItems","minHeight","children","fileName","_jsxFileName","lineNumber","columnNumber","sx","ml","p","severity","action","color","size","onClick","window","location","reload","xs","sm","md","mb","pb","borderBottom","fontWeight","class_name","session_number","date","Date","toLocaleDateString","startIcon","container","spacing","item","borderRadius","boxShadow","overflow","bgcolor","mr","title","disabled","position","aspectRatio","backgroundColor","textAlign","fontSize","mt","fallback","audio","ref","screenshotFormat","videoConstraints","facingMode","style","top","left","objectFit","onUserMedia","onUserMediaError","zIndex","includes","flexDirection","px","bottom","right","borderTop","slice","elevation","border","noWrap","maxHeight","pr","align","py","dense","timestamp","_log$student_id5","primary","secondary","toLocaleTimeString","disablePadding","secondaryAction","edge","minWidth","alt","src","avatar_url","student_code","open","onClose","maxWidth","fullWidth","margin","onChange","multiline","rows","_c3","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/teacher/AttendancePage.js"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useRef,\n  lazy,\n  Suspense,\n  useCallback,\n} from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport {\n  Box,\n  Typography,\n  Card,\n  CardContent,\n  Grid,\n  Paper,\n  Button,\n  Divider,\n  CircularProgress,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Avatar,\n  Chip,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  IconButton,\n  Alert,\n  AlertTitle,\n  Tooltip,\n  Stepper,\n  Step,\n  StepLabel,\n  StepContent,\n} from \"@mui/material\";\nimport {\n  CameraAlt,\n  Check,\n  Close,\n  Edit,\n  Refresh,\n  Save,\n  VerifiedUser,\n  HourglassEmpty,\n  ArrowBack,\n  Info,\n  VideocamOff,\n  PlayCircleOutline,\n  StopCircleOutlined,\n  Visibility,\n  VisibilityOff,\n} from \"@mui/icons-material\";\nimport {\n  setModelLoaded as setFaceRecModelLoaded, // Rename to avoid conflict\n  setCameraReady as setFaceRecCameraReady, // Rename to avoid conflict\n  setDetectedFaces,\n  setRecognizedStudents,\n  clearRecognitionState,\n  getClassFaceFeatures, // Correct thunk action name\n  verifyAttendance,\n  manualAttendance,\n} from \"../../redux/slices/faceRecognitionSlice\"; // Fixed relative import path\n\n// Lazy load Webcam\nconst Webcam = lazy(() => import(\"react-webcam\"));\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320,\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (\n      faceapi.nets.tinyFaceDetector.isLoaded &&\n      faceapi.nets.faceLandmark68Net.isLoaded &&\n      faceapi.nets.faceRecognitionNet.isLoaded\n      // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null,\n    });\n    await Promise.all([\n      faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\n      faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\n      faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\n    ]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", { variant: \"success\" });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", { variant: \"error\" });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = (student) => {\n  if (\n    !student ||\n    (!student.faceFeatures?.descriptors && !student.faceDescriptors)\n  ) {\n    return [];\n  }\n\n  const descriptors = [];\n  const rawDescriptors =\n    student.faceFeatures?.descriptors || student.faceDescriptors || [];\n\n  const findDescriptors = (data) => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every((n) => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n\n  findDescriptors(rawDescriptors);\n  return descriptors.filter((d) => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  const { classId, sessionId } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\",\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const { token } = useSelector((state) => state.auth);\n\n  // Access faceRecognition state directly\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents, // Assuming slice holds the relevant class students\n    isProcessing,\n    error: faceRecError, // Get error state\n  } = useSelector((state) => state.faceRecognition);\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([\n          axios.get(`${API_URL}/classes/teaching/${classId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n        ]);\n\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Nếu phiên đã hoàn thành, không cần tải mô hình nhận dạng\n        const isSessionCompleted = loadedSessionInfo?.status === \"completed\";\n\n        if (isSessionCompleted) {\n          // Không cần tải mô hình và đặc trưng khuôn mặt nếu phiên đã hoàn thành\n          setIsLoading(false);\n          return;\n        }\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          // Capture the return value indicating success/failure\n          const modelsLoadedSuccessfully = await loadFaceRecognitionModels(\n            dispatch,\n            enqueueSnackbar\n          );\n          // Check if model loading failed using the return value\n          if (!modelsLoadedSuccessfully) {\n            // Use the return value here\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n          // No need to check isModelLoaded from state again here\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if (!isSessionCompleted && isModelLoaded) {\n          await dispatch(getClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg =\n          error.response?.data?.message ||\n          error.message ||\n          \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, { variant: \"error\" });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      webcamRef.current?.video?.srcObject\n        ?.getTracks()\n        .forEach((track) => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(\n    (stream) => {\n      console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n      dispatch(setFaceRecCameraReady(true));\n      setComponentError(null); // Clear camera errors\n    },\n    [dispatch]\n  );\n\n  const handleUserMediaError = useCallback(\n    (error) => {\n      console.error(\"Lỗi khi truy cập camera:\", error);\n      const errMsg = `Không thể truy cập camera: ${\n        error.name === \"NotAllowedError\"\n          ? \"Bạn chưa cấp quyền truy cập camera\"\n          : error.name === \"NotFoundError\"\n          ? \"Không tìm thấy thiết bị camera\"\n          : error.message || \"Lỗi không xác định\"\n      }`;\n      enqueueSnackbar(errMsg, { variant: \"error\" });\n      dispatch(setFaceRecCameraReady(false));\n      setComponentError(errMsg);\n    },\n    [dispatch, enqueueSnackbar]\n  );\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback(\n    (detections, recognizedData = []) => {\n      if (!canvasRef.current || !webcamRef.current?.video) return;\n\n      const video = webcamRef.current.video;\n      const canvas = canvasRef.current;\n      const displaySize = {\n        width: video.videoWidth,\n        height: video.videoHeight,\n      };\n      faceapi.matchDimensions(canvas, displaySize);\n\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      resizedDetections.forEach((detection, i) => {\n        // Validate detection and box before drawing\n        if (!detection || !detection.detection || !detection.detection.box) {\n          console.warn(\n            \"Skipping drawing for invalid detection object:\",\n            detection\n          );\n          return; // Skip this detection\n        }\n\n        const box = detection.detection.box;\n\n        // Further validate box properties\n        if (\n          box.x == null ||\n          box.y == null ||\n          box.width == null ||\n          box.height == null ||\n          box.width <= 0 ||\n          box.height <= 0\n        ) {\n          console.warn(\"Skipping drawing for invalid box properties:\", box);\n          return; // Skip this detection\n        }\n\n        const landmarks = detection.landmarks;\n        const recognized = recognizedData.find(\n          (rec) => rec.detectionIndex === i\n        ); // Match recognition result\n\n        // Draw box\n        const boxColor = recognized\n          ? recognized.confidence > CONFIDENCE_THRESHOLD\n            ? \"#4CAF50\"\n            : \"#FFC107\"\n          : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n        ctx.strokeStyle = boxColor;\n        ctx.lineWidth = 2;\n        ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n        // Draw label background\n        const label = recognized\n          ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)`\n          : \"Đang nhận diện...\";\n        const textWidth = ctx.measureText(label).width;\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n        ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n        // Draw label text\n        ctx.fillStyle = \"#FFFFFF\";\n        ctx.font = \"14px Arial\";\n        ctx.fillText(label, box.x + 5, box.y - 5);\n\n        // Draw landmarks if enabled\n        if (showLandmarks && landmarks) {\n          faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n        }\n      });\n    },\n    [showLandmarks]\n  ); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(\n    async (recognize = true) => {\n      if (\n        !isCameraReady ||\n        !webcamRef.current?.video ||\n        webcamRef.current.video.readyState !== 4 ||\n        !isModelLoaded\n      ) {\n        return null; // Return null if detection can't proceed\n      }\n\n      const video = webcamRef.current.video;\n\n      try {\n        let faceData;\n        if (recognize) {\n          // Detect faces, landmarks, and descriptors for recognition\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks()\n            .withFaceDescriptors();\n        } else {\n          // Only detect faces and landmarks (for drawing)\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks();\n        }\n\n        dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n        if (!faceData || faceData.length === 0) {\n          // Clear canvas if no faces detected\n          if (canvasRef.current) {\n            const ctx = canvasRef.current.getContext(\"2d\");\n            ctx.clearRect(\n              0,\n              0,\n              canvasRef.current.width,\n              canvasRef.current.height\n            );\n          }\n          dispatch(setRecognizedStudents([])); // Clear recognized students\n          return null;\n        }\n\n        // --- Recognition Logic (if recognize === true) ---\n        let recognizedData = [];\n        if (recognize && classStudents && classStudents.length > 0) {\n          const labeledDescriptors = classStudents\n            .map((student) => {\n              const descriptors = extractStudentDescriptors(student);\n              if (descriptors.length > 0) {\n                return new faceapi.LabeledFaceDescriptors(\n                  student._id,\n                  descriptors\n                ); // Use student ID as label\n              }\n              return null;\n            })\n            .filter((ld) => ld !== null); // Filter out students with no descriptors\n\n          if (labeledDescriptors.length > 0) {\n            const faceMatcher = new faceapi.FaceMatcher(\n              labeledDescriptors,\n              RECOGNITION_THRESHOLD\n            );\n\n            recognizedData = faceData\n              .map((fd, index) => {\n                const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n                const student = classStudents.find(\n                  (s) => s._id === bestMatch.label\n                ); // Find student by ID label\n                return {\n                  detectionIndex: index, // Link recognition to detection\n                  studentId: student?._id,\n                  name: student?.full_name || \"Không rõ\",\n                  confidence: 1 - bestMatch.distance, // Convert distance to confidence-like score\n                  isUnknown: bestMatch.label === \"unknown\",\n                };\n              })\n              .filter((r) => !r.isUnknown); // Filter out unknown matches\n\n            dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n          } else {\n            dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n          }\n        }\n\n        // Draw landmarks and boxes with recognition info\n        drawLandmarks(faceData, recognizedData);\n\n        return { detections: faceData, recognized: recognizedData }; // Return both detection and recognition results\n      } catch (error) {\n        console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n        enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n          variant: \"error\",\n        });\n        // Clear canvas on error\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(\n            0,\n            0,\n            canvasRef.current.width,\n            canvasRef.current.height\n          );\n        }\n        dispatch(setDetectedFaces([]));\n        dispatch(setRecognizedStudents([]));\n        return null;\n      }\n    },\n    [\n      isCameraReady,\n      isModelLoaded,\n      classStudents,\n      drawLandmarks,\n      dispatch,\n      enqueueSnackbar,\n    ]\n  );\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort(\n        (a, b) => b.confidence - a.confidence\n      )[0];\n      enqueueSnackbar(\n        `Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(\n          1\n        )}%)`,\n        { variant: \"info\" }\n      );\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence >= CONFIDENCE_THRESHOLD) {\n        // Find the corresponding descriptor\n        const descriptor =\n          result.detections[topMatch.detectionIndex]?.descriptor;\n        if (descriptor) {\n          handleMarkAttendance(\n            topMatch.studentId,\n            topMatch.confidence,\n            descriptor\n          );\n        } else {\n          console.warn(\"Không tìm thấy descriptor cho top match\", topMatch);\n          enqueueSnackbar(\n            \"Lỗi: Không thể lấy đặc trưng khuôn mặt để điểm danh.\",\n            { variant: \"warning\" }\n          );\n        }\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\n        \"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\",\n        { variant: \"warning\" }\n      );\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", { variant: \"warning\" });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = (student) => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({ status: \"present\", note: \"\" }); // Reset form\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change\n  const handleManualAttendanceChange = (e) => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n\n    try {\n      const result = await dispatch(\n        manualAttendance({\n          sessionId,\n          studentId: selectedStudent._id,\n          status: manualAttendanceData.status,\n          note: manualAttendanceData.note,\n        })\n      ).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs((prevLogs) => {\n        const existingLogIndex = prevLogs.findIndex(\n          (log) => log.student_id?._id === selectedStudent._id\n        );\n        const newLog = { ...result.data, student_id: selectedStudent }; // Use the selected student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n\n      enqueueSnackbar(\n        `Đã điểm danh thủ công cho ${selectedStudent.full_name}`,\n        { variant: \"success\" }\n      );\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\",\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(\n    async (studentId, confidence, faceDescriptor) => {\n      if (!studentId || isProcessing) return;\n\n      // Check if student already marked present\n      const isAlreadyPresent = attendanceLogs.some(\n        (log) => log.student_id?._id === studentId && log.status === \"present\"\n      );\n      if (isAlreadyPresent) {\n        // console.log(`Student ${studentId} already marked present.`);\n        return; // Don't mark again if already present\n      }\n\n      const student = classStudents.find((s) => s._id === studentId);\n      if (!student) {\n        console.warn(\"Student not found for marking attendance:\", studentId);\n        return;\n      }\n\n      // Capture image for proof (optional, but good practice)\n      let imageBase64 = null;\n      try {\n        if (webcamRef.current) {\n          imageBase64 = webcamRef.current.getScreenshot({\n            width: 320,\n            height: 240,\n          }); // Smaller screenshot\n        }\n      } catch (screenshotError) {\n        console.error(\"Error taking screenshot:\", screenshotError);\n        // Proceed without image if screenshot fails\n      }\n\n      try {\n        const result = await dispatch(\n          verifyAttendance({\n            sessionId,\n            studentId,\n            faceDescriptor, // Pass the received descriptor\n            confidence,\n            imageBase64,\n            recognized: true, // Mark as recognized by the system\n          })\n        ).unwrap();\n\n        // Update local attendance logs\n        setAttendanceLogs((prevLogs) => {\n          const existingLogIndex = prevLogs.findIndex(\n            (log) => log.student_id?._id === studentId\n          );\n          const newLog = { ...result.data, student_id: student }; // Use the found student data\n          if (existingLogIndex > -1) {\n            const updatedLogs = [...prevLogs];\n            updatedLogs[existingLogIndex] = newLog;\n            return updatedLogs;\n          } else {\n            return [...prevLogs, newLog];\n          }\n        });\n\n        enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n          variant: \"success\",\n        });\n      } catch (error) {\n        console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n        enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n          variant: \"error\",\n        });\n      }\n    },\n    [\n      dispatch,\n      sessionId,\n      classStudents,\n      attendanceLogs,\n      isProcessing,\n      enqueueSnackbar,\n    ]\n  ); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (\n      !isCameraReady ||\n      !isModelLoaded ||\n      !classStudents ||\n      classStudents.length === 0\n    ) {\n      enqueueSnackbar(\n        \"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\",\n        { variant: \"warning\" }\n      );\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", { variant: \"info\" });\n\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach((rec) => {\n          // Check if confidence meets or exceeds the threshold\n          if (rec.confidence >= CONFIDENCE_THRESHOLD && rec.studentId) {\n            // Find the corresponding descriptor\n            const descriptor =\n              result.detections[rec.detectionIndex]?.descriptor;\n            if (descriptor) {\n              handleMarkAttendance(rec.studentId, rec.confidence, descriptor); // Attempt to mark attendance\n            } else {\n              console.warn(\n                \"Không tìm thấy descriptor cho recognized student trong auto mode\",\n                rec\n              );\n            }\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [\n    isCameraReady,\n    isModelLoaded,\n    classStudents,\n    detectAndRecognizeFaces,\n    handleMarkAttendance,\n    enqueueSnackbar,\n  ]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", { variant: \"info\" });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      // Lấy danh sách sinh viên vắng mặt từ UI\n      const absentStudentIds = absentStudents.map((student) => student._id);\n\n      enqueueSnackbar(\"Đang kết thúc phiên...\", { variant: \"info\" });\n\n      await axios.put(\n        `${API_URL}/attendance/sessions/${sessionId}`,\n        {\n          status: \"completed\",\n          students_absent: absentStudentIds,\n        },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", { variant: \"success\" });\n      setSessionInfo((prev) => ({ ...prev, status: \"completed\" }));\n      stopAutoAttendance();\n    } catch (error) {\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi kết thúc phiên\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", { variant: \"info\" });\n      const [logsRes, sessionRes] = await Promise.all([\n        axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n        axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n      ]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", { variant: \"success\" });\n    } catch (error) {\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi làm mới dữ liệu\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const toggleLandmarks = () => {\n    setShowLandmarks((prev) => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(\n    (log) => log.status === \"present\"\n  );\n  const absentStudents =\n    classInfo?.students?.filter(\n      (student) =>\n        !attendanceLogs.some(\n          (log) =>\n            log.student_id?._id === student._id &&\n            (log.status === \"present\" || log.status === \"late\")\n        ) // Consider late as not absent\n    ) || [];\n  const totalStudents = classInfo?.students?.length || 0;\n  const sessionCompleted = sessionInfo?.status === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return (\n      <Box\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        minHeight=\"80vh\"\n      >\n        <CircularProgress />\n        <Typography sx={{ ml: 2 }}>Đang tải dữ liệu điểm danh...</Typography>\n      </Box>\n    );\n  }\n\n  if (componentError && !isLoading) {\n    return (\n      <Box sx={{ p: 3 }}>\n        <Alert\n          severity=\"error\"\n          action={\n            <Button\n              color=\"inherit\"\n              size=\"small\"\n              onClick={() => window.location.reload()}\n            >\n              Tải lại trang\n            </Button>\n          }\n        >\n          <AlertTitle>Đã xảy ra lỗi</AlertTitle>\n          {componentError}\n        </Alert>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{ p: { xs: 1, sm: 2, md: 3 } }}>\n      {/* Header */}\n      <Box\n        display=\"flex\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        mb={2.5}\n        pb={2}\n        borderBottom=\"1px solid #eaeaea\"\n      >\n        <Box>\n          <Typography variant=\"h5\" fontWeight={500}>\n            Điểm Danh - {classInfo?.class_name}\n          </Typography>\n          <Typography variant=\"subtitle1\" color=\"textSecondary\">\n            Buổi {sessionInfo?.session_number} -{\" \"}\n            {sessionInfo?.date\n              ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\")\n              : \"N/A\"}\n            <Chip\n              label={sessionInfo?.status || \"N/A\"}\n              color={sessionCompleted ? \"default\" : \"success\"}\n              size=\"small\"\n              sx={{ ml: 1 }}\n            />\n          </Typography>\n        </Box>\n        <Button\n          variant=\"outlined\"\n          startIcon={<ArrowBack />}\n          onClick={() => navigate(`/teacher/classes/${classId}`)}\n        >\n          Quay lại lớp\n        </Button>\n      </Box>\n\n      {sessionCompleted && (\n        <Alert severity=\"info\" sx={{ mb: 2 }}>\n          Phiên điểm danh này đã kết thúc. Bạn chỉ có thể xem lại kết quả.\n        </Alert>\n      )}\n\n      {faceRecError && (\n        <Alert severity=\"warning\" sx={{ mb: 2 }}>\n          Lỗi từ hệ thống nhận diện: {faceRecError}\n        </Alert>\n      )}\n\n      <Grid container spacing={3}>\n        {/* Left Column: Camera and Controls */}\n        <Grid item xs={12} md={8}>\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3, overflow: \"hidden\" }}>\n            <CardContent\n              sx={{\n                bgcolor: \"#f8f9fa\",\n                borderBottom: \"1px solid #eaeaea\",\n                p: 2,\n              }}\n            >\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n              >\n                <Typography\n                  variant=\"h6\"\n                  fontWeight={500}\n                  display=\"flex\"\n                  alignItems=\"center\"\n                >\n                  <CameraAlt sx={{ mr: 1, color: \"primary.main\" }} /> Camera\n                </Typography>\n                {!sessionCompleted &&\n                  isModelLoaded && ( // Show controls only if session active and model loaded\n                    <Box>\n                      <Tooltip\n                        title={\n                          isAutoMode\n                            ? \"Dừng chế độ tự động\"\n                            : \"Bắt đầu chế độ tự động\"\n                        }\n                      >\n                        <IconButton\n                          onClick={\n                            isAutoMode\n                              ? stopAutoAttendance\n                              : startAutoAttendance\n                          }\n                          color={isAutoMode ? \"error\" : \"primary\"}\n                          disabled={!isCameraReady}\n                        >\n                          {isAutoMode ? (\n                            <StopCircleOutlined />\n                          ) : (\n                            <PlayCircleOutline />\n                          )}\n                        </IconButton>\n                      </Tooltip>\n                      <Tooltip\n                        title={showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\"}\n                      >\n                        <IconButton\n                          onClick={toggleLandmarks}\n                          color=\"secondary\"\n                          disabled={!isCameraReady || isAutoMode}\n                        >\n                          {showLandmarks ? <VisibilityOff /> : <Visibility />}\n                        </IconButton>\n                      </Tooltip>\n                    </Box>\n                  )}\n              </Box>\n            </CardContent>\n\n            {/* Camera Display Area */}\n            <Box\n              sx={{\n                position: \"relative\",\n                width: \"100%\",\n                aspectRatio: \"640 / 480\",\n                backgroundColor: \"#000\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              {sessionCompleted ? (\n                <Box textAlign=\"center\" color=\"white\" p={4}>\n                  <Info sx={{ fontSize: 60, mb: 2 }} />\n                  <Typography variant=\"h6\">\n                    Phiên điểm danh đã kết thúc\n                  </Typography>\n                  <Typography variant=\"body2\" mt={1}>\n                    Bạn có thể xem kết quả điểm danh ở danh sách bên phải\n                  </Typography>\n                </Box>\n              ) : !isModelLoaded ? (\n                <Box textAlign=\"center\" color=\"white\">\n                  <CircularProgress color=\"inherit\" />\n                  <Typography>Đang tải mô hình nhận diện...</Typography>\n                </Box>\n              ) : (\n                <Suspense\n                  fallback={\n                    <Box textAlign=\"center\" color=\"white\">\n                      <CircularProgress color=\"inherit\" />\n                      <Typography>Đang khởi tạo camera...</Typography>\n                    </Box>\n                  }\n                >\n                  <Webcam\n                    audio={false}\n                    ref={webcamRef}\n                    screenshotFormat=\"image/jpeg\"\n                    width=\"100%\"\n                    height=\"100%\"\n                    videoConstraints={{\n                      width: 640,\n                      height: 480,\n                      facingMode: \"user\",\n                    }}\n                    style={{\n                      display: \"block\",\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      objectFit: \"cover\",\n                    }}\n                    onUserMedia={handleUserMedia}\n                    onUserMediaError={handleUserMediaError}\n                  />\n                </Suspense>\n              )}\n\n              {/* Canvas for Overlays - chỉ hiển thị nếu phiên chưa kết thúc */}\n              {!sessionCompleted && (\n                <canvas\n                  ref={canvasRef}\n                  style={{\n                    position: \"absolute\",\n                    top: 0,\n                    left: 0,\n                    width: \"100%\",\n                    height: \"100%\",\n                    zIndex: 10,\n                  }}\n                />\n              )}\n\n              {/* Camera Error/Loading Overlay */}\n              {(!isCameraReady || componentError?.includes(\"camera\")) &&\n                !sessionCompleted && (\n                  <Box\n                    sx={{\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      backgroundColor: \"rgba(0,0,0,0.7)\",\n                      display: \"flex\",\n                      flexDirection: \"column\",\n                      justifyContent: \"center\",\n                      alignItems: \"center\",\n                      color: \"white\",\n                      zIndex: 20,\n                    }}\n                  >\n                    <VideocamOff sx={{ fontSize: 60, mb: 2 }} />\n                    <Typography variant=\"h6\">Camera không khả dụng</Typography>\n                    <Typography\n                      variant=\"body2\"\n                      sx={{ mt: 1, px: 2, textAlign: \"center\" }}\n                    >\n                      {componentError ||\n                        \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"}\n                    </Typography>\n                    <Button\n                      variant=\"outlined\"\n                      color=\"inherit\"\n                      sx={{ mt: 2 }}\n                      onClick={() => window.location.reload()}\n                    >\n                      Thử lại\n                    </Button>\n                  </Box>\n                )}\n              {/* Auto Mode Indicator */}\n              {isAutoMode && isCameraReady && (\n                <Chip\n                  label=\"Đang tự động điểm danh\"\n                  color=\"success\"\n                  size=\"small\"\n                  sx={{\n                    position: \"absolute\",\n                    bottom: 10,\n                    right: 10,\n                    zIndex: 15,\n                  }}\n                />\n              )}\n            </Box>\n\n            {/* Action Buttons */}\n            {!sessionCompleted && isCameraReady && isModelLoaded && (\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                p={2}\n                bgcolor=\"#f8f9fa\"\n                borderTop=\"1px solid #eaeaea\"\n              >\n                <Button\n                  variant=\"contained\"\n                  onClick={handleManualCapture}\n                  startIcon={\n                    isProcessing ? (\n                      <CircularProgress size={20} color=\"inherit\" />\n                    ) : (\n                      <CameraAlt />\n                    )\n                  }\n                  disabled={isProcessing || isAutoMode}\n                >\n                  Chụp & Nhận diện\n                </Button>\n                <Button\n                  variant=\"contained\"\n                  color=\"secondary\"\n                  onClick={completeSession}\n                  startIcon={<Save />}\n                  disabled={isProcessing}\n                >\n                  Kết thúc phiên\n                </Button>\n              </Box>\n            )}\n          </Card>\n\n          {/* Recognized Students Preview (Optional) */}\n          {recognizedStudents.length > 0 && !isAutoMode && (\n            <Card sx={{ mt: 2, borderRadius: \"10px\", boxShadow: 1 }}>\n              <CardContent>\n                <Typography variant=\"subtitle1\" fontWeight=\"500\" mb={1}>\n                  Đã nhận diện gần đây\n                </Typography>\n                <Grid container spacing={1}>\n                  {recognizedStudents.slice(0, 4).map(\n                    (\n                      rec,\n                      index // Show max 4\n                    ) => (\n                      <Grid\n                        item\n                        xs={6}\n                        sm={3}\n                        key={`${rec.studentId}-${index}`}\n                      >\n                        <Paper\n                          elevation={0}\n                          sx={{\n                            p: 1,\n                            textAlign: \"center\",\n                            border: \"1px solid #eee\",\n                          }}\n                        >\n                          <Typography variant=\"caption\" display=\"block\" noWrap>\n                            {rec.name}\n                          </Typography>\n                          <Chip\n                            label={`${(rec.confidence * 100).toFixed(0)}%`}\n                            size=\"small\"\n                            color={\n                              rec.confidence > CONFIDENCE_THRESHOLD\n                                ? \"success\"\n                                : \"warning\"\n                            }\n                            sx={{ mt: 0.5 }}\n                          />\n                        </Paper>\n                      </Grid>\n                    )\n                  )}\n                </Grid>\n              </CardContent>\n            </Card>\n          )}\n        </Grid>\n\n        {/* Right Column: Student Lists */}\n        <Grid item xs={12} md={4}>\n          {/* Present Students */}\n          <Card sx={{ mb: 3, borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Typography variant=\"h6\" display=\"flex\" alignItems=\"center\">\n                  <Check sx={{ mr: 1, color: \"success.main\" }} /> Có mặt (\n                  {presentStudents.length}/{totalStudents})\n                </Typography>\n                <Tooltip title=\"Làm mới danh sách\">\n                  <IconButton\n                    size=\"small\"\n                    onClick={refreshAttendanceLogs}\n                    disabled={isProcessing}\n                  >\n                    <Refresh />\n                  </IconButton>\n                </Tooltip>\n              </Box>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {presentStudents.length === 0 ? (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"textSecondary\"\n                    align=\"center\"\n                    sx={{ py: 2 }}\n                  >\n                    Tất cả sinh viên đã có mặt.\n                  </Typography>\n                ) : (\n                  <List dense>\n                    {presentStudents\n                      .sort(\n                        (a, b) => new Date(b.timestamp) - new Date(a.timestamp)\n                      ) // Sort by time desc\n                      .map((log) => (\n                        // Simplified ListItem for debugging\n                        <ListItem key={log._id}>\n                          <ListItemText\n                            primary={\n                              log.student_id?.full_name ||\n                              `Log ID: ${log._id} (Tên bị thiếu)`\n                            }\n                            secondary={`Trạng thái: ${log.status} - ${new Date(\n                              log.timestamp\n                            ).toLocaleTimeString(\"vi-VN\")}`}\n                          />\n                        </ListItem>\n                      ))}\n                  </List>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n\n          {/* Absent Students */}\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Typography\n                variant=\"h6\"\n                display=\"flex\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Close sx={{ mr: 1, color: \"error.main\" }} /> Vắng mặt (\n                {absentStudents.length}/{totalStudents})\n              </Typography>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {absentStudents.length === 0 ? (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"textSecondary\"\n                    align=\"center\"\n                    sx={{ py: 2 }}\n                  >\n                    Tất cả sinh viên đã có mặt.\n                  </Typography>\n                ) : (\n                  <List dense>\n                    {absentStudents.map((student) => (\n                      // Keep absent list detailed for now\n                      <ListItem\n                        key={student._id}\n                        disablePadding\n                        sx={{ mb: 0.5 }}\n                        secondaryAction={\n                          !sessionCompleted ? (\n                            <Tooltip title=\"Điểm danh thủ công\">\n                              <IconButton\n                                edge=\"end\"\n                                size=\"small\"\n                                onClick={() =>\n                                  openManualAttendanceDialog(student)\n                                }\n                                disabled={isProcessing}\n                              >\n                                <Edit fontSize=\"small\" />\n                              </IconButton>\n                            </Tooltip>\n                          ) : null\n                        }\n                      >\n                        <Paper\n                          variant=\"outlined\"\n                          sx={{\n                            width: \"100%\",\n                            display: \"flex\",\n                            alignItems: \"center\",\n                            p: 0.5,\n                            borderRadius: \"4px\",\n                          }}\n                        >\n                          <ListItemAvatar sx={{ minWidth: 45 }}>\n                            <Avatar\n                              alt={student.full_name}\n                              src={student.avatar_url}\n                              sx={{ width: 32, height: 32 }}\n                            />\n                          </ListItemAvatar>\n                          <ListItemText\n                            primary={\n                              <Typography variant=\"body2\" noWrap>\n                                {student.full_name}\n                              </Typography>\n                            }\n                            secondary={\n                              <Typography\n                                variant=\"caption\"\n                                color=\"text.secondary\"\n                              >\n                                {student.student_code}\n                              </Typography>\n                            }\n                          />\n                        </Paper>\n                      </ListItem>\n                    ))}\n                  </List>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n        </Grid>\n      </Grid>\n\n      {/* Manual Attendance Dialog */}\n      <Dialog\n        open={manualDialogOpen}\n        onClose={handleManualDialogClose}\n        maxWidth=\"xs\"\n        fullWidth\n      >\n        <DialogTitle>Điểm danh thủ công</DialogTitle>\n        <DialogContent>\n          {selectedStudent && (\n            <Box display=\"flex\" alignItems=\"center\" mb={2}>\n              <Avatar\n                src={selectedStudent.avatar_url}\n                alt={selectedStudent.full_name}\n                sx={{ width: 48, height: 48, mr: 2 }}\n              />\n              <Box>\n                <Typography variant=\"subtitle1\">\n                  {selectedStudent.full_name}\n                </Typography>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  MSSV: {selectedStudent.student_code}\n                </Typography>\n              </Box>\n            </Box>\n          )}\n          <FormControl fullWidth margin=\"normal\">\n            <InputLabel>Trạng thái</InputLabel>\n            <Select\n              name=\"status\"\n              value={manualAttendanceData.status}\n              onChange={handleManualAttendanceChange}\n              label=\"Trạng thái\"\n            >\n              <MenuItem value=\"present\">Có mặt</MenuItem>\n              <MenuItem value=\"absent\">Vắng mặt</MenuItem>\n              <MenuItem value=\"late\">Đi trễ</MenuItem>\n              <MenuItem value=\"early_leave\">Về sớm</MenuItem>\n            </Select>\n          </FormControl>\n          <TextField\n            fullWidth\n            margin=\"normal\"\n            name=\"note\"\n            label=\"Ghi chú (tùy chọn)\"\n            value={manualAttendanceData.note}\n            onChange={handleManualAttendanceChange}\n            multiline\n            rows={2}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleManualDialogClose}>Hủy</Button>\n          <Button\n            onClick={handleManualAttendanceSubmit}\n            variant=\"contained\"\n            color=\"primary\"\n            disabled={isProcessing}\n          >\n            Xác nhận\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </Box>\n  );\n};\n\nexport default AttendancePage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
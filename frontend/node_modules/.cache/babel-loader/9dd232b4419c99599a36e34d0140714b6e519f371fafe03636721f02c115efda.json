{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useSnackbar}from\"notistack\";import axios from\"axios\";import{Box,Typography,Paper,Button,IconButton,TextField,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,TablePagination,Dialog,DialogActions,DialogContent,DialogContentText,DialogTitle,Grid,Tooltip,CircularProgress,InputAdornment,FormControl,InputLabel,Select,MenuItem,Chip}from\"@mui/material\";import{Add,Delete,Edit,Search,Refresh}from\"@mui/icons-material\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||\"http://localhost:5000/api\";const SemestersPage=()=>{const dispatch=useDispatch();const{enqueueSnackbar}=useSnackbar();const{token}=useSelector(state=>state.auth);// State\nconst[semesters,setSemesters]=useState([]);const[isLoading,setIsLoading]=useState(false);const[page,setPage]=useState(0);const[rowsPerPage,setRowsPerPage]=useState(10);const[totalCount,setTotalCount]=useState(0);const[searchTerm,setSearchTerm]=useState(\"\");// Dialog states\nconst[dialogOpen,setDialogOpen]=useState(false);const[dialogMode,setDialogMode]=useState(\"create\");const[formData,setFormData]=useState({name:\"\",year:new Date().getFullYear(),start_date:\"\",end_date:\"\",is_current:false,status:\"chưa bắt đầu\"});const[selectedSemester,setSelectedSemester]=useState(null);const[deleteDialogOpen,setDeleteDialogOpen]=useState(false);// Load data on mount and when pagination/search changes\nuseEffect(()=>{loadSemesters();},[page,rowsPerPage]);const loadSemesters=async()=>{try{setIsLoading(true);const response=await axios.get(`${API_URL}/semesters?page=${page+1}&limit=${rowsPerPage}&search=${searchTerm}`,{headers:{Authorization:`Bearer ${token}`}});setSemesters(response.data.data||[]);setTotalCount(response.data.totalCount||0);setIsLoading(false);}catch(error){console.error(\"Lỗi khi tải danh sách kỳ học:\",error);enqueueSnackbar(\"Lỗi khi tải danh sách kỳ học\",{variant:\"error\"});setIsLoading(false);}};const handleSearch=()=>{setPage(0);loadSemesters();};const handleChangePage=(event,newPage)=>{setPage(newPage);};const handleChangeRowsPerPage=event=>{setRowsPerPage(parseInt(event.target.value,10));setPage(0);};// Dialog handlers\nconst openDialog=function(mode){let semester=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setDialogMode(mode);if(mode===\"edit\"&&semester){setFormData({name:semester.name,year:semester.year||new Date().getFullYear(),start_date:semester.start_date?semester.start_date.substring(0,10):\"\",end_date:semester.end_date?semester.end_date.substring(0,10):\"\",is_current:semester.is_current||false,status:semester.status||\"chưa bắt đầu\"});setSelectedSemester(semester);}else{setFormData({name:\"\",year:new Date().getFullYear(),start_date:\"\",end_date:\"\",is_current:false,status:\"chưa bắt đầu\"});}setDialogOpen(true);};const handleFormChange=e=>{const{name,value,type,checked}=e.target;setFormData({...formData,[name]:type===\"checkbox\"?checked:value});};const handleFormSubmit=async()=>{try{if(dialogMode===\"create\"){await axios.post(`${API_URL}/semesters`,formData,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Tạo kỳ học mới thành công\",{variant:\"success\"});}else{await axios.put(`${API_URL}/semesters/${selectedSemester._id}`,formData,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Cập nhật kỳ học thành công\",{variant:\"success\"});}setDialogOpen(false);loadSemesters();}catch(error){var _error$response,_error$response$data;console.error(\"Lỗi khi thao tác với kỳ học:\",error);enqueueSnackbar(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||\"Lỗi khi thao tác với kỳ học\",{variant:\"error\"});}};// Delete handlers\nconst openDeleteDialog=semester=>{setSelectedSemester(semester);setDeleteDialogOpen(true);};const handleDeleteSemester=async()=>{try{await axios.delete(`${API_URL}/semesters/${selectedSemester._id}`,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Xóa kỳ học thành công\",{variant:\"success\"});setDeleteDialogOpen(false);loadSemesters();}catch(error){var _error$response2,_error$response2$data;console.error(\"Lỗi khi xóa kỳ học:\",error);enqueueSnackbar(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||\"Lỗi khi xóa kỳ học\",{variant:\"error\"});}};return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Qu\\u1EA3n l\\xFD k\\u1EF3 h\\u1ECDc\"}),/*#__PURE__*/_jsx(Paper,{sx:{p:2,mb:3},children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexDirection:{xs:\"column\",sm:\"row\"},alignItems:{sm:\"center\"},justifyContent:\"space-between\",gap:2,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,flexGrow:1,children:[/*#__PURE__*/_jsx(TextField,{label:\"T\\xECm ki\\u1EBFm k\\u1EF3 h\\u1ECDc\",variant:\"outlined\",size:\"small\",fullWidth:true,value:searchTerm,onChange:e=>setSearchTerm(e.target.value),onKeyPress:e=>e.key===\"Enter\"&&handleSearch(),InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(Search,{})})}}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleSearch,startIcon:/*#__PURE__*/_jsx(Search,{}),children:\"T\\xECm\"})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",gap:2,children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(Refresh,{}),onClick:loadSemesters,children:\"L\\xE0m m\\u1EDBi\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>openDialog(\"create\"),children:\"Th\\xEAm k\\u1EF3 h\\u1ECDc\"})]})]})}),/*#__PURE__*/_jsxs(TableContainer,{component:Paper,children:[/*#__PURE__*/_jsxs(Table,{sx:{minWidth:650},children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"T\\xEAn k\\u1EF3 h\\u1ECDc\"}),/*#__PURE__*/_jsx(TableCell,{children:\"N\\u0103m h\\u1ECDc\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Ng\\xE0y b\\u1EAFt \\u0111\\u1EA7u\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Ng\\xE0y k\\u1EBFt th\\xFAc\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:isLoading?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:/*#__PURE__*/_jsx(CircularProgress,{size:30})})}):semesters.length===0?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:\"Kh\\xF4ng c\\xF3 d\\u1EEF li\\u1EC7u\"})}):semesters.map(semester=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:semester.name}),/*#__PURE__*/_jsx(TableCell,{children:semester.year}),/*#__PURE__*/_jsx(TableCell,{children:semester.start_date?new Date(semester.start_date).toLocaleDateString(\"vi-VN\"):\"\"}),/*#__PURE__*/_jsx(TableCell,{children:semester.end_date?new Date(semester.end_date).toLocaleDateString(\"vi-VN\"):\"\"}),/*#__PURE__*/_jsx(TableCell,{children:semester.status?/*#__PURE__*/_jsx(Chip,{label:semester.status,color:semester.status===\"đang học\"?\"primary\":semester.status===\"đã hoàn thành\"?\"success\":\"warning\",size:\"small\"}):semester.is_current?\"Đang hoạt động\":\"Không hoạt động\"}),/*#__PURE__*/_jsxs(TableCell,{align:\"right\",children:[/*#__PURE__*/_jsx(Tooltip,{title:\"Ch\\u1EC9nh s\\u1EEDa\",children:/*#__PURE__*/_jsx(IconButton,{color:\"primary\",onClick:()=>openDialog(\"edit\",semester),children:/*#__PURE__*/_jsx(Edit,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"X\\xF3a\",children:/*#__PURE__*/_jsx(IconButton,{color:\"error\",onClick:()=>openDeleteDialog(semester),children:/*#__PURE__*/_jsx(Delete,{})})})]})]},semester._id))})]}),/*#__PURE__*/_jsx(TablePagination,{rowsPerPageOptions:[5,10,25],component:\"div\",count:totalCount,rowsPerPage:rowsPerPage,page:page,onPageChange:handleChangePage,onRowsPerPageChange:handleChangeRowsPerPage,labelRowsPerPage:\"S\\u1ED1 d\\xF2ng m\\u1ED7i trang:\",labelDisplayedRows:_ref=>{let{from,to,count}=_ref;return`${from}-${to} của ${count}`;}})]}),/*#__PURE__*/_jsxs(Dialog,{open:dialogOpen,onClose:()=>setDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:dialogMode===\"create\"?\"Thêm kỳ học mới\":\"Chỉnh sửa kỳ học\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mt:1},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{name:\"name\",label:\"T\\xEAn k\\u1EF3 h\\u1ECDc\",fullWidth:true,value:formData.name,onChange:handleFormChange,required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{name:\"year\",label:\"N\\u0103m h\\u1ECDc\",fullWidth:true,type:\"number\",value:formData.year,onChange:handleFormChange,required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{name:\"start_date\",label:\"Ng\\xE0y b\\u1EAFt \\u0111\\u1EA7u\",fullWidth:true,type:\"date\",value:formData.start_date,onChange:handleFormChange,InputLabelProps:{shrink:true},required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,children:/*#__PURE__*/_jsx(TextField,{name:\"end_date\",label:\"Ng\\xE0y k\\u1EBFt th\\xFAc\",fullWidth:true,type:\"date\",value:formData.end_date,onChange:handleFormChange,InputLabelProps:{shrink:true},required:true})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsxs(Select,{name:\"status\",value:formData.status,onChange:handleFormChange,label:\"Tr\\u1EA1ng th\\xE1i\",children:[/*#__PURE__*/_jsx(MenuItem,{value:\"ch\\u01B0a b\\u1EAFt \\u0111\\u1EA7u\",children:\"Ch\\u01B0a b\\u1EAFt \\u0111\\u1EA7u\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"\\u0111ang h\\u1ECDc\",children:\"\\u0110ang h\\u1ECDc\"}),/*#__PURE__*/_jsx(MenuItem,{value:\"\\u0111\\xE3 ho\\xE0n th\\xE0nh\",children:\"\\u0110\\xE3 ho\\xE0n th\\xE0nh\"})]})]})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDialogOpen(false),children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",onClick:handleFormSubmit,children:dialogMode===\"create\"?\"Tạo mới\":\"Cập nhật\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:deleteDialogOpen,onClose:()=>setDeleteDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"X\\xE1c nh\\u1EADn x\\xF3a\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(DialogContentText,{children:[\"B\\u1EA1n c\\xF3 ch\\u1EAFc ch\\u1EAFn mu\\u1ED1n x\\xF3a k\\u1EF3 h\\u1ECDc \\\"\",selectedSemester===null||selectedSemester===void 0?void 0:selectedSemester.name,\"\\\" kh\\xF4ng? H\\xE0nh \\u0111\\u1ED9ng n\\xE0y kh\\xF4ng th\\u1EC3 ho\\xE0n t\\xE1c.\"]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDeleteDialogOpen(false),children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"error\",onClick:handleDeleteSemester,children:\"X\\xF3a\"})]})]})]});};export default SemestersPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"import React,{useState,useEffect,useCallback}from\"react\";import{useParams,useNavigate}from\"react-router-dom\";import{useSelector}from\"react-redux\";import{useSnackbar}from\"notistack\";import axios from\"axios\";import{Box,Typography,Card,CardContent,Grid,Paper,Button,Tabs,Tab,CircularProgress,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,Chip,IconButton,Dialog,DialogTitle,DialogContent,DialogActions,TextField,FormControl,InputLabel,Select,MenuItem,List,ListItem,ListItemText,ListItemSecondaryAction,Divider,Alert,Tooltip,Checkbox}from\"@mui/material\";import{PersonAdd,Delete,Add,Edit,PlayArrow,Stop,CheckCircle,Warning,Info,CalendarToday,AccessTime,Room,Download,School}from\"@mui/icons-material\";import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||\"http://localhost:5000/api\";function a11yProps(index){return{id:`class-tab-${index}`,\"aria-controls\":`class-tabpanel-${index}`};}function TabPanel(props){const{children,value,index,...other}=props;return/*#__PURE__*/_jsx(\"div\",{role:\"tabpanel\",hidden:value!==index,id:`class-tabpanel-${index}`,\"aria-labelledby\":`class-tab-${index}`,...other,children:value===index&&/*#__PURE__*/_jsx(Box,{sx:{p:3},children:children})});}const TeacherClassDetailPage=()=>{var _classInfo$subject_id,_classInfo$subject_id2,_classInfo$semester_i;const{classId}=useParams();const id=classId;// Đảm bảo sử dụng đúng tên param\nconst navigate=useNavigate();const{enqueueSnackbar}=useSnackbar();const{token}=useSelector(state=>state.auth);// State cho dữ liệu\nconst[classInfo,setClassInfo]=useState(null);const[students,setStudents]=useState([]);const[attendanceSessions,setAttendanceSessions]=useState([]);const[attendanceStats,setAttendanceStats]=useState({total:0,pending:0,completed:0});const[isLoading,setIsLoading]=useState(true);// State cho UI\nconst[tabValue,setTabValue]=useState(0);const[openSessionDialog,setOpenSessionDialog]=useState(false);const[sessionFormData,setSessionFormData]=useState({title:\"\",date:new Date().toISOString().split(\"T\")[0],start_time:\"08:00\",end_time:\"09:30\",location:\"\"});// State cho thêm sinh viên\nconst[openAddStudentDialog,setOpenAddStudentDialog]=useState(false);const[availableStudents,setAvailableStudents]=useState([]);const[selectedStudents,setSelectedStudents]=useState([]);const[searchStudent,setSearchStudent]=useState(\"\");const[mainClasses,setMainClasses]=useState([]);const[selectedMainClass,setSelectedMainClass]=useState(\"\");const[isLoadingStudents,setIsLoadingStudents]=useState(false);// Load dữ liệu ban đầu\nconst fetchClassData=useCallback(async()=>{try{var _sessionsResponse$dat,_sessionsResponse$dat2;setIsLoading(true);// Kiểm tra id có tồn tại không\nif(!id){enqueueSnackbar(\"ID lớp học không hợp lệ\",{variant:\"error\"});navigate(\"/teacher/classes\");return;}// Lấy thông tin lớp học\nconst classResponse=await axios.get(`${API_URL}/classes/teaching/${id}`,{headers:{Authorization:`Bearer ${token}`,Accept:\"application/json\"}});// Log dữ liệu để xem cấu trúc\nconsole.log(\"Dữ liệu lớp học nhận về:\",classResponse.data);// Kiểm tra nếu không có dữ liệu trả về\nif(!classResponse.data.success||!classResponse.data.data){enqueueSnackbar(\"Không tìm thấy thông tin lớp học\",{variant:\"error\"});navigate(\"/teacher/classes\");return;}setClassInfo(classResponse.data.data);// Lấy thông tin chi tiết của mỗi sinh viên\ntry{const studentsResponse=await axios.get(`${API_URL}/classes/teaching/${id}/students`,{headers:{Authorization:`Bearer ${token}`,Accept:\"application/json\"}});console.log(\"Dữ liệu sinh viên chi tiết:\",studentsResponse.data);if(studentsResponse.data.success&&studentsResponse.data.data){// Log để kiểm tra cấu trúc dữ liệu sinh viên\nconsole.log(\"Cấu trúc dữ liệu sinh viên đầu tiên:\",studentsResponse.data.data[0]);// Đảm bảo mỗi sinh viên có đủ thông tin cho việc hiển thị\nconst processedStudents=studentsResponse.data.data.map(student=>{// Kiểm tra và log thông tin về face features\nconst hasFaceData=student.faceFeatures&&student.faceFeatures.descriptors&&student.faceFeatures.descriptors.length>0;console.log(`Sinh viên ${student.full_name} - có face data: ${hasFaceData}`);return{...student,// Đảm bảo có trường has_face_data\nhas_face_data:hasFaceData};});setStudents(processedStudents);}else{// Nếu không có dữ liệu từ API, dùng dữ liệu từ response của lớp học\nconst basicStudents=classResponse.data.data.students||[];console.log(\"Sử dụng dữ liệu cơ bản:\",basicStudents);setStudents(basicStudents);}}catch(error){console.error(\"Lỗi khi lấy thông tin chi tiết sinh viên:\",error);// Nếu không lấy được chi tiết, sử dụng danh sách cơ bản từ lớp học\nconst basicStudents=classResponse.data.data.students||[];console.log(\"Sử dụng dữ liệu cơ bản do lỗi:\",basicStudents);setStudents(basicStudents);}// Lấy danh sách phiên điểm danh\nconst sessionsResponse=await axios.get(`${API_URL}/attendance/teaching-class/${id}/sessions`,{headers:{Authorization:`Bearer ${token}`}});setAttendanceSessions(sessionsResponse.data.data||[]);// Tính toán thống kê điểm danh\nconst stats={total:((_sessionsResponse$dat=sessionsResponse.data.data)===null||_sessionsResponse$dat===void 0?void 0:_sessionsResponse$dat.length)||0,pending:0,completed:0};(_sessionsResponse$dat2=sessionsResponse.data.data)===null||_sessionsResponse$dat2===void 0?void 0:_sessionsResponse$dat2.forEach(session=>{if(session.status===\"completed\"){stats.completed++;}else{stats.pending++;}});setAttendanceStats(stats);}catch(error){console.error(\"Lỗi khi tải dữ liệu lớp học:\",error);// Xử lý các loại lỗi từ API\nif(error.response){// Nếu máy chủ phản hồi với mã lỗi\nif(error.response.status===404){enqueueSnackbar(\"Không tìm thấy lớp học với ID đã cho\",{variant:\"error\"});}else if(error.response.status===400){enqueueSnackbar(\"ID lớp học không hợp lệ\",{variant:\"error\"});}else{var _error$response$data;enqueueSnackbar(((_error$response$data=error.response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||\"Lỗi khi tải dữ liệu lớp học\",{variant:\"error\"});}}else{enqueueSnackbar(\"Không thể kết nối đến máy chủ\",{variant:\"error\"});}setIsLoading(false);}finally{setIsLoading(false);}},[id,token,enqueueSnackbar,navigate]);useEffect(()=>{fetchClassData();},[fetchClassData]);// Thay đổi tab\nconst handleChangeTab=(event,newValue)=>{setTabValue(newValue);};// Mở dialog tạo phiên điểm danh\nconst handleOpenSessionDialog=()=>{setSessionFormData({title:`Buổi học ${attendanceSessions.length+1}`,date:new Date().toISOString().split(\"T\")[0],start_time:\"08:00\",end_time:\"09:30\",location:\"\"});setOpenSessionDialog(true);};// Đóng dialog tạo phiên điểm danh\nconst handleCloseSessionDialog=()=>{setOpenSessionDialog(false);};// Cập nhật form dữ liệu phiên điểm danh\nconst handleSessionFormChange=e=>{const{name,value}=e.target;setSessionFormData(prev=>({...prev,[name]:value}));};// Tạo phiên điểm danh mới\nconst handleCreateSession=async()=>{try{const{title,date,start_time,end_time,location}=sessionFormData;// Kiểm tra dữ liệu\nif(!title||!date||!start_time||!end_time){enqueueSnackbar(\"Vui lòng điền đầy đủ thông tin\",{variant:\"error\"});return;}const response=await axios.post(`${API_URL}/attendance/sessions`,{title,date,start_time,end_time,location,teaching_class_id:id},{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Tạo phiên điểm danh thành công\",{variant:\"success\"});setOpenSessionDialog(false);// Cập nhật danh sách phiên\nsetAttendanceSessions(prev=>[...prev,response.data.data]);setAttendanceStats(prev=>({...prev,total:prev.total+1,pending:prev.pending+1}));}catch(error){var _error$response,_error$response$data2;console.error(\"Lỗi khi tạo phiên điểm danh:\",error);enqueueSnackbar(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data2=_error$response.data)===null||_error$response$data2===void 0?void 0:_error$response$data2.message)||\"Lỗi khi tạo phiên điểm danh\",{variant:\"error\"});}};// Bắt đầu phiên điểm danh\nconst handleStartSession=sessionId=>{navigate(`/teacher/attendance/${id}/${sessionId}`);};// Mở dialog thêm sinh viên\nconst handleOpenAddStudentDialog=async()=>{try{var _mainClassResponse$da;setIsLoadingStudents(true);// Lấy danh sách lớp chính\nconst mainClassResponse=await axios.get(`${API_URL}/classes/main?all=true`,{headers:{Authorization:`Bearer ${token}`,Accept:\"application/json\"}});console.log(\"Danh sách lớp chính:\",mainClassResponse.data);if(!((_mainClassResponse$da=mainClassResponse.data)!==null&&_mainClassResponse$da!==void 0&&_mainClassResponse$da.data)){enqueueSnackbar(\"Không thể tải danh sách lớp chính\",{variant:\"error\"});return;}setMainClasses(mainClassResponse.data.data||[]);setAvailableStudents([]);setSelectedStudents([]);setSelectedMainClass(\"\");setOpenAddStudentDialog(true);}catch(error){console.error(\"Lỗi khi tải danh sách lớp chính:\",error);enqueueSnackbar(\"Không thể tải danh sách lớp chính. Vui lòng thử lại sau.\",{variant:\"error\"});}finally{setIsLoadingStudents(false);}};// Lấy danh sách sinh viên từ lớp chính\nconst handleMainClassChange=async e=>{const mainClassId=e.target.value;setSelectedMainClass(mainClassId);if(!mainClassId){setAvailableStudents([]);return;}try{var _studentsResponse$dat;setIsLoadingStudents(true);const studentsResponse=await axios.get(`${API_URL}/classes/main/${mainClassId}/approved-students`,{headers:{Authorization:`Bearer ${token}`,Accept:\"application/json\"}});console.log(\"Danh sách sinh viên lớp chính:\",studentsResponse.data);if(!((_studentsResponse$dat=studentsResponse.data)!==null&&_studentsResponse$dat!==void 0&&_studentsResponse$dat.data)){enqueueSnackbar(\"Không thể tải danh sách sinh viên từ lớp chính\",{variant:\"error\"});return;}// Lọc sinh viên chưa có trong lớp\nconst currentStudentIds=students.map(s=>s._id);const filteredStudents=studentsResponse.data.data.students.filter(s=>!currentStudentIds.includes(s._id));setAvailableStudents(filteredStudents);}catch(error){console.error(\"Lỗi khi tải danh sách sinh viên từ lớp chính:\",error);enqueueSnackbar(\"Không thể tải danh sách sinh viên từ lớp chính\",{variant:\"error\"});setAvailableStudents([]);}finally{setIsLoadingStudents(false);}};// Đóng dialog thêm sinh viên\nconst handleCloseAddStudentDialog=()=>{setOpenAddStudentDialog(false);};// Xử lý chọn sinh viên để thêm\nconst handleSelectStudent=studentId=>{if(selectedStudents.includes(studentId)){setSelectedStudents(selectedStudents.filter(id=>id!==studentId));}else{setSelectedStudents([...selectedStudents,studentId]);}};// Thêm sinh viên vào lớp\nconst handleAddStudents=async()=>{try{if(selectedStudents.length===0){enqueueSnackbar(\"Vui lòng chọn ít nhất một sinh viên\",{variant:\"warning\"});return;}// Gọi API thêm sinh viên\nawait axios.post(`${API_URL}/classes/teaching/${id}/students/batch`,{student_ids:selectedStudents},{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(`Đã thêm ${selectedStudents.length} sinh viên vào lớp`,{variant:\"success\"});setOpenAddStudentDialog(false);// Cập nhật lại danh sách sinh viên\nfetchClassData();}catch(error){console.error(\"Lỗi khi thêm sinh viên:\",error);if(error.response){var _error$response$data3;enqueueSnackbar(`Lỗi: ${error.response.status} - ${((_error$response$data3=error.response.data)===null||_error$response$data3===void 0?void 0:_error$response$data3.message)||\"Không thể thêm sinh viên\"}`,{variant:\"error\"});}else{enqueueSnackbar(\"Lỗi kết nối khi thêm sinh viên vào lớp\",{variant:\"error\"});}}};// Xóa sinh viên khỏi lớp\nconst handleRemoveStudent=async studentId=>{if(!window.confirm(\"Bạn có chắc chắn muốn xóa sinh viên này khỏi lớp không?\")){return;}try{await axios.delete(`${API_URL}/classes/teaching/${id}/students/${studentId}`,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Đã xóa sinh viên khỏi lớp\",{variant:\"success\"});// Cập nhật lại danh sách sinh viên\nsetStudents(students.filter(s=>s._id!==studentId));}catch(error){console.error(\"Lỗi khi xóa sinh viên:\",error);enqueueSnackbar(\"Lỗi khi xóa sinh viên khỏi lớp\",{variant:\"error\"});}};// Xuất danh sách sinh viên\nconst handleExportStudentList=()=>{try{const studentsData=students.map((student,index)=>{var _student$school_info;return{STT:index+1,\"Mã SV\":((_student$school_info=student.school_info)===null||_student$school_info===void 0?void 0:_student$school_info.student_code)||\"N/A\",\"Họ và tên\":student.full_name||student.name,Email:student.email,\"Đăng ký khuôn mặt\":student.faceFeatures&&student.faceFeatures.descriptors&&student.faceFeatures.descriptors.length>0?\"Đã đăng ký\":\"Chưa đăng ký\"};});const header=[\"STT\",\"Mã SV\",\"Họ và tên\",\"Email\",\"Đăng ký khuôn mặt\"];const csvContent=\"data:text/csv;charset=utf-8,\"+[header.join(\",\"),...studentsData.map(row=>[row.STT,row[\"Mã SV\"],row[\"Họ và tên\"],row.Email,row[\"Đăng ký khuôn mặt\"]].join(\",\"))].join(\"\\n\");const encodedUri=encodeURI(csvContent);const link=document.createElement(\"a\");link.setAttribute(\"href\",encodedUri);link.setAttribute(\"download\",`danh_sach_sinh_vien_${classInfo===null||classInfo===void 0?void 0:classInfo.class_name}.csv`);document.body.appendChild(link);link.click();document.body.removeChild(link);enqueueSnackbar(\"Xuất danh sách sinh viên thành công\",{variant:\"success\"});}catch(error){console.error(\"Lỗi khi xuất danh sách:\",error);enqueueSnackbar(\"Lỗi khi xuất danh sách sinh viên\",{variant:\"error\"});}};// Lọc sinh viên theo từ khóa tìm kiếm\nconst filteredAvailableStudents=availableStudents.filter(student=>{var _student$school_info2,_student$school_info3;return student.full_name.toLowerCase().includes(searchStudent.toLowerCase())||((_student$school_info2=student.school_info)===null||_student$school_info2===void 0?void 0:(_student$school_info3=_student$school_info2.student_code)===null||_student$school_info3===void 0?void 0:_student$school_info3.toLowerCase().includes(searchStudent.toLowerCase()))||student.email.toLowerCase().includes(searchStudent.toLowerCase());});if(isLoading){return/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"center\",alignItems:\"center\",height:\"80vh\"},children:/*#__PURE__*/_jsx(CircularProgress,{})});}if(!classInfo){return/*#__PURE__*/_jsx(Box,{sx:{py:3},children:/*#__PURE__*/_jsxs(Card,{sx:{textAlign:\"center\",p:4},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",color:\"error\",gutterBottom:true,children:\"Kh\\xF4ng t\\xECm th\\u1EA5y l\\u1EDBp h\\u1ECDc\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{mb:3},children:\"L\\u1EDBp h\\u1ECDc b\\u1EA1n \\u0111ang t\\xECm ki\\u1EBFm kh\\xF4ng t\\u1ED3n t\\u1EA1i ho\\u1EB7c \\u0111\\xE3 b\\u1ECB x\\xF3a.\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:()=>navigate(\"/teacher/classes\"),children:\"Quay l\\u1EA1i danh s\\xE1ch l\\u1EDBp\"})]})});}return/*#__PURE__*/_jsxs(Box,{sx:{padding:3},children:[/*#__PURE__*/_jsxs(Box,{sx:{mb:3},children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",onClick:()=>navigate(\"/teacher/classes\"),sx:{mb:2},children:\"Quay l\\u1EA1i danh s\\xE1ch l\\u1EDBp\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:classInfo.class_name}),/*#__PURE__*/_jsxs(Typography,{variant:\"subtitle1\",color:\"text.secondary\",gutterBottom:true,children:[(_classInfo$subject_id=classInfo.subject_id)===null||_classInfo$subject_id===void 0?void 0:_classInfo$subject_id.name,\" (\",(_classInfo$subject_id2=classInfo.subject_id)===null||_classInfo$subject_id2===void 0?void 0:_classInfo$subject_id2.code,\")\"]})]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,sx:{mb:3},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Th\\xF4ng tin l\\u1EDBp h\\u1ECDc\"}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:1,display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(CalendarToday,{sx:{mr:1,fontSize:\"small\"}}),\"H\\u1ECDc k\\u1EF3: \",((_classInfo$semester_i=classInfo.semester_id)===null||_classInfo$semester_i===void 0?void 0:_classInfo$semester_i.name)||\"N/A\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:1,display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(CalendarToday,{sx:{mr:1,fontSize:\"small\"}}),\"Ng\\xE0y b\\u1EAFt \\u0111\\u1EA7u:\",\" \",classInfo.course_start_date?new Date(classInfo.course_start_date).toLocaleDateString(\"vi-VN\"):\"N/A\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:1,display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(CalendarToday,{sx:{mr:1,fontSize:\"small\"}}),\"Ng\\xE0y k\\u1EBFt th\\xFAc:\",\" \",classInfo.course_end_date?new Date(classInfo.course_end_date).toLocaleDateString(\"vi-VN\"):\"N/A\"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:1,display:\"flex\",alignItems:\"center\"},children:[/*#__PURE__*/_jsx(Info,{sx:{mr:1,fontSize:\"small\"}}),\"S\\u1ED1 bu\\u1ED5i h\\u1ECDc: \",classInfo.total_sessions||15]})]})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"\\u0110i\\u1EC3m danh\"}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:1},children:[\"T\\u1ED5ng s\\u1ED1 bu\\u1ED5i: \",attendanceStats.total]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:1},children:[\"\\u0110\\xE3 ho\\xE0n th\\xE0nh: \",attendanceStats.completed]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:1},children:[\"Ch\\u01B0a ho\\xE0n th\\xE0nh: \",attendanceStats.pending]})]})]})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsx(Card,{children:/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"Sinh vi\\xEAn\"}),/*#__PURE__*/_jsx(Box,{sx:{mt:2},children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",sx:{mb:1},children:[\"T\\u1ED5ng s\\u1ED1 sinh vi\\xEAn: \",students.length]})}),/*#__PURE__*/_jsx(Button,{variant:\"outlined\",size:\"small\",startIcon:/*#__PURE__*/_jsx(Download,{}),onClick:handleExportStudentList,sx:{mt:2},children:\"Xu\\u1EA5t danh s\\xE1ch\"})]})})})]}),/*#__PURE__*/_jsxs(Box,{sx:{width:\"100%\"},children:[/*#__PURE__*/_jsx(Box,{sx:{borderBottom:1,borderColor:\"divider\"},children:/*#__PURE__*/_jsxs(Tabs,{value:tabValue,onChange:handleChangeTab,\"aria-label\":\"l\\u1EDBp h\\u1ECDc tabs\",children:[/*#__PURE__*/_jsx(Tab,{label:\"Sinh vi\\xEAn\",...a11yProps(0)}),/*#__PURE__*/_jsx(Tab,{label:\"Phi\\xEAn \\u0111i\\u1EC3m danh\",...a11yProps(1)})]})}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:0,children:[/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"flex-end\",mb:2},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(PersonAdd,{}),onClick:handleOpenAddStudentDialog,children:\"Th\\xEAm sinh vi\\xEAn\"})}),/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"STT\"}),/*#__PURE__*/_jsx(TableCell,{children:\"M\\xE3 sinh vi\\xEAn\"}),/*#__PURE__*/_jsx(TableCell,{children:\"H\\u1ECD v\\xE0 t\\xEAn\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Email\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Thao t\\xE1c\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:students.length>0?students.map((student,index)=>{var _student$school_info4;// Kiểm tra và log mỗi sinh viên để debug\nconsole.log(`Hiển thị sinh viên ${index+1}:`,student);// Kiểm tra có face data\nconst hasFaceData=student.faceFeatures&&student.faceFeatures.descriptors&&student.faceFeatures.descriptors.length>0;return/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:index+1}),/*#__PURE__*/_jsx(TableCell,{children:((_student$school_info4=student.school_info)===null||_student$school_info4===void 0?void 0:_student$school_info4.student_code)||\"N/A\"}),/*#__PURE__*/_jsx(TableCell,{children:student.full_name||student.name}),/*#__PURE__*/_jsx(TableCell,{children:student.email}),/*#__PURE__*/_jsx(TableCell,{children:hasFaceData?/*#__PURE__*/_jsx(Chip,{label:\"\\u0110\\xE3 \\u0111\\u0103ng k\\xFD khu\\xF4n m\\u1EB7t\",color:\"success\",size:\"small\"}):/*#__PURE__*/_jsx(Chip,{label:\"Ch\\u01B0a \\u0111\\u0103ng k\\xFD khu\\xF4n m\\u1EB7t\",color:\"warning\",size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Tooltip,{title:\"X\\xF3a kh\\u1ECFi l\\u1EDBp\",children:/*#__PURE__*/_jsx(IconButton,{size:\"small\",color:\"error\",onClick:()=>handleRemoveStudent(student._id),children:/*#__PURE__*/_jsx(Delete,{})})})})]},student._id);}):/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:6,align:\"center\",children:\"Ch\\u01B0a c\\xF3 sinh vi\\xEAn n\\xE0o trong l\\u1EDBp\"})})})]})})]}),/*#__PURE__*/_jsxs(TabPanel,{value:tabValue,index:1,children:[/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"flex-end\",mb:2},children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:handleOpenSessionDialog,children:\"T\\u1EA1o phi\\xEAn \\u0111i\\u1EC3m danh\"})}),/*#__PURE__*/_jsx(TableContainer,{component:Paper,children:/*#__PURE__*/_jsxs(Table,{children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"STT\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Ti\\xEAu \\u0111\\u1EC1\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Ng\\xE0y\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Th\\u1EDDi gian\"}),/*#__PURE__*/_jsx(TableCell,{children:\"V\\u1ECB tr\\xED\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Tr\\u1EA1ng th\\xE1i\"}),/*#__PURE__*/_jsx(TableCell,{children:\"Thao t\\xE1c\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:attendanceSessions.length>0?attendanceSessions.map((session,index)=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:index+1}),/*#__PURE__*/_jsx(TableCell,{children:session.title}),/*#__PURE__*/_jsx(TableCell,{children:new Date(session.date).toLocaleDateString(\"vi-VN\")}),/*#__PURE__*/_jsxs(TableCell,{children:[session.start_time,\" - \",session.end_time]}),/*#__PURE__*/_jsx(TableCell,{children:session.location||\"N/A\"}),/*#__PURE__*/_jsx(TableCell,{children:session.status===\"completed\"?/*#__PURE__*/_jsx(Chip,{label:\"Ho\\xE0n th\\xE0nh\",color:\"success\",size:\"small\"}):session.status===\"in_progress\"?/*#__PURE__*/_jsx(Chip,{label:\"\\u0110ang di\\u1EC5n ra\",color:\"primary\",size:\"small\"}):/*#__PURE__*/_jsx(Chip,{label:\"Ch\\u01B0a b\\u1EAFt \\u0111\\u1EA7u\",color:\"default\",size:\"small\"})}),/*#__PURE__*/_jsx(TableCell,{children:/*#__PURE__*/_jsx(Button,{variant:\"contained\",size:\"small\",color:\"primary\",onClick:()=>handleStartSession(session._id),startIcon:session.status===\"completed\"?/*#__PURE__*/_jsx(CheckCircle,{}):/*#__PURE__*/_jsx(PlayArrow,{}),children:session.status===\"completed\"?\"Xem\":\"Bắt đầu\"})})]},session._id)):/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:7,align:\"center\",children:\"Ch\\u01B0a c\\xF3 phi\\xEAn \\u0111i\\u1EC3m danh n\\xE0o\"})})})]})})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:openSessionDialog,onClose:handleCloseSessionDialog,maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"T\\u1EA1o phi\\xEAn \\u0111i\\u1EC3m danh m\\u1EDBi\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Box,{sx:{mt:2},children:[/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Ti\\xEAu \\u0111\\u1EC1\",name:\"title\",value:sessionFormData.title,onChange:handleSessionFormChange,sx:{mb:2}}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Ng\\xE0y\",name:\"date\",type:\"date\",value:sessionFormData.date,onChange:handleSessionFormChange,sx:{mb:2}}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Th\\u1EDDi gian b\\u1EAFt \\u0111\\u1EA7u\",name:\"start_time\",type:\"time\",value:sessionFormData.start_time,onChange:handleSessionFormChange,sx:{mb:2}})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:6,children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"Th\\u1EDDi gian k\\u1EBFt th\\xFAc\",name:\"end_time\",type:\"time\",value:sessionFormData.end_time,onChange:handleSessionFormChange,sx:{mb:2}})})]}),/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"\\u0110\\u1ECBa \\u0111i\\u1EC3m\",name:\"location\",value:sessionFormData.location,onChange:handleSessionFormChange,sx:{mb:2}})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCloseSessionDialog,children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleCreateSession,children:\"T\\u1EA1o\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:openAddStudentDialog,onClose:handleCloseAddStudentDialog,maxWidth:\"md\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"Th\\xEAm sinh vi\\xEAn v\\xE0o l\\u1EDBp\"}),/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsxs(Box,{sx:{mb:3,mt:1},children:[/*#__PURE__*/_jsxs(FormControl,{fullWidth:true,sx:{mb:2},children:[/*#__PURE__*/_jsx(InputLabel,{children:\"Ch\\u1ECDn l\\u1EDBp ch\\xEDnh\"}),/*#__PURE__*/_jsxs(Select,{value:selectedMainClass,onChange:handleMainClassChange,label:\"Ch\\u1ECDn l\\u1EDBp ch\\xEDnh\",disabled:isLoadingStudents,children:[/*#__PURE__*/_jsx(MenuItem,{value:\"\",children:\"-- Ch\\u1ECDn l\\u1EDBp ch\\xEDnh --\"}),mainClasses.map(mainClass=>/*#__PURE__*/_jsxs(MenuItem,{value:mainClass._id,children:[mainClass.name,\" (\",mainClass.class_code,\")\"]},mainClass._id))]})]}),selectedMainClass&&/*#__PURE__*/_jsx(TextField,{fullWidth:true,label:\"T\\xECm ki\\u1EBFm sinh vi\\xEAn\",value:searchStudent,onChange:e=>setSearchStudent(e.target.value),disabled:isLoadingStudents})]}),isLoadingStudents?/*#__PURE__*/_jsx(Box,{sx:{display:\"flex\",justifyContent:\"center\",my:3},children:/*#__PURE__*/_jsx(CircularProgress,{})}):/*#__PURE__*/_jsx(Box,{sx:{maxHeight:400,overflow:\"auto\",mb:2},children:!selectedMainClass?/*#__PURE__*/_jsx(Alert,{severity:\"info\",children:\"Vui l\\xF2ng ch\\u1ECDn l\\u1EDBp ch\\xEDnh \\u0111\\u1EC3 xem danh s\\xE1ch sinh vi\\xEAn\"}):availableStudents.length===0?/*#__PURE__*/_jsx(Alert,{severity:\"warning\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y sinh vi\\xEAn c\\xF3 th\\u1EC3 th\\xEAm v\\xE0o l\\u1EDBp\"}):/*#__PURE__*/_jsx(List,{children:availableStudents.filter(student=>{var _student$full_name,_student$school_info5,_student$school_info6,_student$email;return((_student$full_name=student.full_name)===null||_student$full_name===void 0?void 0:_student$full_name.toLowerCase().includes(searchStudent.toLowerCase()))||((_student$school_info5=student.school_info)===null||_student$school_info5===void 0?void 0:(_student$school_info6=_student$school_info5.student_code)===null||_student$school_info6===void 0?void 0:_student$school_info6.toLowerCase().includes(searchStudent.toLowerCase()))||((_student$email=student.email)===null||_student$email===void 0?void 0:_student$email.toLowerCase().includes(searchStudent.toLowerCase()));}).map(student=>{var _student$school_info7;return/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsxs(ListItem,{children:[/*#__PURE__*/_jsx(ListItemText,{primary:student.full_name||student.name,secondary:/*#__PURE__*/_jsxs(_Fragment,{children:[((_student$school_info7=student.school_info)===null||_student$school_info7===void 0?void 0:_student$school_info7.student_code)||\"Chưa có mã SV\",\" \",\"- \",student.email]})}),/*#__PURE__*/_jsx(ListItemSecondaryAction,{children:/*#__PURE__*/_jsx(Checkbox,{edge:\"end\",checked:selectedStudents.includes(student._id),onChange:()=>handleSelectStudent(student._id)})})]}),/*#__PURE__*/_jsx(Divider,{})]},student._id);})})}),/*#__PURE__*/_jsx(Box,{sx:{textAlign:\"right\"},children:/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\"\\u0110\\xE3 ch\\u1ECDn: \",selectedStudents.length,\" sinh vi\\xEAn\"]})})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleCloseAddStudentDialog,children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleAddStudents,disabled:selectedStudents.length===0||isLoadingStudents,children:\"Th\\xEAm v\\xE0o l\\u1EDBp\"})]})]})]});};export default TeacherClassDetailPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\teacher\\\\AttendancePage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, lazy, Suspense, useCallback } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport { Box, Typography, Card, CardContent, Grid, Paper, Button, Divider, CircularProgress, List, ListItem, ListItemAvatar, ListItemText, Avatar, Chip, Dialog, DialogTitle, DialogContent, DialogActions, TextField, FormControl, InputLabel, Select, MenuItem, IconButton, Alert, AlertTitle, Tooltip, Stepper, Step, StepLabel, StepContent } from \"@mui/material\";\nimport { CameraAlt, Check, Close, Edit, Refresh, Save, VerifiedUser, HourglassEmpty, ArrowBack, Info, VideocamOff, PlayCircleOutline, StopCircleOutlined, Visibility, VisibilityOff } from \"@mui/icons-material\";\nimport { setModelLoaded as setFaceRecModelLoaded,\n// Rename to avoid conflict\nsetCameraReady as setFaceRecCameraReady,\n// Rename to avoid conflict\nsetDetectedFaces, setRecognizedStudents, clearRecognitionState, getClassFaceFeatures,\n// Correct thunk action name\nverifyAttendance, manualAttendance } from \"../../redux/slices/faceRecognitionSlice\"; // Fixed relative import path\n\n// Lazy load Webcam\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Webcam = /*#__PURE__*/lazy(_c = () => import(\"react-webcam\"));\n_c2 = Webcam;\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (faceapi.nets.tinyFaceDetector.isLoaded && faceapi.nets.faceLandmark68Net.isLoaded && faceapi.nets.faceRecognitionNet.isLoaded\n    // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null\n    });\n    await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\n      variant: \"success\"\n    });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = student => {\n  var _student$faceFeatures, _student$faceFeatures2;\n  if (!student || !((_student$faceFeatures = student.faceFeatures) !== null && _student$faceFeatures !== void 0 && _student$faceFeatures.descriptors) && !student.faceDescriptors) {\n    return [];\n  }\n  const descriptors = [];\n  const rawDescriptors = ((_student$faceFeatures2 = student.faceFeatures) === null || _student$faceFeatures2 === void 0 ? void 0 : _student$faceFeatures2.descriptors) || student.faceDescriptors || [];\n  const findDescriptors = data => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every(n => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n  findDescriptors(rawDescriptors);\n  return descriptors.filter(d => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  _s();\n  var _classInfo$students, _classInfo$students2, _selectedStudent$scho;\n  const {\n    classId,\n    sessionId\n  } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    note: \"\"\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const {\n    token\n  } = useSelector(state => state.auth);\n\n  // Access faceRecognition state directly\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents,\n    // Assuming slice holds the relevant class students\n    isProcessing,\n    error: faceRecError // Get error state\n  } = useSelector(state => state.faceRecognition);\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([axios.get(`${API_URL}/classes/teaching/${classId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        })]);\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Nếu phiên đã hoàn thành, không cần tải mô hình nhận dạng\n        const isSessionCompleted = (loadedSessionInfo === null || loadedSessionInfo === void 0 ? void 0 : loadedSessionInfo.status) === \"completed\";\n        if (isSessionCompleted) {\n          // Không cần tải mô hình và đặc trưng khuôn mặt nếu phiên đã hoàn thành\n          setIsLoading(false);\n          return;\n        }\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          // Capture the return value indicating success/failure\n          const modelsLoadedSuccessfully = await loadFaceRecognitionModels(dispatch, enqueueSnackbar);\n          // Check if model loading failed using the return value\n          if (!modelsLoadedSuccessfully) {\n            // Use the return value here\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n          // No need to check isModelLoaded from state again here\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if (!isSessionCompleted && isModelLoaded) {\n          await dispatch(getClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        var _error$response, _error$response$data;\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, {\n          variant: \"error\"\n        });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      var _webcamRef$current, _webcamRef$current$vi, _webcamRef$current$vi2;\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      (_webcamRef$current = webcamRef.current) === null || _webcamRef$current === void 0 ? void 0 : (_webcamRef$current$vi = _webcamRef$current.video) === null || _webcamRef$current$vi === void 0 ? void 0 : (_webcamRef$current$vi2 = _webcamRef$current$vi.srcObject) === null || _webcamRef$current$vi2 === void 0 ? void 0 : _webcamRef$current$vi2.getTracks().forEach(track => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(stream => {\n    console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n    dispatch(setFaceRecCameraReady(true));\n    setComponentError(null); // Clear camera errors\n  }, [dispatch]);\n  const handleUserMediaError = useCallback(error => {\n    console.error(\"Lỗi khi truy cập camera:\", error);\n    const errMsg = `Không thể truy cập camera: ${error.name === \"NotAllowedError\" ? \"Bạn chưa cấp quyền truy cập camera\" : error.name === \"NotFoundError\" ? \"Không tìm thấy thiết bị camera\" : error.message || \"Lỗi không xác định\"}`;\n    enqueueSnackbar(errMsg, {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecCameraReady(false));\n    setComponentError(errMsg);\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback((detections, recognizedData = []) => {\n    var _webcamRef$current2;\n    if (!canvasRef.current || !((_webcamRef$current2 = webcamRef.current) !== null && _webcamRef$current2 !== void 0 && _webcamRef$current2.video)) return;\n    const video = webcamRef.current.video;\n    const canvas = canvasRef.current;\n    const displaySize = {\n      width: video.videoWidth,\n      height: video.videoHeight\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n    const resizedDetections = faceapi.resizeResults(detections, displaySize);\n    const ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    resizedDetections.forEach((detection, i) => {\n      // Validate detection and box before drawing\n      if (!detection || !detection.detection || !detection.detection.box) {\n        console.warn(\"Skipping drawing for invalid detection object:\", detection);\n        return; // Skip this detection\n      }\n      const box = detection.detection.box;\n\n      // Further validate box properties\n      if (box.x == null || box.y == null || box.width == null || box.height == null || box.width <= 0 || box.height <= 0) {\n        console.warn(\"Skipping drawing for invalid box properties:\", box);\n        return; // Skip this detection\n      }\n      const landmarks = detection.landmarks;\n      const recognized = recognizedData.find(rec => rec.detectionIndex === i); // Match recognition result\n\n      // Draw box\n      const boxColor = recognized ? recognized.confidence > CONFIDENCE_THRESHOLD ? \"#4CAF50\" : \"#FFC107\" : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n      ctx.strokeStyle = boxColor;\n      ctx.lineWidth = 2;\n      ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n      // Draw label background\n      const label = recognized ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)` : \"Đang nhận diện...\";\n      const textWidth = ctx.measureText(label).width;\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n      ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n      // Draw label text\n      ctx.fillStyle = \"#FFFFFF\";\n      ctx.font = \"14px Arial\";\n      ctx.fillText(label, box.x + 5, box.y - 5);\n\n      // Draw landmarks if enabled\n      if (showLandmarks && landmarks) {\n        faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n      }\n    });\n  }, [showLandmarks]); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(async (recognize = true) => {\n    var _webcamRef$current3;\n    if (!isCameraReady || !((_webcamRef$current3 = webcamRef.current) !== null && _webcamRef$current3 !== void 0 && _webcamRef$current3.video) || webcamRef.current.video.readyState !== 4 || !isModelLoaded) {\n      return null; // Return null if detection can't proceed\n    }\n    const video = webcamRef.current.video;\n    try {\n      let faceData;\n      if (recognize) {\n        // Detect faces, landmarks, and descriptors for recognition\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks().withFaceDescriptors();\n      } else {\n        // Only detect faces and landmarks (for drawing)\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks();\n      }\n      dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n      if (!faceData || faceData.length === 0) {\n        // Clear canvas if no faces detected\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        }\n        dispatch(setRecognizedStudents([])); // Clear recognized students\n        return null;\n      }\n\n      // --- Recognition Logic (if recognize === true) ---\n      let recognizedData = [];\n      if (recognize && classStudents && classStudents.length > 0) {\n        const labeledDescriptors = classStudents.map(student => {\n          const descriptors = extractStudentDescriptors(student);\n          if (descriptors.length > 0) {\n            return new faceapi.LabeledFaceDescriptors(student._id, descriptors); // Use student ID as label\n          }\n          return null;\n        }).filter(ld => ld !== null); // Filter out students with no descriptors\n\n        if (labeledDescriptors.length > 0) {\n          const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, RECOGNITION_THRESHOLD);\n          recognizedData = faceData.map((fd, index) => {\n            const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n            const student = classStudents.find(s => s._id === bestMatch.label); // Find student by ID label\n            return {\n              detectionIndex: index,\n              // Link recognition to detection\n              studentId: student === null || student === void 0 ? void 0 : student._id,\n              name: (student === null || student === void 0 ? void 0 : student.full_name) || \"Không rõ\",\n              confidence: 1 - bestMatch.distance,\n              // Convert distance to confidence-like score\n              isUnknown: bestMatch.label === \"unknown\"\n            };\n          }).filter(r => !r.isUnknown); // Filter out unknown matches\n\n          dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n        } else {\n          dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n        }\n      }\n\n      // Draw landmarks and boxes with recognition info\n      drawLandmarks(faceData, recognizedData);\n      return {\n        detections: faceData,\n        recognized: recognizedData\n      }; // Return both detection and recognition results\n    } catch (error) {\n      console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n      enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n        variant: \"error\"\n      });\n      // Clear canvas on error\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n      dispatch(setDetectedFaces([]));\n      dispatch(setRecognizedStudents([]));\n      return null;\n    }\n  }, [isCameraReady, isModelLoaded, classStudents, drawLandmarks, dispatch, enqueueSnackbar]);\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort((a, b) => b.confidence - a.confidence)[0];\n      enqueueSnackbar(`Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(1)}%)`, {\n        variant: \"info\"\n      });\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence >= CONFIDENCE_THRESHOLD) {\n        var _result$detections$to;\n        // Find the corresponding descriptor\n        const descriptor = (_result$detections$to = result.detections[topMatch.detectionIndex]) === null || _result$detections$to === void 0 ? void 0 : _result$detections$to.descriptor;\n        if (descriptor) {\n          handleMarkAttendance(topMatch.studentId, topMatch.confidence, descriptor);\n        } else {\n          console.warn(\"Không tìm thấy descriptor cho top match\", topMatch);\n          enqueueSnackbar(\"Lỗi: Không thể lấy đặc trưng khuôn mặt để điểm danh.\", {\n            variant: \"warning\"\n          });\n        }\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\", {\n        variant: \"warning\"\n      });\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", {\n        variant: \"warning\"\n      });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = student => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({\n      note: \"\"\n    }); // Chỉ cần reset note\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change (chỉ còn note)\n  const handleManualAttendanceChange = e => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n    try {\n      // Chỉ gửi sessionId, studentId và note\n      const result = await dispatch(manualAttendance({\n        sessionId,\n        studentId: selectedStudent._id,\n        // status: manualAttendanceData.status, // Bỏ status\n        note: manualAttendanceData.note\n      })).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id;\n          return ((_log$student_id = log.student_id) === null || _log$student_id === void 0 ? void 0 : _log$student_id._id) === selectedStudent._id;\n        });\n        // Đảm bảo log mới có status là 'present'\n        const newLogData = {\n          ...result.data,\n          status: \"present\",\n          student_id: selectedStudent\n        };\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLogData;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLogData];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh thủ công (Có mặt) cho ${selectedStudent.full_name}`, {\n        variant: \"success\"\n      });\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(async (studentId, confidence, faceDescriptor) => {\n    if (!studentId || isProcessing) return;\n\n    // Check if student already marked present\n    const isAlreadyPresent = attendanceLogs.some(log => {\n      var _log$student_id2;\n      return ((_log$student_id2 = log.student_id) === null || _log$student_id2 === void 0 ? void 0 : _log$student_id2._id) === studentId && log.status === \"present\";\n    });\n    if (isAlreadyPresent) {\n      // console.log(`Student ${studentId} already marked present.`);\n      return; // Don't mark again if already present\n    }\n    const student = classStudents.find(s => s._id === studentId);\n    if (!student) {\n      console.warn(\"Student not found for marking attendance:\", studentId);\n      return;\n    }\n\n    // Capture image for proof (optional, but good practice)\n    let imageBase64 = null;\n    try {\n      if (webcamRef.current) {\n        imageBase64 = webcamRef.current.getScreenshot({\n          width: 320,\n          height: 240\n        }); // Smaller screenshot\n      }\n    } catch (screenshotError) {\n      console.error(\"Error taking screenshot:\", screenshotError);\n      // Proceed without image if screenshot fails\n    }\n    try {\n      const result = await dispatch(verifyAttendance({\n        sessionId,\n        studentId,\n        faceDescriptor,\n        // Pass the received descriptor\n        confidence,\n        imageBase64,\n        recognized: true // Mark as recognized by the system\n      })).unwrap();\n\n      // Update local attendance logs\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id3;\n          return ((_log$student_id3 = log.student_id) === null || _log$student_id3 === void 0 ? void 0 : _log$student_id3._id) === studentId;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: student\n        }; // Use the found student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n        variant: \"success\"\n      });\n    } catch (error) {\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  }, [dispatch, sessionId, classStudents, attendanceLogs, isProcessing, enqueueSnackbar]); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (!isCameraReady || !isModelLoaded || !classStudents || classStudents.length === 0) {\n      enqueueSnackbar(\"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\", {\n        variant: \"warning\"\n      });\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach(rec => {\n          // Check if confidence meets or exceeds the threshold\n          if (rec.confidence >= CONFIDENCE_THRESHOLD && rec.studentId) {\n            var _result$detections$re;\n            // Find the corresponding descriptor\n            const descriptor = (_result$detections$re = result.detections[rec.detectionIndex]) === null || _result$detections$re === void 0 ? void 0 : _result$detections$re.descriptor;\n            if (descriptor) {\n              handleMarkAttendance(rec.studentId, rec.confidence, descriptor); // Attempt to mark attendance\n            } else {\n              console.warn(\"Không tìm thấy descriptor cho recognized student trong auto mode\", rec);\n            }\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [isCameraReady, isModelLoaded, classStudents, detectAndRecognizeFaces, handleMarkAttendance, enqueueSnackbar]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      // Lấy danh sách sinh viên vắng mặt từ UI\n      const absentStudentIds = absentStudents.map(student => student._id);\n      enqueueSnackbar(\"Đang kết thúc phiên...\", {\n        variant: \"info\"\n      });\n      await axios.put(`${API_URL}/attendance/sessions/${sessionId}`, {\n        status: \"completed\",\n        students_absent: absentStudentIds\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", {\n        variant: \"success\"\n      });\n      setSessionInfo(prev => ({\n        ...prev,\n        status: \"completed\"\n      }));\n      stopAutoAttendance();\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || \"Lỗi khi kết thúc phiên\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", {\n        variant: \"info\"\n      });\n      const [logsRes, sessionRes] = await Promise.all([axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      })]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", {\n        variant: \"success\"\n      });\n    } catch (error) {\n      var _error$response3, _error$response3$data;\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || \"Lỗi khi làm mới dữ liệu\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const toggleLandmarks = () => {\n    setShowLandmarks(prev => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(log => log.status === \"present\");\n  const absentStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students = classInfo.students) === null || _classInfo$students === void 0 ? void 0 : _classInfo$students.filter(student => !attendanceLogs.some(log => {\n    var _log$student_id4;\n    return ((_log$student_id4 = log.student_id) === null || _log$student_id4 === void 0 ? void 0 : _log$student_id4._id) === student._id && (log.status === \"present\" || log.status === \"late\");\n  }) // Consider late as not absent\n  )) || [];\n  const totalStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students2 = classInfo.students) === null || _classInfo$students2 === void 0 ? void 0 : _classInfo$students2.length) || 0;\n  const sessionCompleted = (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      minHeight: \"80vh\",\n      children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 894,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        sx: {\n          ml: 2\n        },\n        children: \"\\u0110ang t\\u1EA3i d\\u1EEF li\\u1EC7u \\u0111i\\u1EC3m danh...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 895,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 888,\n      columnNumber: 7\n    }, this);\n  }\n  if (componentError && !isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 3\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        action: /*#__PURE__*/_jsxDEV(Button, {\n          color: \"inherit\",\n          size: \"small\",\n          onClick: () => window.location.reload(),\n          children: \"T\\u1EA3i l\\u1EA1i trang\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 906,\n          columnNumber: 13\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(AlertTitle, {\n          children: \"\\u0110\\xE3 x\\u1EA3y ra l\\u1ED7i\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 915,\n          columnNumber: 11\n        }, this), componentError]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 903,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 902,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      p: {\n        xs: 1,\n        sm: 2,\n        md: 3\n      }\n    },\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      mb: 2.5,\n      pb: 2,\n      borderBottom: \"1px solid #eaeaea\",\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          fontWeight: 500,\n          children: [\"\\u0110i\\u1EC3m Danh - \", classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 934,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          color: \"textSecondary\",\n          children: [\"Bu\\u1ED5i \", sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.session_number, \" -\", \" \", sessionInfo !== null && sessionInfo !== void 0 && sessionInfo.date ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\") : \"N/A\", /*#__PURE__*/_jsxDEV(Chip, {\n            label: (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) || \"N/A\",\n            color: sessionCompleted ? \"default\" : \"success\",\n            size: \"small\",\n            sx: {\n              ml: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 942,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 937,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 933,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        startIcon: /*#__PURE__*/_jsxDEV(ArrowBack, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 952,\n          columnNumber: 22\n        }, this),\n        onClick: () => navigate(`/teacher/classes/${classId}`),\n        children: \"Quay l\\u1EA1i l\\u1EDBp\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 950,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 925,\n      columnNumber: 7\n    }, this), sessionCompleted && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      sx: {\n        mb: 2\n      },\n      children: \"Phi\\xEAn \\u0111i\\u1EC3m danh n\\xE0y \\u0111\\xE3 k\\u1EBFt th\\xFAc. B\\u1EA1n ch\\u1EC9 c\\xF3 th\\u1EC3 xem l\\u1EA1i k\\u1EBFt qu\\u1EA3.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 960,\n      columnNumber: 9\n    }, this), faceRecError && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"warning\",\n      sx: {\n        mb: 2\n      },\n      children: [\"L\\u1ED7i t\\u1EEB h\\u1EC7 th\\u1ED1ng nh\\u1EADn di\\u1EC7n: \", faceRecError]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 966,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 3,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 8,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3,\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(CardContent, {\n            sx: {\n              bgcolor: \"#f8f9fa\",\n              borderBottom: \"1px solid #eaeaea\",\n              p: 2\n            },\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 500,\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(CameraAlt, {\n                  sx: {\n                    mr: 1,\n                    color: \"primary.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 993,\n                  columnNumber: 19\n                }, this), \" Camera\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 987,\n                columnNumber: 17\n              }, this), !sessionCompleted && isModelLoaded &&\n              /*#__PURE__*/\n              // Show controls only if session active and model loaded\n              _jsxDEV(Box, {\n                children: [/*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: isAutoMode ? \"Dừng chế độ tự động\" : \"Bắt đầu chế độ tự động\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: isAutoMode ? stopAutoAttendance : startAutoAttendance,\n                    color: isAutoMode ? \"error\" : \"primary\",\n                    disabled: !isCameraReady,\n                    children: isAutoMode ? /*#__PURE__*/_jsxDEV(StopCircleOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1015,\n                      columnNumber: 29\n                    }, this) : /*#__PURE__*/_jsxDEV(PlayCircleOutline, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1017,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1005,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 998,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: toggleLandmarks,\n                    color: \"secondary\",\n                    disabled: !isCameraReady || isAutoMode,\n                    children: showLandmarks ? /*#__PURE__*/_jsxDEV(VisibilityOff, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1029,\n                      columnNumber: 44\n                    }, this) : /*#__PURE__*/_jsxDEV(Visibility, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1029,\n                      columnNumber: 64\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1024,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1021,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 997,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 982,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 975,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              position: \"relative\",\n              width: \"100%\",\n              aspectRatio: \"640 / 480\",\n              backgroundColor: \"#000\",\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\"\n            },\n            children: [sessionCompleted ? /*#__PURE__*/_jsxDEV(Box, {\n              textAlign: \"center\",\n              color: \"white\",\n              p: 4,\n              children: [/*#__PURE__*/_jsxDEV(Info, {\n                sx: {\n                  fontSize: 60,\n                  mb: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1051,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Phi\\xEAn \\u0111i\\u1EC3m danh \\u0111\\xE3 k\\u1EBFt th\\xFAc\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1052,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                mt: 1,\n                children: \"B\\u1EA1n c\\xF3 th\\u1EC3 xem k\\u1EBFt qu\\u1EA3 \\u0111i\\u1EC3m danh \\u1EDF danh s\\xE1ch b\\xEAn ph\\u1EA3i\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1055,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1050,\n              columnNumber: 17\n            }, this) : !isModelLoaded ? /*#__PURE__*/_jsxDEV(Box, {\n              textAlign: \"center\",\n              color: \"white\",\n              children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1061,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                children: \"\\u0110ang t\\u1EA3i m\\xF4 h\\xECnh nh\\u1EADn di\\u1EC7n...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1062,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1060,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Suspense, {\n              fallback: /*#__PURE__*/_jsxDEV(Box, {\n                textAlign: \"center\",\n                color: \"white\",\n                children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                  color: \"inherit\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1068,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  children: \"\\u0110ang kh\\u1EDFi t\\u1EA1o camera...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1069,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1067,\n                columnNumber: 21\n              }, this),\n              children: /*#__PURE__*/_jsxDEV(Webcam, {\n                audio: false,\n                ref: webcamRef,\n                screenshotFormat: \"image/jpeg\",\n                width: \"100%\",\n                height: \"100%\",\n                videoConstraints: {\n                  width: 640,\n                  height: 480,\n                  facingMode: \"user\"\n                },\n                style: {\n                  display: \"block\",\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\"\n                },\n                onUserMedia: handleUserMedia,\n                onUserMediaError: handleUserMediaError\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1073,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1065,\n              columnNumber: 17\n            }, this), !sessionCompleted && /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              style: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                zIndex: 10\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1101,\n              columnNumber: 17\n            }, this), (!isCameraReady || (componentError === null || componentError === void 0 ? void 0 : componentError.includes(\"camera\"))) && !sessionCompleted && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                backgroundColor: \"rgba(0,0,0,0.7)\",\n                display: \"flex\",\n                flexDirection: \"column\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                color: \"white\",\n                zIndex: 20\n              },\n              children: [/*#__PURE__*/_jsxDEV(VideocamOff, {\n                sx: {\n                  fontSize: 60,\n                  mb: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1133,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Camera kh\\xF4ng kh\\u1EA3 d\\u1EE5ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1134,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mt: 1,\n                  px: 2,\n                  textAlign: \"center\"\n                },\n                children: componentError || \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1135,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                color: \"inherit\",\n                sx: {\n                  mt: 2\n                },\n                onClick: () => window.location.reload(),\n                children: \"Th\\u1EED l\\u1EA1i\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1142,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1117,\n              columnNumber: 19\n            }, this), isAutoMode && isCameraReady && /*#__PURE__*/_jsxDEV(Chip, {\n              label: \"\\u0110ang t\\u1EF1 \\u0111\\u1ED9ng \\u0111i\\u1EC3m danh\",\n              color: \"success\",\n              size: \"small\",\n              sx: {\n                position: \"absolute\",\n                bottom: 10,\n                right: 10,\n                zIndex: 15\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1154,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1038,\n            columnNumber: 13\n          }, this), !sessionCompleted && isCameraReady && isModelLoaded && /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            p: 2,\n            bgcolor: \"#f8f9fa\",\n            borderTop: \"1px solid #eaeaea\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              onClick: handleManualCapture,\n              startIcon: isProcessing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1182,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1184,\n                columnNumber: 23\n              }, this),\n              disabled: isProcessing || isAutoMode,\n              children: \"Ch\\u1EE5p & Nh\\u1EADn di\\u1EC7n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1177,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"secondary\",\n              onClick: completeSession,\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1195,\n                columnNumber: 30\n              }, this),\n              disabled: isProcessing,\n              children: \"K\\u1EBFt th\\xFAc phi\\xEAn\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1191,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1170,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 974,\n          columnNumber: 11\n        }, this), recognizedStudents.length > 0 && !isAutoMode && /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mt: 2,\n            borderRadius: \"10px\",\n            boxShadow: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              fontWeight: \"500\",\n              mb: 1,\n              children: \"\\u0110\\xE3 nh\\u1EADn di\\u1EC7n g\\u1EA7n \\u0111\\xE2y\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1208,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacing: 1,\n              children: recognizedStudents.slice(0, 4).map((rec, index // Show max 4\n              ) => /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 6,\n                sm: 3,\n                children: /*#__PURE__*/_jsxDEV(Paper, {\n                  elevation: 0,\n                  sx: {\n                    p: 1,\n                    textAlign: \"center\",\n                    border: \"1px solid #eee\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"caption\",\n                    display: \"block\",\n                    noWrap: true,\n                    children: rec.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1231,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Chip, {\n                    label: `${(rec.confidence * 100).toFixed(0)}%`,\n                    size: \"small\",\n                    color: rec.confidence > CONFIDENCE_THRESHOLD ? \"success\" : \"warning\",\n                    sx: {\n                      mt: 0.5\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1234,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1223,\n                  columnNumber: 25\n                }, this)\n              }, `${rec.studentId}-${index}`, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1217,\n                columnNumber: 23\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1211,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1207,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1206,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 973,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 4,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mb: 3,\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(Check, {\n                  sx: {\n                    mr: 1,\n                    color: \"success.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1266,\n                  columnNumber: 19\n                }, this), \" C\\xF3 m\\u1EB7t (\", presentStudents.length, \"/\", totalStudents, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1265,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                title: \"L\\xE0m m\\u1EDBi danh s\\xE1ch\",\n                children: /*#__PURE__*/_jsxDEV(IconButton, {\n                  size: \"small\",\n                  onClick: refreshAttendanceLogs,\n                  disabled: isProcessing,\n                  children: /*#__PURE__*/_jsxDEV(Refresh, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1275,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1270,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1269,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1259,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1279,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: presentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                align: \"center\",\n                sx: {\n                  py: 2\n                },\n                children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 c\\xF3 m\\u1EB7t.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1282,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(List, {\n                dense: true,\n                children: presentStudents.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)) // Sort by time desc\n                .map(log => {\n                  var _log$student_id5;\n                  return (\n                    /*#__PURE__*/\n                    // Simplified ListItem for debugging\n                    _jsxDEV(ListItem, {\n                      children: /*#__PURE__*/_jsxDEV(ListItemText, {\n                        primary: ((_log$student_id5 = log.student_id) === null || _log$student_id5 === void 0 ? void 0 : _log$student_id5.full_name) || `Log ID: ${log._id} (Tên bị thiếu)`,\n                        secondary: `Trạng thái: ${log.status} - ${new Date(log.timestamp).toLocaleTimeString(\"vi-VN\")}`\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1299,\n                        columnNumber: 27\n                      }, this)\n                    }, log._id, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1298,\n                      columnNumber: 25\n                    }, this)\n                  );\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1291,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1280,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1258,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1257,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h6\",\n              display: \"flex\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Close, {\n                sx: {\n                  mr: 1,\n                  color: \"error.main\"\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1325,\n                columnNumber: 17\n              }, this), \" V\\u1EAFng m\\u1EB7t (\", absentStudents.length, \"/\", totalStudents, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1319,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1328,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: absentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                align: \"center\",\n                sx: {\n                  py: 2\n                },\n                children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 c\\xF3 m\\u1EB7t.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1331,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(List, {\n                dense: true,\n                children: absentStudents.map(student =>\n                /*#__PURE__*/\n                // Keep absent list detailed for now\n                _jsxDEV(ListItem, {\n                  disablePadding: true,\n                  sx: {\n                    mb: 0.5\n                  },\n                  secondaryAction: !sessionCompleted ? /*#__PURE__*/_jsxDEV(Tooltip, {\n                    title: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\",\n                    children: /*#__PURE__*/_jsxDEV(IconButton, {\n                      edge: \"end\",\n                      size: \"small\",\n                      onClick: () => openManualAttendanceDialog(student),\n                      disabled: isProcessing,\n                      children: /*#__PURE__*/_jsxDEV(Edit, {\n                        fontSize: \"small\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1358,\n                        columnNumber: 33\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1350,\n                      columnNumber: 31\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1349,\n                    columnNumber: 29\n                  }, this) : null,\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    variant: \"outlined\",\n                    sx: {\n                      width: \"100%\",\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      p: 0.5,\n                      borderRadius: \"4px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                      sx: {\n                        minWidth: 45\n                      },\n                      children: /*#__PURE__*/_jsxDEV(Avatar, {\n                        alt: student.full_name,\n                        src: student.avatar_url,\n                        sx: {\n                          width: 32,\n                          height: 32\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1375,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1374,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                      primary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"body2\",\n                        noWrap: true,\n                        children: student.full_name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1383,\n                        columnNumber: 31\n                      }, this),\n                      secondary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"caption\",\n                        color: \"text.secondary\",\n                        children: student.student_id\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1388,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1381,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1364,\n                    columnNumber: 25\n                  }, this)\n                }, student._id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1343,\n                  columnNumber: 23\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1340,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1329,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1318,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1317,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1255,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 971,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: manualDialogOpen,\n      onClose: handleManualDialogClose,\n      maxWidth: \"xs\",\n      fullWidth: true,\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng (Ghi nh\\u1EADn C\\xF3 m\\u1EB7t)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1414,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [selectedStudent && /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          alignItems: \"center\",\n          mb: 2,\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            src: selectedStudent.avatar_url,\n            alt: selectedStudent.full_name,\n            sx: {\n              width: 48,\n              height: 48,\n              mr: 2\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1418,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              children: selectedStudent.full_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1424,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              color: \"text.secondary\",\n              children: [\"MSSV: \", ((_selectedStudent$scho = selectedStudent.school_info) === null || _selectedStudent$scho === void 0 ? void 0 : _selectedStudent$scho.student_id) || \"N/A\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1427,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1423,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1417,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(TextField, {\n          fullWidth: true,\n          margin: \"normal\",\n          name: \"note\",\n          label: \"Ghi ch\\xFA (t\\xF9y ch\\u1ECDn)\",\n          value: manualAttendanceData.note,\n          onChange: handleManualAttendanceChange,\n          multiline: true,\n          rows: 2,\n          placeholder: \"Nh\\u1EADp l\\xFD do \\u0111i\\u1EC3m danh th\\u1EE7 c\\xF4ng (n\\u1EBFu c\\xF3)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1433,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1415,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualDialogClose,\n          children: \"H\\u1EE7y\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1446,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualAttendanceSubmit,\n          variant: \"contained\",\n          color: \"primary\",\n          disabled: isProcessing,\n          children: \"X\\xE1c nh\\u1EADn C\\xF3 m\\u1EB7t\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1447,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1445,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1408,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 923,\n    columnNumber: 5\n  }, this);\n};\n_s(AttendancePage, \"5OScZVeZDjUdFmMShCz3CZwmYbI=\", false, function () {\n  return [useParams, useNavigate, useDispatch, useSnackbar, useSelector, useSelector];\n});\n_c3 = AttendancePage;\nexport default AttendancePage;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"Webcam$lazy\");\n$RefreshReg$(_c2, \"Webcam\");\n$RefreshReg$(_c3, \"AttendancePage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","lazy","Suspense","useCallback","useParams","useNavigate","useDispatch","useSelector","useSnackbar","axios","faceapi","Box","Typography","Card","CardContent","Grid","Paper","Button","Divider","CircularProgress","List","ListItem","ListItemAvatar","ListItemText","Avatar","Chip","Dialog","DialogTitle","DialogContent","DialogActions","TextField","FormControl","InputLabel","Select","MenuItem","IconButton","Alert","AlertTitle","Tooltip","Stepper","Step","StepLabel","StepContent","CameraAlt","Check","Close","Edit","Refresh","Save","VerifiedUser","HourglassEmpty","ArrowBack","Info","VideocamOff","PlayCircleOutline","StopCircleOutlined","Visibility","VisibilityOff","setModelLoaded","setFaceRecModelLoaded","setCameraReady","setFaceRecCameraReady","setDetectedFaces","setRecognizedStudents","clearRecognitionState","getClassFaceFeatures","verifyAttendance","manualAttendance","jsxDEV","_jsxDEV","Webcam","_c","_c2","API_URL","process","env","REACT_APP_API_URL","RECOGNITION_THRESHOLD","DETECTION_THRESHOLD","CONFIDENCE_THRESHOLD","AUTO_DETECT_INTERVAL","FACE_DETECTION_OPTIONS","TinyFaceDetectorOptions","scoreThreshold","inputSize","MODEL_URL","loadFaceRecognitionModels","dispatch","enqueueSnackbar","nets","tinyFaceDetector","isLoaded","faceLandmark68Net","faceRecognitionNet","variant","autoHideDuration","Promise","all","loadFromUri","error","console","extractStudentDescriptors","student","_student$faceFeatures","_student$faceFeatures2","faceFeatures","descriptors","faceDescriptors","rawDescriptors","findDescriptors","data","Array","isArray","length","every","n","push","Float32Array","forEach","Object","values","filter","d","AttendancePage","_s","_classInfo$students","_classInfo$students2","_selectedStudent$scho","classId","sessionId","navigate","webcamRef","canvasRef","autoModeIntervalRef","landmarkIntervalRef","isLoading","setIsLoading","classInfo","setClassInfo","sessionInfo","setSessionInfo","attendanceLogs","setAttendanceLogs","isAutoMode","setIsAutoMode","showLandmarks","setShowLandmarks","manualDialogOpen","setManualDialogOpen","selectedStudent","setSelectedStudent","manualAttendanceData","setManualAttendanceData","note","componentError","setComponentError","token","state","auth","isModelLoaded","isCameraReady","detectedFaces","recognizedStudents","classStudents","isProcessing","faceRecError","faceRecognition","loadData","classRes","sessionRes","logsRes","get","headers","Authorization","loadedSessionInfo","isSessionCompleted","status","modelsLoadedSuccessfully","Error","unwrap","_error$response","_error$response$data","errMsg","response","message","_webcamRef$current","_webcamRef$current$vi","_webcamRef$current$vi2","clearInterval","current","video","srcObject","getTracks","track","stop","startLandmarkDetection","stopLandmarkDetection","ctx","getContext","clearRect","width","height","handleUserMedia","stream","log","id","handleUserMediaError","name","drawLandmarks","detections","recognizedData","_webcamRef$current2","canvas","displaySize","videoWidth","videoHeight","matchDimensions","resizedDetections","resizeResults","detection","i","box","warn","x","y","landmarks","recognized","find","rec","detectionIndex","boxColor","confidence","strokeStyle","lineWidth","strokeRect","label","toFixed","textWidth","measureText","fillStyle","fillRect","font","fillText","draw","drawFaceLandmarks","detectAndRecognizeFaces","recognize","_webcamRef$current3","readyState","faceData","detectAllFaces","withFaceLandmarks","withFaceDescriptors","labeledDescriptors","map","LabeledFaceDescriptors","_id","ld","faceMatcher","FaceMatcher","fd","index","bestMatch","findBestMatch","descriptor","s","studentId","full_name","distance","isUnknown","r","handleManualCapture","result","topMatch","sort","a","b","_result$detections$to","handleMarkAttendance","openManualAttendanceDialog","handleManualDialogClose","handleManualAttendanceChange","e","target","value","handleManualAttendanceSubmit","prevLogs","existingLogIndex","findIndex","_log$student_id","student_id","newLogData","updatedLogs","faceDescriptor","isAlreadyPresent","some","_log$student_id2","imageBase64","getScreenshot","screenshotError","_log$student_id3","newLog","startAutoAttendance","stopAutoAttendance","setInterval","_result$detections$re","completeSession","absentStudentIds","absentStudents","put","students_absent","prev","_error$response2","_error$response2$data","refreshAttendanceLogs","_error$response3","_error$response3$data","toggleLandmarks","presentStudents","students","_log$student_id4","totalStudents","sessionCompleted","display","justifyContent","alignItems","minHeight","children","fileName","_jsxFileName","lineNumber","columnNumber","sx","ml","p","severity","action","color","size","onClick","window","location","reload","xs","sm","md","mb","pb","borderBottom","fontWeight","class_name","session_number","date","Date","toLocaleDateString","startIcon","container","spacing","item","borderRadius","boxShadow","overflow","bgcolor","mr","title","disabled","position","aspectRatio","backgroundColor","textAlign","fontSize","mt","fallback","audio","ref","screenshotFormat","videoConstraints","facingMode","style","top","left","objectFit","onUserMedia","onUserMediaError","zIndex","includes","flexDirection","px","bottom","right","borderTop","slice","elevation","border","noWrap","maxHeight","pr","align","py","dense","timestamp","_log$student_id5","primary","secondary","toLocaleTimeString","disablePadding","secondaryAction","edge","minWidth","alt","src","avatar_url","open","onClose","maxWidth","fullWidth","school_info","margin","onChange","multiline","rows","placeholder","_c3","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/teacher/AttendancePage.js"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useRef,\n  lazy,\n  Suspense,\n  useCallback,\n} from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport {\n  Box,\n  Typography,\n  Card,\n  CardContent,\n  Grid,\n  Paper,\n  Button,\n  Divider,\n  CircularProgress,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Avatar,\n  Chip,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  IconButton,\n  Alert,\n  AlertTitle,\n  Tooltip,\n  Stepper,\n  Step,\n  StepLabel,\n  StepContent,\n} from \"@mui/material\";\nimport {\n  CameraAlt,\n  Check,\n  Close,\n  Edit,\n  Refresh,\n  Save,\n  VerifiedUser,\n  HourglassEmpty,\n  ArrowBack,\n  Info,\n  VideocamOff,\n  PlayCircleOutline,\n  StopCircleOutlined,\n  Visibility,\n  VisibilityOff,\n} from \"@mui/icons-material\";\nimport {\n  setModelLoaded as setFaceRecModelLoaded, // Rename to avoid conflict\n  setCameraReady as setFaceRecCameraReady, // Rename to avoid conflict\n  setDetectedFaces,\n  setRecognizedStudents,\n  clearRecognitionState,\n  getClassFaceFeatures, // Correct thunk action name\n  verifyAttendance,\n  manualAttendance,\n} from \"../../redux/slices/faceRecognitionSlice\"; // Fixed relative import path\n\n// Lazy load Webcam\nconst Webcam = lazy(() => import(\"react-webcam\"));\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320,\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (\n      faceapi.nets.tinyFaceDetector.isLoaded &&\n      faceapi.nets.faceLandmark68Net.isLoaded &&\n      faceapi.nets.faceRecognitionNet.isLoaded\n      // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null,\n    });\n    await Promise.all([\n      faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\n      faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\n      faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\n    ]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", { variant: \"success\" });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", { variant: \"error\" });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = (student) => {\n  if (\n    !student ||\n    (!student.faceFeatures?.descriptors && !student.faceDescriptors)\n  ) {\n    return [];\n  }\n\n  const descriptors = [];\n  const rawDescriptors =\n    student.faceFeatures?.descriptors || student.faceDescriptors || [];\n\n  const findDescriptors = (data) => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every((n) => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n\n  findDescriptors(rawDescriptors);\n  return descriptors.filter((d) => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  const { classId, sessionId } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    note: \"\",\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const { token } = useSelector((state) => state.auth);\n\n  // Access faceRecognition state directly\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents, // Assuming slice holds the relevant class students\n    isProcessing,\n    error: faceRecError, // Get error state\n  } = useSelector((state) => state.faceRecognition);\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([\n          axios.get(`${API_URL}/classes/teaching/${classId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n        ]);\n\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Nếu phiên đã hoàn thành, không cần tải mô hình nhận dạng\n        const isSessionCompleted = loadedSessionInfo?.status === \"completed\";\n\n        if (isSessionCompleted) {\n          // Không cần tải mô hình và đặc trưng khuôn mặt nếu phiên đã hoàn thành\n          setIsLoading(false);\n          return;\n        }\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          // Capture the return value indicating success/failure\n          const modelsLoadedSuccessfully = await loadFaceRecognitionModels(\n            dispatch,\n            enqueueSnackbar\n          );\n          // Check if model loading failed using the return value\n          if (!modelsLoadedSuccessfully) {\n            // Use the return value here\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n          // No need to check isModelLoaded from state again here\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if (!isSessionCompleted && isModelLoaded) {\n          await dispatch(getClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg =\n          error.response?.data?.message ||\n          error.message ||\n          \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, { variant: \"error\" });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      webcamRef.current?.video?.srcObject\n        ?.getTracks()\n        .forEach((track) => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(\n    (stream) => {\n      console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n      dispatch(setFaceRecCameraReady(true));\n      setComponentError(null); // Clear camera errors\n    },\n    [dispatch]\n  );\n\n  const handleUserMediaError = useCallback(\n    (error) => {\n      console.error(\"Lỗi khi truy cập camera:\", error);\n      const errMsg = `Không thể truy cập camera: ${\n        error.name === \"NotAllowedError\"\n          ? \"Bạn chưa cấp quyền truy cập camera\"\n          : error.name === \"NotFoundError\"\n          ? \"Không tìm thấy thiết bị camera\"\n          : error.message || \"Lỗi không xác định\"\n      }`;\n      enqueueSnackbar(errMsg, { variant: \"error\" });\n      dispatch(setFaceRecCameraReady(false));\n      setComponentError(errMsg);\n    },\n    [dispatch, enqueueSnackbar]\n  );\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback(\n    (detections, recognizedData = []) => {\n      if (!canvasRef.current || !webcamRef.current?.video) return;\n\n      const video = webcamRef.current.video;\n      const canvas = canvasRef.current;\n      const displaySize = {\n        width: video.videoWidth,\n        height: video.videoHeight,\n      };\n      faceapi.matchDimensions(canvas, displaySize);\n\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      resizedDetections.forEach((detection, i) => {\n        // Validate detection and box before drawing\n        if (!detection || !detection.detection || !detection.detection.box) {\n          console.warn(\n            \"Skipping drawing for invalid detection object:\",\n            detection\n          );\n          return; // Skip this detection\n        }\n\n        const box = detection.detection.box;\n\n        // Further validate box properties\n        if (\n          box.x == null ||\n          box.y == null ||\n          box.width == null ||\n          box.height == null ||\n          box.width <= 0 ||\n          box.height <= 0\n        ) {\n          console.warn(\"Skipping drawing for invalid box properties:\", box);\n          return; // Skip this detection\n        }\n\n        const landmarks = detection.landmarks;\n        const recognized = recognizedData.find(\n          (rec) => rec.detectionIndex === i\n        ); // Match recognition result\n\n        // Draw box\n        const boxColor = recognized\n          ? recognized.confidence > CONFIDENCE_THRESHOLD\n            ? \"#4CAF50\"\n            : \"#FFC107\"\n          : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n        ctx.strokeStyle = boxColor;\n        ctx.lineWidth = 2;\n        ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n        // Draw label background\n        const label = recognized\n          ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)`\n          : \"Đang nhận diện...\";\n        const textWidth = ctx.measureText(label).width;\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n        ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n        // Draw label text\n        ctx.fillStyle = \"#FFFFFF\";\n        ctx.font = \"14px Arial\";\n        ctx.fillText(label, box.x + 5, box.y - 5);\n\n        // Draw landmarks if enabled\n        if (showLandmarks && landmarks) {\n          faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n        }\n      });\n    },\n    [showLandmarks]\n  ); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(\n    async (recognize = true) => {\n      if (\n        !isCameraReady ||\n        !webcamRef.current?.video ||\n        webcamRef.current.video.readyState !== 4 ||\n        !isModelLoaded\n      ) {\n        return null; // Return null if detection can't proceed\n      }\n\n      const video = webcamRef.current.video;\n\n      try {\n        let faceData;\n        if (recognize) {\n          // Detect faces, landmarks, and descriptors for recognition\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks()\n            .withFaceDescriptors();\n        } else {\n          // Only detect faces and landmarks (for drawing)\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks();\n        }\n\n        dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n        if (!faceData || faceData.length === 0) {\n          // Clear canvas if no faces detected\n          if (canvasRef.current) {\n            const ctx = canvasRef.current.getContext(\"2d\");\n            ctx.clearRect(\n              0,\n              0,\n              canvasRef.current.width,\n              canvasRef.current.height\n            );\n          }\n          dispatch(setRecognizedStudents([])); // Clear recognized students\n          return null;\n        }\n\n        // --- Recognition Logic (if recognize === true) ---\n        let recognizedData = [];\n        if (recognize && classStudents && classStudents.length > 0) {\n          const labeledDescriptors = classStudents\n            .map((student) => {\n              const descriptors = extractStudentDescriptors(student);\n              if (descriptors.length > 0) {\n                return new faceapi.LabeledFaceDescriptors(\n                  student._id,\n                  descriptors\n                ); // Use student ID as label\n              }\n              return null;\n            })\n            .filter((ld) => ld !== null); // Filter out students with no descriptors\n\n          if (labeledDescriptors.length > 0) {\n            const faceMatcher = new faceapi.FaceMatcher(\n              labeledDescriptors,\n              RECOGNITION_THRESHOLD\n            );\n\n            recognizedData = faceData\n              .map((fd, index) => {\n                const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n                const student = classStudents.find(\n                  (s) => s._id === bestMatch.label\n                ); // Find student by ID label\n                return {\n                  detectionIndex: index, // Link recognition to detection\n                  studentId: student?._id,\n                  name: student?.full_name || \"Không rõ\",\n                  confidence: 1 - bestMatch.distance, // Convert distance to confidence-like score\n                  isUnknown: bestMatch.label === \"unknown\",\n                };\n              })\n              .filter((r) => !r.isUnknown); // Filter out unknown matches\n\n            dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n          } else {\n            dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n          }\n        }\n\n        // Draw landmarks and boxes with recognition info\n        drawLandmarks(faceData, recognizedData);\n\n        return { detections: faceData, recognized: recognizedData }; // Return both detection and recognition results\n      } catch (error) {\n        console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n        enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n          variant: \"error\",\n        });\n        // Clear canvas on error\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(\n            0,\n            0,\n            canvasRef.current.width,\n            canvasRef.current.height\n          );\n        }\n        dispatch(setDetectedFaces([]));\n        dispatch(setRecognizedStudents([]));\n        return null;\n      }\n    },\n    [\n      isCameraReady,\n      isModelLoaded,\n      classStudents,\n      drawLandmarks,\n      dispatch,\n      enqueueSnackbar,\n    ]\n  );\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort(\n        (a, b) => b.confidence - a.confidence\n      )[0];\n      enqueueSnackbar(\n        `Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(\n          1\n        )}%)`,\n        { variant: \"info\" }\n      );\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence >= CONFIDENCE_THRESHOLD) {\n        // Find the corresponding descriptor\n        const descriptor =\n          result.detections[topMatch.detectionIndex]?.descriptor;\n        if (descriptor) {\n          handleMarkAttendance(\n            topMatch.studentId,\n            topMatch.confidence,\n            descriptor\n          );\n        } else {\n          console.warn(\"Không tìm thấy descriptor cho top match\", topMatch);\n          enqueueSnackbar(\n            \"Lỗi: Không thể lấy đặc trưng khuôn mặt để điểm danh.\",\n            { variant: \"warning\" }\n          );\n        }\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\n        \"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\",\n        { variant: \"warning\" }\n      );\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", { variant: \"warning\" });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = (student) => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({ note: \"\" }); // Chỉ cần reset note\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change (chỉ còn note)\n  const handleManualAttendanceChange = (e) => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n\n    try {\n      // Chỉ gửi sessionId, studentId và note\n      const result = await dispatch(\n        manualAttendance({\n          sessionId,\n          studentId: selectedStudent._id,\n          // status: manualAttendanceData.status, // Bỏ status\n          note: manualAttendanceData.note,\n        })\n      ).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs((prevLogs) => {\n        const existingLogIndex = prevLogs.findIndex(\n          (log) => log.student_id?._id === selectedStudent._id\n        );\n        // Đảm bảo log mới có status là 'present'\n        const newLogData = {\n          ...result.data,\n          status: \"present\",\n          student_id: selectedStudent,\n        };\n\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLogData;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLogData];\n        }\n      });\n\n      enqueueSnackbar(\n        `Đã điểm danh thủ công (Có mặt) cho ${selectedStudent.full_name}`,\n        { variant: \"success\" }\n      );\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\",\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(\n    async (studentId, confidence, faceDescriptor) => {\n      if (!studentId || isProcessing) return;\n\n      // Check if student already marked present\n      const isAlreadyPresent = attendanceLogs.some(\n        (log) => log.student_id?._id === studentId && log.status === \"present\"\n      );\n      if (isAlreadyPresent) {\n        // console.log(`Student ${studentId} already marked present.`);\n        return; // Don't mark again if already present\n      }\n\n      const student = classStudents.find((s) => s._id === studentId);\n      if (!student) {\n        console.warn(\"Student not found for marking attendance:\", studentId);\n        return;\n      }\n\n      // Capture image for proof (optional, but good practice)\n      let imageBase64 = null;\n      try {\n        if (webcamRef.current) {\n          imageBase64 = webcamRef.current.getScreenshot({\n            width: 320,\n            height: 240,\n          }); // Smaller screenshot\n        }\n      } catch (screenshotError) {\n        console.error(\"Error taking screenshot:\", screenshotError);\n        // Proceed without image if screenshot fails\n      }\n\n      try {\n        const result = await dispatch(\n          verifyAttendance({\n            sessionId,\n            studentId,\n            faceDescriptor, // Pass the received descriptor\n            confidence,\n            imageBase64,\n            recognized: true, // Mark as recognized by the system\n          })\n        ).unwrap();\n\n        // Update local attendance logs\n        setAttendanceLogs((prevLogs) => {\n          const existingLogIndex = prevLogs.findIndex(\n            (log) => log.student_id?._id === studentId\n          );\n          const newLog = { ...result.data, student_id: student }; // Use the found student data\n          if (existingLogIndex > -1) {\n            const updatedLogs = [...prevLogs];\n            updatedLogs[existingLogIndex] = newLog;\n            return updatedLogs;\n          } else {\n            return [...prevLogs, newLog];\n          }\n        });\n\n        enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n          variant: \"success\",\n        });\n      } catch (error) {\n        console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n        enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n          variant: \"error\",\n        });\n      }\n    },\n    [\n      dispatch,\n      sessionId,\n      classStudents,\n      attendanceLogs,\n      isProcessing,\n      enqueueSnackbar,\n    ]\n  ); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (\n      !isCameraReady ||\n      !isModelLoaded ||\n      !classStudents ||\n      classStudents.length === 0\n    ) {\n      enqueueSnackbar(\n        \"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\",\n        { variant: \"warning\" }\n      );\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", { variant: \"info\" });\n\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach((rec) => {\n          // Check if confidence meets or exceeds the threshold\n          if (rec.confidence >= CONFIDENCE_THRESHOLD && rec.studentId) {\n            // Find the corresponding descriptor\n            const descriptor =\n              result.detections[rec.detectionIndex]?.descriptor;\n            if (descriptor) {\n              handleMarkAttendance(rec.studentId, rec.confidence, descriptor); // Attempt to mark attendance\n            } else {\n              console.warn(\n                \"Không tìm thấy descriptor cho recognized student trong auto mode\",\n                rec\n              );\n            }\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [\n    isCameraReady,\n    isModelLoaded,\n    classStudents,\n    detectAndRecognizeFaces,\n    handleMarkAttendance,\n    enqueueSnackbar,\n  ]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", { variant: \"info\" });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      // Lấy danh sách sinh viên vắng mặt từ UI\n      const absentStudentIds = absentStudents.map((student) => student._id);\n\n      enqueueSnackbar(\"Đang kết thúc phiên...\", { variant: \"info\" });\n\n      await axios.put(\n        `${API_URL}/attendance/sessions/${sessionId}`,\n        {\n          status: \"completed\",\n          students_absent: absentStudentIds,\n        },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", { variant: \"success\" });\n      setSessionInfo((prev) => ({ ...prev, status: \"completed\" }));\n      stopAutoAttendance();\n    } catch (error) {\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi kết thúc phiên\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", { variant: \"info\" });\n      const [logsRes, sessionRes] = await Promise.all([\n        axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n        axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n      ]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", { variant: \"success\" });\n    } catch (error) {\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi làm mới dữ liệu\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const toggleLandmarks = () => {\n    setShowLandmarks((prev) => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(\n    (log) => log.status === \"present\"\n  );\n  const absentStudents =\n    classInfo?.students?.filter(\n      (student) =>\n        !attendanceLogs.some(\n          (log) =>\n            log.student_id?._id === student._id &&\n            (log.status === \"present\" || log.status === \"late\")\n        ) // Consider late as not absent\n    ) || [];\n  const totalStudents = classInfo?.students?.length || 0;\n  const sessionCompleted = sessionInfo?.status === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return (\n      <Box\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        minHeight=\"80vh\"\n      >\n        <CircularProgress />\n        <Typography sx={{ ml: 2 }}>Đang tải dữ liệu điểm danh...</Typography>\n      </Box>\n    );\n  }\n\n  if (componentError && !isLoading) {\n    return (\n      <Box sx={{ p: 3 }}>\n        <Alert\n          severity=\"error\"\n          action={\n            <Button\n              color=\"inherit\"\n              size=\"small\"\n              onClick={() => window.location.reload()}\n            >\n              Tải lại trang\n            </Button>\n          }\n        >\n          <AlertTitle>Đã xảy ra lỗi</AlertTitle>\n          {componentError}\n        </Alert>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{ p: { xs: 1, sm: 2, md: 3 } }}>\n      {/* Header */}\n      <Box\n        display=\"flex\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        mb={2.5}\n        pb={2}\n        borderBottom=\"1px solid #eaeaea\"\n      >\n        <Box>\n          <Typography variant=\"h5\" fontWeight={500}>\n            Điểm Danh - {classInfo?.class_name}\n          </Typography>\n          <Typography variant=\"subtitle1\" color=\"textSecondary\">\n            Buổi {sessionInfo?.session_number} -{\" \"}\n            {sessionInfo?.date\n              ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\")\n              : \"N/A\"}\n            <Chip\n              label={sessionInfo?.status || \"N/A\"}\n              color={sessionCompleted ? \"default\" : \"success\"}\n              size=\"small\"\n              sx={{ ml: 1 }}\n            />\n          </Typography>\n        </Box>\n        <Button\n          variant=\"outlined\"\n          startIcon={<ArrowBack />}\n          onClick={() => navigate(`/teacher/classes/${classId}`)}\n        >\n          Quay lại lớp\n        </Button>\n      </Box>\n\n      {sessionCompleted && (\n        <Alert severity=\"info\" sx={{ mb: 2 }}>\n          Phiên điểm danh này đã kết thúc. Bạn chỉ có thể xem lại kết quả.\n        </Alert>\n      )}\n\n      {faceRecError && (\n        <Alert severity=\"warning\" sx={{ mb: 2 }}>\n          Lỗi từ hệ thống nhận diện: {faceRecError}\n        </Alert>\n      )}\n\n      <Grid container spacing={3}>\n        {/* Left Column: Camera and Controls */}\n        <Grid item xs={12} md={8}>\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3, overflow: \"hidden\" }}>\n            <CardContent\n              sx={{\n                bgcolor: \"#f8f9fa\",\n                borderBottom: \"1px solid #eaeaea\",\n                p: 2,\n              }}\n            >\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n              >\n                <Typography\n                  variant=\"h6\"\n                  fontWeight={500}\n                  display=\"flex\"\n                  alignItems=\"center\"\n                >\n                  <CameraAlt sx={{ mr: 1, color: \"primary.main\" }} /> Camera\n                </Typography>\n                {!sessionCompleted &&\n                  isModelLoaded && ( // Show controls only if session active and model loaded\n                    <Box>\n                      <Tooltip\n                        title={\n                          isAutoMode\n                            ? \"Dừng chế độ tự động\"\n                            : \"Bắt đầu chế độ tự động\"\n                        }\n                      >\n                        <IconButton\n                          onClick={\n                            isAutoMode\n                              ? stopAutoAttendance\n                              : startAutoAttendance\n                          }\n                          color={isAutoMode ? \"error\" : \"primary\"}\n                          disabled={!isCameraReady}\n                        >\n                          {isAutoMode ? (\n                            <StopCircleOutlined />\n                          ) : (\n                            <PlayCircleOutline />\n                          )}\n                        </IconButton>\n                      </Tooltip>\n                      <Tooltip\n                        title={showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\"}\n                      >\n                        <IconButton\n                          onClick={toggleLandmarks}\n                          color=\"secondary\"\n                          disabled={!isCameraReady || isAutoMode}\n                        >\n                          {showLandmarks ? <VisibilityOff /> : <Visibility />}\n                        </IconButton>\n                      </Tooltip>\n                    </Box>\n                  )}\n              </Box>\n            </CardContent>\n\n            {/* Camera Display Area */}\n            <Box\n              sx={{\n                position: \"relative\",\n                width: \"100%\",\n                aspectRatio: \"640 / 480\",\n                backgroundColor: \"#000\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              {sessionCompleted ? (\n                <Box textAlign=\"center\" color=\"white\" p={4}>\n                  <Info sx={{ fontSize: 60, mb: 2 }} />\n                  <Typography variant=\"h6\">\n                    Phiên điểm danh đã kết thúc\n                  </Typography>\n                  <Typography variant=\"body2\" mt={1}>\n                    Bạn có thể xem kết quả điểm danh ở danh sách bên phải\n                  </Typography>\n                </Box>\n              ) : !isModelLoaded ? (\n                <Box textAlign=\"center\" color=\"white\">\n                  <CircularProgress color=\"inherit\" />\n                  <Typography>Đang tải mô hình nhận diện...</Typography>\n                </Box>\n              ) : (\n                <Suspense\n                  fallback={\n                    <Box textAlign=\"center\" color=\"white\">\n                      <CircularProgress color=\"inherit\" />\n                      <Typography>Đang khởi tạo camera...</Typography>\n                    </Box>\n                  }\n                >\n                  <Webcam\n                    audio={false}\n                    ref={webcamRef}\n                    screenshotFormat=\"image/jpeg\"\n                    width=\"100%\"\n                    height=\"100%\"\n                    videoConstraints={{\n                      width: 640,\n                      height: 480,\n                      facingMode: \"user\",\n                    }}\n                    style={{\n                      display: \"block\",\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      objectFit: \"cover\",\n                    }}\n                    onUserMedia={handleUserMedia}\n                    onUserMediaError={handleUserMediaError}\n                  />\n                </Suspense>\n              )}\n\n              {/* Canvas for Overlays - chỉ hiển thị nếu phiên chưa kết thúc */}\n              {!sessionCompleted && (\n                <canvas\n                  ref={canvasRef}\n                  style={{\n                    position: \"absolute\",\n                    top: 0,\n                    left: 0,\n                    width: \"100%\",\n                    height: \"100%\",\n                    zIndex: 10,\n                  }}\n                />\n              )}\n\n              {/* Camera Error/Loading Overlay */}\n              {(!isCameraReady || componentError?.includes(\"camera\")) &&\n                !sessionCompleted && (\n                  <Box\n                    sx={{\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      backgroundColor: \"rgba(0,0,0,0.7)\",\n                      display: \"flex\",\n                      flexDirection: \"column\",\n                      justifyContent: \"center\",\n                      alignItems: \"center\",\n                      color: \"white\",\n                      zIndex: 20,\n                    }}\n                  >\n                    <VideocamOff sx={{ fontSize: 60, mb: 2 }} />\n                    <Typography variant=\"h6\">Camera không khả dụng</Typography>\n                    <Typography\n                      variant=\"body2\"\n                      sx={{ mt: 1, px: 2, textAlign: \"center\" }}\n                    >\n                      {componentError ||\n                        \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"}\n                    </Typography>\n                    <Button\n                      variant=\"outlined\"\n                      color=\"inherit\"\n                      sx={{ mt: 2 }}\n                      onClick={() => window.location.reload()}\n                    >\n                      Thử lại\n                    </Button>\n                  </Box>\n                )}\n              {/* Auto Mode Indicator */}\n              {isAutoMode && isCameraReady && (\n                <Chip\n                  label=\"Đang tự động điểm danh\"\n                  color=\"success\"\n                  size=\"small\"\n                  sx={{\n                    position: \"absolute\",\n                    bottom: 10,\n                    right: 10,\n                    zIndex: 15,\n                  }}\n                />\n              )}\n            </Box>\n\n            {/* Action Buttons */}\n            {!sessionCompleted && isCameraReady && isModelLoaded && (\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                p={2}\n                bgcolor=\"#f8f9fa\"\n                borderTop=\"1px solid #eaeaea\"\n              >\n                <Button\n                  variant=\"contained\"\n                  onClick={handleManualCapture}\n                  startIcon={\n                    isProcessing ? (\n                      <CircularProgress size={20} color=\"inherit\" />\n                    ) : (\n                      <CameraAlt />\n                    )\n                  }\n                  disabled={isProcessing || isAutoMode}\n                >\n                  Chụp & Nhận diện\n                </Button>\n                <Button\n                  variant=\"contained\"\n                  color=\"secondary\"\n                  onClick={completeSession}\n                  startIcon={<Save />}\n                  disabled={isProcessing}\n                >\n                  Kết thúc phiên\n                </Button>\n              </Box>\n            )}\n          </Card>\n\n          {/* Recognized Students Preview (Optional) */}\n          {recognizedStudents.length > 0 && !isAutoMode && (\n            <Card sx={{ mt: 2, borderRadius: \"10px\", boxShadow: 1 }}>\n              <CardContent>\n                <Typography variant=\"subtitle1\" fontWeight=\"500\" mb={1}>\n                  Đã nhận diện gần đây\n                </Typography>\n                <Grid container spacing={1}>\n                  {recognizedStudents.slice(0, 4).map(\n                    (\n                      rec,\n                      index // Show max 4\n                    ) => (\n                      <Grid\n                        item\n                        xs={6}\n                        sm={3}\n                        key={`${rec.studentId}-${index}`}\n                      >\n                        <Paper\n                          elevation={0}\n                          sx={{\n                            p: 1,\n                            textAlign: \"center\",\n                            border: \"1px solid #eee\",\n                          }}\n                        >\n                          <Typography variant=\"caption\" display=\"block\" noWrap>\n                            {rec.name}\n                          </Typography>\n                          <Chip\n                            label={`${(rec.confidence * 100).toFixed(0)}%`}\n                            size=\"small\"\n                            color={\n                              rec.confidence > CONFIDENCE_THRESHOLD\n                                ? \"success\"\n                                : \"warning\"\n                            }\n                            sx={{ mt: 0.5 }}\n                          />\n                        </Paper>\n                      </Grid>\n                    )\n                  )}\n                </Grid>\n              </CardContent>\n            </Card>\n          )}\n        </Grid>\n\n        {/* Right Column: Student Lists */}\n        <Grid item xs={12} md={4}>\n          {/* Present Students */}\n          <Card sx={{ mb: 3, borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Typography variant=\"h6\" display=\"flex\" alignItems=\"center\">\n                  <Check sx={{ mr: 1, color: \"success.main\" }} /> Có mặt (\n                  {presentStudents.length}/{totalStudents})\n                </Typography>\n                <Tooltip title=\"Làm mới danh sách\">\n                  <IconButton\n                    size=\"small\"\n                    onClick={refreshAttendanceLogs}\n                    disabled={isProcessing}\n                  >\n                    <Refresh />\n                  </IconButton>\n                </Tooltip>\n              </Box>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {presentStudents.length === 0 ? (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"textSecondary\"\n                    align=\"center\"\n                    sx={{ py: 2 }}\n                  >\n                    Tất cả sinh viên đã có mặt.\n                  </Typography>\n                ) : (\n                  <List dense>\n                    {presentStudents\n                      .sort(\n                        (a, b) => new Date(b.timestamp) - new Date(a.timestamp)\n                      ) // Sort by time desc\n                      .map((log) => (\n                        // Simplified ListItem for debugging\n                        <ListItem key={log._id}>\n                          <ListItemText\n                            primary={\n                              log.student_id?.full_name ||\n                              `Log ID: ${log._id} (Tên bị thiếu)`\n                            }\n                            secondary={`Trạng thái: ${log.status} - ${new Date(\n                              log.timestamp\n                            ).toLocaleTimeString(\"vi-VN\")}`}\n                          />\n                        </ListItem>\n                      ))}\n                  </List>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n\n          {/* Absent Students */}\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Typography\n                variant=\"h6\"\n                display=\"flex\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Close sx={{ mr: 1, color: \"error.main\" }} /> Vắng mặt (\n                {absentStudents.length}/{totalStudents})\n              </Typography>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {absentStudents.length === 0 ? (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"textSecondary\"\n                    align=\"center\"\n                    sx={{ py: 2 }}\n                  >\n                    Tất cả sinh viên đã có mặt.\n                  </Typography>\n                ) : (\n                  <List dense>\n                    {absentStudents.map((student) => (\n                      // Keep absent list detailed for now\n                      <ListItem\n                        key={student._id}\n                        disablePadding\n                        sx={{ mb: 0.5 }}\n                        secondaryAction={\n                          !sessionCompleted ? (\n                            <Tooltip title=\"Điểm danh thủ công\">\n                              <IconButton\n                                edge=\"end\"\n                                size=\"small\"\n                                onClick={() =>\n                                  openManualAttendanceDialog(student)\n                                }\n                                disabled={isProcessing}\n                              >\n                                <Edit fontSize=\"small\" />\n                              </IconButton>\n                            </Tooltip>\n                          ) : null\n                        }\n                      >\n                        <Paper\n                          variant=\"outlined\"\n                          sx={{\n                            width: \"100%\",\n                            display: \"flex\",\n                            alignItems: \"center\",\n                            p: 0.5,\n                            borderRadius: \"4px\",\n                          }}\n                        >\n                          <ListItemAvatar sx={{ minWidth: 45 }}>\n                            <Avatar\n                              alt={student.full_name}\n                              src={student.avatar_url}\n                              sx={{ width: 32, height: 32 }}\n                            />\n                          </ListItemAvatar>\n                          <ListItemText\n                            primary={\n                              <Typography variant=\"body2\" noWrap>\n                                {student.full_name}\n                              </Typography>\n                            }\n                            secondary={\n                              <Typography\n                                variant=\"caption\"\n                                color=\"text.secondary\"\n                              >\n                                {student.student_id}\n                              </Typography>\n                            }\n                          />\n                        </Paper>\n                      </ListItem>\n                    ))}\n                  </List>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n        </Grid>\n      </Grid>\n\n      {/* Manual Attendance Dialog */}\n      <Dialog\n        open={manualDialogOpen}\n        onClose={handleManualDialogClose}\n        maxWidth=\"xs\"\n        fullWidth\n      >\n        <DialogTitle>Điểm danh thủ công (Ghi nhận Có mặt)</DialogTitle>\n        <DialogContent>\n          {selectedStudent && (\n            <Box display=\"flex\" alignItems=\"center\" mb={2}>\n              <Avatar\n                src={selectedStudent.avatar_url}\n                alt={selectedStudent.full_name}\n                sx={{ width: 48, height: 48, mr: 2 }}\n              />\n              <Box>\n                <Typography variant=\"subtitle1\">\n                  {selectedStudent.full_name}\n                </Typography>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  MSSV: {selectedStudent.school_info?.student_id || \"N/A\"}\n                </Typography>\n              </Box>\n            </Box>\n          )}\n          <TextField\n            fullWidth\n            margin=\"normal\"\n            name=\"note\"\n            label=\"Ghi chú (tùy chọn)\"\n            value={manualAttendanceData.note}\n            onChange={handleManualAttendanceChange}\n            multiline\n            rows={2}\n            placeholder=\"Nhập lý do điểm danh thủ công (nếu có)\"\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleManualDialogClose}>Hủy</Button>\n          <Button\n            onClick={handleManualAttendanceSubmit}\n            variant=\"contained\"\n            color=\"primary\"\n            disabled={isProcessing}\n          >\n            Xác nhận Có mặt\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </Box>\n  );\n};\n\nexport default AttendancePage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
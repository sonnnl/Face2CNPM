{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\teacher\\\\AttendancePage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, lazy, Suspense, useCallback } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport { Box, Typography, Card, CardContent, Grid, Paper, Button, Divider, CircularProgress, List, ListItem, ListItemAvatar, ListItemText, Avatar, Chip, Dialog, DialogTitle, DialogContent, DialogActions, TextField, FormControl, InputLabel, Select, MenuItem, IconButton, Alert, AlertTitle, Tooltip, Stepper, Step, StepLabel, StepContent } from \"@mui/material\";\nimport { CameraAlt, Check, Close, Edit, Refresh, Save, VerifiedUser, HourglassEmpty, ArrowBack, Info, VideocamOff, PlayCircleOutline, StopCircleOutlined, Visibility, VisibilityOff } from \"@mui/icons-material\";\nimport { setModelLoaded as setFaceRecModelLoaded,\n// Rename to avoid conflict\nsetCameraReady as setFaceRecCameraReady,\n// Rename to avoid conflict\nsetDetectedFaces, setRecognizedStudents, clearRecognitionState, selectClassStudents, selectIsModelLoaded as selectIsFaceRecModelLoaded,\n// Rename to avoid conflict\nselectIsCameraReady as selectIsFaceRecCameraReady,\n// Rename to avoid conflict\nselectDetectedFaces, selectRecognizedStudents, selectIsProcessing as selectIsFaceRecProcessing,\n// Rename to avoid conflict\nselectError as selectFaceRecError,\n// Rename to avoid conflict\nfetchClassFaceFeatures,\n// Use thunk action\nverifyAttendance, manualAttendance } from \"../../redux/slices/faceRecognitionSlice\"; // Adjust imports\n\n// Lazy load Webcam\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Webcam = /*#__PURE__*/lazy(_c = () => import(\"react-webcam\"));\n_c2 = Webcam;\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (faceapi.nets.tinyFaceDetector.isLoaded && faceapi.nets.faceLandmark68Net.isLoaded && faceapi.nets.faceRecognitionNet.isLoaded\n    // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null\n    });\n    await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\n      variant: \"success\"\n    });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = student => {\n  var _student$faceFeatures, _student$faceFeatures2;\n  if (!student || !((_student$faceFeatures = student.faceFeatures) !== null && _student$faceFeatures !== void 0 && _student$faceFeatures.descriptors) && !student.faceDescriptors) {\n    return [];\n  }\n  const descriptors = [];\n  const rawDescriptors = ((_student$faceFeatures2 = student.faceFeatures) === null || _student$faceFeatures2 === void 0 ? void 0 : _student$faceFeatures2.descriptors) || student.faceDescriptors || [];\n  const findDescriptors = data => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every(n => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n  findDescriptors(rawDescriptors);\n  return descriptors.filter(d => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  _s();\n  var _classInfo$students, _classInfo$students2;\n  const {\n    classId,\n    sessionId\n  } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\"\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const {\n    token\n  } = useSelector(state => state.auth);\n  const isModelLoaded = useSelector(selectIsFaceRecModelLoaded);\n  const isCameraReady = useSelector(selectIsFaceRecCameraReady);\n  const detectedFaces = useSelector(selectDetectedFaces);\n  const recognizedStudents = useSelector(selectRecognizedStudents);\n  const classStudents = useSelector(state => selectClassStudents(state, classId)); // Memoized selector\n  const isProcessing = useSelector(selectIsFaceRecProcessing); // Loading state from slice\n  const faceRecError = useSelector(selectFaceRecError); // API errors from slice\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([axios.get(`${API_URL}/classes/teaching/${classId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        })]);\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          await loadFaceRecognitionModels(dispatch, enqueueSnackbar);\n          // Check if model loading failed\n          if (!isModelLoaded) {\n            // Re-check state after attempting load\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if ((loadedSessionInfo === null || loadedSessionInfo === void 0 ? void 0 : loadedSessionInfo.status) !== \"completed\" && isModelLoaded) {\n          await dispatch(fetchClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        var _error$response, _error$response$data;\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, {\n          variant: \"error\"\n        });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      var _webcamRef$current, _webcamRef$current$vi, _webcamRef$current$vi2;\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      (_webcamRef$current = webcamRef.current) === null || _webcamRef$current === void 0 ? void 0 : (_webcamRef$current$vi = _webcamRef$current.video) === null || _webcamRef$current$vi === void 0 ? void 0 : (_webcamRef$current$vi2 = _webcamRef$current$vi.srcObject) === null || _webcamRef$current$vi2 === void 0 ? void 0 : _webcamRef$current$vi2.getTracks().forEach(track => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(stream => {\n    console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n    dispatch(setFaceRecCameraReady(true));\n    setComponentError(null); // Clear camera errors\n  }, [dispatch]);\n  const handleUserMediaError = useCallback(error => {\n    console.error(\"Lỗi khi truy cập camera:\", error);\n    const errMsg = `Không thể truy cập camera: ${error.name === \"NotAllowedError\" ? \"Bạn chưa cấp quyền truy cập camera\" : error.name === \"NotFoundError\" ? \"Không tìm thấy thiết bị camera\" : error.message || \"Lỗi không xác định\"}`;\n    enqueueSnackbar(errMsg, {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecCameraReady(false));\n    setComponentError(errMsg);\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback((detections, recognizedData = []) => {\n    var _webcamRef$current2;\n    if (!canvasRef.current || !((_webcamRef$current2 = webcamRef.current) !== null && _webcamRef$current2 !== void 0 && _webcamRef$current2.video)) return;\n    const video = webcamRef.current.video;\n    const canvas = canvasRef.current;\n    const displaySize = {\n      width: video.videoWidth,\n      height: video.videoHeight\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n    const resizedDetections = faceapi.resizeResults(detections, displaySize);\n    const ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    resizedDetections.forEach((detection, i) => {\n      const box = detection.detection.box;\n      const landmarks = detection.landmarks;\n      const recognized = recognizedData.find(rec => rec.detectionIndex === i); // Match recognition result\n\n      // Draw box\n      const boxColor = recognized ? recognized.confidence > CONFIDENCE_THRESHOLD ? \"#4CAF50\" : \"#FFC107\" : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n      ctx.strokeStyle = boxColor;\n      ctx.lineWidth = 2;\n      ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n      // Draw label background\n      const label = recognized ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)` : \"Đang nhận diện...\";\n      const textWidth = ctx.measureText(label).width;\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n      ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n      // Draw label text\n      ctx.fillStyle = \"#FFFFFF\";\n      ctx.font = \"14px Arial\";\n      ctx.fillText(label, box.x + 5, box.y - 5);\n\n      // Draw landmarks if enabled\n      if (showLandmarks && landmarks) {\n        faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n      }\n    });\n  }, [showLandmarks]); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(async (recognize = true) => {\n    var _webcamRef$current3;\n    if (!isCameraReady || !((_webcamRef$current3 = webcamRef.current) !== null && _webcamRef$current3 !== void 0 && _webcamRef$current3.video) || webcamRef.current.video.readyState !== 4 || !isModelLoaded) {\n      return null; // Return null if detection can't proceed\n    }\n    const video = webcamRef.current.video;\n    try {\n      let faceData;\n      if (recognize) {\n        // Detect faces, landmarks, and descriptors for recognition\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks().withFaceDescriptors();\n      } else {\n        // Only detect faces and landmarks (for drawing)\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks();\n      }\n      dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n      if (!faceData || faceData.length === 0) {\n        // Clear canvas if no faces detected\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        }\n        dispatch(setRecognizedStudents([])); // Clear recognized students\n        return null;\n      }\n\n      // --- Recognition Logic (if recognize === true) ---\n      let recognizedData = [];\n      if (recognize && classStudents && classStudents.length > 0) {\n        const labeledDescriptors = classStudents.map(student => {\n          const descriptors = extractStudentDescriptors(student);\n          if (descriptors.length > 0) {\n            return new faceapi.LabeledFaceDescriptors(student._id, descriptors); // Use student ID as label\n          }\n          return null;\n        }).filter(ld => ld !== null); // Filter out students with no descriptors\n\n        if (labeledDescriptors.length > 0) {\n          const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, RECOGNITION_THRESHOLD);\n          recognizedData = faceData.map((fd, index) => {\n            const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n            const student = classStudents.find(s => s._id === bestMatch.label); // Find student by ID label\n            return {\n              detectionIndex: index,\n              // Link recognition to detection\n              studentId: student === null || student === void 0 ? void 0 : student._id,\n              name: (student === null || student === void 0 ? void 0 : student.full_name) || \"Không rõ\",\n              confidence: 1 - bestMatch.distance,\n              // Convert distance to confidence-like score\n              isUnknown: bestMatch.label === \"unknown\"\n            };\n          }).filter(r => !r.isUnknown); // Filter out unknown matches\n\n          dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n        } else {\n          dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n        }\n      }\n\n      // Draw landmarks and boxes with recognition info\n      drawLandmarks(faceData, recognizedData);\n      return {\n        detections: faceData,\n        recognized: recognizedData\n      }; // Return both detection and recognition results\n    } catch (error) {\n      console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n      enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n        variant: \"error\"\n      });\n      // Clear canvas on error\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n      dispatch(setDetectedFaces([]));\n      dispatch(setRecognizedStudents([]));\n      return null;\n    }\n  }, [isCameraReady, isModelLoaded, classStudents, drawLandmarks, dispatch, enqueueSnackbar]);\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort((a, b) => b.confidence - a.confidence)[0];\n      enqueueSnackbar(`Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(1)}%)`, {\n        variant: \"info\"\n      });\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence > CONFIDENCE_THRESHOLD) {\n        handleMarkAttendance(topMatch.studentId, topMatch.confidence);\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\", {\n        variant: \"warning\"\n      });\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", {\n        variant: \"warning\"\n      });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = student => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({\n      status: \"present\",\n      note: \"\"\n    }); // Reset form\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change\n  const handleManualAttendanceChange = e => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n    try {\n      const result = await dispatch(manualAttendance({\n        sessionId,\n        studentId: selectedStudent._id,\n        status: manualAttendanceData.status,\n        note: manualAttendanceData.note\n      })).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id;\n          return ((_log$student_id = log.student_id) === null || _log$student_id === void 0 ? void 0 : _log$student_id._id) === selectedStudent._id;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: selectedStudent\n        }; // Use the selected student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh thủ công cho ${selectedStudent.full_name}`, {\n        variant: \"success\"\n      });\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(async (studentId, confidence) => {\n    if (!studentId || isProcessing) return;\n\n    // Check if student already marked present\n    const isAlreadyPresent = attendanceLogs.some(log => {\n      var _log$student_id2;\n      return ((_log$student_id2 = log.student_id) === null || _log$student_id2 === void 0 ? void 0 : _log$student_id2._id) === studentId && log.status === \"present\";\n    });\n    if (isAlreadyPresent) {\n      // console.log(`Student ${studentId} already marked present.`);\n      return; // Don't mark again if already present\n    }\n    const student = classStudents.find(s => s._id === studentId);\n    if (!student) {\n      console.warn(\"Student not found for marking attendance:\", studentId);\n      return;\n    }\n\n    // Capture image for proof (optional, but good practice)\n    let imageBase64 = null;\n    try {\n      if (webcamRef.current) {\n        imageBase64 = webcamRef.current.getScreenshot({\n          width: 320,\n          height: 240\n        }); // Smaller screenshot\n      }\n    } catch (screenshotError) {\n      console.error(\"Error taking screenshot:\", screenshotError);\n      // Proceed without image if screenshot fails\n    }\n    try {\n      const result = await dispatch(verifyAttendance({\n        sessionId,\n        studentId,\n        // faceDescriptor: null, // Descriptor not strictly needed for verification API if confidence is high\n        confidence,\n        imageBase64,\n        recognized: true // Mark as recognized by the system\n      })).unwrap();\n\n      // Update local attendance logs\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id3;\n          return ((_log$student_id3 = log.student_id) === null || _log$student_id3 === void 0 ? void 0 : _log$student_id3._id) === studentId;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: student\n        }; // Use the found student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n        variant: \"success\"\n      });\n    } catch (error) {\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  }, [dispatch, sessionId, classStudents, attendanceLogs, isProcessing, enqueueSnackbar]); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (!isCameraReady || !isModelLoaded || !classStudents || classStudents.length === 0) {\n      enqueueSnackbar(\"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\", {\n        variant: \"warning\"\n      });\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach(rec => {\n          if (rec.confidence > CONFIDENCE_THRESHOLD && rec.studentId) {\n            handleMarkAttendance(rec.studentId, rec.confidence); // Attempt to mark attendance\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [isCameraReady, isModelLoaded, classStudents, detectAndRecognizeFaces, handleMarkAttendance, enqueueSnackbar]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang kết thúc phiên...\", {\n        variant: \"info\"\n      });\n      await axios.put(`${API_URL}/attendance/sessions/${sessionId}`, {\n        status: \"completed\"\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", {\n        variant: \"success\"\n      });\n      setSessionInfo(prev => ({\n        ...prev,\n        status: \"completed\"\n      })); // Update local state\n      stopAutoAttendance(); // Stop auto mode if running\n      // Optionally navigate back after a delay\n      // setTimeout(() => navigate(`/teacher/classes/${classId}`), 1000);\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || \"Lỗi khi kết thúc phiên\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", {\n        variant: \"info\"\n      });\n      const [logsRes, sessionRes] = await Promise.all([axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      })]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", {\n        variant: \"success\"\n      });\n    } catch (error) {\n      var _error$response3, _error$response3$data;\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || \"Lỗi khi làm mới dữ liệu\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const toggleLandmarks = () => {\n    setShowLandmarks(prev => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(log => log.status === \"present\");\n  const absentStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students = classInfo.students) === null || _classInfo$students === void 0 ? void 0 : _classInfo$students.filter(student => !attendanceLogs.some(log => {\n    var _log$student_id4;\n    return ((_log$student_id4 = log.student_id) === null || _log$student_id4 === void 0 ? void 0 : _log$student_id4._id) === student._id && (log.status === \"present\" || log.status === \"late\");\n  }) // Consider late as not absent\n  )) || [];\n  const totalStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students2 = classInfo.students) === null || _classInfo$students2 === void 0 ? void 0 : _classInfo$students2.length) || 0;\n  const sessionCompleted = (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      minHeight: \"80vh\",\n      children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 824,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        sx: {\n          ml: 2\n        },\n        children: \"\\u0110ang t\\u1EA3i d\\u1EEF li\\u1EC7u \\u0111i\\u1EC3m danh...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 825,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 818,\n      columnNumber: 7\n    }, this);\n  }\n  if (componentError && !isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 3\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        action: /*#__PURE__*/_jsxDEV(Button, {\n          color: \"inherit\",\n          size: \"small\",\n          onClick: () => window.location.reload(),\n          children: \"T\\u1EA3i l\\u1EA1i trang\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 836,\n          columnNumber: 13\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(AlertTitle, {\n          children: \"\\u0110\\xE3 x\\u1EA3y ra l\\u1ED7i\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 845,\n          columnNumber: 11\n        }, this), componentError]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 833,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 832,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      p: {\n        xs: 1,\n        sm: 2,\n        md: 3\n      }\n    },\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      mb: 2.5,\n      pb: 2,\n      borderBottom: \"1px solid #eaeaea\",\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          fontWeight: 500,\n          children: [\"\\u0110i\\u1EC3m Danh - \", classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 864,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          color: \"textSecondary\",\n          children: [\"Bu\\u1ED5i \", sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.session_number, \" -\", \" \", sessionInfo !== null && sessionInfo !== void 0 && sessionInfo.date ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\") : \"N/A\", /*#__PURE__*/_jsxDEV(Chip, {\n            label: (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) || \"N/A\",\n            color: sessionCompleted ? \"default\" : \"success\",\n            size: \"small\",\n            sx: {\n              ml: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 872,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 867,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 863,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        startIcon: /*#__PURE__*/_jsxDEV(ArrowBack, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 882,\n          columnNumber: 22\n        }, this),\n        onClick: () => navigate(`/teacher/classes/${classId}`),\n        children: \"Quay l\\u1EA1i l\\u1EDBp\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 880,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 855,\n      columnNumber: 7\n    }, this), sessionCompleted && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      sx: {\n        mb: 2\n      },\n      children: \"Phi\\xEAn \\u0111i\\u1EC3m danh n\\xE0y \\u0111\\xE3 k\\u1EBFt th\\xFAc. B\\u1EA1n ch\\u1EC9 c\\xF3 th\\u1EC3 xem l\\u1EA1i k\\u1EBFt qu\\u1EA3.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 890,\n      columnNumber: 9\n    }, this), faceRecError && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"warning\",\n      sx: {\n        mb: 2\n      },\n      children: [\"L\\u1ED7i t\\u1EEB h\\u1EC7 th\\u1ED1ng nh\\u1EADn di\\u1EC7n: \", faceRecError]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 896,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 3,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 8,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3,\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(CardContent, {\n            sx: {\n              bgcolor: \"#f8f9fa\",\n              borderBottom: \"1px solid #eaeaea\",\n              p: 2\n            },\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 500,\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(CameraAlt, {\n                  sx: {\n                    mr: 1,\n                    color: \"primary.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 923,\n                  columnNumber: 19\n                }, this), \" Camera\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 917,\n                columnNumber: 17\n              }, this), !sessionCompleted && isModelLoaded &&\n              /*#__PURE__*/\n              // Show controls only if session active and model loaded\n              _jsxDEV(Box, {\n                children: [/*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: isAutoMode ? \"Dừng chế độ tự động\" : \"Bắt đầu chế độ tự động\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: isAutoMode ? stopAutoAttendance : startAutoAttendance,\n                    color: isAutoMode ? \"error\" : \"primary\",\n                    disabled: !isCameraReady,\n                    children: isAutoMode ? /*#__PURE__*/_jsxDEV(StopCircleOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 945,\n                      columnNumber: 29\n                    }, this) : /*#__PURE__*/_jsxDEV(PlayCircleOutline, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 947,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 935,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 928,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: toggleLandmarks,\n                    color: \"secondary\",\n                    disabled: !isCameraReady || isAutoMode,\n                    children: showLandmarks ? /*#__PURE__*/_jsxDEV(VisibilityOff, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 959,\n                      columnNumber: 44\n                    }, this) : /*#__PURE__*/_jsxDEV(Visibility, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 959,\n                      columnNumber: 64\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 954,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 951,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 927,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 912,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 905,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              position: \"relative\",\n              width: \"100%\",\n              aspectRatio: \"640 / 480\",\n              backgroundColor: \"#000\",\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\"\n            },\n            children: [!isModelLoaded && !sessionCompleted ? /*#__PURE__*/_jsxDEV(Box, {\n              textAlign: \"center\",\n              color: \"white\",\n              children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 981,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                children: \"\\u0110ang t\\u1EA3i m\\xF4 h\\xECnh nh\\u1EADn di\\u1EC7n...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 982,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 980,\n              columnNumber: 17\n            }, this) : !sessionCompleted ? /*#__PURE__*/_jsxDEV(Suspense, {\n              fallback: /*#__PURE__*/_jsxDEV(Box, {\n                textAlign: \"center\",\n                color: \"white\",\n                children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                  color: \"inherit\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 988,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  children: \"\\u0110ang kh\\u1EDFi t\\u1EA1o camera...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 989,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 987,\n                columnNumber: 21\n              }, this),\n              children: /*#__PURE__*/_jsxDEV(Webcam, {\n                audio: false,\n                ref: webcamRef,\n                screenshotFormat: \"image/jpeg\",\n                width: \"100%\",\n                height: \"100%\",\n                videoConstraints: {\n                  width: 640,\n                  height: 480,\n                  facingMode: \"user\"\n                },\n                style: {\n                  display: \"block\",\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\"\n                },\n                onUserMedia: handleUserMedia,\n                onUserMediaError: handleUserMediaError\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 993,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 985,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n              color: \"white\",\n              children: \"Phi\\xEAn \\u0111\\xE3 k\\u1EBFt th\\xFAc\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1018,\n              columnNumber: 17\n            }, this) // Placeholder if session completed\n            , /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              style: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                zIndex: 10\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1022,\n              columnNumber: 15\n            }, this), (!isCameraReady || (componentError === null || componentError === void 0 ? void 0 : componentError.includes(\"camera\"))) && !sessionCompleted && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                backgroundColor: \"rgba(0,0,0,0.7)\",\n                display: \"flex\",\n                flexDirection: \"column\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                color: \"white\",\n                zIndex: 20\n              },\n              children: [/*#__PURE__*/_jsxDEV(VideocamOff, {\n                sx: {\n                  fontSize: 60,\n                  mb: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1053,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Camera kh\\xF4ng kh\\u1EA3 d\\u1EE5ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1054,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mt: 1,\n                  px: 2,\n                  textAlign: \"center\"\n                },\n                children: componentError || \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1055,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                color: \"inherit\",\n                sx: {\n                  mt: 2\n                },\n                onClick: () => window.location.reload(),\n                children: \"Th\\u1EED l\\u1EA1i\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1062,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1037,\n              columnNumber: 19\n            }, this), isAutoMode && isCameraReady && /*#__PURE__*/_jsxDEV(Chip, {\n              label: \"\\u0110ang t\\u1EF1 \\u0111\\u1ED9ng \\u0111i\\u1EC3m danh\",\n              color: \"success\",\n              size: \"small\",\n              sx: {\n                position: \"absolute\",\n                bottom: 10,\n                right: 10,\n                zIndex: 15\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1074,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 968,\n            columnNumber: 13\n          }, this), !sessionCompleted && isCameraReady && isModelLoaded && /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            p: 2,\n            bgcolor: \"#f8f9fa\",\n            borderTop: \"1px solid #eaeaea\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              onClick: handleManualCapture,\n              startIcon: isProcessing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1102,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1104,\n                columnNumber: 23\n              }, this),\n              disabled: isProcessing || isAutoMode,\n              children: \"Ch\\u1EE5p & Nh\\u1EADn di\\u1EC7n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1097,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"secondary\",\n              onClick: completeSession,\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1115,\n                columnNumber: 30\n              }, this),\n              disabled: isProcessing,\n              children: \"K\\u1EBFt th\\xFAc phi\\xEAn\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1111,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1090,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 904,\n          columnNumber: 11\n        }, this), recognizedStudents.length > 0 && !isAutoMode && /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mt: 2,\n            borderRadius: \"10px\",\n            boxShadow: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              fontWeight: \"500\",\n              mb: 1,\n              children: \"\\u0110\\xE3 nh\\u1EADn di\\u1EC7n g\\u1EA7n \\u0111\\xE2y\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1128,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacing: 1,\n              children: recognizedStudents.slice(0, 4).map((rec, index // Show max 4\n              ) => /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 6,\n                sm: 3,\n                children: /*#__PURE__*/_jsxDEV(Paper, {\n                  elevation: 0,\n                  sx: {\n                    p: 1,\n                    textAlign: \"center\",\n                    border: \"1px solid #eee\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"caption\",\n                    display: \"block\",\n                    noWrap: true,\n                    children: rec.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1151,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Chip, {\n                    label: `${(rec.confidence * 100).toFixed(0)}%`,\n                    size: \"small\",\n                    color: rec.confidence > CONFIDENCE_THRESHOLD ? \"success\" : \"warning\",\n                    sx: {\n                      mt: 0.5\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1154,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1143,\n                  columnNumber: 25\n                }, this)\n              }, `${rec.studentId}-${index}`, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1137,\n                columnNumber: 23\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1131,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1127,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1126,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 903,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 4,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mb: 3,\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(Check, {\n                  sx: {\n                    mr: 1,\n                    color: \"success.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1186,\n                  columnNumber: 19\n                }, this), \" C\\xF3 m\\u1EB7t (\", presentStudents.length, \"/\", totalStudents, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1185,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                title: \"L\\xE0m m\\u1EDBi danh s\\xE1ch\",\n                children: /*#__PURE__*/_jsxDEV(IconButton, {\n                  size: \"small\",\n                  onClick: refreshAttendanceLogs,\n                  disabled: isProcessing,\n                  children: /*#__PURE__*/_jsxDEV(Refresh, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1195,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1190,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1189,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1179,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1199,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: presentStudents.map(student => /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                children: student.full_name\n              }, student._id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1202,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1200,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1178,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1177,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h6\",\n              display: \"flex\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Close, {\n                sx: {\n                  mr: 1,\n                  color: \"error.main\"\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1219,\n                columnNumber: 17\n              }, this), \" V\\u1EAFng m\\u1EB7t (\", absentStudents.length, \"/\", totalStudents, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1213,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1222,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: absentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                align: \"center\",\n                sx: {\n                  py: 2\n                },\n                children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 c\\xF3 m\\u1EB7t.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1225,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(List, {\n                dense: true,\n                children: absentStudents.map(student => /*#__PURE__*/_jsxDEV(ListItem, {\n                  disablePadding: true,\n                  sx: {\n                    mb: 0.5\n                  },\n                  secondaryAction: !sessionCompleted ? /*#__PURE__*/_jsxDEV(Tooltip, {\n                    title: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\",\n                    children: /*#__PURE__*/_jsxDEV(IconButton, {\n                      edge: \"end\",\n                      size: \"small\",\n                      onClick: () => openManualAttendanceDialog(student),\n                      disabled: isProcessing,\n                      children: /*#__PURE__*/_jsxDEV(Edit, {\n                        fontSize: \"small\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1251,\n                        columnNumber: 33\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1243,\n                      columnNumber: 31\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1242,\n                    columnNumber: 29\n                  }, this) : null,\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    variant: \"outlined\",\n                    sx: {\n                      width: \"100%\",\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      p: 0.5,\n                      borderRadius: \"4px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                      sx: {\n                        minWidth: 45\n                      },\n                      children: /*#__PURE__*/_jsxDEV(Avatar, {\n                        alt: student.full_name,\n                        src: student.avatar_url,\n                        sx: {\n                          width: 32,\n                          height: 32\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1268,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1267,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                      primary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"body2\",\n                        noWrap: true,\n                        children: student.full_name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1276,\n                        columnNumber: 31\n                      }, this),\n                      secondary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"caption\",\n                        color: \"text.secondary\",\n                        children: student.student_code\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1281,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1274,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1257,\n                    columnNumber: 25\n                  }, this)\n                }, student._id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1236,\n                  columnNumber: 23\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1234,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1223,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1212,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1211,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1175,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 901,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: manualDialogOpen,\n      onClose: handleManualDialogClose,\n      maxWidth: \"xs\",\n      fullWidth: true,\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"\\u0110i\\u1EC3m Danh Th\\u1EE7 C\\xF4ng\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1307,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          label: \"Tr\\u1EA1ng Th\\xE1i\",\n          name: \"status\",\n          value: manualAttendanceData.status,\n          onChange: handleManualAttendanceChange,\n          fullWidth: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1309,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TextField, {\n          label: \"Ghi Ch\\xFA\",\n          name: \"note\",\n          value: manualAttendanceData.note,\n          onChange: handleManualAttendanceChange,\n          fullWidth: true,\n          multiline: true,\n          rows: 4\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1316,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1308,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualDialogClose,\n          children: \"H\\u1EE7y\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1327,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualAttendanceSubmit,\n          children: \"L\\u01B0u\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1328,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1326,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1301,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 853,\n    columnNumber: 5\n  }, this);\n};\n_s(AttendancePage, \"lg1kUTiDDe+i6KHbecj6XhASn/Q=\", false, function () {\n  return [useParams, useNavigate, useDispatch, useSnackbar, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector];\n});\n_c3 = AttendancePage;\nexport default AttendancePage;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"Webcam$lazy\");\n$RefreshReg$(_c2, \"Webcam\");\n$RefreshReg$(_c3, \"AttendancePage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","lazy","Suspense","useCallback","useParams","useNavigate","useDispatch","useSelector","useSnackbar","axios","faceapi","Box","Typography","Card","CardContent","Grid","Paper","Button","Divider","CircularProgress","List","ListItem","ListItemAvatar","ListItemText","Avatar","Chip","Dialog","DialogTitle","DialogContent","DialogActions","TextField","FormControl","InputLabel","Select","MenuItem","IconButton","Alert","AlertTitle","Tooltip","Stepper","Step","StepLabel","StepContent","CameraAlt","Check","Close","Edit","Refresh","Save","VerifiedUser","HourglassEmpty","ArrowBack","Info","VideocamOff","PlayCircleOutline","StopCircleOutlined","Visibility","VisibilityOff","setModelLoaded","setFaceRecModelLoaded","setCameraReady","setFaceRecCameraReady","setDetectedFaces","setRecognizedStudents","clearRecognitionState","selectClassStudents","selectIsModelLoaded","selectIsFaceRecModelLoaded","selectIsCameraReady","selectIsFaceRecCameraReady","selectDetectedFaces","selectRecognizedStudents","selectIsProcessing","selectIsFaceRecProcessing","selectError","selectFaceRecError","fetchClassFaceFeatures","verifyAttendance","manualAttendance","jsxDEV","_jsxDEV","Webcam","_c","_c2","API_URL","process","env","REACT_APP_API_URL","RECOGNITION_THRESHOLD","DETECTION_THRESHOLD","CONFIDENCE_THRESHOLD","AUTO_DETECT_INTERVAL","FACE_DETECTION_OPTIONS","TinyFaceDetectorOptions","scoreThreshold","inputSize","MODEL_URL","loadFaceRecognitionModels","dispatch","enqueueSnackbar","nets","tinyFaceDetector","isLoaded","faceLandmark68Net","faceRecognitionNet","variant","autoHideDuration","Promise","all","loadFromUri","error","console","extractStudentDescriptors","student","_student$faceFeatures","_student$faceFeatures2","faceFeatures","descriptors","faceDescriptors","rawDescriptors","findDescriptors","data","Array","isArray","length","every","n","push","Float32Array","forEach","Object","values","filter","d","AttendancePage","_s","_classInfo$students","_classInfo$students2","classId","sessionId","navigate","webcamRef","canvasRef","autoModeIntervalRef","landmarkIntervalRef","isLoading","setIsLoading","classInfo","setClassInfo","sessionInfo","setSessionInfo","attendanceLogs","setAttendanceLogs","isAutoMode","setIsAutoMode","showLandmarks","setShowLandmarks","manualDialogOpen","setManualDialogOpen","selectedStudent","setSelectedStudent","manualAttendanceData","setManualAttendanceData","status","note","componentError","setComponentError","token","state","auth","isModelLoaded","isCameraReady","detectedFaces","recognizedStudents","classStudents","isProcessing","faceRecError","loadData","classRes","sessionRes","logsRes","get","headers","Authorization","loadedSessionInfo","Error","unwrap","_error$response","_error$response$data","errMsg","response","message","_webcamRef$current","_webcamRef$current$vi","_webcamRef$current$vi2","clearInterval","current","video","srcObject","getTracks","track","stop","startLandmarkDetection","stopLandmarkDetection","ctx","getContext","clearRect","width","height","handleUserMedia","stream","log","id","handleUserMediaError","name","drawLandmarks","detections","recognizedData","_webcamRef$current2","canvas","displaySize","videoWidth","videoHeight","matchDimensions","resizedDetections","resizeResults","detection","i","box","landmarks","recognized","find","rec","detectionIndex","boxColor","confidence","strokeStyle","lineWidth","strokeRect","x","y","label","toFixed","textWidth","measureText","fillStyle","fillRect","font","fillText","draw","drawFaceLandmarks","detectAndRecognizeFaces","recognize","_webcamRef$current3","readyState","faceData","detectAllFaces","withFaceLandmarks","withFaceDescriptors","labeledDescriptors","map","LabeledFaceDescriptors","_id","ld","faceMatcher","FaceMatcher","fd","index","bestMatch","findBestMatch","descriptor","s","studentId","full_name","distance","isUnknown","r","handleManualCapture","result","topMatch","sort","a","b","handleMarkAttendance","openManualAttendanceDialog","handleManualDialogClose","handleManualAttendanceChange","e","target","value","handleManualAttendanceSubmit","prevLogs","existingLogIndex","findIndex","_log$student_id","student_id","newLog","updatedLogs","isAlreadyPresent","some","_log$student_id2","warn","imageBase64","getScreenshot","screenshotError","_log$student_id3","startAutoAttendance","stopAutoAttendance","setInterval","completeSession","put","prev","_error$response2","_error$response2$data","refreshAttendanceLogs","_error$response3","_error$response3$data","toggleLandmarks","presentStudents","absentStudents","students","_log$student_id4","totalStudents","sessionCompleted","display","justifyContent","alignItems","minHeight","children","fileName","_jsxFileName","lineNumber","columnNumber","sx","ml","p","severity","action","color","size","onClick","window","location","reload","xs","sm","md","mb","pb","borderBottom","fontWeight","class_name","session_number","date","Date","toLocaleDateString","startIcon","container","spacing","item","borderRadius","boxShadow","overflow","bgcolor","mr","title","disabled","position","aspectRatio","backgroundColor","textAlign","fallback","audio","ref","screenshotFormat","videoConstraints","facingMode","style","top","left","objectFit","onUserMedia","onUserMediaError","zIndex","includes","flexDirection","fontSize","mt","px","bottom","right","borderTop","slice","elevation","border","noWrap","maxHeight","pr","align","py","dense","disablePadding","secondaryAction","edge","minWidth","alt","src","avatar_url","primary","secondary","student_code","open","onClose","maxWidth","fullWidth","onChange","multiline","rows","_c3","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/teacher/AttendancePage.js"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useRef,\n  lazy,\n  Suspense,\n  useCallback,\n} from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport {\n  Box,\n  Typography,\n  Card,\n  CardContent,\n  Grid,\n  Paper,\n  Button,\n  Divider,\n  CircularProgress,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Avatar,\n  Chip,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  IconButton,\n  Alert,\n  AlertTitle,\n  Tooltip,\n  Stepper,\n  Step,\n  StepLabel,\n  StepContent,\n} from \"@mui/material\";\nimport {\n  CameraAlt,\n  Check,\n  Close,\n  Edit,\n  Refresh,\n  Save,\n  VerifiedUser,\n  HourglassEmpty,\n  ArrowBack,\n  Info,\n  VideocamOff,\n  PlayCircleOutline,\n  StopCircleOutlined,\n  Visibility,\n  VisibilityOff,\n} from \"@mui/icons-material\";\nimport {\n  setModelLoaded as setFaceRecModelLoaded, // Rename to avoid conflict\n  setCameraReady as setFaceRecCameraReady, // Rename to avoid conflict\n  setDetectedFaces,\n  setRecognizedStudents,\n  clearRecognitionState,\n  selectClassStudents,\n  selectIsModelLoaded as selectIsFaceRecModelLoaded, // Rename to avoid conflict\n  selectIsCameraReady as selectIsFaceRecCameraReady, // Rename to avoid conflict\n  selectDetectedFaces,\n  selectRecognizedStudents,\n  selectIsProcessing as selectIsFaceRecProcessing, // Rename to avoid conflict\n  selectError as selectFaceRecError, // Rename to avoid conflict\n  fetchClassFaceFeatures, // Use thunk action\n  verifyAttendance,\n  manualAttendance,\n} from \"../../redux/slices/faceRecognitionSlice\"; // Adjust imports\n\n// Lazy load Webcam\nconst Webcam = lazy(() => import(\"react-webcam\"));\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320,\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (\n      faceapi.nets.tinyFaceDetector.isLoaded &&\n      faceapi.nets.faceLandmark68Net.isLoaded &&\n      faceapi.nets.faceRecognitionNet.isLoaded\n      // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null,\n    });\n    await Promise.all([\n      faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\n      faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\n      faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\n    ]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", { variant: \"success\" });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", { variant: \"error\" });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = (student) => {\n  if (\n    !student ||\n    (!student.faceFeatures?.descriptors && !student.faceDescriptors)\n  ) {\n    return [];\n  }\n\n  const descriptors = [];\n  const rawDescriptors =\n    student.faceFeatures?.descriptors || student.faceDescriptors || [];\n\n  const findDescriptors = (data) => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every((n) => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n\n  findDescriptors(rawDescriptors);\n  return descriptors.filter((d) => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  const { classId, sessionId } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\",\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const { token } = useSelector((state) => state.auth);\n  const isModelLoaded = useSelector(selectIsFaceRecModelLoaded);\n  const isCameraReady = useSelector(selectIsFaceRecCameraReady);\n  const detectedFaces = useSelector(selectDetectedFaces);\n  const recognizedStudents = useSelector(selectRecognizedStudents);\n  const classStudents = useSelector((state) =>\n    selectClassStudents(state, classId)\n  ); // Memoized selector\n  const isProcessing = useSelector(selectIsFaceRecProcessing); // Loading state from slice\n  const faceRecError = useSelector(selectFaceRecError); // API errors from slice\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([\n          axios.get(`${API_URL}/classes/teaching/${classId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n        ]);\n\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          await loadFaceRecognitionModels(dispatch, enqueueSnackbar);\n          // Check if model loading failed\n          if (!isModelLoaded) {\n            // Re-check state after attempting load\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if (loadedSessionInfo?.status !== \"completed\" && isModelLoaded) {\n          await dispatch(fetchClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg =\n          error.response?.data?.message ||\n          error.message ||\n          \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, { variant: \"error\" });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      webcamRef.current?.video?.srcObject\n        ?.getTracks()\n        .forEach((track) => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(\n    (stream) => {\n      console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n      dispatch(setFaceRecCameraReady(true));\n      setComponentError(null); // Clear camera errors\n    },\n    [dispatch]\n  );\n\n  const handleUserMediaError = useCallback(\n    (error) => {\n      console.error(\"Lỗi khi truy cập camera:\", error);\n      const errMsg = `Không thể truy cập camera: ${\n        error.name === \"NotAllowedError\"\n          ? \"Bạn chưa cấp quyền truy cập camera\"\n          : error.name === \"NotFoundError\"\n          ? \"Không tìm thấy thiết bị camera\"\n          : error.message || \"Lỗi không xác định\"\n      }`;\n      enqueueSnackbar(errMsg, { variant: \"error\" });\n      dispatch(setFaceRecCameraReady(false));\n      setComponentError(errMsg);\n    },\n    [dispatch, enqueueSnackbar]\n  );\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback(\n    (detections, recognizedData = []) => {\n      if (!canvasRef.current || !webcamRef.current?.video) return;\n\n      const video = webcamRef.current.video;\n      const canvas = canvasRef.current;\n      const displaySize = {\n        width: video.videoWidth,\n        height: video.videoHeight,\n      };\n      faceapi.matchDimensions(canvas, displaySize);\n\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      resizedDetections.forEach((detection, i) => {\n        const box = detection.detection.box;\n        const landmarks = detection.landmarks;\n        const recognized = recognizedData.find(\n          (rec) => rec.detectionIndex === i\n        ); // Match recognition result\n\n        // Draw box\n        const boxColor = recognized\n          ? recognized.confidence > CONFIDENCE_THRESHOLD\n            ? \"#4CAF50\"\n            : \"#FFC107\"\n          : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n        ctx.strokeStyle = boxColor;\n        ctx.lineWidth = 2;\n        ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n        // Draw label background\n        const label = recognized\n          ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)`\n          : \"Đang nhận diện...\";\n        const textWidth = ctx.measureText(label).width;\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n        ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n        // Draw label text\n        ctx.fillStyle = \"#FFFFFF\";\n        ctx.font = \"14px Arial\";\n        ctx.fillText(label, box.x + 5, box.y - 5);\n\n        // Draw landmarks if enabled\n        if (showLandmarks && landmarks) {\n          faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n        }\n      });\n    },\n    [showLandmarks]\n  ); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(\n    async (recognize = true) => {\n      if (\n        !isCameraReady ||\n        !webcamRef.current?.video ||\n        webcamRef.current.video.readyState !== 4 ||\n        !isModelLoaded\n      ) {\n        return null; // Return null if detection can't proceed\n      }\n\n      const video = webcamRef.current.video;\n\n      try {\n        let faceData;\n        if (recognize) {\n          // Detect faces, landmarks, and descriptors for recognition\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks()\n            .withFaceDescriptors();\n        } else {\n          // Only detect faces and landmarks (for drawing)\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks();\n        }\n\n        dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n        if (!faceData || faceData.length === 0) {\n          // Clear canvas if no faces detected\n          if (canvasRef.current) {\n            const ctx = canvasRef.current.getContext(\"2d\");\n            ctx.clearRect(\n              0,\n              0,\n              canvasRef.current.width,\n              canvasRef.current.height\n            );\n          }\n          dispatch(setRecognizedStudents([])); // Clear recognized students\n          return null;\n        }\n\n        // --- Recognition Logic (if recognize === true) ---\n        let recognizedData = [];\n        if (recognize && classStudents && classStudents.length > 0) {\n          const labeledDescriptors = classStudents\n            .map((student) => {\n              const descriptors = extractStudentDescriptors(student);\n              if (descriptors.length > 0) {\n                return new faceapi.LabeledFaceDescriptors(\n                  student._id,\n                  descriptors\n                ); // Use student ID as label\n              }\n              return null;\n            })\n            .filter((ld) => ld !== null); // Filter out students with no descriptors\n\n          if (labeledDescriptors.length > 0) {\n            const faceMatcher = new faceapi.FaceMatcher(\n              labeledDescriptors,\n              RECOGNITION_THRESHOLD\n            );\n\n            recognizedData = faceData\n              .map((fd, index) => {\n                const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n                const student = classStudents.find(\n                  (s) => s._id === bestMatch.label\n                ); // Find student by ID label\n                return {\n                  detectionIndex: index, // Link recognition to detection\n                  studentId: student?._id,\n                  name: student?.full_name || \"Không rõ\",\n                  confidence: 1 - bestMatch.distance, // Convert distance to confidence-like score\n                  isUnknown: bestMatch.label === \"unknown\",\n                };\n              })\n              .filter((r) => !r.isUnknown); // Filter out unknown matches\n\n            dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n          } else {\n            dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n          }\n        }\n\n        // Draw landmarks and boxes with recognition info\n        drawLandmarks(faceData, recognizedData);\n\n        return { detections: faceData, recognized: recognizedData }; // Return both detection and recognition results\n      } catch (error) {\n        console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n        enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n          variant: \"error\",\n        });\n        // Clear canvas on error\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(\n            0,\n            0,\n            canvasRef.current.width,\n            canvasRef.current.height\n          );\n        }\n        dispatch(setDetectedFaces([]));\n        dispatch(setRecognizedStudents([]));\n        return null;\n      }\n    },\n    [\n      isCameraReady,\n      isModelLoaded,\n      classStudents,\n      drawLandmarks,\n      dispatch,\n      enqueueSnackbar,\n    ]\n  );\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort(\n        (a, b) => b.confidence - a.confidence\n      )[0];\n      enqueueSnackbar(\n        `Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(\n          1\n        )}%)`,\n        { variant: \"info\" }\n      );\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence > CONFIDENCE_THRESHOLD) {\n        handleMarkAttendance(topMatch.studentId, topMatch.confidence);\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\n        \"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\",\n        { variant: \"warning\" }\n      );\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", { variant: \"warning\" });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = (student) => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({ status: \"present\", note: \"\" }); // Reset form\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change\n  const handleManualAttendanceChange = (e) => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n\n    try {\n      const result = await dispatch(\n        manualAttendance({\n          sessionId,\n          studentId: selectedStudent._id,\n          status: manualAttendanceData.status,\n          note: manualAttendanceData.note,\n        })\n      ).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs((prevLogs) => {\n        const existingLogIndex = prevLogs.findIndex(\n          (log) => log.student_id?._id === selectedStudent._id\n        );\n        const newLog = { ...result.data, student_id: selectedStudent }; // Use the selected student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n\n      enqueueSnackbar(\n        `Đã điểm danh thủ công cho ${selectedStudent.full_name}`,\n        { variant: \"success\" }\n      );\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\",\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(\n    async (studentId, confidence) => {\n      if (!studentId || isProcessing) return;\n\n      // Check if student already marked present\n      const isAlreadyPresent = attendanceLogs.some(\n        (log) => log.student_id?._id === studentId && log.status === \"present\"\n      );\n      if (isAlreadyPresent) {\n        // console.log(`Student ${studentId} already marked present.`);\n        return; // Don't mark again if already present\n      }\n\n      const student = classStudents.find((s) => s._id === studentId);\n      if (!student) {\n        console.warn(\"Student not found for marking attendance:\", studentId);\n        return;\n      }\n\n      // Capture image for proof (optional, but good practice)\n      let imageBase64 = null;\n      try {\n        if (webcamRef.current) {\n          imageBase64 = webcamRef.current.getScreenshot({\n            width: 320,\n            height: 240,\n          }); // Smaller screenshot\n        }\n      } catch (screenshotError) {\n        console.error(\"Error taking screenshot:\", screenshotError);\n        // Proceed without image if screenshot fails\n      }\n\n      try {\n        const result = await dispatch(\n          verifyAttendance({\n            sessionId,\n            studentId,\n            // faceDescriptor: null, // Descriptor not strictly needed for verification API if confidence is high\n            confidence,\n            imageBase64,\n            recognized: true, // Mark as recognized by the system\n          })\n        ).unwrap();\n\n        // Update local attendance logs\n        setAttendanceLogs((prevLogs) => {\n          const existingLogIndex = prevLogs.findIndex(\n            (log) => log.student_id?._id === studentId\n          );\n          const newLog = { ...result.data, student_id: student }; // Use the found student data\n          if (existingLogIndex > -1) {\n            const updatedLogs = [...prevLogs];\n            updatedLogs[existingLogIndex] = newLog;\n            return updatedLogs;\n          } else {\n            return [...prevLogs, newLog];\n          }\n        });\n\n        enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n          variant: \"success\",\n        });\n      } catch (error) {\n        console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n        enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n          variant: \"error\",\n        });\n      }\n    },\n    [\n      dispatch,\n      sessionId,\n      classStudents,\n      attendanceLogs,\n      isProcessing,\n      enqueueSnackbar,\n    ]\n  ); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (\n      !isCameraReady ||\n      !isModelLoaded ||\n      !classStudents ||\n      classStudents.length === 0\n    ) {\n      enqueueSnackbar(\n        \"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\",\n        { variant: \"warning\" }\n      );\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", { variant: \"info\" });\n\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach((rec) => {\n          if (rec.confidence > CONFIDENCE_THRESHOLD && rec.studentId) {\n            handleMarkAttendance(rec.studentId, rec.confidence); // Attempt to mark attendance\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [\n    isCameraReady,\n    isModelLoaded,\n    classStudents,\n    detectAndRecognizeFaces,\n    handleMarkAttendance,\n    enqueueSnackbar,\n  ]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", { variant: \"info\" });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang kết thúc phiên...\", { variant: \"info\" });\n      await axios.put(\n        `${API_URL}/attendance/sessions/${sessionId}`,\n        { status: \"completed\" },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", { variant: \"success\" });\n      setSessionInfo((prev) => ({ ...prev, status: \"completed\" })); // Update local state\n      stopAutoAttendance(); // Stop auto mode if running\n      // Optionally navigate back after a delay\n      // setTimeout(() => navigate(`/teacher/classes/${classId}`), 1000);\n    } catch (error) {\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi kết thúc phiên\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", { variant: \"info\" });\n      const [logsRes, sessionRes] = await Promise.all([\n        axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n        axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n      ]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", { variant: \"success\" });\n    } catch (error) {\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi làm mới dữ liệu\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const toggleLandmarks = () => {\n    setShowLandmarks((prev) => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(\n    (log) => log.status === \"present\"\n  );\n  const absentStudents =\n    classInfo?.students?.filter(\n      (student) =>\n        !attendanceLogs.some(\n          (log) =>\n            log.student_id?._id === student._id &&\n            (log.status === \"present\" || log.status === \"late\")\n        ) // Consider late as not absent\n    ) || [];\n  const totalStudents = classInfo?.students?.length || 0;\n  const sessionCompleted = sessionInfo?.status === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return (\n      <Box\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        minHeight=\"80vh\"\n      >\n        <CircularProgress />\n        <Typography sx={{ ml: 2 }}>Đang tải dữ liệu điểm danh...</Typography>\n      </Box>\n    );\n  }\n\n  if (componentError && !isLoading) {\n    return (\n      <Box sx={{ p: 3 }}>\n        <Alert\n          severity=\"error\"\n          action={\n            <Button\n              color=\"inherit\"\n              size=\"small\"\n              onClick={() => window.location.reload()}\n            >\n              Tải lại trang\n            </Button>\n          }\n        >\n          <AlertTitle>Đã xảy ra lỗi</AlertTitle>\n          {componentError}\n        </Alert>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{ p: { xs: 1, sm: 2, md: 3 } }}>\n      {/* Header */}\n      <Box\n        display=\"flex\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        mb={2.5}\n        pb={2}\n        borderBottom=\"1px solid #eaeaea\"\n      >\n        <Box>\n          <Typography variant=\"h5\" fontWeight={500}>\n            Điểm Danh - {classInfo?.class_name}\n          </Typography>\n          <Typography variant=\"subtitle1\" color=\"textSecondary\">\n            Buổi {sessionInfo?.session_number} -{\" \"}\n            {sessionInfo?.date\n              ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\")\n              : \"N/A\"}\n            <Chip\n              label={sessionInfo?.status || \"N/A\"}\n              color={sessionCompleted ? \"default\" : \"success\"}\n              size=\"small\"\n              sx={{ ml: 1 }}\n            />\n          </Typography>\n        </Box>\n        <Button\n          variant=\"outlined\"\n          startIcon={<ArrowBack />}\n          onClick={() => navigate(`/teacher/classes/${classId}`)}\n        >\n          Quay lại lớp\n        </Button>\n      </Box>\n\n      {sessionCompleted && (\n        <Alert severity=\"info\" sx={{ mb: 2 }}>\n          Phiên điểm danh này đã kết thúc. Bạn chỉ có thể xem lại kết quả.\n        </Alert>\n      )}\n\n      {faceRecError && (\n        <Alert severity=\"warning\" sx={{ mb: 2 }}>\n          Lỗi từ hệ thống nhận diện: {faceRecError}\n        </Alert>\n      )}\n\n      <Grid container spacing={3}>\n        {/* Left Column: Camera and Controls */}\n        <Grid item xs={12} md={8}>\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3, overflow: \"hidden\" }}>\n            <CardContent\n              sx={{\n                bgcolor: \"#f8f9fa\",\n                borderBottom: \"1px solid #eaeaea\",\n                p: 2,\n              }}\n            >\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n              >\n                <Typography\n                  variant=\"h6\"\n                  fontWeight={500}\n                  display=\"flex\"\n                  alignItems=\"center\"\n                >\n                  <CameraAlt sx={{ mr: 1, color: \"primary.main\" }} /> Camera\n                </Typography>\n                {!sessionCompleted &&\n                  isModelLoaded && ( // Show controls only if session active and model loaded\n                    <Box>\n                      <Tooltip\n                        title={\n                          isAutoMode\n                            ? \"Dừng chế độ tự động\"\n                            : \"Bắt đầu chế độ tự động\"\n                        }\n                      >\n                        <IconButton\n                          onClick={\n                            isAutoMode\n                              ? stopAutoAttendance\n                              : startAutoAttendance\n                          }\n                          color={isAutoMode ? \"error\" : \"primary\"}\n                          disabled={!isCameraReady}\n                        >\n                          {isAutoMode ? (\n                            <StopCircleOutlined />\n                          ) : (\n                            <PlayCircleOutline />\n                          )}\n                        </IconButton>\n                      </Tooltip>\n                      <Tooltip\n                        title={showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\"}\n                      >\n                        <IconButton\n                          onClick={toggleLandmarks}\n                          color=\"secondary\"\n                          disabled={!isCameraReady || isAutoMode}\n                        >\n                          {showLandmarks ? <VisibilityOff /> : <Visibility />}\n                        </IconButton>\n                      </Tooltip>\n                    </Box>\n                  )}\n              </Box>\n            </CardContent>\n\n            {/* Camera Display Area */}\n            <Box\n              sx={{\n                position: \"relative\",\n                width: \"100%\",\n                aspectRatio: \"640 / 480\",\n                backgroundColor: \"#000\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              {!isModelLoaded && !sessionCompleted ? (\n                <Box textAlign=\"center\" color=\"white\">\n                  <CircularProgress color=\"inherit\" />\n                  <Typography>Đang tải mô hình nhận diện...</Typography>\n                </Box>\n              ) : !sessionCompleted ? (\n                <Suspense\n                  fallback={\n                    <Box textAlign=\"center\" color=\"white\">\n                      <CircularProgress color=\"inherit\" />\n                      <Typography>Đang khởi tạo camera...</Typography>\n                    </Box>\n                  }\n                >\n                  <Webcam\n                    audio={false}\n                    ref={webcamRef}\n                    screenshotFormat=\"image/jpeg\"\n                    width=\"100%\"\n                    height=\"100%\"\n                    videoConstraints={{\n                      width: 640,\n                      height: 480,\n                      facingMode: \"user\",\n                    }}\n                    style={{\n                      display: \"block\",\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      objectFit: \"cover\",\n                    }}\n                    onUserMedia={handleUserMedia}\n                    onUserMediaError={handleUserMediaError}\n                  />\n                </Suspense>\n              ) : (\n                <Typography color=\"white\">Phiên đã kết thúc</Typography> // Placeholder if session completed\n              )}\n\n              {/* Canvas for Overlays */}\n              <canvas\n                ref={canvasRef}\n                style={{\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  zIndex: 10,\n                }}\n              />\n\n              {/* Camera Error/Loading Overlay */}\n              {(!isCameraReady || componentError?.includes(\"camera\")) &&\n                !sessionCompleted && (\n                  <Box\n                    sx={{\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      backgroundColor: \"rgba(0,0,0,0.7)\",\n                      display: \"flex\",\n                      flexDirection: \"column\",\n                      justifyContent: \"center\",\n                      alignItems: \"center\",\n                      color: \"white\",\n                      zIndex: 20,\n                    }}\n                  >\n                    <VideocamOff sx={{ fontSize: 60, mb: 2 }} />\n                    <Typography variant=\"h6\">Camera không khả dụng</Typography>\n                    <Typography\n                      variant=\"body2\"\n                      sx={{ mt: 1, px: 2, textAlign: \"center\" }}\n                    >\n                      {componentError ||\n                        \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"}\n                    </Typography>\n                    <Button\n                      variant=\"outlined\"\n                      color=\"inherit\"\n                      sx={{ mt: 2 }}\n                      onClick={() => window.location.reload()}\n                    >\n                      Thử lại\n                    </Button>\n                  </Box>\n                )}\n              {/* Auto Mode Indicator */}\n              {isAutoMode && isCameraReady && (\n                <Chip\n                  label=\"Đang tự động điểm danh\"\n                  color=\"success\"\n                  size=\"small\"\n                  sx={{\n                    position: \"absolute\",\n                    bottom: 10,\n                    right: 10,\n                    zIndex: 15,\n                  }}\n                />\n              )}\n            </Box>\n\n            {/* Action Buttons */}\n            {!sessionCompleted && isCameraReady && isModelLoaded && (\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                p={2}\n                bgcolor=\"#f8f9fa\"\n                borderTop=\"1px solid #eaeaea\"\n              >\n                <Button\n                  variant=\"contained\"\n                  onClick={handleManualCapture}\n                  startIcon={\n                    isProcessing ? (\n                      <CircularProgress size={20} color=\"inherit\" />\n                    ) : (\n                      <CameraAlt />\n                    )\n                  }\n                  disabled={isProcessing || isAutoMode}\n                >\n                  Chụp & Nhận diện\n                </Button>\n                <Button\n                  variant=\"contained\"\n                  color=\"secondary\"\n                  onClick={completeSession}\n                  startIcon={<Save />}\n                  disabled={isProcessing}\n                >\n                  Kết thúc phiên\n                </Button>\n              </Box>\n            )}\n          </Card>\n\n          {/* Recognized Students Preview (Optional) */}\n          {recognizedStudents.length > 0 && !isAutoMode && (\n            <Card sx={{ mt: 2, borderRadius: \"10px\", boxShadow: 1 }}>\n              <CardContent>\n                <Typography variant=\"subtitle1\" fontWeight=\"500\" mb={1}>\n                  Đã nhận diện gần đây\n                </Typography>\n                <Grid container spacing={1}>\n                  {recognizedStudents.slice(0, 4).map(\n                    (\n                      rec,\n                      index // Show max 4\n                    ) => (\n                      <Grid\n                        item\n                        xs={6}\n                        sm={3}\n                        key={`${rec.studentId}-${index}`}\n                      >\n                        <Paper\n                          elevation={0}\n                          sx={{\n                            p: 1,\n                            textAlign: \"center\",\n                            border: \"1px solid #eee\",\n                          }}\n                        >\n                          <Typography variant=\"caption\" display=\"block\" noWrap>\n                            {rec.name}\n                          </Typography>\n                          <Chip\n                            label={`${(rec.confidence * 100).toFixed(0)}%`}\n                            size=\"small\"\n                            color={\n                              rec.confidence > CONFIDENCE_THRESHOLD\n                                ? \"success\"\n                                : \"warning\"\n                            }\n                            sx={{ mt: 0.5 }}\n                          />\n                        </Paper>\n                      </Grid>\n                    )\n                  )}\n                </Grid>\n              </CardContent>\n            </Card>\n          )}\n        </Grid>\n\n        {/* Right Column: Student Lists */}\n        <Grid item xs={12} md={4}>\n          {/* Present Students */}\n          <Card sx={{ mb: 3, borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Typography variant=\"h6\" display=\"flex\" alignItems=\"center\">\n                  <Check sx={{ mr: 1, color: \"success.main\" }} /> Có mặt (\n                  {presentStudents.length}/{totalStudents})\n                </Typography>\n                <Tooltip title=\"Làm mới danh sách\">\n                  <IconButton\n                    size=\"small\"\n                    onClick={refreshAttendanceLogs}\n                    disabled={isProcessing}\n                  >\n                    <Refresh />\n                  </IconButton>\n                </Tooltip>\n              </Box>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {presentStudents.map((student) => (\n                  <Typography key={student._id} variant=\"body2\">\n                    {student.full_name}\n                  </Typography>\n                ))}\n              </Box>\n            </CardContent>\n          </Card>\n\n          {/* Absent Students */}\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Typography\n                variant=\"h6\"\n                display=\"flex\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Close sx={{ mr: 1, color: \"error.main\" }} /> Vắng mặt (\n                {absentStudents.length}/{totalStudents})\n              </Typography>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {absentStudents.length === 0 ? (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"textSecondary\"\n                    align=\"center\"\n                    sx={{ py: 2 }}\n                  >\n                    Tất cả sinh viên đã có mặt.\n                  </Typography>\n                ) : (\n                  <List dense>\n                    {absentStudents.map((student) => (\n                      <ListItem\n                        key={student._id}\n                        disablePadding\n                        sx={{ mb: 0.5 }}\n                        secondaryAction={\n                          !sessionCompleted ? (\n                            <Tooltip title=\"Điểm danh thủ công\">\n                              <IconButton\n                                edge=\"end\"\n                                size=\"small\"\n                                onClick={() =>\n                                  openManualAttendanceDialog(student)\n                                }\n                                disabled={isProcessing}\n                              >\n                                <Edit fontSize=\"small\" />\n                              </IconButton>\n                            </Tooltip>\n                          ) : null\n                        }\n                      >\n                        <Paper\n                          variant=\"outlined\"\n                          sx={{\n                            width: \"100%\",\n                            display: \"flex\",\n                            alignItems: \"center\",\n                            p: 0.5,\n                            borderRadius: \"4px\",\n                          }}\n                        >\n                          <ListItemAvatar sx={{ minWidth: 45 }}>\n                            <Avatar\n                              alt={student.full_name}\n                              src={student.avatar_url}\n                              sx={{ width: 32, height: 32 }}\n                            />\n                          </ListItemAvatar>\n                          <ListItemText\n                            primary={\n                              <Typography variant=\"body2\" noWrap>\n                                {student.full_name}\n                              </Typography>\n                            }\n                            secondary={\n                              <Typography\n                                variant=\"caption\"\n                                color=\"text.secondary\"\n                              >\n                                {student.student_code}\n                              </Typography>\n                            }\n                          />\n                        </Paper>\n                      </ListItem>\n                    ))}\n                  </List>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n        </Grid>\n      </Grid>\n\n      {/* Manual Attendance Dialog */}\n      <Dialog\n        open={manualDialogOpen}\n        onClose={handleManualDialogClose}\n        maxWidth=\"xs\"\n        fullWidth\n      >\n        <DialogTitle>Điểm Danh Thủ Công</DialogTitle>\n        <DialogContent>\n          <TextField\n            label=\"Trạng Thái\"\n            name=\"status\"\n            value={manualAttendanceData.status}\n            onChange={handleManualAttendanceChange}\n            fullWidth\n          />\n          <TextField\n            label=\"Ghi Chú\"\n            name=\"note\"\n            value={manualAttendanceData.note}\n            onChange={handleManualAttendanceChange}\n            fullWidth\n            multiline\n            rows={4}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleManualDialogClose}>Hủy</Button>\n          <Button onClick={handleManualAttendanceSubmit}>Lưu</Button>\n        </DialogActions>\n      </Dialog>\n    </Box>\n  );\n};\n\nexport default AttendancePage;\n"],"mappings":";;AAAA,OAAOA,KAAK,IACVC,QAAQ,EACRC,SAAS,EACTC,MAAM,EACNC,IAAI,EACJC,QAAQ,EACRC,WAAW,QACN,OAAO;AACd,SAASC,SAAS,EAAEC,WAAW,QAAQ,kBAAkB;AACzD,SAASC,WAAW,EAAEC,WAAW,QAAQ,aAAa;AACtD,SAASC,WAAW,QAAQ,WAAW;AACvC,OAAOC,KAAK,MAAM,OAAO;AACzB,OAAO,KAAKC,OAAO,MAAM,aAAa;AACtC,SACEC,GAAG,EACHC,UAAU,EACVC,IAAI,EACJC,WAAW,EACXC,IAAI,EACJC,KAAK,EACLC,MAAM,EACNC,OAAO,EACPC,gBAAgB,EAChBC,IAAI,EACJC,QAAQ,EACRC,cAAc,EACdC,YAAY,EACZC,MAAM,EACNC,IAAI,EACJC,MAAM,EACNC,WAAW,EACXC,aAAa,EACbC,aAAa,EACbC,SAAS,EACTC,WAAW,EACXC,UAAU,EACVC,MAAM,EACNC,QAAQ,EACRC,UAAU,EACVC,KAAK,EACLC,UAAU,EACVC,OAAO,EACPC,OAAO,EACPC,IAAI,EACJC,SAAS,EACTC,WAAW,QACN,eAAe;AACtB,SACEC,SAAS,EACTC,KAAK,EACLC,KAAK,EACLC,IAAI,EACJC,OAAO,EACPC,IAAI,EACJC,YAAY,EACZC,cAAc,EACdC,SAAS,EACTC,IAAI,EACJC,WAAW,EACXC,iBAAiB,EACjBC,kBAAkB,EAClBC,UAAU,EACVC,aAAa,QACR,qBAAqB;AAC5B,SACEC,cAAc,IAAIC,qBAAqB;AAAE;AACzCC,cAAc,IAAIC,qBAAqB;AAAE;AACzCC,gBAAgB,EAChBC,qBAAqB,EACrBC,qBAAqB,EACrBC,mBAAmB,EACnBC,mBAAmB,IAAIC,0BAA0B;AAAE;AACnDC,mBAAmB,IAAIC,0BAA0B;AAAE;AACnDC,mBAAmB,EACnBC,wBAAwB,EACxBC,kBAAkB,IAAIC,yBAAyB;AAAE;AACjDC,WAAW,IAAIC,kBAAkB;AAAE;AACnCC,sBAAsB;AAAE;AACxBC,gBAAgB,EAChBC,gBAAgB,QACX,yCAAyC,CAAC,CAAC;;AAElD;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACA,MAAMC,MAAM,gBAAGhF,IAAI,CAAAiF,EAAA,GAACA,CAAA,KAAM,MAAM,CAAC,cAAc,CAAC,CAAC;AAACC,GAAA,GAA5CF,MAAM;AAEZ,MAAMG,OAAO,GAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,IAAI,2BAA2B;;AAE5E;AACA,MAAMC,qBAAqB,GAAG,IAAI;AAClC,MAAMC,mBAAmB,GAAG,GAAG;AAC/B,MAAMC,oBAAoB,GAAG,GAAG,CAAC,CAAC;AAClC,MAAMC,oBAAoB,GAAG,IAAI,CAAC,CAAC;AACnC,MAAMC,sBAAsB,GAAG,IAAIlF,OAAO,CAACmF,uBAAuB,CAAC;EACjEC,cAAc,EAAEL,mBAAmB;EACnCM,SAAS,EAAE;AACb,CAAC,CAAC;AACF,MAAMC,SAAS,GAAG,SAAS,CAAC,CAAC;;AAE7B;;AAEA;AACA,MAAMC,yBAAyB,GAAG,MAAAA,CAAOC,QAAQ,EAAEC,eAAe,KAAK;EACrE,IAAI;IACF;IACA,IACEzF,OAAO,CAAC0F,IAAI,CAACC,gBAAgB,CAACC,QAAQ,IACtC5F,OAAO,CAAC0F,IAAI,CAACG,iBAAiB,CAACD,QAAQ,IACvC5F,OAAO,CAAC0F,IAAI,CAACI,kBAAkB,CAACF;IAChC;IAAA,EACA;MACAJ,QAAQ,CAACvC,qBAAqB,CAAC,IAAI,CAAC,CAAC;MACrC,OAAO,IAAI;IACb;IAEAwC,eAAe,CAAC,+BAA+B,EAAE;MAC/CM,OAAO,EAAE,MAAM;MACfC,gBAAgB,EAAE;IACpB,CAAC,CAAC;IACF,MAAMC,OAAO,CAACC,GAAG,CAAC,CAChBlG,OAAO,CAAC0F,IAAI,CAACC,gBAAgB,CAACQ,WAAW,CAACb,SAAS,CAAC,EACpDtF,OAAO,CAAC0F,IAAI,CAACG,iBAAiB,CAACM,WAAW,CAACb,SAAS,CAAC,EACrDtF,OAAO,CAAC0F,IAAI,CAACI,kBAAkB,CAACK,WAAW,CAACb,SAAS,CAAC,CACvD,CAAC;IACFE,QAAQ,CAACvC,qBAAqB,CAAC,IAAI,CAAC,CAAC;IACrCwC,eAAe,CAAC,kCAAkC,EAAE;MAAEM,OAAO,EAAE;IAAU,CAAC,CAAC;IAC3E,OAAO,IAAI;EACb,CAAC,CAAC,OAAOK,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;IAC5CX,eAAe,CAAC,iCAAiC,EAAE;MAAEM,OAAO,EAAE;IAAQ,CAAC,CAAC;IACxEP,QAAQ,CAACvC,qBAAqB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IACxC,OAAO,KAAK;EACd;AACF,CAAC;;AAED;AACA,MAAMqD,yBAAyB,GAAIC,OAAO,IAAK;EAAA,IAAAC,qBAAA,EAAAC,sBAAA;EAC7C,IACE,CAACF,OAAO,IACP,GAAAC,qBAAA,GAACD,OAAO,CAACG,YAAY,cAAAF,qBAAA,eAApBA,qBAAA,CAAsBG,WAAW,KAAI,CAACJ,OAAO,CAACK,eAAgB,EAChE;IACA,OAAO,EAAE;EACX;EAEA,MAAMD,WAAW,GAAG,EAAE;EACtB,MAAME,cAAc,GAClB,EAAAJ,sBAAA,GAAAF,OAAO,CAACG,YAAY,cAAAD,sBAAA,uBAApBA,sBAAA,CAAsBE,WAAW,KAAIJ,OAAO,CAACK,eAAe,IAAI,EAAE;EAEpE,MAAME,eAAe,GAAIC,IAAI,IAAK;IAChC,IAAI,CAACA,IAAI,EAAE;IACX,IAAIC,KAAK,CAACC,OAAO,CAACF,IAAI,CAAC,EAAE;MACvB,IAAIA,IAAI,CAACG,MAAM,KAAK,GAAG,IAAIH,IAAI,CAACI,KAAK,CAAEC,CAAC,IAAK,OAAOA,CAAC,KAAK,QAAQ,CAAC,EAAE;QACnET,WAAW,CAACU,IAAI,CAAC,IAAIC,YAAY,CAACP,IAAI,CAAC,CAAC,CAAC,CAAC;MAC5C,CAAC,MAAM;QACLA,IAAI,CAACQ,OAAO,CAACT,eAAe,CAAC,CAAC,CAAC;MACjC;IACF,CAAC,MAAM,IAAI,OAAOC,IAAI,KAAK,QAAQ,IAAIA,IAAI,KAAK,IAAI,EAAE;MACpD;MACAS,MAAM,CAACC,MAAM,CAACV,IAAI,CAAC,CAACQ,OAAO,CAACT,eAAe,CAAC;IAC9C;EACF,CAAC;EAEDA,eAAe,CAACD,cAAc,CAAC;EAC/B,OAAOF,WAAW,CAACe,MAAM,CAAEC,CAAC,IAAKA,CAAC,CAACT,MAAM,KAAK,GAAG,CAAC,CAAC,CAAC;AACtD,CAAC;;AAED;;AAEA,MAAMU,cAAc,GAAGA,CAAA,KAAM;EAAAC,EAAA;EAAA,IAAAC,mBAAA,EAAAC,oBAAA;EAC3B,MAAM;IAAEC,OAAO;IAAEC;EAAU,CAAC,GAAGvI,SAAS,CAAC,CAAC;EAC1C,MAAMwI,QAAQ,GAAGvI,WAAW,CAAC,CAAC;EAC9B,MAAM6F,QAAQ,GAAG5F,WAAW,CAAC,CAAC;EAC9B,MAAM;IAAE6F;EAAgB,CAAC,GAAG3F,WAAW,CAAC,CAAC;;EAEzC;EACA,MAAMqI,SAAS,GAAG7I,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAM8I,SAAS,GAAG9I,MAAM,CAAC,IAAI,CAAC;EAC9B,MAAM+I,mBAAmB,GAAG/I,MAAM,CAAC,IAAI,CAAC;EACxC,MAAMgJ,mBAAmB,GAAGhJ,MAAM,CAAC,IAAI,CAAC;;EAExC;EACA,MAAM,CAACiJ,SAAS,EAAEC,YAAY,CAAC,GAAGpJ,QAAQ,CAAC,IAAI,CAAC;EAChD,MAAM,CAACqJ,SAAS,EAAEC,YAAY,CAAC,GAAGtJ,QAAQ,CAAC,IAAI,CAAC;EAChD,MAAM,CAACuJ,WAAW,EAAEC,cAAc,CAAC,GAAGxJ,QAAQ,CAAC,IAAI,CAAC;EACpD,MAAM,CAACyJ,cAAc,EAAEC,iBAAiB,CAAC,GAAG1J,QAAQ,CAAC,EAAE,CAAC;EACxD,MAAM,CAAC2J,UAAU,EAAEC,aAAa,CAAC,GAAG5J,QAAQ,CAAC,KAAK,CAAC;EACnD,MAAM,CAAC6J,aAAa,EAAEC,gBAAgB,CAAC,GAAG9J,QAAQ,CAAC,IAAI,CAAC;EACxD,MAAM,CAAC+J,gBAAgB,EAAEC,mBAAmB,CAAC,GAAGhK,QAAQ,CAAC,KAAK,CAAC;EAC/D,MAAM,CAACiK,eAAe,EAAEC,kBAAkB,CAAC,GAAGlK,QAAQ,CAAC,IAAI,CAAC;EAC5D,MAAM,CAACmK,oBAAoB,EAAEC,uBAAuB,CAAC,GAAGpK,QAAQ,CAAC;IAC/DqK,MAAM,EAAE,SAAS;IACjBC,IAAI,EAAE;EACR,CAAC,CAAC;EACF,MAAM,CAACC,cAAc,EAAEC,iBAAiB,CAAC,GAAGxK,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;;EAE5D;EACA,MAAM;IAAEyK;EAAM,CAAC,GAAGhK,WAAW,CAAEiK,KAAK,IAAKA,KAAK,CAACC,IAAI,CAAC;EACpD,MAAMC,aAAa,GAAGnK,WAAW,CAAC4D,0BAA0B,CAAC;EAC7D,MAAMwG,aAAa,GAAGpK,WAAW,CAAC8D,0BAA0B,CAAC;EAC7D,MAAMuG,aAAa,GAAGrK,WAAW,CAAC+D,mBAAmB,CAAC;EACtD,MAAMuG,kBAAkB,GAAGtK,WAAW,CAACgE,wBAAwB,CAAC;EAChE,MAAMuG,aAAa,GAAGvK,WAAW,CAAEiK,KAAK,IACtCvG,mBAAmB,CAACuG,KAAK,EAAE9B,OAAO,CACpC,CAAC,CAAC,CAAC;EACH,MAAMqC,YAAY,GAAGxK,WAAW,CAACkE,yBAAyB,CAAC,CAAC,CAAC;EAC7D,MAAMuG,YAAY,GAAGzK,WAAW,CAACoE,kBAAkB,CAAC,CAAC,CAAC;;EAEtD;;EAEA;EACA5E,SAAS,CAAC,MAAM;IACd,MAAMkL,QAAQ,GAAG,MAAAA,CAAA,KAAY;MAC3B/B,YAAY,CAAC,IAAI,CAAC;MAClBoB,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC;MACzB,IAAI;QACF;QACA,MAAM,CAACY,QAAQ,EAAEC,UAAU,EAAEC,OAAO,CAAC,GAAG,MAAMzE,OAAO,CAACC,GAAG,CAAC,CACxDnG,KAAK,CAAC4K,GAAG,CAAC,GAAGjG,OAAO,qBAAqBsD,OAAO,EAAE,EAAE;UAClD4C,OAAO,EAAE;YAAEC,aAAa,EAAE,UAAUhB,KAAK;UAAG;QAC9C,CAAC,CAAC,EACF9J,KAAK,CAAC4K,GAAG,CAAC,GAAGjG,OAAO,wBAAwBuD,SAAS,EAAE,EAAE;UACvD2C,OAAO,EAAE;YAAEC,aAAa,EAAE,UAAUhB,KAAK;UAAG;QAC9C,CAAC,CAAC,EACF9J,KAAK,CAAC4K,GAAG,CAAC,GAAGjG,OAAO,oBAAoBuD,SAAS,EAAE,EAAE;UACnD2C,OAAO,EAAE;YAAEC,aAAa,EAAE,UAAUhB,KAAK;UAAG;QAC9C,CAAC,CAAC,CACH,CAAC;QAEF,MAAMiB,iBAAiB,GAAGL,UAAU,CAAC1D,IAAI,CAACA,IAAI;QAC9C2B,YAAY,CAAC8B,QAAQ,CAACzD,IAAI,CAACA,IAAI,CAAC;QAChC6B,cAAc,CAACkC,iBAAiB,CAAC;QACjChC,iBAAiB,CAAC4B,OAAO,CAAC3D,IAAI,CAACA,IAAI,CAAC;;QAEpC;QACA,IAAI,CAACiD,aAAa,EAAE;UAClB,MAAMzE,yBAAyB,CAACC,QAAQ,EAAEC,eAAe,CAAC;UAC1D;UACA,IAAI,CAACuE,aAAa,EAAE;YAClB;YACA,MAAM,IAAIe,KAAK,CAAC,yCAAyC,CAAC;UAC5D;QACF;;QAEA;QACA,IAAI,CAAAD,iBAAiB,aAAjBA,iBAAiB,uBAAjBA,iBAAiB,CAAErB,MAAM,MAAK,WAAW,IAAIO,aAAa,EAAE;UAC9D,MAAMxE,QAAQ,CAACtB,sBAAsB,CAAC8D,OAAO,CAAC,CAAC,CAACgD,MAAM,CAAC,CAAC;QAC1D;MACF,CAAC,CAAC,OAAO5E,KAAK,EAAE;QAAA,IAAA6E,eAAA,EAAAC,oBAAA;QACd7E,OAAO,CAACD,KAAK,CAAC,sBAAsB,EAAEA,KAAK,CAAC;QAC5C,MAAM+E,MAAM,GACV,EAAAF,eAAA,GAAA7E,KAAK,CAACgF,QAAQ,cAAAH,eAAA,wBAAAC,oBAAA,GAAdD,eAAA,CAAgBlE,IAAI,cAAAmE,oBAAA,uBAApBA,oBAAA,CAAsBG,OAAO,KAC7BjF,KAAK,CAACiF,OAAO,IACb,qBAAqB;QACvB5F,eAAe,CAAC0F,MAAM,EAAE;UAAEpF,OAAO,EAAE;QAAQ,CAAC,CAAC;QAC7C6D,iBAAiB,CAACuB,MAAM,CAAC,CAAC,CAAC;MAC7B,CAAC,SAAS;QACR3C,YAAY,CAAC,KAAK,CAAC;MACrB;IACF,CAAC;IACD+B,QAAQ,CAAC,CAAC;;IAEV;IACA,OAAO,MAAM;MAAA,IAAAe,kBAAA,EAAAC,qBAAA,EAAAC,sBAAA;MACXhG,QAAQ,CAAClC,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAAC;MACnCmI,aAAa,CAACpD,mBAAmB,CAACqD,OAAO,CAAC;MAC1CD,aAAa,CAACnD,mBAAmB,CAACoD,OAAO,CAAC;MAC1C;MACA,CAAAJ,kBAAA,GAAAnD,SAAS,CAACuD,OAAO,cAAAJ,kBAAA,wBAAAC,qBAAA,GAAjBD,kBAAA,CAAmBK,KAAK,cAAAJ,qBAAA,wBAAAC,sBAAA,GAAxBD,qBAAA,CAA0BK,SAAS,cAAAJ,sBAAA,uBAAnCA,sBAAA,CACIK,SAAS,CAAC,CAAC,CACZtE,OAAO,CAAEuE,KAAK,IAAKA,KAAK,CAACC,IAAI,CAAC,CAAC,CAAC;IACrC,CAAC;IACD;EACF,CAAC,EAAE,CAAC/D,OAAO,EAAEC,SAAS,EAAE4B,KAAK,EAAErE,QAAQ,EAAEC,eAAe,EAAEuE,aAAa,CAAC,CAAC;;EAEzE;EACA3K,SAAS,CAAC,MAAM;IACd,IAAI4K,aAAa,IAAIhB,aAAa,IAAI,CAACF,UAAU,EAAE;MACjD;MACAiD,sBAAsB,CAAC,CAAC;IAC1B,CAAC,MAAM;MACLC,qBAAqB,CAAC,CAAC;MACvB;MACA,IAAI7D,SAAS,CAACsD,OAAO,EAAE;QACrB,MAAMQ,GAAG,GAAG9D,SAAS,CAACsD,OAAO,CAACS,UAAU,CAAC,IAAI,CAAC;QAC9CD,GAAG,CAACE,SAAS,CAAC,CAAC,EAAE,CAAC,EAAEhE,SAAS,CAACsD,OAAO,CAACW,KAAK,EAAEjE,SAAS,CAACsD,OAAO,CAACY,MAAM,CAAC;MACxE;IACF;IACA;IACA,OAAO,MAAML,qBAAqB,CAAC,CAAC;EACtC,CAAC,EAAE,CAAChC,aAAa,EAAEhB,aAAa,EAAEF,UAAU,CAAC,CAAC,CAAC,CAAC;;EAEhD;;EAEA,MAAMwD,eAAe,GAAG9M,WAAW,CAChC+M,MAAM,IAAK;IACVnG,OAAO,CAACoG,GAAG,CAAC,uCAAuC,EAAED,MAAM,CAACE,EAAE,CAAC;IAC/DlH,QAAQ,CAACrC,qBAAqB,CAAC,IAAI,CAAC,CAAC;IACrCyG,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC;EAC3B,CAAC,EACD,CAACpE,QAAQ,CACX,CAAC;EAED,MAAMmH,oBAAoB,GAAGlN,WAAW,CACrC2G,KAAK,IAAK;IACTC,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;IAChD,MAAM+E,MAAM,GAAG,8BACb/E,KAAK,CAACwG,IAAI,KAAK,iBAAiB,GAC5B,oCAAoC,GACpCxG,KAAK,CAACwG,IAAI,KAAK,eAAe,GAC9B,gCAAgC,GAChCxG,KAAK,CAACiF,OAAO,IAAI,oBAAoB,EACzC;IACF5F,eAAe,CAAC0F,MAAM,EAAE;MAAEpF,OAAO,EAAE;IAAQ,CAAC,CAAC;IAC7CP,QAAQ,CAACrC,qBAAqB,CAAC,KAAK,CAAC,CAAC;IACtCyG,iBAAiB,CAACuB,MAAM,CAAC;EAC3B,CAAC,EACD,CAAC3F,QAAQ,EAAEC,eAAe,CAC5B,CAAC;;EAED;;EAEA,MAAMoH,aAAa,GAAGpN,WAAW,CAC/B,CAACqN,UAAU,EAAEC,cAAc,GAAG,EAAE,KAAK;IAAA,IAAAC,mBAAA;IACnC,IAAI,CAAC5E,SAAS,CAACsD,OAAO,IAAI,GAAAsB,mBAAA,GAAC7E,SAAS,CAACuD,OAAO,cAAAsB,mBAAA,eAAjBA,mBAAA,CAAmBrB,KAAK,GAAE;IAErD,MAAMA,KAAK,GAAGxD,SAAS,CAACuD,OAAO,CAACC,KAAK;IACrC,MAAMsB,MAAM,GAAG7E,SAAS,CAACsD,OAAO;IAChC,MAAMwB,WAAW,GAAG;MAClBb,KAAK,EAAEV,KAAK,CAACwB,UAAU;MACvBb,MAAM,EAAEX,KAAK,CAACyB;IAChB,CAAC;IACDpN,OAAO,CAACqN,eAAe,CAACJ,MAAM,EAAEC,WAAW,CAAC;IAE5C,MAAMI,iBAAiB,GAAGtN,OAAO,CAACuN,aAAa,CAACT,UAAU,EAAEI,WAAW,CAAC;IACxE,MAAMhB,GAAG,GAAGe,MAAM,CAACd,UAAU,CAAC,IAAI,CAAC;IACnCD,GAAG,CAACE,SAAS,CAAC,CAAC,EAAE,CAAC,EAAEa,MAAM,CAACZ,KAAK,EAAEY,MAAM,CAACX,MAAM,CAAC;IAEhDgB,iBAAiB,CAAC/F,OAAO,CAAC,CAACiG,SAAS,EAAEC,CAAC,KAAK;MAC1C,MAAMC,GAAG,GAAGF,SAAS,CAACA,SAAS,CAACE,GAAG;MACnC,MAAMC,SAAS,GAAGH,SAAS,CAACG,SAAS;MACrC,MAAMC,UAAU,GAAGb,cAAc,CAACc,IAAI,CACnCC,GAAG,IAAKA,GAAG,CAACC,cAAc,KAAKN,CAClC,CAAC,CAAC,CAAC;;MAEH;MACA,MAAMO,QAAQ,GAAGJ,UAAU,GACvBA,UAAU,CAACK,UAAU,GAAGjJ,oBAAoB,GAC1C,SAAS,GACT,SAAS,GACX,SAAS,CAAC,CAAC;MACfkH,GAAG,CAACgC,WAAW,GAAGF,QAAQ;MAC1B9B,GAAG,CAACiC,SAAS,GAAG,CAAC;MACjBjC,GAAG,CAACkC,UAAU,CAACV,GAAG,CAACW,CAAC,EAAEX,GAAG,CAACY,CAAC,EAAEZ,GAAG,CAACrB,KAAK,EAAEqB,GAAG,CAACpB,MAAM,CAAC;;MAEnD;MACA,MAAMiC,KAAK,GAAGX,UAAU,GACpB,GAAGA,UAAU,CAAChB,IAAI,KAAK,CAACgB,UAAU,CAACK,UAAU,GAAG,GAAG,EAAEO,OAAO,CAAC,CAAC,CAAC,IAAI,GACnE,mBAAmB;MACvB,MAAMC,SAAS,GAAGvC,GAAG,CAACwC,WAAW,CAACH,KAAK,CAAC,CAAClC,KAAK;MAC9CH,GAAG,CAACyC,SAAS,GAAG,oBAAoB;MACpCzC,GAAG,CAAC0C,QAAQ,CAAClB,GAAG,CAACW,CAAC,EAAEX,GAAG,CAACY,CAAC,GAAG,EAAE,EAAEG,SAAS,GAAG,EAAE,EAAE,EAAE,CAAC;;MAEnD;MACAvC,GAAG,CAACyC,SAAS,GAAG,SAAS;MACzBzC,GAAG,CAAC2C,IAAI,GAAG,YAAY;MACvB3C,GAAG,CAAC4C,QAAQ,CAACP,KAAK,EAAEb,GAAG,CAACW,CAAC,GAAG,CAAC,EAAEX,GAAG,CAACY,CAAC,GAAG,CAAC,CAAC;;MAEzC;MACA,IAAIrF,aAAa,IAAI0E,SAAS,EAAE;QAC9B3N,OAAO,CAAC+O,IAAI,CAACC,iBAAiB,CAAC/B,MAAM,EAAEK,iBAAiB,CAAC,CAAC,CAAC;MAC7D;IACF,CAAC,CAAC;EACJ,CAAC,EACD,CAACrE,aAAa,CAChB,CAAC,CAAC,CAAC;;EAEH,MAAMgG,uBAAuB,GAAGxP,WAAW,CACzC,OAAOyP,SAAS,GAAG,IAAI,KAAK;IAAA,IAAAC,mBAAA;IAC1B,IACE,CAAClF,aAAa,IACd,GAAAkF,mBAAA,GAAChH,SAAS,CAACuD,OAAO,cAAAyD,mBAAA,eAAjBA,mBAAA,CAAmBxD,KAAK,KACzBxD,SAAS,CAACuD,OAAO,CAACC,KAAK,CAACyD,UAAU,KAAK,CAAC,IACxC,CAACpF,aAAa,EACd;MACA,OAAO,IAAI,CAAC,CAAC;IACf;IAEA,MAAM2B,KAAK,GAAGxD,SAAS,CAACuD,OAAO,CAACC,KAAK;IAErC,IAAI;MACF,IAAI0D,QAAQ;MACZ,IAAIH,SAAS,EAAE;QACb;QACAG,QAAQ,GAAG,MAAMrP,OAAO,CACrBsP,cAAc,CAAC3D,KAAK,EAAEzG,sBAAsB,CAAC,CAC7CqK,iBAAiB,CAAC,CAAC,CACnBC,mBAAmB,CAAC,CAAC;MAC1B,CAAC,MAAM;QACL;QACAH,QAAQ,GAAG,MAAMrP,OAAO,CACrBsP,cAAc,CAAC3D,KAAK,EAAEzG,sBAAsB,CAAC,CAC7CqK,iBAAiB,CAAC,CAAC;MACxB;MAEA/J,QAAQ,CAACpC,gBAAgB,CAACiM,QAAQ,CAAC,CAAC,CAAC,CAAC;;MAEtC,IAAI,CAACA,QAAQ,IAAIA,QAAQ,CAACnI,MAAM,KAAK,CAAC,EAAE;QACtC;QACA,IAAIkB,SAAS,CAACsD,OAAO,EAAE;UACrB,MAAMQ,GAAG,GAAG9D,SAAS,CAACsD,OAAO,CAACS,UAAU,CAAC,IAAI,CAAC;UAC9CD,GAAG,CAACE,SAAS,CACX,CAAC,EACD,CAAC,EACDhE,SAAS,CAACsD,OAAO,CAACW,KAAK,EACvBjE,SAAS,CAACsD,OAAO,CAACY,MACpB,CAAC;QACH;QACA9G,QAAQ,CAACnC,qBAAqB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QACrC,OAAO,IAAI;MACb;;MAEA;MACA,IAAI0J,cAAc,GAAG,EAAE;MACvB,IAAImC,SAAS,IAAI9E,aAAa,IAAIA,aAAa,CAAClD,MAAM,GAAG,CAAC,EAAE;QAC1D,MAAMuI,kBAAkB,GAAGrF,aAAa,CACrCsF,GAAG,CAAEnJ,OAAO,IAAK;UAChB,MAAMI,WAAW,GAAGL,yBAAyB,CAACC,OAAO,CAAC;UACtD,IAAII,WAAW,CAACO,MAAM,GAAG,CAAC,EAAE;YAC1B,OAAO,IAAIlH,OAAO,CAAC2P,sBAAsB,CACvCpJ,OAAO,CAACqJ,GAAG,EACXjJ,WACF,CAAC,CAAC,CAAC;UACL;UACA,OAAO,IAAI;QACb,CAAC,CAAC,CACDe,MAAM,CAAEmI,EAAE,IAAKA,EAAE,KAAK,IAAI,CAAC,CAAC,CAAC;;QAEhC,IAAIJ,kBAAkB,CAACvI,MAAM,GAAG,CAAC,EAAE;UACjC,MAAM4I,WAAW,GAAG,IAAI9P,OAAO,CAAC+P,WAAW,CACzCN,kBAAkB,EAClB3K,qBACF,CAAC;UAEDiI,cAAc,GAAGsC,QAAQ,CACtBK,GAAG,CAAC,CAACM,EAAE,EAAEC,KAAK,KAAK;YAClB,MAAMC,SAAS,GAAGJ,WAAW,CAACK,aAAa,CAACH,EAAE,CAACI,UAAU,CAAC;YAC1D,MAAM7J,OAAO,GAAG6D,aAAa,CAACyD,IAAI,CAC/BwC,CAAC,IAAKA,CAAC,CAACT,GAAG,KAAKM,SAAS,CAAC3B,KAC7B,CAAC,CAAC,CAAC;YACH,OAAO;cACLR,cAAc,EAAEkC,KAAK;cAAE;cACvBK,SAAS,EAAE/J,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEqJ,GAAG;cACvBhD,IAAI,EAAE,CAAArG,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEgK,SAAS,KAAI,UAAU;cACtCtC,UAAU,EAAE,CAAC,GAAGiC,SAAS,CAACM,QAAQ;cAAE;cACpCC,SAAS,EAAEP,SAAS,CAAC3B,KAAK,KAAK;YACjC,CAAC;UACH,CAAC,CAAC,CACD7G,MAAM,CAAEgJ,CAAC,IAAK,CAACA,CAAC,CAACD,SAAS,CAAC,CAAC,CAAC;;UAEhCjL,QAAQ,CAACnC,qBAAqB,CAAC0J,cAAc,CAAC,CAAC,CAAC,CAAC;QACnD,CAAC,MAAM;UACLvH,QAAQ,CAACnC,qBAAqB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;QACvC;MACF;;MAEA;MACAwJ,aAAa,CAACwC,QAAQ,EAAEtC,cAAc,CAAC;MAEvC,OAAO;QAAED,UAAU,EAAEuC,QAAQ;QAAEzB,UAAU,EAAEb;MAAe,CAAC,CAAC,CAAC;IAC/D,CAAC,CAAC,OAAO3G,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,wCAAwC,EAAEA,KAAK,CAAC;MAC9DX,eAAe,CAAC,qCAAqC,EAAE;QACrDM,OAAO,EAAE;MACX,CAAC,CAAC;MACF;MACA,IAAIqC,SAAS,CAACsD,OAAO,EAAE;QACrB,MAAMQ,GAAG,GAAG9D,SAAS,CAACsD,OAAO,CAACS,UAAU,CAAC,IAAI,CAAC;QAC9CD,GAAG,CAACE,SAAS,CACX,CAAC,EACD,CAAC,EACDhE,SAAS,CAACsD,OAAO,CAACW,KAAK,EACvBjE,SAAS,CAACsD,OAAO,CAACY,MACpB,CAAC;MACH;MACA9G,QAAQ,CAACpC,gBAAgB,CAAC,EAAE,CAAC,CAAC;MAC9BoC,QAAQ,CAACnC,qBAAqB,CAAC,EAAE,CAAC,CAAC;MACnC,OAAO,IAAI;IACb;EACF,CAAC,EACD,CACE4G,aAAa,EACbD,aAAa,EACbI,aAAa,EACbyC,aAAa,EACbrH,QAAQ,EACRC,eAAe,CAEnB,CAAC;;EAED;;EAEA;EACA,MAAMkL,mBAAmB,GAAG,MAAAA,CAAA,KAAY;IACtC,IAAItG,YAAY,EAAE,OAAO,CAAC;;IAE1B,MAAMuG,MAAM,GAAG,MAAM3B,uBAAuB,CAAC,IAAI,CAAC,CAAC,CAAC;;IAEpD,IAAI2B,MAAM,IAAIA,MAAM,CAAChD,UAAU,CAAC1G,MAAM,GAAG,CAAC,EAAE;MAC1C,MAAM2J,QAAQ,GAAGD,MAAM,CAAChD,UAAU,CAACkD,IAAI,CACrC,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAAC/C,UAAU,GAAG8C,CAAC,CAAC9C,UAC7B,CAAC,CAAC,CAAC,CAAC;MACJxI,eAAe,CACb,iBAAiBoL,QAAQ,CAACjE,IAAI,KAAK,CAACiE,QAAQ,CAAC5C,UAAU,GAAG,GAAG,EAAEO,OAAO,CACpE,CACF,CAAC,IAAI,EACL;QAAEzI,OAAO,EAAE;MAAO,CACpB,CAAC;MACD;MACA,IAAI8K,QAAQ,CAAC5C,UAAU,GAAGjJ,oBAAoB,EAAE;QAC9CiM,oBAAoB,CAACJ,QAAQ,CAACP,SAAS,EAAEO,QAAQ,CAAC5C,UAAU,CAAC;MAC/D;IACF,CAAC,MAAM,IAAI2C,MAAM,IAAIA,MAAM,CAAC9D,UAAU,CAAC5F,MAAM,GAAG,CAAC,EAAE;MACjDzB,eAAe,CACb,8DAA8D,EAC9D;QAAEM,OAAO,EAAE;MAAU,CACvB,CAAC;IACH,CAAC,MAAM;MACLN,eAAe,CAAC,+BAA+B,EAAE;QAAEM,OAAO,EAAE;MAAU,CAAC,CAAC;IAC1E;EACF,CAAC;;EAED;EACA,MAAMmL,0BAA0B,GAAI3K,OAAO,IAAK;IAC9C,IAAI,CAACA,OAAO,EAAE;IACd+C,kBAAkB,CAAC/C,OAAO,CAAC;IAC3BiD,uBAAuB,CAAC;MAAEC,MAAM,EAAE,SAAS;MAAEC,IAAI,EAAE;IAAG,CAAC,CAAC,CAAC,CAAC;IAC1DN,mBAAmB,CAAC,IAAI,CAAC;EAC3B,CAAC;;EAED;EACA,MAAM+H,uBAAuB,GAAGA,CAAA,KAAM;IACpC/H,mBAAmB,CAAC,KAAK,CAAC;IAC1BE,kBAAkB,CAAC,IAAI,CAAC;EAC1B,CAAC;;EAED;EACA,MAAM8H,4BAA4B,GAAIC,CAAC,IAAK;IAC1C7H,uBAAuB,CAAC;MACtB,GAAGD,oBAAoB;MACvB,CAAC8H,CAAC,CAACC,MAAM,CAAC1E,IAAI,GAAGyE,CAAC,CAACC,MAAM,CAACC;IAC5B,CAAC,CAAC;EACJ,CAAC;;EAED;EACA,MAAMC,4BAA4B,GAAG,MAAAA,CAAA,KAAY;IAC/C,IAAI,CAACnI,eAAe,IAAIgB,YAAY,EAAE;IAEtC,IAAI;MACF,MAAMuG,MAAM,GAAG,MAAMpL,QAAQ,CAC3BpB,gBAAgB,CAAC;QACf6D,SAAS;QACTqI,SAAS,EAAEjH,eAAe,CAACuG,GAAG;QAC9BnG,MAAM,EAAEF,oBAAoB,CAACE,MAAM;QACnCC,IAAI,EAAEH,oBAAoB,CAACG;MAC7B,CAAC,CACH,CAAC,CAACsB,MAAM,CAAC,CAAC;;MAEV;MACAlC,iBAAiB,CAAE2I,QAAQ,IAAK;QAC9B,MAAMC,gBAAgB,GAAGD,QAAQ,CAACE,SAAS,CACxClF,GAAG;UAAA,IAAAmF,eAAA;UAAA,OAAK,EAAAA,eAAA,GAAAnF,GAAG,CAACoF,UAAU,cAAAD,eAAA,uBAAdA,eAAA,CAAgBhC,GAAG,MAAKvG,eAAe,CAACuG,GAAG;QAAA,CACtD,CAAC;QACD,MAAMkC,MAAM,GAAG;UAAE,GAAGlB,MAAM,CAAC7J,IAAI;UAAE8K,UAAU,EAAExI;QAAgB,CAAC,CAAC,CAAC;QAChE,IAAIqI,gBAAgB,GAAG,CAAC,CAAC,EAAE;UACzB,MAAMK,WAAW,GAAG,CAAC,GAAGN,QAAQ,CAAC;UACjCM,WAAW,CAACL,gBAAgB,CAAC,GAAGI,MAAM;UACtC,OAAOC,WAAW;QACpB,CAAC,MAAM;UACL,OAAO,CAAC,GAAGN,QAAQ,EAAEK,MAAM,CAAC;QAC9B;MACF,CAAC,CAAC;MAEFrM,eAAe,CACb,6BAA6B4D,eAAe,CAACkH,SAAS,EAAE,EACxD;QAAExK,OAAO,EAAE;MAAU,CACvB,CAAC;MACDoL,uBAAuB,CAAC,CAAC;MACzB;MACA;IACF,CAAC,CAAC,OAAO/K,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnDX,eAAe,CAACW,KAAK,CAACiF,OAAO,IAAI,4BAA4B,EAAE;QAC7DtF,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;EACF,CAAC;;EAED;EACA,MAAMkL,oBAAoB,GAAGxR,WAAW,CACtC,OAAO6Q,SAAS,EAAErC,UAAU,KAAK;IAC/B,IAAI,CAACqC,SAAS,IAAIjG,YAAY,EAAE;;IAEhC;IACA,MAAM2H,gBAAgB,GAAGnJ,cAAc,CAACoJ,IAAI,CACzCxF,GAAG;MAAA,IAAAyF,gBAAA;MAAA,OAAK,EAAAA,gBAAA,GAAAzF,GAAG,CAACoF,UAAU,cAAAK,gBAAA,uBAAdA,gBAAA,CAAgBtC,GAAG,MAAKU,SAAS,IAAI7D,GAAG,CAAChD,MAAM,KAAK,SAAS;IAAA,CACxE,CAAC;IACD,IAAIuI,gBAAgB,EAAE;MACpB;MACA,OAAO,CAAC;IACV;IAEA,MAAMzL,OAAO,GAAG6D,aAAa,CAACyD,IAAI,CAAEwC,CAAC,IAAKA,CAAC,CAACT,GAAG,KAAKU,SAAS,CAAC;IAC9D,IAAI,CAAC/J,OAAO,EAAE;MACZF,OAAO,CAAC8L,IAAI,CAAC,2CAA2C,EAAE7B,SAAS,CAAC;MACpE;IACF;;IAEA;IACA,IAAI8B,WAAW,GAAG,IAAI;IACtB,IAAI;MACF,IAAIjK,SAAS,CAACuD,OAAO,EAAE;QACrB0G,WAAW,GAAGjK,SAAS,CAACuD,OAAO,CAAC2G,aAAa,CAAC;UAC5ChG,KAAK,EAAE,GAAG;UACVC,MAAM,EAAE;QACV,CAAC,CAAC,CAAC,CAAC;MACN;IACF,CAAC,CAAC,OAAOgG,eAAe,EAAE;MACxBjM,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEkM,eAAe,CAAC;MAC1D;IACF;IAEA,IAAI;MACF,MAAM1B,MAAM,GAAG,MAAMpL,QAAQ,CAC3BrB,gBAAgB,CAAC;QACf8D,SAAS;QACTqI,SAAS;QACT;QACArC,UAAU;QACVmE,WAAW;QACXxE,UAAU,EAAE,IAAI,CAAE;MACpB,CAAC,CACH,CAAC,CAAC5C,MAAM,CAAC,CAAC;;MAEV;MACAlC,iBAAiB,CAAE2I,QAAQ,IAAK;QAC9B,MAAMC,gBAAgB,GAAGD,QAAQ,CAACE,SAAS,CACxClF,GAAG;UAAA,IAAA8F,gBAAA;UAAA,OAAK,EAAAA,gBAAA,GAAA9F,GAAG,CAACoF,UAAU,cAAAU,gBAAA,uBAAdA,gBAAA,CAAgB3C,GAAG,MAAKU,SAAS;QAAA,CAC5C,CAAC;QACD,MAAMwB,MAAM,GAAG;UAAE,GAAGlB,MAAM,CAAC7J,IAAI;UAAE8K,UAAU,EAAEtL;QAAQ,CAAC,CAAC,CAAC;QACxD,IAAImL,gBAAgB,GAAG,CAAC,CAAC,EAAE;UACzB,MAAMK,WAAW,GAAG,CAAC,GAAGN,QAAQ,CAAC;UACjCM,WAAW,CAACL,gBAAgB,CAAC,GAAGI,MAAM;UACtC,OAAOC,WAAW;QACpB,CAAC,MAAM;UACL,OAAO,CAAC,GAAGN,QAAQ,EAAEK,MAAM,CAAC;QAC9B;MACF,CAAC,CAAC;MAEFrM,eAAe,CAAC,oBAAoBc,OAAO,CAACgK,SAAS,EAAE,EAAE;QACvDxK,OAAO,EAAE;MACX,CAAC,CAAC;IACJ,CAAC,CAAC,OAAOK,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,6BAA6B,EAAEA,KAAK,CAAC;MACnDX,eAAe,CAACW,KAAK,CAACiF,OAAO,IAAI,4BAA4B,EAAE;QAC7DtF,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;EACF,CAAC,EACD,CACEP,QAAQ,EACRyC,SAAS,EACTmC,aAAa,EACbvB,cAAc,EACdwB,YAAY,EACZ5E,eAAe,CAEnB,CAAC,CAAC,CAAC;;EAEH;;EAEA,MAAM+M,mBAAmB,GAAG/S,WAAW,CAAC,MAAM;IAC5C,IACE,CAACwK,aAAa,IACd,CAACD,aAAa,IACd,CAACI,aAAa,IACdA,aAAa,CAAClD,MAAM,KAAK,CAAC,EAC1B;MACAzB,eAAe,CACb,6EAA6E,EAC7E;QAAEM,OAAO,EAAE;MAAU,CACvB,CAAC;MACD;IACF;IACA0M,kBAAkB,CAAC,CAAC,CAAC,CAAC;IACtBzJ,aAAa,CAAC,IAAI,CAAC;IACnBvD,eAAe,CAAC,8BAA8B,EAAE;MAAEM,OAAO,EAAE;IAAO,CAAC,CAAC;IAEpEsC,mBAAmB,CAACqD,OAAO,GAAGgH,WAAW,CAAC,YAAY;MACpD,MAAM9B,MAAM,GAAG,MAAM3B,uBAAuB,CAAC,IAAI,CAAC,CAAC,CAAC;;MAEpD,IAAI2B,MAAM,IAAIA,MAAM,CAAChD,UAAU,CAAC1G,MAAM,GAAG,CAAC,EAAE;QAC1C;QACA0J,MAAM,CAAChD,UAAU,CAACrG,OAAO,CAAEuG,GAAG,IAAK;UACjC,IAAIA,GAAG,CAACG,UAAU,GAAGjJ,oBAAoB,IAAI8I,GAAG,CAACwC,SAAS,EAAE;YAC1DW,oBAAoB,CAACnD,GAAG,CAACwC,SAAS,EAAExC,GAAG,CAACG,UAAU,CAAC,CAAC,CAAC;UACvD;QACF,CAAC,CAAC;MACJ;IACF,CAAC,EAAEhJ,oBAAoB,CAAC;EAC1B,CAAC,EAAE,CACDgF,aAAa,EACbD,aAAa,EACbI,aAAa,EACb6E,uBAAuB,EACvBgC,oBAAoB,EACpBxL,eAAe,CAChB,CAAC,CAAC,CAAC;;EAEJ,MAAMgN,kBAAkB,GAAGhT,WAAW,CAAC,MAAM;IAC3CgM,aAAa,CAACpD,mBAAmB,CAACqD,OAAO,CAAC;IAC1CrD,mBAAmB,CAACqD,OAAO,GAAG,IAAI;IAClC1C,aAAa,CAAC,KAAK,CAAC;IACpBxD,QAAQ,CAACnC,qBAAqB,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IACrC;IACA,IAAI+E,SAAS,CAACsD,OAAO,EAAE;MACrB,MAAMQ,GAAG,GAAG9D,SAAS,CAACsD,OAAO,CAACS,UAAU,CAAC,IAAI,CAAC;MAC9CD,GAAG,CAACE,SAAS,CAAC,CAAC,EAAE,CAAC,EAAEhE,SAAS,CAACsD,OAAO,CAACW,KAAK,EAAEjE,SAAS,CAACsD,OAAO,CAACY,MAAM,CAAC;IACxE;IACA7G,eAAe,CAAC,8BAA8B,EAAE;MAAEM,OAAO,EAAE;IAAO,CAAC,CAAC;EACtE,CAAC,EAAE,CAACP,QAAQ,EAAEC,eAAe,CAAC,CAAC;;EAE/B;EACA,MAAMuG,sBAAsB,GAAGvM,WAAW,CAAC,MAAM;IAC/CwM,qBAAqB,CAAC,CAAC,CAAC,CAAC;IACzB3D,mBAAmB,CAACoD,OAAO,GAAGgH,WAAW,CAAC,YAAY;MACpD;MACA,MAAMzD,uBAAuB,CAAC,KAAK,CAAC;IACtC,CAAC,EAAE,GAAG,CAAC,CAAC,CAAC;EACX,CAAC,EAAE,CAACA,uBAAuB,CAAC,CAAC,CAAC,CAAC;;EAE/B,MAAMhD,qBAAqB,GAAGxM,WAAW,CAAC,MAAM;IAC9CgM,aAAa,CAACnD,mBAAmB,CAACoD,OAAO,CAAC;IAC1CpD,mBAAmB,CAACoD,OAAO,GAAG,IAAI;EACpC,CAAC,EAAE,EAAE,CAAC;;EAEN;;EAEA,MAAMiH,eAAe,GAAG,MAAAA,CAAA,KAAY;IAClC,IAAItI,YAAY,EAAE;IAClB,IAAI;MACF5E,eAAe,CAAC,wBAAwB,EAAE;QAAEM,OAAO,EAAE;MAAO,CAAC,CAAC;MAC9D,MAAMhG,KAAK,CAAC6S,GAAG,CACb,GAAGlO,OAAO,wBAAwBuD,SAAS,EAAE,EAC7C;QAAEwB,MAAM,EAAE;MAAY,CAAC,EACvB;QAAEmB,OAAO,EAAE;UAAEC,aAAa,EAAE,UAAUhB,KAAK;QAAG;MAAE,CAClD,CAAC;MACDpE,eAAe,CAAC,6BAA6B,EAAE;QAAEM,OAAO,EAAE;MAAU,CAAC,CAAC;MACtE6C,cAAc,CAAEiK,IAAI,KAAM;QAAE,GAAGA,IAAI;QAAEpJ,MAAM,EAAE;MAAY,CAAC,CAAC,CAAC,CAAC,CAAC;MAC9DgJ,kBAAkB,CAAC,CAAC,CAAC,CAAC;MACtB;MACA;IACF,CAAC,CAAC,OAAOrM,KAAK,EAAE;MAAA,IAAA0M,gBAAA,EAAAC,qBAAA;MACd1M,OAAO,CAACD,KAAK,CAAC,yBAAyB,EAAEA,KAAK,CAAC;MAC/CX,eAAe,CACb,EAAAqN,gBAAA,GAAA1M,KAAK,CAACgF,QAAQ,cAAA0H,gBAAA,wBAAAC,qBAAA,GAAdD,gBAAA,CAAgB/L,IAAI,cAAAgM,qBAAA,uBAApBA,qBAAA,CAAsB1H,OAAO,KAAI,wBAAwB,EACzD;QAAEtF,OAAO,EAAE;MAAQ,CACrB,CAAC;IACH;EACF,CAAC;EAED,MAAMiN,qBAAqB,GAAG,MAAAA,CAAA,KAAY;IACxC,IAAI3I,YAAY,EAAE;IAClB,IAAI;MACF5E,eAAe,CAAC,yBAAyB,EAAE;QAAEM,OAAO,EAAE;MAAO,CAAC,CAAC;MAC/D,MAAM,CAAC2E,OAAO,EAAED,UAAU,CAAC,GAAG,MAAMxE,OAAO,CAACC,GAAG,CAAC,CAC9CnG,KAAK,CAAC4K,GAAG,CAAC,GAAGjG,OAAO,oBAAoBuD,SAAS,EAAE,EAAE;QACnD2C,OAAO,EAAE;UAAEC,aAAa,EAAE,UAAUhB,KAAK;QAAG;MAC9C,CAAC,CAAC,EACF9J,KAAK,CAAC4K,GAAG,CAAC,GAAGjG,OAAO,wBAAwBuD,SAAS,EAAE,EAAE;QACvD2C,OAAO,EAAE;UAAEC,aAAa,EAAE,UAAUhB,KAAK;QAAG;MAC9C,CAAC,CAAC,CACH,CAAC;MACFf,iBAAiB,CAAC4B,OAAO,CAAC3D,IAAI,CAACA,IAAI,CAAC;MACpC6B,cAAc,CAAC6B,UAAU,CAAC1D,IAAI,CAACA,IAAI,CAAC;MACpCtB,eAAe,CAAC,oBAAoB,EAAE;QAAEM,OAAO,EAAE;MAAU,CAAC,CAAC;IAC/D,CAAC,CAAC,OAAOK,KAAK,EAAE;MAAA,IAAA6M,gBAAA,EAAAC,qBAAA;MACd7M,OAAO,CAACD,KAAK,CAAC,0BAA0B,EAAEA,KAAK,CAAC;MAChDX,eAAe,CACb,EAAAwN,gBAAA,GAAA7M,KAAK,CAACgF,QAAQ,cAAA6H,gBAAA,wBAAAC,qBAAA,GAAdD,gBAAA,CAAgBlM,IAAI,cAAAmM,qBAAA,uBAApBA,qBAAA,CAAsB7H,OAAO,KAAI,yBAAyB,EAC1D;QAAEtF,OAAO,EAAE;MAAQ,CACrB,CAAC;IACH;EACF,CAAC;EAED,MAAMoN,eAAe,GAAGA,CAAA,KAAM;IAC5BjK,gBAAgB,CAAE2J,IAAI,IAAK,CAACA,IAAI,CAAC;EACnC,CAAC;;EAED;EACA,MAAMO,eAAe,GAAGvK,cAAc,CAACnB,MAAM,CAC1C+E,GAAG,IAAKA,GAAG,CAAChD,MAAM,KAAK,SAC1B,CAAC;EACD,MAAM4J,cAAc,GAClB,CAAA5K,SAAS,aAATA,SAAS,wBAAAX,mBAAA,GAATW,SAAS,CAAE6K,QAAQ,cAAAxL,mBAAA,uBAAnBA,mBAAA,CAAqBJ,MAAM,CACxBnB,OAAO,IACN,CAACsC,cAAc,CAACoJ,IAAI,CACjBxF,GAAG;IAAA,IAAA8G,gBAAA;IAAA,OACF,EAAAA,gBAAA,GAAA9G,GAAG,CAACoF,UAAU,cAAA0B,gBAAA,uBAAdA,gBAAA,CAAgB3D,GAAG,MAAKrJ,OAAO,CAACqJ,GAAG,KAClCnD,GAAG,CAAChD,MAAM,KAAK,SAAS,IAAIgD,GAAG,CAAChD,MAAM,KAAK,MAAM,CAAC;EAAA,CACvD,CAAC,CAAC;EACN,CAAC,KAAI,EAAE;EACT,MAAM+J,aAAa,GAAG,CAAA/K,SAAS,aAATA,SAAS,wBAAAV,oBAAA,GAATU,SAAS,CAAE6K,QAAQ,cAAAvL,oBAAA,uBAAnBA,oBAAA,CAAqBb,MAAM,KAAI,CAAC;EACtD,MAAMuM,gBAAgB,GAAG,CAAA9K,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEc,MAAM,MAAK,WAAW;;EAE5D;;EAEA,IAAIlB,SAAS,EAAE;IACb,oBACEjE,OAAA,CAACrE,GAAG;MACFyT,OAAO,EAAC,MAAM;MACdC,cAAc,EAAC,QAAQ;MACvBC,UAAU,EAAC,QAAQ;MACnBC,SAAS,EAAC,MAAM;MAAAC,QAAA,gBAEhBxP,OAAA,CAAC7D,gBAAgB;QAAAsT,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,eACpB5P,OAAA,CAACpE,UAAU;QAACiU,EAAE,EAAE;UAAEC,EAAE,EAAE;QAAE,CAAE;QAAAN,QAAA,EAAC;MAA6B;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAY,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAClE,CAAC;EAEV;EAEA,IAAIvK,cAAc,IAAI,CAACpB,SAAS,EAAE;IAChC,oBACEjE,OAAA,CAACrE,GAAG;MAACkU,EAAE,EAAE;QAAEE,CAAC,EAAE;MAAE,CAAE;MAAAP,QAAA,eAChBxP,OAAA,CAAC5C,KAAK;QACJ4S,QAAQ,EAAC,OAAO;QAChBC,MAAM,eACJjQ,OAAA,CAAC/D,MAAM;UACLiU,KAAK,EAAC,SAAS;UACfC,IAAI,EAAC,OAAO;UACZC,OAAO,EAAEA,CAAA,KAAMC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAE;UAAAf,QAAA,EACzC;QAED;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CACT;QAAAJ,QAAA,gBAEDxP,OAAA,CAAC3C,UAAU;UAAAmS,QAAA,EAAC;QAAa;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAY,CAAC,EACrCvK,cAAc;MAAA;QAAAoK,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACV;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC;EAEV;EAEA,oBACE5P,OAAA,CAACrE,GAAG;IAACkU,EAAE,EAAE;MAAEE,CAAC,EAAE;QAAES,EAAE,EAAE,CAAC;QAAEC,EAAE,EAAE,CAAC;QAAEC,EAAE,EAAE;MAAE;IAAE,CAAE;IAAAlB,QAAA,gBAEtCxP,OAAA,CAACrE,GAAG;MACFyT,OAAO,EAAC,MAAM;MACdC,cAAc,EAAC,eAAe;MAC9BC,UAAU,EAAC,QAAQ;MACnBqB,EAAE,EAAE,GAAI;MACRC,EAAE,EAAE,CAAE;MACNC,YAAY,EAAC,mBAAmB;MAAArB,QAAA,gBAEhCxP,OAAA,CAACrE,GAAG;QAAA6T,QAAA,gBACFxP,OAAA,CAACpE,UAAU;UAAC6F,OAAO,EAAC,IAAI;UAACqP,UAAU,EAAE,GAAI;UAAAtB,QAAA,GAAC,wBAC5B,EAACrL,SAAS,aAATA,SAAS,uBAATA,SAAS,CAAE4M,UAAU;QAAA;UAAAtB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACxB,CAAC,eACb5P,OAAA,CAACpE,UAAU;UAAC6F,OAAO,EAAC,WAAW;UAACyO,KAAK,EAAC,eAAe;UAAAV,QAAA,GAAC,YAC/C,EAACnL,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAE2M,cAAc,EAAC,IAAE,EAAC,GAAG,EACvC3M,WAAW,aAAXA,WAAW,eAAXA,WAAW,CAAE4M,IAAI,GACd,IAAIC,IAAI,CAAC7M,WAAW,CAAC4M,IAAI,CAAC,CAACE,kBAAkB,CAAC,OAAO,CAAC,GACtD,KAAK,eACTnR,OAAA,CAACvD,IAAI;YACHwN,KAAK,EAAE,CAAA5F,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEc,MAAM,KAAI,KAAM;YACpC+K,KAAK,EAAEf,gBAAgB,GAAG,SAAS,GAAG,SAAU;YAChDgB,IAAI,EAAC,OAAO;YACZN,EAAE,EAAE;cAAEC,EAAE,EAAE;YAAE;UAAE;YAAAL,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACf,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACQ,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACV,CAAC,eACN5P,OAAA,CAAC/D,MAAM;QACLwF,OAAO,EAAC,UAAU;QAClB2P,SAAS,eAAEpR,OAAA,CAAC7B,SAAS;UAAAsR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAE,CAAE;QACzBQ,OAAO,EAAEA,CAAA,KAAMxM,QAAQ,CAAC,oBAAoBF,OAAO,EAAE,CAAE;QAAA8L,QAAA,EACxD;MAED;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CAAC,EAELT,gBAAgB,iBACfnP,OAAA,CAAC5C,KAAK;MAAC4S,QAAQ,EAAC,MAAM;MAACH,EAAE,EAAE;QAAEc,EAAE,EAAE;MAAE,CAAE;MAAAnB,QAAA,EAAC;IAEtC;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAO,CACR,EAEA5J,YAAY,iBACXhG,OAAA,CAAC5C,KAAK;MAAC4S,QAAQ,EAAC,SAAS;MAACH,EAAE,EAAE;QAAEc,EAAE,EAAE;MAAE,CAAE;MAAAnB,QAAA,GAAC,2DACZ,EAACxJ,YAAY;IAAA;MAAAyJ,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACnC,CACR,eAED5P,OAAA,CAACjE,IAAI;MAACsV,SAAS;MAACC,OAAO,EAAE,CAAE;MAAA9B,QAAA,gBAEzBxP,OAAA,CAACjE,IAAI;QAACwV,IAAI;QAACf,EAAE,EAAE,EAAG;QAACE,EAAE,EAAE,CAAE;QAAAlB,QAAA,gBACvBxP,OAAA,CAACnE,IAAI;UAACgU,EAAE,EAAE;YAAE2B,YAAY,EAAE,MAAM;YAAEC,SAAS,EAAE,CAAC;YAAEC,QAAQ,EAAE;UAAS,CAAE;UAAAlC,QAAA,gBACnExP,OAAA,CAAClE,WAAW;YACV+T,EAAE,EAAE;cACF8B,OAAO,EAAE,SAAS;cAClBd,YAAY,EAAE,mBAAmB;cACjCd,CAAC,EAAE;YACL,CAAE;YAAAP,QAAA,eAEFxP,OAAA,CAACrE,GAAG;cACFyT,OAAO,EAAC,MAAM;cACdC,cAAc,EAAC,eAAe;cAC9BC,UAAU,EAAC,QAAQ;cAAAE,QAAA,gBAEnBxP,OAAA,CAACpE,UAAU;gBACT6F,OAAO,EAAC,IAAI;gBACZqP,UAAU,EAAE,GAAI;gBAChB1B,OAAO,EAAC,MAAM;gBACdE,UAAU,EAAC,QAAQ;gBAAAE,QAAA,gBAEnBxP,OAAA,CAACrC,SAAS;kBAACkS,EAAE,EAAE;oBAAE+B,EAAE,EAAE,CAAC;oBAAE1B,KAAK,EAAE;kBAAe;gBAAE;kBAAAT,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAE,CAAC,WACrD;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAY,CAAC,EACZ,CAACT,gBAAgB,IAChBzJ,aAAa;cAAA;cAAM;cACjB1F,OAAA,CAACrE,GAAG;gBAAA6T,QAAA,gBACFxP,OAAA,CAAC1C,OAAO;kBACNuU,KAAK,EACHpN,UAAU,GACN,qBAAqB,GACrB,wBACL;kBAAA+K,QAAA,eAEDxP,OAAA,CAAC7C,UAAU;oBACTiT,OAAO,EACL3L,UAAU,GACN0J,kBAAkB,GAClBD,mBACL;oBACDgC,KAAK,EAAEzL,UAAU,GAAG,OAAO,GAAG,SAAU;oBACxCqN,QAAQ,EAAE,CAACnM,aAAc;oBAAA6J,QAAA,EAExB/K,UAAU,gBACTzE,OAAA,CAACzB,kBAAkB;sBAAAkR,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAE,CAAC,gBAEtB5P,OAAA,CAAC1B,iBAAiB;sBAAAmR,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAE;kBACrB;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACS;gBAAC;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACN,CAAC,eACV5P,OAAA,CAAC1C,OAAO;kBACNuU,KAAK,EAAElN,aAAa,GAAG,aAAa,GAAG,eAAgB;kBAAA6K,QAAA,eAEvDxP,OAAA,CAAC7C,UAAU;oBACTiT,OAAO,EAAEvB,eAAgB;oBACzBqB,KAAK,EAAC,WAAW;oBACjB4B,QAAQ,EAAE,CAACnM,aAAa,IAAIlB,UAAW;oBAAA+K,QAAA,EAEtC7K,aAAa,gBAAG3E,OAAA,CAACvB,aAAa;sBAAAgR,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAE,CAAC,gBAAG5P,OAAA,CAACxB,UAAU;sBAAAiR,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OAAE;kBAAC;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACzC;gBAAC;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACN,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACP,CACN;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACA;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACK,CAAC,eAGd5P,OAAA,CAACrE,GAAG;YACFkU,EAAE,EAAE;cACFkC,QAAQ,EAAE,UAAU;cACpBhK,KAAK,EAAE,MAAM;cACbiK,WAAW,EAAE,WAAW;cACxBC,eAAe,EAAE,MAAM;cACvB7C,OAAO,EAAE,MAAM;cACfC,cAAc,EAAE,QAAQ;cACxBC,UAAU,EAAE;YACd,CAAE;YAAAE,QAAA,GAED,CAAC9J,aAAa,IAAI,CAACyJ,gBAAgB,gBAClCnP,OAAA,CAACrE,GAAG;cAACuW,SAAS,EAAC,QAAQ;cAAChC,KAAK,EAAC,OAAO;cAAAV,QAAA,gBACnCxP,OAAA,CAAC7D,gBAAgB;gBAAC+T,KAAK,EAAC;cAAS;gBAAAT,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,eACpC5P,OAAA,CAACpE,UAAU;gBAAA4T,QAAA,EAAC;cAA6B;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAY,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACnD,CAAC,GACJ,CAACT,gBAAgB,gBACnBnP,OAAA,CAAC9E,QAAQ;cACPiX,QAAQ,eACNnS,OAAA,CAACrE,GAAG;gBAACuW,SAAS,EAAC,QAAQ;gBAAChC,KAAK,EAAC,OAAO;gBAAAV,QAAA,gBACnCxP,OAAA,CAAC7D,gBAAgB;kBAAC+T,KAAK,EAAC;gBAAS;kBAAAT,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAE,CAAC,eACpC5P,OAAA,CAACpE,UAAU;kBAAA4T,QAAA,EAAC;gBAAuB;kBAAAC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAY,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAC7C,CACN;cAAAJ,QAAA,eAEDxP,OAAA,CAACC,MAAM;gBACLmS,KAAK,EAAE,KAAM;gBACbC,GAAG,EAAExO,SAAU;gBACfyO,gBAAgB,EAAC,YAAY;gBAC7BvK,KAAK,EAAC,MAAM;gBACZC,MAAM,EAAC,MAAM;gBACbuK,gBAAgB,EAAE;kBAChBxK,KAAK,EAAE,GAAG;kBACVC,MAAM,EAAE,GAAG;kBACXwK,UAAU,EAAE;gBACd,CAAE;gBACFC,KAAK,EAAE;kBACLrD,OAAO,EAAE,OAAO;kBAChB2C,QAAQ,EAAE,UAAU;kBACpBW,GAAG,EAAE,CAAC;kBACNC,IAAI,EAAE,CAAC;kBACP5K,KAAK,EAAE,MAAM;kBACbC,MAAM,EAAE,MAAM;kBACd4K,SAAS,EAAE;gBACb,CAAE;gBACFC,WAAW,EAAE5K,eAAgB;gBAC7B6K,gBAAgB,EAAEzK;cAAqB;gBAAAoH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACxC;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACM,CAAC,gBAEX5P,OAAA,CAACpE,UAAU;cAACsU,KAAK,EAAC,OAAO;cAAAV,QAAA,EAAC;YAAiB;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAY,CAAC,CAAC;YAC1D,eAGD5P,OAAA;cACEqS,GAAG,EAAEvO,SAAU;cACf2O,KAAK,EAAE;gBACLV,QAAQ,EAAE,UAAU;gBACpBW,GAAG,EAAE,CAAC;gBACNC,IAAI,EAAE,CAAC;gBACP5K,KAAK,EAAE,MAAM;gBACbC,MAAM,EAAE,MAAM;gBACd+K,MAAM,EAAE;cACV;YAAE;cAAAtD,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CAAC,EAGD,CAAC,CAACjK,aAAa,KAAIN,cAAc,aAAdA,cAAc,uBAAdA,cAAc,CAAE2N,QAAQ,CAAC,QAAQ,CAAC,MACpD,CAAC7D,gBAAgB,iBACfnP,OAAA,CAACrE,GAAG;cACFkU,EAAE,EAAE;gBACFkC,QAAQ,EAAE,UAAU;gBACpBW,GAAG,EAAE,CAAC;gBACNC,IAAI,EAAE,CAAC;gBACP5K,KAAK,EAAE,MAAM;gBACbC,MAAM,EAAE,MAAM;gBACdiK,eAAe,EAAE,iBAAiB;gBAClC7C,OAAO,EAAE,MAAM;gBACf6D,aAAa,EAAE,QAAQ;gBACvB5D,cAAc,EAAE,QAAQ;gBACxBC,UAAU,EAAE,QAAQ;gBACpBY,KAAK,EAAE,OAAO;gBACd6C,MAAM,EAAE;cACV,CAAE;cAAAvD,QAAA,gBAEFxP,OAAA,CAAC3B,WAAW;gBAACwR,EAAE,EAAE;kBAAEqD,QAAQ,EAAE,EAAE;kBAAEvC,EAAE,EAAE;gBAAE;cAAE;gBAAAlB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,eAC5C5P,OAAA,CAACpE,UAAU;gBAAC6F,OAAO,EAAC,IAAI;gBAAA+N,QAAA,EAAC;cAAqB;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAY,CAAC,eAC3D5P,OAAA,CAACpE,UAAU;gBACT6F,OAAO,EAAC,OAAO;gBACfoO,EAAE,EAAE;kBAAEsD,EAAE,EAAE,CAAC;kBAAEC,EAAE,EAAE,CAAC;kBAAElB,SAAS,EAAE;gBAAS,CAAE;gBAAA1C,QAAA,EAEzCnK,cAAc,IACb;cAAyE;gBAAAoK,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACjE,CAAC,eACb5P,OAAA,CAAC/D,MAAM;gBACLwF,OAAO,EAAC,UAAU;gBAClByO,KAAK,EAAC,SAAS;gBACfL,EAAE,EAAE;kBAAEsD,EAAE,EAAE;gBAAE,CAAE;gBACd/C,OAAO,EAAEA,CAAA,KAAMC,MAAM,CAACC,QAAQ,CAACC,MAAM,CAAC,CAAE;gBAAAf,QAAA,EACzC;cAED;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAQ,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACN,CACN,EAEFnL,UAAU,IAAIkB,aAAa,iBAC1B3F,OAAA,CAACvD,IAAI;cACHwN,KAAK,EAAC,sDAAwB;cAC9BiG,KAAK,EAAC,SAAS;cACfC,IAAI,EAAC,OAAO;cACZN,EAAE,EAAE;gBACFkC,QAAQ,EAAE,UAAU;gBACpBsB,MAAM,EAAE,EAAE;gBACVC,KAAK,EAAE,EAAE;gBACTP,MAAM,EAAE;cACV;YAAE;cAAAtD,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACH,CACF;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACE,CAAC,EAGL,CAACT,gBAAgB,IAAIxJ,aAAa,IAAID,aAAa,iBAClD1F,OAAA,CAACrE,GAAG;YACFyT,OAAO,EAAC,MAAM;YACdC,cAAc,EAAC,eAAe;YAC9BU,CAAC,EAAE,CAAE;YACL4B,OAAO,EAAC,SAAS;YACjB4B,SAAS,EAAC,mBAAmB;YAAA/D,QAAA,gBAE7BxP,OAAA,CAAC/D,MAAM;cACLwF,OAAO,EAAC,WAAW;cACnB2O,OAAO,EAAE/D,mBAAoB;cAC7B+E,SAAS,EACPrL,YAAY,gBACV/F,OAAA,CAAC7D,gBAAgB;gBAACgU,IAAI,EAAE,EAAG;gBAACD,KAAK,EAAC;cAAS;gBAAAT,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,gBAE9C5P,OAAA,CAACrC,SAAS;gBAAA8R,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAEf;cACDkC,QAAQ,EAAE/L,YAAY,IAAItB,UAAW;cAAA+K,QAAA,EACtC;YAED;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,eACT5P,OAAA,CAAC/D,MAAM;cACLwF,OAAO,EAAC,WAAW;cACnByO,KAAK,EAAC,WAAW;cACjBE,OAAO,EAAE/B,eAAgB;cACzB+C,SAAS,eAAEpR,OAAA,CAAChC,IAAI;gBAAAyR,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAE;cACpBkC,QAAQ,EAAE/L,YAAa;cAAAyJ,QAAA,EACxB;YAED;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACN,CACN;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACG,CAAC,EAGN/J,kBAAkB,CAACjD,MAAM,GAAG,CAAC,IAAI,CAAC6B,UAAU,iBAC3CzE,OAAA,CAACnE,IAAI;UAACgU,EAAE,EAAE;YAAEsD,EAAE,EAAE,CAAC;YAAE3B,YAAY,EAAE,MAAM;YAAEC,SAAS,EAAE;UAAE,CAAE;UAAAjC,QAAA,eACtDxP,OAAA,CAAClE,WAAW;YAAA0T,QAAA,gBACVxP,OAAA,CAACpE,UAAU;cAAC6F,OAAO,EAAC,WAAW;cAACqP,UAAU,EAAC,KAAK;cAACH,EAAE,EAAE,CAAE;cAAAnB,QAAA,EAAC;YAExD;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAY,CAAC,eACb5P,OAAA,CAACjE,IAAI;cAACsV,SAAS;cAACC,OAAO,EAAE,CAAE;cAAA9B,QAAA,EACxB3J,kBAAkB,CAAC2N,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAACpI,GAAG,CACjC,CACE5B,GAAG,EACHmC,KAAK,CAAC;cAAA,kBAEN3L,OAAA,CAACjE,IAAI;gBACHwV,IAAI;gBACJf,EAAE,EAAE,CAAE;gBACNC,EAAE,EAAE,CAAE;gBAAAjB,QAAA,eAGNxP,OAAA,CAAChE,KAAK;kBACJyX,SAAS,EAAE,CAAE;kBACb5D,EAAE,EAAE;oBACFE,CAAC,EAAE,CAAC;oBACJmC,SAAS,EAAE,QAAQ;oBACnBwB,MAAM,EAAE;kBACV,CAAE;kBAAAlE,QAAA,gBAEFxP,OAAA,CAACpE,UAAU;oBAAC6F,OAAO,EAAC,SAAS;oBAAC2N,OAAO,EAAC,OAAO;oBAACuE,MAAM;oBAAAnE,QAAA,EACjDhG,GAAG,CAAClB;kBAAI;oBAAAmH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACC,CAAC,eACb5P,OAAA,CAACvD,IAAI;oBACHwN,KAAK,EAAE,GAAG,CAACT,GAAG,CAACG,UAAU,GAAG,GAAG,EAAEO,OAAO,CAAC,CAAC,CAAC,GAAI;oBAC/CiG,IAAI,EAAC,OAAO;oBACZD,KAAK,EACH1G,GAAG,CAACG,UAAU,GAAGjJ,oBAAoB,GACjC,SAAS,GACT,SACL;oBACDmP,EAAE,EAAE;sBAAEsD,EAAE,EAAE;oBAAI;kBAAE;oBAAA1D,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACjB,CAAC;gBAAA;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACG;cAAC,GAvBH,GAAGpG,GAAG,CAACwC,SAAS,IAAIL,KAAK,EAAE;gBAAA8D,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAwB5B,CAEV;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACG,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACI;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACV,CACP;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACG,CAAC,eAGP5P,OAAA,CAACjE,IAAI;QAACwV,IAAI;QAACf,EAAE,EAAE,EAAG;QAACE,EAAE,EAAE,CAAE;QAAAlB,QAAA,gBAEvBxP,OAAA,CAACnE,IAAI;UAACgU,EAAE,EAAE;YAAEc,EAAE,EAAE,CAAC;YAAEa,YAAY,EAAE,MAAM;YAAEC,SAAS,EAAE;UAAE,CAAE;UAAAjC,QAAA,eACtDxP,OAAA,CAAClE,WAAW;YAAA0T,QAAA,gBACVxP,OAAA,CAACrE,GAAG;cACFyT,OAAO,EAAC,MAAM;cACdC,cAAc,EAAC,eAAe;cAC9BC,UAAU,EAAC,QAAQ;cACnBqB,EAAE,EAAE,CAAE;cAAAnB,QAAA,gBAENxP,OAAA,CAACpE,UAAU;gBAAC6F,OAAO,EAAC,IAAI;gBAAC2N,OAAO,EAAC,MAAM;gBAACE,UAAU,EAAC,QAAQ;gBAAAE,QAAA,gBACzDxP,OAAA,CAACpC,KAAK;kBAACiS,EAAE,EAAE;oBAAE+B,EAAE,EAAE,CAAC;oBAAE1B,KAAK,EAAE;kBAAe;gBAAE;kBAAAT,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAE,CAAC,qBAC/C,EAACd,eAAe,CAAClM,MAAM,EAAC,GAAC,EAACsM,aAAa,EAAC,GAC1C;cAAA;gBAAAO,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAY,CAAC,eACb5P,OAAA,CAAC1C,OAAO;gBAACuU,KAAK,EAAC,8BAAmB;gBAAArC,QAAA,eAChCxP,OAAA,CAAC7C,UAAU;kBACTgT,IAAI,EAAC,OAAO;kBACZC,OAAO,EAAE1B,qBAAsB;kBAC/BoD,QAAQ,EAAE/L,YAAa;kBAAAyJ,QAAA,eAEvBxP,OAAA,CAACjC,OAAO;oBAAA0R,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OAAE;gBAAC;kBAAAH,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OACD;cAAC;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACN,CAAC;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACP,CAAC,eACN5P,OAAA,CAAC9D,OAAO;cAAC2T,EAAE,EAAE;gBAAEc,EAAE,EAAE;cAAE;YAAE;cAAAlB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,eAC1B5P,OAAA,CAACrE,GAAG;cAACkU,EAAE,EAAE;gBAAE+D,SAAS,EAAE,OAAO;gBAAElC,QAAQ,EAAE,MAAM;gBAAEmC,EAAE,EAAE;cAAE,CAAE;cAAArE,QAAA,EACtDV,eAAe,CAAC1D,GAAG,CAAEnJ,OAAO,iBAC3BjC,OAAA,CAACpE,UAAU;gBAAmB6F,OAAO,EAAC,OAAO;gBAAA+N,QAAA,EAC1CvN,OAAO,CAACgK;cAAS,GADHhK,OAAO,CAACqJ,GAAG;gBAAAmE,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAEhB,CACb;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACC,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACK;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACV,CAAC,eAGP5P,OAAA,CAACnE,IAAI;UAACgU,EAAE,EAAE;YAAE2B,YAAY,EAAE,MAAM;YAAEC,SAAS,EAAE;UAAE,CAAE;UAAAjC,QAAA,eAC/CxP,OAAA,CAAClE,WAAW;YAAA0T,QAAA,gBACVxP,OAAA,CAACpE,UAAU;cACT6F,OAAO,EAAC,IAAI;cACZ2N,OAAO,EAAC,MAAM;cACdE,UAAU,EAAC,QAAQ;cACnBqB,EAAE,EAAE,CAAE;cAAAnB,QAAA,gBAENxP,OAAA,CAACnC,KAAK;gBAACgS,EAAE,EAAE;kBAAE+B,EAAE,EAAE,CAAC;kBAAE1B,KAAK,EAAE;gBAAa;cAAE;gBAAAT,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,yBAC7C,EAACb,cAAc,CAACnM,MAAM,EAAC,GAAC,EAACsM,aAAa,EAAC,GACzC;YAAA;cAAAO,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAY,CAAC,eACb5P,OAAA,CAAC9D,OAAO;cAAC2T,EAAE,EAAE;gBAAEc,EAAE,EAAE;cAAE;YAAE;cAAAlB,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAE,CAAC,eAC1B5P,OAAA,CAACrE,GAAG;cAACkU,EAAE,EAAE;gBAAE+D,SAAS,EAAE,OAAO;gBAAElC,QAAQ,EAAE,MAAM;gBAAEmC,EAAE,EAAE;cAAE,CAAE;cAAArE,QAAA,EACtDT,cAAc,CAACnM,MAAM,KAAK,CAAC,gBAC1B5C,OAAA,CAACpE,UAAU;gBACT6F,OAAO,EAAC,OAAO;gBACfyO,KAAK,EAAC,eAAe;gBACrB4D,KAAK,EAAC,QAAQ;gBACdjE,EAAE,EAAE;kBAAEkE,EAAE,EAAE;gBAAE,CAAE;gBAAAvE,QAAA,EACf;cAED;gBAAAC,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAY,CAAC,gBAEb5P,OAAA,CAAC5D,IAAI;gBAAC4X,KAAK;gBAAAxE,QAAA,EACRT,cAAc,CAAC3D,GAAG,CAAEnJ,OAAO,iBAC1BjC,OAAA,CAAC3D,QAAQ;kBAEP4X,cAAc;kBACdpE,EAAE,EAAE;oBAAEc,EAAE,EAAE;kBAAI,CAAE;kBAChBuD,eAAe,EACb,CAAC/E,gBAAgB,gBACfnP,OAAA,CAAC1C,OAAO;oBAACuU,KAAK,EAAC,sCAAoB;oBAAArC,QAAA,eACjCxP,OAAA,CAAC7C,UAAU;sBACTgX,IAAI,EAAC,KAAK;sBACVhE,IAAI,EAAC,OAAO;sBACZC,OAAO,EAAEA,CAAA,KACPxD,0BAA0B,CAAC3K,OAAO,CACnC;sBACD6P,QAAQ,EAAE/L,YAAa;sBAAAyJ,QAAA,eAEvBxP,OAAA,CAAClC,IAAI;wBAACoV,QAAQ,EAAC;sBAAO;wBAAAzD,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAAE;oBAAC;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OACf;kBAAC;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACN,CAAC,GACR,IACL;kBAAAJ,QAAA,eAEDxP,OAAA,CAAChE,KAAK;oBACJyF,OAAO,EAAC,UAAU;oBAClBoO,EAAE,EAAE;sBACF9H,KAAK,EAAE,MAAM;sBACbqH,OAAO,EAAE,MAAM;sBACfE,UAAU,EAAE,QAAQ;sBACpBS,CAAC,EAAE,GAAG;sBACNyB,YAAY,EAAE;oBAChB,CAAE;oBAAAhC,QAAA,gBAEFxP,OAAA,CAAC1D,cAAc;sBAACuT,EAAE,EAAE;wBAAEuE,QAAQ,EAAE;sBAAG,CAAE;sBAAA5E,QAAA,eACnCxP,OAAA,CAACxD,MAAM;wBACL6X,GAAG,EAAEpS,OAAO,CAACgK,SAAU;wBACvBqI,GAAG,EAAErS,OAAO,CAACsS,UAAW;wBACxB1E,EAAE,EAAE;0BAAE9H,KAAK,EAAE,EAAE;0BAAEC,MAAM,EAAE;wBAAG;sBAAE;wBAAAyH,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OAC/B;oBAAC;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OACY,CAAC,eACjB5P,OAAA,CAACzD,YAAY;sBACXiY,OAAO,eACLxU,OAAA,CAACpE,UAAU;wBAAC6F,OAAO,EAAC,OAAO;wBAACkS,MAAM;wBAAAnE,QAAA,EAC/BvN,OAAO,CAACgK;sBAAS;wBAAAwD,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OACR,CACb;sBACD6E,SAAS,eACPzU,OAAA,CAACpE,UAAU;wBACT6F,OAAO,EAAC,SAAS;wBACjByO,KAAK,EAAC,gBAAgB;wBAAAV,QAAA,EAErBvN,OAAO,CAACyS;sBAAY;wBAAAjF,QAAA,EAAAC,YAAA;wBAAAC,UAAA;wBAAAC,YAAA;sBAAA,OACX;oBACb;sBAAAH,QAAA,EAAAC,YAAA;sBAAAC,UAAA;sBAAAC,YAAA;oBAAA,OACF,CAAC;kBAAA;oBAAAH,QAAA,EAAAC,YAAA;oBAAAC,UAAA;oBAAAC,YAAA;kBAAA,OACG;gBAAC,GApDH3N,OAAO,CAACqJ,GAAG;kBAAAmE,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAqDR,CACX;cAAC;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACE;YACP;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACK;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACV,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,eAGP5P,OAAA,CAACtD,MAAM;MACLiY,IAAI,EAAE9P,gBAAiB;MACvB+P,OAAO,EAAE/H,uBAAwB;MACjCgI,QAAQ,EAAC,IAAI;MACbC,SAAS;MAAAtF,QAAA,gBAETxP,OAAA,CAACrD,WAAW;QAAA6S,QAAA,EAAC;MAAkB;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAa,CAAC,eAC7C5P,OAAA,CAACpD,aAAa;QAAA4S,QAAA,gBACZxP,OAAA,CAAClD,SAAS;UACRmN,KAAK,EAAC,oBAAY;UAClB3B,IAAI,EAAC,QAAQ;UACb2E,KAAK,EAAEhI,oBAAoB,CAACE,MAAO;UACnC4P,QAAQ,EAAEjI,4BAA6B;UACvCgI,SAAS;QAAA;UAAArF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACV,CAAC,eACF5P,OAAA,CAAClD,SAAS;UACRmN,KAAK,EAAC,YAAS;UACf3B,IAAI,EAAC,MAAM;UACX2E,KAAK,EAAEhI,oBAAoB,CAACG,IAAK;UACjC2P,QAAQ,EAAEjI,4BAA6B;UACvCgI,SAAS;UACTE,SAAS;UACTC,IAAI,EAAE;QAAE;UAAAxF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACT,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACW,CAAC,eAChB5P,OAAA,CAACnD,aAAa;QAAA2S,QAAA,gBACZxP,OAAA,CAAC/D,MAAM;UAACmU,OAAO,EAAEvD,uBAAwB;UAAA2C,QAAA,EAAC;QAAG;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eACtD5P,OAAA,CAAC/D,MAAM;UAACmU,OAAO,EAAElD,4BAA6B;UAAAsC,QAAA,EAAC;QAAG;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC9C,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACV,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACN,CAAC;AAEV,CAAC;AAACrM,EAAA,CA7oCID,cAAc;EAAA,QACalI,SAAS,EACvBC,WAAW,EACXC,WAAW,EACAE,WAAW,EAwBrBD,WAAW,EACPA,WAAW,EACXA,WAAW,EACXA,WAAW,EACNA,WAAW,EAChBA,WAAW,EAGZA,WAAW,EACXA,WAAW;AAAA;AAAA2Z,GAAA,GArC5B5R,cAAc;AA+oCpB,eAAeA,cAAc;AAAC,IAAApD,EAAA,EAAAC,GAAA,EAAA+U,GAAA;AAAAC,YAAA,CAAAjV,EAAA;AAAAiV,YAAA,CAAAhV,GAAA;AAAAgV,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
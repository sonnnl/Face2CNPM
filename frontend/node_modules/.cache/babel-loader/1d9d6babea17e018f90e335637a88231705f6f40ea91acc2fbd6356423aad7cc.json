{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\FaceRegistrationPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, lazy, Suspense } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport { Box, Typography, Paper, Button, Stepper, Step, StepLabel, StepContent, CircularProgress, Alert, Card, CardContent, Grid, Divider, List, ListItem, ListItemIcon, ListItemText, Dialog, DialogTitle, DialogContent, DialogActions, Stack, Avatar, Container, Skeleton, AlertTitle } from \"@mui/material\";\nimport { Camera, Check, Face, Info, ViewArray, SaveAlt, ErrorOutline, CheckCircleOutline, ArrowBack, HelpOutline, CameraAlt, Person, Replay, FaceRetouchingNatural } from \"@mui/icons-material\";\nimport { getCurrentUser } from \"../redux/slices/authSlice\";\nimport { loadModels, detectFace } from \"../utils/faceUtils\";\nimport FaceRegistrationComponent from \"../components/FaceRegistrationComponent\";\n\n// Lazy load Webcam to reduce initial bundle size\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Webcam = /*#__PURE__*/lazy(_c = () => import(\"react-webcam\"));\n_c2 = Webcam;\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\nconst REQUIRED_IMAGES = 3;\n\n// Improved video constraints for better mobile compatibility\nconst videoConstraints = {\n  width: {\n    ideal: 640\n  },\n  height: {\n    ideal: 480\n  },\n  facingMode: \"user\"\n};\nconst FaceRegistrationPage = () => {\n  _s();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    user,\n    token,\n    isLoading: authLoading\n  } = useSelector(state => state.auth);\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null); // Keep if needed for drawing overlays\n\n  // --- State ---\n  const [capturedFaceData, setCapturedFaceData] = useState(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [registrationError, setRegistrationError] = useState(\"\");\n  const [registrationSuccess, setRegistrationSuccess] = useState(false);\n  const [activeStep, setActiveStep] = useState(0);\n  const [showHelpDialog, setShowHelpDialog] = useState(false);\n  const [allowRegistration, setAllowRegistration] = useState(false);\n  const [checkingFaceStatus, setCheckingFaceStatus] = useState(true);\n  const [hasFaceRegistered, setHasFaceRegistered] = useState(false);\n\n  // --- Effects ---\n\n  // 1. Check initial face registration status\n  useEffect(() => {\n    console.log(\"[Debug] Checking face status - authLoading:\", authLoading, \"User:\", user);\n    if (!authLoading && user) {\n      var _user$faceFeatures, _user$faceFeatures2, _user$faceFeatures2$d;\n      const registered = !!user.faceFeatures && !!user.faceFeatures.descriptors && user.faceFeatures.descriptors.length > 0 && user.faceFeatures.descriptors[0].length > 0;\n      console.log(\"[Debug] User loaded. faceFeatures exists:\", !!user.faceFeatures, \"Descriptors exist:\", !!((_user$faceFeatures = user.faceFeatures) !== null && _user$faceFeatures !== void 0 && _user$faceFeatures.descriptors), \"Descriptors length > 0:\", (((_user$faceFeatures2 = user.faceFeatures) === null || _user$faceFeatures2 === void 0 ? void 0 : (_user$faceFeatures2$d = _user$faceFeatures2.descriptors) === null || _user$faceFeatures2$d === void 0 ? void 0 : _user$faceFeatures2$d.length) || 0) > 0, \"=> hasFaceRegistered:\", registered);\n      setHasFaceRegistered(registered);\n      if (!registered) {\n        console.log(\"[Debug] No face registered (based on faceFeatures), allowing registration.\");\n        setAllowRegistration(true);\n      }\n      setCheckingFaceStatus(false);\n    }\n  }, [user, authLoading]);\n\n  // 2. Load face models when registration is allowed and needed (Step 1)\n  useEffect(() => {\n    const initModels = async () => {\n      // Only load if registration is allowed, we are on the capture step (index 1), and models aren't loaded yet\n      if (allowRegistration && activeStep === 1 && !capturedFaceData && !registrationError) {\n        setIsSubmitting(true);\n        setRegistrationError(null);\n        try {\n          console.log(\"Loading face models...\");\n          await loadModels();\n          console.log(\"Models loaded successfully.\");\n          // enqueueSnackbar(\"Đã tải mô hình nhận diện khuôn mặt\", { variant: \"success\" });\n        } catch (error) {\n          console.error(\"Error loading face models:\", error);\n          setRegistrationError(\"Không thể tải mô hình nhận diện. Vui lòng tải lại trang hoặc thử lại.\");\n          enqueueSnackbar(\"Lỗi tải mô hình nhận diện\", {\n            variant: \"error\"\n          });\n        } finally {\n          setIsSubmitting(false);\n        }\n      }\n    };\n    initModels();\n  }, [allowRegistration, activeStep, capturedFaceData, registrationError, enqueueSnackbar]);\n\n  // 3. Monitor camera readiness (using callback now)\n  const handleUserMedia = () => {\n    console.log(\"Camera is ready.\");\n  };\n  const handleUserMediaError = error => {\n    console.error(\"Camera error:\", error);\n    enqueueSnackbar(\"Không thể truy cập camera. Vui lòng cấp quyền và thử lại.\", {\n      variant: \"error\"\n    });\n    // Maybe move to a specific error step or show alert directly\n    if (activeStep === 1) {\n      // If error happens during capture step\n      setRegistrationError(\"Lỗi camera. Kiểm tra quyền truy cập.\");\n    }\n  };\n\n  // --- Actions ---\n\n  const handleAllowReRegistration = () => {\n    console.log(\"[Debug] Allowing re-registration.\");\n    setAllowRegistration(true);\n    setHasFaceRegistered(false);\n    handleReset();\n  };\n  const handleNext = () => {\n    setActiveStep(prev => prev + 1);\n  };\n  const handleBack = () => {\n    setRegistrationError(\"\");\n    setActiveStep(prev => prev - 1);\n  };\n  const handleReset = () => {\n    setCapturedFaceData(null);\n    setActiveStep(0);\n    setRegistrationError(\"\");\n    setRegistrationSuccess(false);\n    setIsSubmitting(false);\n  };\n  const handleFaceDataCaptured = faceData => {\n    console.log(\"[FaceRegistrationPage] Received face data from component:\", faceData);\n    if (faceData && faceData.length >= REQUIRED_IMAGES) {\n      setCapturedFaceData(faceData);\n      if (activeStep === 1) {\n        handleNext();\n      }\n    } else {\n      setCapturedFaceData(null);\n    }\n  };\n  const submitRegistration = async () => {\n    console.log('[Debug] \"Đăng ký khuôn mặt\" button clicked. Starting submission...'); // Log button click\n    if (!capturedFaceData || capturedFaceData.length < REQUIRED_IMAGES || isSubmitting) {\n      enqueueSnackbar(`Cần đủ ${REQUIRED_IMAGES} ảnh để đăng ký.`, {\n        variant: \"warning\"\n      });\n      return;\n    }\n    setIsSubmitting(true);\n    setRegistrationError(\"\");\n    setRegistrationSuccess(false);\n    try {\n      const payload = {\n        descriptors: capturedFaceData.map(data => data.descriptor)\n      };\n      console.log(\"Submitting registration data:\", payload);\n      const response = await axios.post(`${API_URL}/face-recognition/register`, payload, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n          \"Content-Type\": \"application/json\"\n        }\n      });\n      if (response.data.success) {\n        console.log(\"Registration successful:\", response.data);\n        enqueueSnackbar(\"Đăng ký khuôn mặt thành công!\", {\n          variant: \"success\"\n        });\n        setRegistrationSuccess(true);\n        dispatch(getCurrentUser());\n        handleNext();\n      } else {\n        throw new Error(response.data.message || \"Đăng ký không thành công từ server.\");\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error(\"Lỗi đăng ký khuôn mặt:\", error);\n      const errMsg = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || \"Lỗi không xác định khi đăng ký.\";\n      setRegistrationError(`Đăng ký thất bại: ${errMsg}`);\n      enqueueSnackbar(`Đăng ký thất bại: ${errMsg}`, {\n        variant: \"error\"\n      });\n      setRegistrationSuccess(false);\n      console.log(\"[Debug] Submission failed. Error displayed on Confirmation step.\");\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n  const navigateToProfile = () => {\n    navigate(\"/profile\");\n  };\n  const steps = [\n  // Step 0: Introduction\n  {\n    label: \"Giới thiệu\",\n    content: /*#__PURE__*/_jsxDEV(Box, {\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        gutterBottom: true,\n        children: \"Ch\\xE0o m\\u1EEBng \\u0111\\u1EBFn v\\u1EDBi \\u0111\\u0103ng k\\xFD khu\\xF4n m\\u1EB7t\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        paragraph: true,\n        children: \"Qu\\xE1 tr\\xECnh n\\xE0y gi\\xFAp h\\u1EC7 th\\u1ED1ng nh\\u1EADn di\\u1EC7n b\\u1EA1n \\u0111\\u1EC3 \\u0111i\\u1EC3m danh. Vui l\\xF2ng l\\xE0m theo c\\xE1c b\\u01B0\\u1EDBc sau v\\xE0 \\u0111\\u1EA3m b\\u1EA3o b\\u1EA1n \\u0111ang \\u1EDF n\\u01A1i c\\xF3 \\u0111\\u1EE7 \\xE1nh s\\xE1ng, khu\\xF4n m\\u1EB7t kh\\xF4ng b\\u1ECB che khu\\u1EA5t.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 306,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"info\",\n        icon: /*#__PURE__*/_jsxDEV(Info, {\n          fontSize: \"inherit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 313,\n          columnNumber: 19\n        }, this),\n        sx: {\n          mt: 2\n        },\n        children: [\"B\\u1EA1n s\\u1EBD c\\u1EA7n ch\\u1EE5p \", /*#__PURE__*/_jsxDEV(\"strong\", {\n          children: [REQUIRED_IMAGES, \" \\u1EA3nh\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 316,\n          columnNumber: 29\n        }, this), \" khu\\xF4n m\\u1EB7t. Gi\\u1EEF khu\\xF4n m\\u1EB7t th\\u1EB3ng, nh\\xECn tr\\u1EF1c di\\u1EC7n v\\xE0o camera.\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 311,\n        columnNumber: 11\n      }, this), registrationError && /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        sx: {\n          mt: 2\n        },\n        children: registrationError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 320,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 9\n    }, this)\n  },\n  // Step 1: Capture using Component\n  {\n    label: \"Chụp ảnh\",\n    content: /*#__PURE__*/_jsxDEV(Box, {\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        gutterBottom: true,\n        children: [\"Ch\\u1EE5p \", REQUIRED_IMAGES, \" \\u1EA3nh\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 332,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body2\",\n        color: \"textSecondary\",\n        paragraph: true,\n        children: \"Gi\\u1EEF y\\xEAn v\\xE0 nh\\xECn th\\u1EB3ng v\\xE0o camera. Nh\\u1EA5n n\\xFAt \\\"Ch\\u1EE5p \\u1EA3nh\\\" khi s\\u1EB5n s\\xE0ng. S\\u1EED d\\u1EE5ng n\\xFAt \\\"Hi\\u1EC7n Landmark\\\" \\u0111\\u1EC3 xem c\\xE1c \\u0111i\\u1EC3m nh\\u1EADn di\\u1EC7n (n\\u1EBFu c\\u1EA7n).\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 335,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(FaceRegistrationComponent, {\n        onFaceDataCapture: handleFaceDataCaptured,\n        requiredImages: REQUIRED_IMAGES\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 339,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 331,\n      columnNumber: 9\n    }, this)\n  },\n  // Step 2: Confirmation\n  {\n    label: \"Xác nhận\",\n    content: /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        textAlign: \"center\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        gutterBottom: true,\n        children: \"Xem l\\u1EA1i v\\xE0 X\\xE1c nh\\u1EADn\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 351,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        paragraph: true,\n        children: [\"B\\u1EA1n \\u0111\\xE3 ch\\u1EE5p \\u0111\\u1EE7 \", REQUIRED_IMAGES, \" \\u1EA3nh. Xem l\\u1EA1i c\\xE1c \\u1EA3nh d\\u01B0\\u1EDBi \\u0111\\xE2y. N\\u1EBFu h\\xE0i l\\xF2ng, nh\\u1EA5n \\\"\\u0110\\u0103ng k\\xFD\\\".\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 11\n      }, this), capturedFaceData && capturedFaceData.length > 0 && /*#__PURE__*/_jsxDEV(Stack, {\n        direction: \"row\",\n        spacing: 1,\n        justifyContent: \"center\",\n        flexWrap: \"wrap\",\n        mb: 3,\n        children: capturedFaceData.map((imgData, index) => /*#__PURE__*/_jsxDEV(Avatar, {\n          src: imgData.img,\n          sx: {\n            width: 80,\n            height: 80\n          }\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 17\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 13\n      }, this), registrationError && /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        sx: {\n          mb: 2,\n          textAlign: \"left\"\n        },\n        children: registrationError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"success\",\n        startIcon: /*#__PURE__*/_jsxDEV(SaveAlt, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 385,\n          columnNumber: 24\n        }, this),\n        onClick: submitRegistration,\n        disabled: isSubmitting || !capturedFaceData || capturedFaceData.length < REQUIRED_IMAGES,\n        sx: {\n          mt: 1,\n          mb: 1\n        },\n        children: isSubmitting ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          size: 24,\n          color: \"inherit\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 395,\n          columnNumber: 15\n        }, this) : \"Đăng ký khuôn mặt\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 382,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 9\n    }, this)\n  },\n  // Step 3: Completion\n  {\n    label: \"Hoàn thành\",\n    content: /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        textAlign: \"center\",\n        p: 2\n      },\n      children: registrationSuccess ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(CheckCircleOutline, {\n          color: \"success\",\n          sx: {\n            fontSize: 60,\n            mb: 2\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 410,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          gutterBottom: true,\n          children: \"\\u0110\\u0103ng k\\xFD th\\xE0nh c\\xF4ng!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 414,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          paragraph: true,\n          children: \"D\\u1EEF li\\u1EC7u khu\\xF4n m\\u1EB7t c\\u1EE7a b\\u1EA1n \\u0111\\xE3 \\u0111\\u01B0\\u1EE3c l\\u01B0u.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          onClick: navigateToProfile,\n          children: \"V\\u1EC1 trang c\\xE1 nh\\xE2n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 420,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(ErrorOutline, {\n          color: \"error\",\n          sx: {\n            fontSize: 60,\n            mb: 2\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 426,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          gutterBottom: true,\n          children: \"\\u0110\\u0103ng k\\xFD th\\u1EA5t b\\u1EA1i\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 427,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          paragraph: true,\n          color: \"error\",\n          children: registrationError || \"Đã có lỗi xảy ra trong quá trình đăng ký.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"outlined\",\n          onClick: handleReset,\n          startIcon: /*#__PURE__*/_jsxDEV(Replay, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 437,\n            columnNumber: 28\n          }, this),\n          children: \"Th\\u1EED l\\u1EA1i t\\u1EEB \\u0111\\u1EA7u\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 434,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 407,\n      columnNumber: 9\n    }, this)\n  }];\n\n  // --- Render Logic ---\n\n  if (checkingFaceStatus || authLoading) {\n    console.log(\"[Debug] Render: Showing loading state.\");\n    return /*#__PURE__*/_jsxDEV(Container, {\n      maxWidth: \"sm\",\n      sx: {\n        textAlign: \"center\",\n        mt: 5\n      },\n      children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 454,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        sx: {\n          mt: 2\n        },\n        children: \"\\u0110ang ki\\u1EC3m tra tr\\u1EA1ng th\\xE1i \\u0111\\u0103ng k\\xFD...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 455,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 453,\n      columnNumber: 7\n    }, this);\n  }\n  if (hasFaceRegistered && !allowRegistration) {\n    console.log(\"[Debug] Render: Showing 'Already Registered' screen. hasFaceRegistered:\", hasFaceRegistered, \"allowRegistration:\", allowRegistration);\n    return /*#__PURE__*/_jsxDEV(Container, {\n      maxWidth: \"sm\",\n      sx: {\n        mt: 4\n      },\n      children: /*#__PURE__*/_jsxDEV(Paper, {\n        elevation: 3,\n        sx: {\n          p: 4,\n          textAlign: \"center\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(FaceRetouchingNatural, {\n          color: \"success\",\n          sx: {\n            fontSize: 60,\n            mb: 2\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 472,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          gutterBottom: true,\n          children: \"\\u0110\\xE3 c\\xF3 d\\u1EEF li\\u1EC7u khu\\xF4n m\\u1EB7t\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 473,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          paragraph: true,\n          color: \"text.secondary\",\n          children: \"H\\u1EC7 th\\u1ED1ng \\u0111\\xE3 ghi nh\\u1EADn d\\u1EEF li\\u1EC7u khu\\xF4n m\\u1EB7t c\\u1EE7a b\\u1EA1n.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 476,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Stack, {\n          direction: \"row\",\n          spacing: 2,\n          justifyContent: \"center\",\n          sx: {\n            mt: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            onClick: navigateToProfile,\n            startIcon: /*#__PURE__*/_jsxDEV(Person, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 488,\n              columnNumber: 26\n            }, this),\n            children: \"Xem h\\u1ED3 s\\u01A1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 485,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outlined\",\n            onClick: handleAllowReRegistration,\n            startIcon: /*#__PURE__*/_jsxDEV(Replay, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 495,\n              columnNumber: 26\n            }, this),\n            children: \"\\u0110\\u0103ng k\\xFD l\\u1EA1i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 492,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 479,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 471,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 470,\n      columnNumber: 7\n    }, this);\n  }\n  console.log(\"[Debug] Render: Showing Registration Stepper. hasFaceRegistered:\", hasFaceRegistered, \"allowRegistration:\", allowRegistration);\n  return /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"md\",\n    sx: {\n      mt: 4,\n      mb: 4\n    },\n    children: [/*#__PURE__*/_jsxDEV(Paper, {\n      elevation: 3,\n      sx: {\n        p: {\n          xs: 2,\n          sm: 3\n        }\n      },\n      children: [/*#__PURE__*/_jsxDEV(Stack, {\n        direction: \"row\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        mb: 2,\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h4\",\n          component: \"h1\",\n          children: \"\\u0110\\u0103ng k\\xFD khu\\xF4n m\\u1EB7t\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 520,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          startIcon: /*#__PURE__*/_jsxDEV(HelpOutline, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 524,\n            columnNumber: 24\n          }, this),\n          onClick: () => setShowHelpDialog(true),\n          size: \"small\",\n          children: \"Tr\\u1EE3 gi\\xFAp\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 523,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Divider, {\n        sx: {\n          mb: 3\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 531,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Stepper, {\n        activeStep: activeStep,\n        orientation: \"vertical\",\n        children: steps.map((step, index) => /*#__PURE__*/_jsxDEV(Step, {\n          expanded: true,\n          children: [/*#__PURE__*/_jsxDEV(StepLabel, {\n            icon: index === activeStep ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n              size: 24\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 539,\n              columnNumber: 21\n            }, this) : index < activeStep ? /*#__PURE__*/_jsxDEV(Check, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 541,\n              columnNumber: 21\n            }, this) : index + 1,\n            children: /*#__PURE__*/_jsxDEV(Typography, {\n              variant: activeStep === index ? \"h6\" : \"body1\",\n              children: step.label\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 547,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 536,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(StepContent, {\n            TransitionProps: {\n              unmountOnExit: false\n            },\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                mb: 2,\n                mt: 1,\n                pl: {\n                  xs: 0,\n                  sm: 1\n                }\n              },\n              children: [step.content, activeStep < steps.length - 1 && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mt: 3,\n                  mb: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  onClick: handleNext,\n                  disabled: index === 1 && (!capturedFaceData || capturedFaceData.length < REQUIRED_IMAGES) || isSubmitting,\n                  sx: {\n                    mr: 1\n                  },\n                  children: \"Ti\\u1EBFp t\\u1EE5c\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 556,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  disabled: index === 0 || isSubmitting,\n                  onClick: handleBack,\n                  children: \"Quay l\\u1EA1i\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 569,\n                  columnNumber: 23\n                }, this), index > 0 && /*#__PURE__*/_jsxDEV(Button, {\n                  onClick: handleReset,\n                  sx: {\n                    ml: 2\n                  },\n                  color: \"warning\",\n                  disabled: isSubmitting,\n                  children: \"B\\u1EAFt \\u0111\\u1EA7u l\\u1EA1i\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 576,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 555,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 552,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 551,\n            columnNumber: 15\n          }, this)]\n        }, step.label, true, {\n          fileName: _jsxFileName,\n          lineNumber: 535,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 533,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 513,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: showHelpDialog,\n      onClose: () => setShowHelpDialog(false),\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"H\\u01B0\\u1EDBng d\\u1EABn \\u0110\\u0103ng k\\xFD Khu\\xF4n m\\u1EB7t\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 595,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: /*#__PURE__*/_jsxDEV(List, {\n          dense: true,\n          children: [/*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(Info, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 600,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 599,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"M\\u1EE5c \\u0111\\xEDch: \\u0110\\u0103ng k\\xFD d\\u1EEF li\\u1EC7u khu\\xF4n m\\u1EB7t \\u0111\\u1EC3 h\\u1EC7 th\\u1ED1ng c\\xF3 th\\u1EC3 nh\\u1EADn di\\u1EC7n b\\u1EA1n.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 602,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 598,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(HelpOutline, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 606,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 605,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: `Chuẩn bị: Ngồi ở nơi đủ sáng, không đeo kính râm hoặc khẩu trang. Giữ khuôn mặt thẳng, nhìn vào camera.`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 608,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 604,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 614,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 613,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: `Chụp ảnh: Nhấn nút 'Chụp ảnh' ${REQUIRED_IMAGES} lần. Có thể bật landmark để căn chỉnh.`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 616,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 612,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(Check, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 622,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 621,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: `Xác nhận & Hoàn thành: Xem lại ${REQUIRED_IMAGES} ảnh đã chụp, sau đó nhấn 'Đăng ký'.`\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 624,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 620,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(ErrorOutline, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 630,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 629,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"L\\u1ED7i: N\\u1EBFu kh\\xF4ng nh\\u1EADn di\\u1EC7n \\u0111\\u01B0\\u1EE3c khu\\xF4n m\\u1EB7t, h\\xE3y th\\u1EED l\\u1EA1i \\u1EDF g\\xF3c \\u0111\\u1ED9 ho\\u1EB7c \\xE1nh s\\xE1ng kh\\xE1c. N\\u1EBFu l\\u1ED7i ti\\u1EBFp di\\u1EC5n, li\\xEAn h\\u1EC7 h\\u1ED7 tr\\u1EE3.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 632,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 628,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(Replay, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 636,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 635,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"\\u0110\\u0103ng k\\xFD l\\u1EA1i: N\\u1EBFu mu\\u1ED1n c\\u1EADp nh\\u1EADt \\u1EA3nh khu\\xF4n m\\u1EB7t, b\\u1EA1n c\\xF3 th\\u1EC3 ch\\u1ECDn '\\u0110\\u0103ng k\\xFD l\\u1EA1i' t\\u1EEB m\\xE0n h\\xECnh th\\xF4ng b\\xE1o.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 638,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 634,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 597,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 596,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => setShowHelpDialog(false),\n          children: \"\\u0110\\xF3ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 643,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 642,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 594,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 512,\n    columnNumber: 5\n  }, this);\n};\n\n// Wrapper for lazy loading Webcam\n_s(FaceRegistrationPage, \"7uKYnw6wRBw0IQjv0oilrJwW38w=\", false, function () {\n  return [useNavigate, useDispatch, useSnackbar, useSelector];\n});\n_c3 = FaceRegistrationPage;\nconst FaceRegistrationPageWithSuspense = () => /*#__PURE__*/_jsxDEV(Suspense, {\n  fallback: /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"sm\",\n    sx: {\n      textAlign: \"center\",\n      mt: 5\n    },\n    children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 655,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      sx: {\n        mt: 2\n      },\n      children: \"\\u0110ang t\\u1EA3i th\\xE0nh ph\\u1EA7n...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 656,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 654,\n    columnNumber: 7\n  }, this),\n  children: /*#__PURE__*/_jsxDEV(FaceRegistrationPage, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 660,\n    columnNumber: 5\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 652,\n  columnNumber: 3\n}, this);\n_c4 = FaceRegistrationPageWithSuspense;\nexport default FaceRegistrationPageWithSuspense;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"Webcam$lazy\");\n$RefreshReg$(_c2, \"Webcam\");\n$RefreshReg$(_c3, \"FaceRegistrationPage\");\n$RefreshReg$(_c4, \"FaceRegistrationPageWithSuspense\");","map":{"version":3,"names":["React","useState","useEffect","useRef","lazy","Suspense","useNavigate","useSelector","useDispatch","useSnackbar","axios","Box","Typography","Paper","Button","Stepper","Step","StepLabel","StepContent","CircularProgress","Alert","Card","CardContent","Grid","Divider","List","ListItem","ListItemIcon","ListItemText","Dialog","DialogTitle","DialogContent","DialogActions","Stack","Avatar","Container","Skeleton","AlertTitle","Camera","Check","Face","Info","ViewArray","SaveAlt","ErrorOutline","CheckCircleOutline","ArrowBack","HelpOutline","CameraAlt","Person","Replay","FaceRetouchingNatural","getCurrentUser","loadModels","detectFace","FaceRegistrationComponent","jsxDEV","_jsxDEV","Fragment","_Fragment","Webcam","_c","_c2","API_URL","process","env","REACT_APP_API_URL","REQUIRED_IMAGES","videoConstraints","width","ideal","height","facingMode","FaceRegistrationPage","_s","navigate","dispatch","enqueueSnackbar","user","token","isLoading","authLoading","state","auth","webcamRef","canvasRef","capturedFaceData","setCapturedFaceData","isSubmitting","setIsSubmitting","registrationError","setRegistrationError","registrationSuccess","setRegistrationSuccess","activeStep","setActiveStep","showHelpDialog","setShowHelpDialog","allowRegistration","setAllowRegistration","checkingFaceStatus","setCheckingFaceStatus","hasFaceRegistered","setHasFaceRegistered","console","log","_user$faceFeatures","_user$faceFeatures2","_user$faceFeatures2$d","registered","faceFeatures","descriptors","length","initModels","error","variant","handleUserMedia","handleUserMediaError","handleAllowReRegistration","handleReset","handleNext","prev","handleBack","handleFaceDataCaptured","faceData","submitRegistration","payload","map","data","descriptor","response","post","headers","Authorization","success","Error","message","_error$response","_error$response$data","errMsg","navigateToProfile","steps","label","content","children","gutterBottom","fileName","_jsxFileName","lineNumber","columnNumber","paragraph","severity","icon","fontSize","sx","mt","color","onFaceDataCapture","requiredImages","textAlign","direction","spacing","justifyContent","flexWrap","mb","imgData","index","src","img","startIcon","onClick","disabled","size","p","maxWidth","elevation","xs","sm","alignItems","component","orientation","step","expanded","TransitionProps","unmountOnExit","pl","mr","ml","open","onClose","dense","primary","_c3","FaceRegistrationPageWithSuspense","fallback","_c4","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/FaceRegistrationPage.js"],"sourcesContent":["import React, { useState, useEffect, useRef, lazy, Suspense } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport {\n  Box,\n  Typography,\n  Paper,\n  Button,\n  Stepper,\n  Step,\n  StepLabel,\n  StepContent,\n  CircularProgress,\n  Alert,\n  Card,\n  CardContent,\n  Grid,\n  Divider,\n  List,\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Stack,\n  Avatar,\n  Container,\n  Skeleton,\n  AlertTitle,\n} from \"@mui/material\";\nimport {\n  Camera,\n  Check,\n  Face,\n  Info,\n  ViewArray,\n  SaveAlt,\n  ErrorOutline,\n  CheckCircleOutline,\n  ArrowBack,\n  HelpOutline,\n  CameraAlt,\n  Person,\n  Replay,\n  FaceRetouchingNatural,\n} from \"@mui/icons-material\";\nimport { getCurrentUser } from \"../redux/slices/authSlice\";\nimport { loadModels, detectFace } from \"../utils/faceUtils\";\nimport FaceRegistrationComponent from \"../components/FaceRegistrationComponent\";\n\n// Lazy load Webcam to reduce initial bundle size\nconst Webcam = lazy(() => import(\"react-webcam\"));\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\nconst REQUIRED_IMAGES = 3;\n\n// Improved video constraints for better mobile compatibility\nconst videoConstraints = {\n  width: { ideal: 640 },\n  height: { ideal: 480 },\n  facingMode: \"user\",\n};\n\nconst FaceRegistrationPage = () => {\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n  const {\n    user,\n    token,\n    isLoading: authLoading,\n  } = useSelector((state) => state.auth);\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null); // Keep if needed for drawing overlays\n\n  // --- State ---\n  const [capturedFaceData, setCapturedFaceData] = useState(null);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [registrationError, setRegistrationError] = useState(\"\");\n  const [registrationSuccess, setRegistrationSuccess] = useState(false);\n  const [activeStep, setActiveStep] = useState(0);\n  const [showHelpDialog, setShowHelpDialog] = useState(false);\n  const [allowRegistration, setAllowRegistration] = useState(false);\n  const [checkingFaceStatus, setCheckingFaceStatus] = useState(true);\n  const [hasFaceRegistered, setHasFaceRegistered] = useState(false);\n\n  // --- Effects ---\n\n  // 1. Check initial face registration status\n  useEffect(() => {\n    console.log(\n      \"[Debug] Checking face status - authLoading:\",\n      authLoading,\n      \"User:\",\n      user\n    );\n    if (!authLoading && user) {\n      const registered =\n        !!user.faceFeatures &&\n        !!user.faceFeatures.descriptors &&\n        user.faceFeatures.descriptors.length > 0 &&\n        user.faceFeatures.descriptors[0].length > 0;\n\n      console.log(\n        \"[Debug] User loaded. faceFeatures exists:\",\n        !!user.faceFeatures,\n        \"Descriptors exist:\",\n        !!user.faceFeatures?.descriptors,\n        \"Descriptors length > 0:\",\n        (user.faceFeatures?.descriptors?.length || 0) > 0,\n        \"=> hasFaceRegistered:\",\n        registered\n      );\n\n      setHasFaceRegistered(registered);\n      if (!registered) {\n        console.log(\n          \"[Debug] No face registered (based on faceFeatures), allowing registration.\"\n        );\n        setAllowRegistration(true);\n      }\n      setCheckingFaceStatus(false);\n    }\n  }, [user, authLoading]);\n\n  // 2. Load face models when registration is allowed and needed (Step 1)\n  useEffect(() => {\n    const initModels = async () => {\n      // Only load if registration is allowed, we are on the capture step (index 1), and models aren't loaded yet\n      if (\n        allowRegistration &&\n        activeStep === 1 &&\n        !capturedFaceData &&\n        !registrationError\n      ) {\n        setIsSubmitting(true);\n        setRegistrationError(null);\n        try {\n          console.log(\"Loading face models...\");\n          await loadModels();\n          console.log(\"Models loaded successfully.\");\n          // enqueueSnackbar(\"Đã tải mô hình nhận diện khuôn mặt\", { variant: \"success\" });\n        } catch (error) {\n          console.error(\"Error loading face models:\", error);\n          setRegistrationError(\n            \"Không thể tải mô hình nhận diện. Vui lòng tải lại trang hoặc thử lại.\"\n          );\n          enqueueSnackbar(\"Lỗi tải mô hình nhận diện\", { variant: \"error\" });\n        } finally {\n          setIsSubmitting(false);\n        }\n      }\n    };\n    initModels();\n  }, [\n    allowRegistration,\n    activeStep,\n    capturedFaceData,\n    registrationError,\n    enqueueSnackbar,\n  ]);\n\n  // 3. Monitor camera readiness (using callback now)\n  const handleUserMedia = () => {\n    console.log(\"Camera is ready.\");\n  };\n\n  const handleUserMediaError = (error) => {\n    console.error(\"Camera error:\", error);\n    enqueueSnackbar(\n      \"Không thể truy cập camera. Vui lòng cấp quyền và thử lại.\",\n      { variant: \"error\" }\n    );\n    // Maybe move to a specific error step or show alert directly\n    if (activeStep === 1) {\n      // If error happens during capture step\n      setRegistrationError(\"Lỗi camera. Kiểm tra quyền truy cập.\");\n    }\n  };\n\n  // --- Actions ---\n\n  const handleAllowReRegistration = () => {\n    console.log(\"[Debug] Allowing re-registration.\");\n    setAllowRegistration(true);\n    setHasFaceRegistered(false);\n    handleReset();\n  };\n\n  const handleNext = () => {\n    setActiveStep((prev) => prev + 1);\n  };\n\n  const handleBack = () => {\n    setRegistrationError(\"\");\n    setActiveStep((prev) => prev - 1);\n  };\n\n  const handleReset = () => {\n    setCapturedFaceData(null);\n    setActiveStep(0);\n    setRegistrationError(\"\");\n    setRegistrationSuccess(false);\n    setIsSubmitting(false);\n  };\n\n  const handleFaceDataCaptured = (faceData) => {\n    console.log(\n      \"[FaceRegistrationPage] Received face data from component:\",\n      faceData\n    );\n    if (faceData && faceData.length >= REQUIRED_IMAGES) {\n      setCapturedFaceData(faceData);\n      if (activeStep === 1) {\n        handleNext();\n      }\n    } else {\n      setCapturedFaceData(null);\n    }\n  };\n\n  const submitRegistration = async () => {\n    console.log(\n      '[Debug] \"Đăng ký khuôn mặt\" button clicked. Starting submission...'\n    ); // Log button click\n    if (\n      !capturedFaceData ||\n      capturedFaceData.length < REQUIRED_IMAGES ||\n      isSubmitting\n    ) {\n      enqueueSnackbar(`Cần đủ ${REQUIRED_IMAGES} ảnh để đăng ký.`, {\n        variant: \"warning\",\n      });\n      return;\n    }\n\n    setIsSubmitting(true);\n    setRegistrationError(\"\");\n    setRegistrationSuccess(false);\n\n    try {\n      const payload = {\n        descriptors: capturedFaceData.map((data) => data.descriptor),\n      };\n      console.log(\"Submitting registration data:\", payload);\n      const response = await axios.post(\n        `${API_URL}/face-recognition/register`,\n        payload,\n        {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            \"Content-Type\": \"application/json\",\n          },\n        }\n      );\n\n      if (response.data.success) {\n        console.log(\"Registration successful:\", response.data);\n        enqueueSnackbar(\"Đăng ký khuôn mặt thành công!\", {\n          variant: \"success\",\n        });\n        setRegistrationSuccess(true);\n        dispatch(getCurrentUser());\n        handleNext();\n      } else {\n        throw new Error(\n          response.data.message || \"Đăng ký không thành công từ server.\"\n        );\n      }\n    } catch (error) {\n      console.error(\"Lỗi đăng ký khuôn mặt:\", error);\n      const errMsg =\n        error.response?.data?.message ||\n        error.message ||\n        \"Lỗi không xác định khi đăng ký.\";\n      setRegistrationError(`Đăng ký thất bại: ${errMsg}`);\n      enqueueSnackbar(`Đăng ký thất bại: ${errMsg}`, { variant: \"error\" });\n      setRegistrationSuccess(false);\n      console.log(\n        \"[Debug] Submission failed. Error displayed on Confirmation step.\"\n      );\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const navigateToProfile = () => {\n    navigate(\"/profile\");\n  };\n\n  const steps = [\n    // Step 0: Introduction\n    {\n      label: \"Giới thiệu\",\n      content: (\n        <Box>\n          <Typography variant=\"h6\" gutterBottom>\n            Chào mừng đến với đăng ký khuôn mặt\n          </Typography>\n          <Typography paragraph>\n            Quá trình này giúp hệ thống nhận diện bạn để điểm danh. Vui lòng làm\n            theo các bước sau và đảm bảo bạn đang ở nơi có đủ ánh sáng, khuôn\n            mặt không bị che khuất.\n          </Typography>\n          <Alert\n            severity=\"info\"\n            icon={<Info fontSize=\"inherit\" />}\n            sx={{ mt: 2 }}\n          >\n            Bạn sẽ cần chụp <strong>{REQUIRED_IMAGES} ảnh</strong> khuôn mặt.\n            Giữ khuôn mặt thẳng, nhìn trực diện vào camera.\n          </Alert>\n          {registrationError && (\n            <Alert severity=\"error\" sx={{ mt: 2 }}>\n              {registrationError}\n            </Alert>\n          )}\n        </Box>\n      ),\n    },\n    // Step 1: Capture using Component\n    {\n      label: \"Chụp ảnh\",\n      content: (\n        <Box>\n          <Typography variant=\"h6\" gutterBottom>\n            Chụp {REQUIRED_IMAGES} ảnh\n          </Typography>\n          <Typography variant=\"body2\" color=\"textSecondary\" paragraph>\n            Giữ yên và nhìn thẳng vào camera. Nhấn nút \"Chụp ảnh\" khi sẵn sàng.\n            Sử dụng nút \"Hiện Landmark\" để xem các điểm nhận diện (nếu cần).\n          </Typography>\n          <FaceRegistrationComponent\n            onFaceDataCapture={handleFaceDataCaptured}\n            requiredImages={REQUIRED_IMAGES}\n          />\n        </Box>\n      ),\n    },\n    // Step 2: Confirmation\n    {\n      label: \"Xác nhận\",\n      content: (\n        <Box sx={{ textAlign: \"center\" }}>\n          <Typography variant=\"h6\" gutterBottom>\n            Xem lại và Xác nhận\n          </Typography>\n          <Typography paragraph>\n            Bạn đã chụp đủ {REQUIRED_IMAGES} ảnh. Xem lại các ảnh dưới đây. Nếu\n            hài lòng, nhấn \"Đăng ký\".\n          </Typography>\n          {capturedFaceData && capturedFaceData.length > 0 && (\n            <Stack\n              direction=\"row\"\n              spacing={1}\n              justifyContent=\"center\"\n              flexWrap=\"wrap\"\n              mb={3}\n            >\n              {capturedFaceData.map((imgData, index) => (\n                <Avatar\n                  key={index}\n                  src={imgData.img}\n                  sx={{ width: 80, height: 80 }}\n                />\n              ))}\n            </Stack>\n          )}\n\n          {registrationError && (\n            <Alert severity=\"error\" sx={{ mb: 2, textAlign: \"left\" }}>\n              {registrationError}\n            </Alert>\n          )}\n\n          <Button\n            variant=\"contained\"\n            color=\"success\"\n            startIcon={<SaveAlt />}\n            onClick={submitRegistration}\n            disabled={\n              isSubmitting ||\n              !capturedFaceData ||\n              capturedFaceData.length < REQUIRED_IMAGES\n            }\n            sx={{ mt: 1, mb: 1 }}\n          >\n            {isSubmitting ? (\n              <CircularProgress size={24} color=\"inherit\" />\n            ) : (\n              \"Đăng ký khuôn mặt\"\n            )}\n          </Button>\n        </Box>\n      ),\n    },\n    // Step 3: Completion\n    {\n      label: \"Hoàn thành\",\n      content: (\n        <Box sx={{ textAlign: \"center\", p: 2 }}>\n          {registrationSuccess ? (\n            <>\n              <CheckCircleOutline\n                color=\"success\"\n                sx={{ fontSize: 60, mb: 2 }}\n              />\n              <Typography variant=\"h5\" gutterBottom>\n                Đăng ký thành công!\n              </Typography>\n              <Typography paragraph>\n                Dữ liệu khuôn mặt của bạn đã được lưu.\n              </Typography>\n              <Button variant=\"contained\" onClick={navigateToProfile}>\n                Về trang cá nhân\n              </Button>\n            </>\n          ) : (\n            <>\n              <ErrorOutline color=\"error\" sx={{ fontSize: 60, mb: 2 }} />\n              <Typography variant=\"h5\" gutterBottom>\n                Đăng ký thất bại\n              </Typography>\n              <Typography paragraph color=\"error\">\n                {registrationError ||\n                  \"Đã có lỗi xảy ra trong quá trình đăng ký.\"}\n              </Typography>\n              <Button\n                variant=\"outlined\"\n                onClick={handleReset}\n                startIcon={<Replay />}\n              >\n                Thử lại từ đầu\n              </Button>\n            </>\n          )}\n        </Box>\n      ),\n    },\n  ];\n\n  // --- Render Logic ---\n\n  if (checkingFaceStatus || authLoading) {\n    console.log(\"[Debug] Render: Showing loading state.\");\n    return (\n      <Container maxWidth=\"sm\" sx={{ textAlign: \"center\", mt: 5 }}>\n        <CircularProgress />\n        <Typography sx={{ mt: 2 }}>\n          Đang kiểm tra trạng thái đăng ký...\n        </Typography>\n      </Container>\n    );\n  }\n\n  if (hasFaceRegistered && !allowRegistration) {\n    console.log(\n      \"[Debug] Render: Showing 'Already Registered' screen. hasFaceRegistered:\",\n      hasFaceRegistered,\n      \"allowRegistration:\",\n      allowRegistration\n    );\n    return (\n      <Container maxWidth=\"sm\" sx={{ mt: 4 }}>\n        <Paper elevation={3} sx={{ p: 4, textAlign: \"center\" }}>\n          <FaceRetouchingNatural color=\"success\" sx={{ fontSize: 60, mb: 2 }} />\n          <Typography variant=\"h5\" gutterBottom>\n            Đã có dữ liệu khuôn mặt\n          </Typography>\n          <Typography paragraph color=\"text.secondary\">\n            Hệ thống đã ghi nhận dữ liệu khuôn mặt của bạn.\n          </Typography>\n          <Stack\n            direction=\"row\"\n            spacing={2}\n            justifyContent=\"center\"\n            sx={{ mt: 3 }}\n          >\n            <Button\n              variant=\"contained\"\n              onClick={navigateToProfile}\n              startIcon={<Person />}\n            >\n              Xem hồ sơ\n            </Button>\n            <Button\n              variant=\"outlined\"\n              onClick={handleAllowReRegistration}\n              startIcon={<Replay />}\n            >\n              Đăng ký lại\n            </Button>\n          </Stack>\n        </Paper>\n      </Container>\n    );\n  }\n\n  console.log(\n    \"[Debug] Render: Showing Registration Stepper. hasFaceRegistered:\",\n    hasFaceRegistered,\n    \"allowRegistration:\",\n    allowRegistration\n  );\n  return (\n    <Container maxWidth=\"md\" sx={{ mt: 4, mb: 4 }}>\n      <Paper elevation={3} sx={{ p: { xs: 2, sm: 3 } }}>\n        <Stack\n          direction=\"row\"\n          justifyContent=\"space-between\"\n          alignItems=\"center\"\n          mb={2}\n        >\n          <Typography variant=\"h4\" component=\"h1\">\n            Đăng ký khuôn mặt\n          </Typography>\n          <Button\n            startIcon={<HelpOutline />}\n            onClick={() => setShowHelpDialog(true)}\n            size=\"small\"\n          >\n            Trợ giúp\n          </Button>\n        </Stack>\n        <Divider sx={{ mb: 3 }} />\n\n        <Stepper activeStep={activeStep} orientation=\"vertical\">\n          {steps.map((step, index) => (\n            <Step key={step.label} expanded={true}>\n              <StepLabel\n                icon={\n                  index === activeStep ? (\n                    <CircularProgress size={24} />\n                  ) : index < activeStep ? (\n                    <Check />\n                  ) : (\n                    index + 1\n                  )\n                }\n              >\n                <Typography variant={activeStep === index ? \"h6\" : \"body1\"}>\n                  {step.label}\n                </Typography>\n              </StepLabel>\n              <StepContent TransitionProps={{ unmountOnExit: false }}>\n                <Box sx={{ mb: 2, mt: 1, pl: { xs: 0, sm: 1 } }}>\n                  {step.content}\n                  {activeStep < steps.length - 1 && (\n                    <Box sx={{ mt: 3, mb: 1 }}>\n                      <Button\n                        variant=\"contained\"\n                        onClick={handleNext}\n                        disabled={\n                          (index === 1 &&\n                            (!capturedFaceData ||\n                              capturedFaceData.length < REQUIRED_IMAGES)) ||\n                          isSubmitting\n                        }\n                        sx={{ mr: 1 }}\n                      >\n                        Tiếp tục\n                      </Button>\n                      <Button\n                        disabled={index === 0 || isSubmitting}\n                        onClick={handleBack}\n                      >\n                        Quay lại\n                      </Button>\n                      {index > 0 && (\n                        <Button\n                          onClick={handleReset}\n                          sx={{ ml: 2 }}\n                          color=\"warning\"\n                          disabled={isSubmitting}\n                        >\n                          Bắt đầu lại\n                        </Button>\n                      )}\n                    </Box>\n                  )}\n                </Box>\n              </StepContent>\n            </Step>\n          ))}\n        </Stepper>\n      </Paper>\n\n      <Dialog open={showHelpDialog} onClose={() => setShowHelpDialog(false)}>\n        <DialogTitle>Hướng dẫn Đăng ký Khuôn mặt</DialogTitle>\n        <DialogContent>\n          <List dense>\n            <ListItem>\n              <ListItemIcon>\n                <Info />\n              </ListItemIcon>\n              <ListItemText primary=\"Mục đích: Đăng ký dữ liệu khuôn mặt để hệ thống có thể nhận diện bạn.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <HelpOutline />\n              </ListItemIcon>\n              <ListItemText\n                primary={`Chuẩn bị: Ngồi ở nơi đủ sáng, không đeo kính râm hoặc khẩu trang. Giữ khuôn mặt thẳng, nhìn vào camera.`}\n              />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <CameraAlt />\n              </ListItemIcon>\n              <ListItemText\n                primary={`Chụp ảnh: Nhấn nút 'Chụp ảnh' ${REQUIRED_IMAGES} lần. Có thể bật landmark để căn chỉnh.`}\n              />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <Check />\n              </ListItemIcon>\n              <ListItemText\n                primary={`Xác nhận & Hoàn thành: Xem lại ${REQUIRED_IMAGES} ảnh đã chụp, sau đó nhấn 'Đăng ký'.`}\n              />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <ErrorOutline />\n              </ListItemIcon>\n              <ListItemText primary=\"Lỗi: Nếu không nhận diện được khuôn mặt, hãy thử lại ở góc độ hoặc ánh sáng khác. Nếu lỗi tiếp diễn, liên hệ hỗ trợ.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <Replay />\n              </ListItemIcon>\n              <ListItemText primary=\"Đăng ký lại: Nếu muốn cập nhật ảnh khuôn mặt, bạn có thể chọn 'Đăng ký lại' từ màn hình thông báo.\" />\n            </ListItem>\n          </List>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setShowHelpDialog(false)}>Đóng</Button>\n        </DialogActions>\n      </Dialog>\n    </Container>\n  );\n};\n\n// Wrapper for lazy loading Webcam\nconst FaceRegistrationPageWithSuspense = () => (\n  <Suspense\n    fallback={\n      <Container maxWidth=\"sm\" sx={{ textAlign: \"center\", mt: 5 }}>\n        <CircularProgress />\n        <Typography sx={{ mt: 2 }}>Đang tải thành phần...</Typography>\n      </Container>\n    }\n  >\n    <FaceRegistrationPage />\n  </Suspense>\n);\n\nexport default FaceRegistrationPageWithSuspense;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
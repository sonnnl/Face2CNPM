{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\FaceRegistrationPage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, lazy, Suspense } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport { Box, Typography, Paper, Button, Stepper, Step, StepLabel, StepContent, CircularProgress, Alert, Card, CardContent, Grid, Divider, List, ListItem, ListItemIcon, ListItemText, Dialog, DialogTitle, DialogContent, DialogActions, Stack, Avatar, Container, Skeleton, AlertTitle } from \"@mui/material\";\nimport { Camera, Check, Face, Info, ViewArray, SaveAlt, ErrorOutline, CheckCircleOutline, ArrowBack, HelpOutline, CameraAlt, Person, Replay, FaceRetouchingNatural } from \"@mui/icons-material\";\nimport { getCurrentUser } from \"../redux/slices/authSlice\";\nimport { loadModels, detectFace } from \"../utils/faceUtils\";\n\n// Lazy load Webcam to reduce initial bundle size\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Webcam = /*#__PURE__*/lazy(_c = () => import(\"react-webcam\"));\n_c2 = Webcam;\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Improved video constraints for better mobile compatibility\nconst videoConstraints = {\n  width: {\n    ideal: 640\n  },\n  height: {\n    ideal: 480\n  },\n  facingMode: \"user\"\n};\nconst FaceRegistrationPage = () => {\n  _s();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const {\n    user,\n    token,\n    isLoading: authLoading\n  } = useSelector(state => state.auth);\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null); // Keep if needed for drawing overlays\n\n  // --- State ---\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [modelLoadingError, setModelLoadingError] = useState(null);\n  const [cameraReady, setCameraReady] = useState(false);\n  const [capturedImages, setCapturedImages] = useState([]); // Array of { img: base64, descriptor: Float32Array }\n  const [isProcessing, setIsProcessing] = useState(false); // For capture or registration operations\n  const [registrationError, setRegistrationError] = useState(\"\");\n  const [registrationSuccess, setRegistrationSuccess] = useState(false);\n  const [activeStep, setActiveStep] = useState(0);\n  const [showHelpDialog, setShowHelpDialog] = useState(false);\n\n  // New state to manage registration flow based on existing data\n  const [allowRegistration, setAllowRegistration] = useState(false);\n  const [checkingFaceStatus, setCheckingFaceStatus] = useState(true); // Initially check status\n  const [hasFaceRegistered, setHasFaceRegistered] = useState(false);\n\n  // --- Effects ---\n\n  // 1. Check initial face registration status when user data is available\n  useEffect(() => {\n    if (!authLoading && user) {\n      setHasFaceRegistered(!!user.face_registered); // Set based on user data\n      if (!user.face_registered) {\n        setAllowRegistration(true); // Allow registration if no face data\n      }\n      setCheckingFaceStatus(false); // Finished checking\n    }\n    // Consider adding dependency on token if needed for re-fetching user\n  }, [user, authLoading]);\n\n  // 2. Load face models when registration is allowed and needed (Step 1)\n  useEffect(() => {\n    const initModels = async () => {\n      // Only load if registration is allowed, we are on the capture step (index 1), and models aren't loaded yet\n      if (allowRegistration && activeStep === 1 && !modelsLoaded && !modelLoadingError) {\n        setIsProcessing(true); // Use general processing state\n        setModelLoadingError(null); // Reset previous error\n        try {\n          console.log(\"Loading face models...\");\n          await loadModels();\n          setModelsLoaded(true);\n          console.log(\"Models loaded successfully.\");\n          // enqueueSnackbar(\"Đã tải mô hình nhận diện khuôn mặt\", { variant: \"success\" });\n        } catch (error) {\n          console.error(\"Error loading face models:\", error);\n          setModelLoadingError(\"Không thể tải mô hình nhận diện. Vui lòng tải lại trang hoặc thử lại.\");\n          enqueueSnackbar(\"Lỗi tải mô hình nhận diện\", {\n            variant: \"error\"\n          });\n        } finally {\n          setIsProcessing(false);\n        }\n      }\n    };\n    initModels();\n  }, [allowRegistration, activeStep, modelsLoaded, modelLoadingError, enqueueSnackbar]);\n\n  // 3. Monitor camera readiness (using callback now)\n  const handleUserMedia = () => {\n    console.log(\"Camera is ready.\");\n    setCameraReady(true);\n  };\n  const handleUserMediaError = error => {\n    console.error(\"Camera error:\", error);\n    setCameraReady(false);\n    enqueueSnackbar(\"Không thể truy cập camera. Vui lòng cấp quyền và thử lại.\", {\n      variant: \"error\"\n    });\n    // Maybe move to a specific error step or show alert directly\n    if (activeStep === 1) {\n      // If error happens during capture step\n      setRegistrationError(\"Lỗi camera. Kiểm tra quyền truy cập.\");\n    }\n  };\n\n  // --- Actions ---\n\n  const handleAllowReRegistration = () => {\n    setAllowRegistration(true);\n    setHasFaceRegistered(false); // Treat as if not registered for the UI flow\n    handleReset(); // Reset steps and captured data\n  };\n  const handleNext = () => {\n    setActiveStep(prev => prev + 1);\n  };\n  const handleBack = () => {\n    setRegistrationError(\"\"); // Clear error when moving back\n    setActiveStep(prev => prev - 1);\n  };\n  const handleReset = () => {\n    setCapturedImages([]);\n    setActiveStep(0);\n    setRegistrationError(\"\");\n    setRegistrationSuccess(false);\n    setIsProcessing(false);\n    setModelsLoaded(false); // Reset models loaded state if needed, depends on desired behavior\n    setModelLoadingError(null);\n    setCameraReady(false);\n    // Do NOT reset allowRegistration or hasFaceRegistered here unless intended\n  };\n  const captureImage = async () => {\n    if (!webcamRef.current || !cameraReady || isProcessing) {\n      enqueueSnackbar(\"Camera chưa sẵn sàng hoặc đang xử lý\", {\n        variant: \"warning\"\n      });\n      return;\n    }\n    if (!modelsLoaded) {\n      enqueueSnackbar(\"Mô hình nhận diện chưa tải xong\", {\n        variant: \"warning\"\n      });\n      return;\n    }\n    setIsProcessing(true);\n    setRegistrationError(\"\"); // Clear previous error\n\n    try {\n      const imageSrc = webcamRef.current.getScreenshot({\n        width: 640,\n        height: 480\n      }); // Match constraints if possible\n      if (!imageSrc) {\n        throw new Error(\"Không thể chụp ảnh từ webcam.\");\n      }\n\n      // Perform face detection\n      const detections = await detectFace(imageSrc); // detectFace should return descriptor\n\n      if (!detections || !detections.descriptor) {\n        enqueueSnackbar(\"Không phát hiện được khuôn mặt rõ ràng. Hãy thử lại.\", {\n          variant: \"warning\"\n        });\n        setIsProcessing(false);\n        return;\n      }\n\n      // Store image and descriptor\n      const newImageData = {\n        img: imageSrc,\n        descriptor: Array.from(detections.descriptor) // Ensure descriptor is serializable\n      };\n      setCapturedImages(prev => [...prev, newImageData]);\n      enqueueSnackbar(`Đã chụp ảnh ${capturedImages.length + 1}/5`, {\n        variant: \"success\",\n        autoHideDuration: 1500\n      });\n\n      // Auto-advance to next step if 5 images are captured\n      if (capturedImages.length + 1 >= 5) {\n        handleNext();\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi chụp hoặc xử lý ảnh:\", error);\n      enqueueSnackbar(\"Lỗi khi chụp ảnh. Vui lòng thử lại.\", {\n        variant: \"error\"\n      });\n      setRegistrationError(\"Đã xảy ra lỗi trong quá trình chụp ảnh.\");\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  const submitRegistration = async () => {\n    if (capturedImages.length < 5 || isProcessing) {\n      enqueueSnackbar(\"Cần đủ 5 ảnh để đăng ký.\", {\n        variant: \"warning\"\n      });\n      return;\n    }\n    setIsProcessing(true);\n    setRegistrationError(\"\");\n    setRegistrationSuccess(false);\n    try {\n      const faceData = {\n        // Only send descriptors, server might not need full images if storage is a concern\n        descriptors: capturedImages.map(img => img.descriptor)\n        // Optional: include base64 images if server requires them\n        // images: capturedImages.map(img => img.img)\n      };\n      console.log(\"Submitting registration data...\");\n      const response = await axios.post(`${API_URL}/face-recognition/register`,\n      // Ensure endpoint is correct\n      faceData, {\n        headers: {\n          Authorization: `Bearer ${token}`,\n          \"Content-Type\": \"application/json\"\n        }\n      });\n      if (response.data.success) {\n        console.log(\"Registration successful:\", response.data);\n        enqueueSnackbar(\"Đăng ký khuôn mặt thành công!\", {\n          variant: \"success\"\n        });\n        setRegistrationSuccess(true);\n        dispatch(getCurrentUser()); // Refresh user data to update face_registered status\n        handleNext(); // Move to final step\n      } else {\n        throw new Error(response.data.message || \"Đăng ký không thành công từ server.\");\n      }\n    } catch (error) {\n      var _error$response, _error$response$data;\n      console.error(\"Lỗi đăng ký khuôn mặt:\", error);\n      const errMsg = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || \"Lỗi không xác định khi đăng ký.\";\n      setRegistrationError(`Đăng ký thất bại: ${errMsg}`);\n      enqueueSnackbar(`Đăng ký thất bại: ${errMsg}`, {\n        variant: \"error\"\n      });\n      // Consider moving back to the capture step or allowing retry on the summary step\n      // setActiveStep(2); // Stay on summary step to show error\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n  const navigateToProfile = () => {\n    navigate(\"/profile\"); // Or student dashboard\n  };\n  const steps = [\n  // Step 0: Introduction / Instructions\n  {\n    label: \"Giới thiệu\",\n    content: /*#__PURE__*/_jsxDEV(Box, {\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        gutterBottom: true,\n        children: \"Ch\\xE0o m\\u1EEBng \\u0111\\u1EBFn v\\u1EDBi \\u0111\\u0103ng k\\xFD khu\\xF4n m\\u1EB7t\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        paragraph: true,\n        children: \"Qu\\xE1 tr\\xECnh n\\xE0y gi\\xFAp h\\u1EC7 th\\u1ED1ng nh\\u1EADn di\\u1EC7n b\\u1EA1n \\u0111\\u1EC3 \\u0111i\\u1EC3m danh. Vui l\\xF2ng l\\xE0m theo c\\xE1c b\\u01B0\\u1EDBc sau:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 333,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(List, {\n        dense: true,\n        children: [/*#__PURE__*/_jsxDEV(ListItem, {\n          children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n            children: /*#__PURE__*/_jsxDEV(Info, {\n              fontSize: \"small\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 340,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 339,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n            primary: \"\\u0110\\u1EA3m b\\u1EA3o b\\u1EA1n \\u0111ang \\u1EDF n\\u01A1i c\\xF3 \\u0111\\u1EE7 \\xE1nh s\\xE1ng.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 342,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 338,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n          children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n            children: /*#__PURE__*/_jsxDEV(Face, {\n              fontSize: \"small\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 346,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 345,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n            primary: \"Gi\\u1EEF khu\\xF4n m\\u1EB7t th\\u1EB3ng, nh\\xECn tr\\u1EF1c di\\u1EC7n v\\xE0o camera.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 348,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n          children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n            children: /*#__PURE__*/_jsxDEV(ViewArray, {\n              fontSize: \"small\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 352,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 351,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n            primary: \"H\\u1EC7 th\\u1ED1ng s\\u1EBD y\\xEAu c\\u1EA7u b\\u1EA1n ch\\u1EE5p 5 \\u1EA3nh.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 354,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 350,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n          children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n            children: /*#__PURE__*/_jsxDEV(CameraAlt, {\n              fontSize: \"small\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 358,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 357,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n            primary: \"Nh\\u1EA5n n\\xFAt 'Ch\\u1EE5p \\u1EA3nh' khi b\\u1EA1n \\u0111\\xE3 s\\u1EB5n s\\xE0ng \\u1EDF m\\u1ED7i l\\u1EA7n ch\\u1EE5p.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 337,\n        columnNumber: 11\n      }, this), registrationError &&\n      /*#__PURE__*/\n      // Show general errors here too if needed\n      _jsxDEV(Alert, {\n        severity: \"error\",\n        sx: {\n          mt: 2\n        },\n        children: registrationError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 364,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 329,\n      columnNumber: 9\n    }, this)\n  },\n  // Step 1: Camera Setup & Capture\n  {\n    label: \"Chụp ảnh\",\n    content: /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        textAlign: \"center\"\n      },\n      children: [modelLoadingError && /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        sx: {\n          mb: 2\n        },\n        children: modelLoadingError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 377,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        gutterBottom: true,\n        children: [\"Ch\\u1EE5p \", capturedImages.length, \"/5 \\u1EA3nh\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 381,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body2\",\n        color: \"textSecondary\",\n        gutterBottom: true,\n        children: \"Gi\\u1EEF y\\xEAn v\\xE0 nh\\xECn th\\u1EB3ng v\\xE0o camera. Nh\\u1EA5n n\\xFAt khi s\\u1EB5n s\\xE0ng.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 384,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Paper, {\n        elevation: 3,\n        sx: {\n          position: \"relative\",\n          width: \"100%\",\n          // Make it responsive\n          maxWidth: \"480px\",\n          // Max width for the camera view\n          aspectRatio: \"4 / 3\",\n          // Maintain aspect ratio\n          margin: \"16px auto\",\n          overflow: \"hidden\",\n          bgcolor: \"grey.300\" // Background color while loading\n        },\n        children: [/*#__PURE__*/_jsxDEV(Suspense, {\n          fallback: /*#__PURE__*/_jsxDEV(CircularProgress, {\n            sx: {\n              position: \"absolute\",\n              top: \"50%\",\n              left: \"50%\",\n              transform: \"translate(-50%, -50%)\"\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 17\n          }, this),\n          children: /*#__PURE__*/_jsxDEV(Webcam, {\n            audio: false,\n            ref: webcamRef,\n            screenshotFormat: \"image/jpeg\",\n            videoConstraints: videoConstraints,\n            onUserMedia: handleUserMedia,\n            onUserMediaError: handleUserMediaError,\n            style: {\n              display: \"block\",\n              // Ensure it takes block space\n              width: \"100%\",\n              height: \"100%\",\n              objectFit: \"cover\" // Cover the container\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 411,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 399,\n          columnNumber: 13\n        }, this), !cameraReady && !modelLoadingError && /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            position: \"absolute\",\n            top: \"50%\",\n            left: \"50%\",\n            transform: \"translate(-50%, -50%)\",\n            textAlign: \"center\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 438,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            children: \"\\u0110ang kh\\u1EDFi \\u0111\\u1ED9ng camera...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 439,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 429,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"primary\",\n        startIcon: /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 24\n        }, this),\n        onClick: captureImage,\n        disabled: !cameraReady || isProcessing || capturedImages.length >= 5 || !modelsLoaded || !!modelLoadingError,\n        sx: {\n          mt: 2,\n          mb: 1\n        },\n        children: isProcessing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          size: 24\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 459,\n          columnNumber: 15\n        }, this) : `Chụp ảnh (${capturedImages.length}/5)`\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 444,\n        columnNumber: 11\n      }, this), capturedImages.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          mt: 2,\n          display: \"flex\",\n          justifyContent: \"center\",\n          gap: 1,\n          flexWrap: \"wrap\"\n        },\n        children: [capturedImages.map((imgData, index) => /*#__PURE__*/_jsxDEV(Avatar, {\n          src: imgData.img,\n          sx: {\n            width: 56,\n            height: 56\n          }\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 477,\n          columnNumber: 17\n        }, this)), [...Array(Math.max(0, 5 - capturedImages.length))].map((_, i) => /*#__PURE__*/_jsxDEV(Avatar, {\n          sx: {\n            width: 56,\n            height: 56,\n            bgcolor: \"grey.200\"\n          },\n          children: /*#__PURE__*/_jsxDEV(Person, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 490,\n            columnNumber: 21\n          }, this)\n        }, `placeholder-${i}`, false, {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 19\n        }, this))]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 467,\n        columnNumber: 13\n      }, this), registrationError &&\n      /*#__PURE__*/\n      // Show capture specific errors\n      _jsxDEV(Alert, {\n        severity: \"error\",\n        sx: {\n          mt: 2\n        },\n        children: registrationError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 497,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 375,\n      columnNumber: 9\n    }, this)\n  },\n  // Step 2: Confirmation / Summary\n  {\n    label: \"Xác nhận\",\n    content: /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        textAlign: \"center\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        gutterBottom: true,\n        children: \"Xem l\\u1EA1i v\\xE0 X\\xE1c nh\\u1EADn\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 509,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        paragraph: true,\n        children: \"B\\u1EA1n \\u0111\\xE3 ch\\u1EE5p \\u0111\\u1EE7 5 \\u1EA3nh. Xem l\\u1EA1i c\\xE1c \\u1EA3nh d\\u01B0\\u1EDBi \\u0111\\xE2y. N\\u1EBFu h\\xE0i l\\xF2ng, nh\\u1EA5n \\\"\\u0110\\u0103ng k\\xFD\\\".\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 512,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          display: \"flex\",\n          justifyContent: \"center\",\n          gap: 1,\n          flexWrap: \"wrap\",\n          mb: 3\n        },\n        children: capturedImages.map((imgData, index) => /*#__PURE__*/_jsxDEV(Avatar, {\n          src: imgData.img,\n          sx: {\n            width: 80,\n            height: 80\n          }\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 526,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 516,\n        columnNumber: 11\n      }, this), registrationError && /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        sx: {\n          mb: 2\n        },\n        children: registrationError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        color: \"success\" // Use success color for final action\n        ,\n        startIcon: /*#__PURE__*/_jsxDEV(SaveAlt, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 543,\n          columnNumber: 24\n        }, this),\n        onClick: submitRegistration,\n        disabled: isProcessing || capturedImages.length < 5,\n        sx: {\n          mt: 1,\n          mb: 1\n        },\n        children: isProcessing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          size: 24\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 549,\n          columnNumber: 15\n        }, this) : \"Đăng ký khuôn mặt\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 540,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 508,\n      columnNumber: 9\n    }, this)\n  },\n  // Step 3: Completion\n  {\n    label: \"Hoàn thành\",\n    content: /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        textAlign: \"center\",\n        p: 2\n      },\n      children: registrationSuccess ? /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(CheckCircleOutline, {\n          color: \"success\",\n          sx: {\n            fontSize: 60,\n            mb: 2\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 564,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          gutterBottom: true,\n          children: \"\\u0110\\u0103ng k\\xFD th\\xE0nh c\\xF4ng!\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 568,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          paragraph: true,\n          children: \"D\\u1EEF li\\u1EC7u khu\\xF4n m\\u1EB7t c\\u1EE7a b\\u1EA1n \\u0111\\xE3 \\u0111\\u01B0\\u1EE3c l\\u01B0u. B\\u1EA1n c\\xF3 th\\u1EC3 s\\u1EED d\\u1EE5ng t\\xEDnh n\\u0103ng \\u0111i\\u1EC3m danh b\\u1EB1ng khu\\xF4n m\\u1EB7t.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 571,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          onClick: navigateToProfile,\n          children: \"V\\u1EC1 trang c\\xE1 nh\\xE2n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 575,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true) : /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(ErrorOutline, {\n          color: \"error\",\n          sx: {\n            fontSize: 60,\n            mb: 2\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 581,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          gutterBottom: true,\n          children: \"\\u0110\\u0103ng k\\xFD th\\u1EA5t b\\u1EA1i\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 582,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          paragraph: true,\n          color: \"error\",\n          children: registrationError || \"Đã có lỗi xảy ra trong quá trình đăng ký.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 585,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"outlined\",\n          onClick: handleReset,\n          children: \"Th\\u1EED l\\u1EA1i t\\u1EEB \\u0111\\u1EA7u\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 589,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 561,\n      columnNumber: 9\n    }, this)\n  }];\n\n  // --- Render Logic ---\n\n  // Loading state for initial check\n  if (checkingFaceStatus || authLoading) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      maxWidth: \"sm\",\n      sx: {\n        textAlign: \"center\",\n        mt: 5\n      },\n      children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 605,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        sx: {\n          mt: 2\n        },\n        children: \"\\u0110ang ki\\u1EC3m tra tr\\u1EA1ng th\\xE1i \\u0111\\u0103ng k\\xFD...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 606,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 604,\n      columnNumber: 7\n    }, this);\n  }\n\n  // If face is already registered and registration is not explicitly allowed (re-register)\n  if (hasFaceRegistered && !allowRegistration) {\n    return /*#__PURE__*/_jsxDEV(Container, {\n      maxWidth: \"sm\",\n      sx: {\n        mt: 4\n      },\n      children: /*#__PURE__*/_jsxDEV(Paper, {\n        elevation: 3,\n        sx: {\n          p: 4,\n          textAlign: \"center\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(FaceRetouchingNatural, {\n          color: \"success\",\n          sx: {\n            fontSize: 60,\n            mb: 2\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 618,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          gutterBottom: true,\n          children: \"\\u0110\\xE3 c\\xF3 d\\u1EEF li\\u1EC7u khu\\xF4n m\\u1EB7t\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 619,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          paragraph: true,\n          color: \"text.secondary\",\n          children: \"H\\u1EC7 th\\u1ED1ng \\u0111\\xE3 ghi nh\\u1EADn d\\u1EEF li\\u1EC7u khu\\xF4n m\\u1EB7t c\\u1EE7a b\\u1EA1n. B\\u1EA1n c\\xF3 th\\u1EC3 s\\u1EED d\\u1EE5ng c\\xE1c t\\xEDnh n\\u0103ng li\\xEAn quan.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 622,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Stack, {\n          direction: \"row\",\n          spacing: 2,\n          justifyContent: \"center\",\n          sx: {\n            mt: 3\n          },\n          children: [/*#__PURE__*/_jsxDEV(Button, {\n            variant: \"contained\",\n            onClick: navigateToProfile,\n            startIcon: /*#__PURE__*/_jsxDEV(Person, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 635,\n              columnNumber: 26\n            }, this),\n            children: \"Xem h\\u1ED3 s\\u01A1\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 632,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Button, {\n            variant: \"outlined\",\n            onClick: handleAllowReRegistration,\n            startIcon: /*#__PURE__*/_jsxDEV(Replay, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 642,\n              columnNumber: 26\n            }, this),\n            children: \"\\u0110\\u0103ng k\\xFD l\\u1EA1i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 639,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 626,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 617,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 616,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Main Registration Stepper UI\n  return /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"md\",\n    sx: {\n      mt: 4,\n      mb: 4\n    },\n    children: [/*#__PURE__*/_jsxDEV(Paper, {\n      elevation: 3,\n      sx: {\n        p: {\n          xs: 2,\n          sm: 3\n        }\n      },\n      children: [/*#__PURE__*/_jsxDEV(Stack, {\n        direction: \"row\",\n        justifyContent: \"space-between\",\n        alignItems: \"center\",\n        mb: 2,\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h4\",\n          component: \"h1\",\n          children: \"\\u0110\\u0103ng k\\xFD khu\\xF4n m\\u1EB7t\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 662,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          startIcon: /*#__PURE__*/_jsxDEV(HelpOutline, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 666,\n            columnNumber: 24\n          }, this),\n          onClick: () => setShowHelpDialog(true),\n          size: \"small\",\n          children: \"Tr\\u1EE3 gi\\xFAp\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 665,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 656,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Divider, {\n        sx: {\n          mb: 3\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 673,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Stepper, {\n        activeStep: activeStep,\n        orientation: \"vertical\",\n        children: steps.map((step, index) => /*#__PURE__*/_jsxDEV(Step, {\n          expanded: true,\n          children: [\" \", /*#__PURE__*/_jsxDEV(StepLabel, {\n            icon: index === activeStep ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n              size: 24\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 684,\n              columnNumber: 21\n            }, this) : index < activeStep ? /*#__PURE__*/_jsxDEV(Check, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 686,\n              columnNumber: 21\n            }, this) : index + 1 // Custom icon logic might be better\n            // optional={ index === 2 ? ( <Typography variant=\"caption\">Bước cuối</Typography> ) : null }\n            ,\n            children: /*#__PURE__*/_jsxDEV(Typography, {\n              variant: activeStep === index ? \"h6\" : \"body1\",\n              children: step.label\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 693,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 681,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(StepContent, {\n            TransitionProps: {\n              unmountOnExit: false\n            },\n            children: [\" \", /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                mb: 2,\n                mt: 1,\n                pl: {\n                  xs: 0,\n                  sm: 1\n                }\n              },\n              children: [\" \", step.content, activeStep !== steps.length - 1 && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mt: 3,\n                  mb: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  onClick: handleNext,\n                  disabled: index === 1 && capturedImages.length < 5 || index === 2 && !registrationSuccess || isProcessing // Disable next based on step logic\n                  ,\n                  sx: {\n                    mr: 1\n                  },\n                  children: index === steps.length - 2 ? \"Hoàn thành\" : \"Tiếp tục\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 708,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  disabled: index === 0 || isProcessing,\n                  onClick: handleBack,\n                  children: \"Quay l\\u1EA1i\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 720,\n                  columnNumber: 23\n                }, this), index > 0 && index < steps.length - 1 && /*#__PURE__*/_jsxDEV(Button, {\n                  onClick: handleReset,\n                  sx: {\n                    ml: 2\n                  },\n                  color: \"warning\",\n                  children: \"B\\u1EAFt \\u0111\\u1EA7u l\\u1EA1i\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 728,\n                  columnNumber: 25\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 707,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 700,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 697,\n            columnNumber: 15\n          }, this)]\n        }, step.label, true, {\n          fileName: _jsxFileName,\n          lineNumber: 678,\n          columnNumber: 13\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 676,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 655,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: showHelpDialog,\n      onClose: () => setShowHelpDialog(false),\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"H\\u01B0\\u1EDBng d\\u1EABn \\u0110\\u0103ng k\\xFD Khu\\xF4n m\\u1EB7t\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 759,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: /*#__PURE__*/_jsxDEV(List, {\n          dense: true,\n          children: [/*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(Info, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 764,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 763,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"M\\u1EE5c \\u0111\\xEDch: \\u0110\\u0103ng k\\xFD d\\u1EEF li\\u1EC7u khu\\xF4n m\\u1EB7t \\u0111\\u1EC3 h\\u1EC7 th\\u1ED1ng c\\xF3 th\\u1EC3 nh\\u1EADn di\\u1EC7n b\\u1EA1n.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 766,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 762,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 770,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 769,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"Chu\\u1EA9n b\\u1ECB: Ng\\u1ED3i \\u1EDF n\\u01A1i \\u0111\\u1EE7 s\\xE1ng, kh\\xF4ng \\u0111eo k\\xEDnh r\\xE2m ho\\u1EB7c kh\\u1EA9u trang.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 772,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 768,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(Face, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 776,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 775,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"Ch\\u1EE5p \\u1EA3nh: Gi\\u1EEF khu\\xF4n m\\u1EB7t \\u1ED5n \\u0111\\u1ECBnh, nh\\xECn th\\u1EB3ng camera. H\\u1EC7 th\\u1ED1ng c\\u1EA7n 5 \\u1EA3nh.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 778,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 774,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(Check, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 782,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 781,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"Ho\\xE0n th\\xE0nh: Sau khi ch\\u1EE5p \\u0111\\u1EE7 \\u1EA3nh, nh\\u1EA5n '\\u0110\\u0103ng k\\xFD'. N\\u1EBFu th\\xE0nh c\\xF4ng, b\\u1EA1n s\\u1EBD nh\\u1EADn \\u0111\\u01B0\\u1EE3c th\\xF4ng b\\xE1o.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 784,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 780,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(ErrorOutline, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 788,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 787,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"L\\u1ED7i: N\\u1EBFu kh\\xF4ng nh\\u1EADn di\\u1EC7n \\u0111\\u01B0\\u1EE3c khu\\xF4n m\\u1EB7t, h\\xE3y th\\u1EED l\\u1EA1i \\u1EDF g\\xF3c \\u0111\\u1ED9 ho\\u1EB7c \\xE1nh s\\xE1ng kh\\xE1c. N\\u1EBFu l\\u1ED7i ti\\u1EBFp di\\u1EC5n, li\\xEAn h\\u1EC7 h\\u1ED7 tr\\u1EE3.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 790,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 786,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(ListItem, {\n            children: [/*#__PURE__*/_jsxDEV(ListItemIcon, {\n              children: /*#__PURE__*/_jsxDEV(Replay, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 794,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 793,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n              primary: \"\\u0110\\u0103ng k\\xFD l\\u1EA1i: N\\u1EBFu mu\\u1ED1n c\\u1EADp nh\\u1EADt \\u1EA3nh khu\\xF4n m\\u1EB7t, b\\u1EA1n c\\xF3 th\\u1EC3 ch\\u1ECDn '\\u0110\\u0103ng k\\xFD l\\u1EA1i' t\\u1EEB m\\xE0n h\\xECnh th\\xF4ng b\\xE1o.\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 796,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 792,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 761,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 760,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          onClick: () => setShowHelpDialog(false),\n          children: \"\\u0110\\xF3ng\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 801,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 800,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 758,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 654,\n    columnNumber: 5\n  }, this);\n};\n\n// Wrapper for lazy loading Webcam\n_s(FaceRegistrationPage, \"1Zx4Lb7NfMTaVy1egu/S1BiZQ4w=\", false, function () {\n  return [useNavigate, useDispatch, useSnackbar, useSelector];\n});\n_c3 = FaceRegistrationPage;\nconst FaceRegistrationPageWithSuspense = () => /*#__PURE__*/_jsxDEV(Suspense, {\n  fallback: /*#__PURE__*/_jsxDEV(Container, {\n    maxWidth: \"sm\",\n    sx: {\n      textAlign: \"center\",\n      mt: 5\n    },\n    children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 813,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      sx: {\n        mt: 2\n      },\n      children: \"\\u0110ang t\\u1EA3i th\\xE0nh ph\\u1EA7n...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 814,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 812,\n    columnNumber: 7\n  }, this),\n  children: /*#__PURE__*/_jsxDEV(FaceRegistrationPage, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 818,\n    columnNumber: 5\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 810,\n  columnNumber: 3\n}, this);\n_c4 = FaceRegistrationPageWithSuspense;\nexport default FaceRegistrationPageWithSuspense; // Export the wrapper\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"Webcam$lazy\");\n$RefreshReg$(_c2, \"Webcam\");\n$RefreshReg$(_c3, \"FaceRegistrationPage\");\n$RefreshReg$(_c4, \"FaceRegistrationPageWithSuspense\");","map":{"version":3,"names":["React","useState","useEffect","useRef","lazy","Suspense","useNavigate","useSelector","useDispatch","useSnackbar","axios","Box","Typography","Paper","Button","Stepper","Step","StepLabel","StepContent","CircularProgress","Alert","Card","CardContent","Grid","Divider","List","ListItem","ListItemIcon","ListItemText","Dialog","DialogTitle","DialogContent","DialogActions","Stack","Avatar","Container","Skeleton","AlertTitle","Camera","Check","Face","Info","ViewArray","SaveAlt","ErrorOutline","CheckCircleOutline","ArrowBack","HelpOutline","CameraAlt","Person","Replay","FaceRetouchingNatural","getCurrentUser","loadModels","detectFace","jsxDEV","_jsxDEV","Fragment","_Fragment","Webcam","_c","_c2","API_URL","process","env","REACT_APP_API_URL","videoConstraints","width","ideal","height","facingMode","FaceRegistrationPage","_s","navigate","dispatch","enqueueSnackbar","user","token","isLoading","authLoading","state","auth","webcamRef","canvasRef","modelsLoaded","setModelsLoaded","modelLoadingError","setModelLoadingError","cameraReady","setCameraReady","capturedImages","setCapturedImages","isProcessing","setIsProcessing","registrationError","setRegistrationError","registrationSuccess","setRegistrationSuccess","activeStep","setActiveStep","showHelpDialog","setShowHelpDialog","allowRegistration","setAllowRegistration","checkingFaceStatus","setCheckingFaceStatus","hasFaceRegistered","setHasFaceRegistered","face_registered","initModels","console","log","error","variant","handleUserMedia","handleUserMediaError","handleAllowReRegistration","handleReset","handleNext","prev","handleBack","captureImage","current","imageSrc","getScreenshot","Error","detections","descriptor","newImageData","img","Array","from","length","autoHideDuration","submitRegistration","faceData","descriptors","map","response","post","headers","Authorization","data","success","message","_error$response","_error$response$data","errMsg","navigateToProfile","steps","label","content","children","gutterBottom","fileName","_jsxFileName","lineNumber","columnNumber","paragraph","dense","fontSize","primary","severity","sx","mt","textAlign","mb","color","elevation","position","maxWidth","aspectRatio","margin","overflow","bgcolor","fallback","top","left","transform","audio","ref","screenshotFormat","onUserMedia","onUserMediaError","style","display","objectFit","startIcon","onClick","disabled","size","justifyContent","gap","flexWrap","imgData","index","src","Math","max","_","i","p","direction","spacing","xs","sm","alignItems","component","orientation","step","expanded","icon","TransitionProps","unmountOnExit","pl","mr","ml","open","onClose","_c3","FaceRegistrationPageWithSuspense","_c4","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/FaceRegistrationPage.js"],"sourcesContent":["import React, { useState, useEffect, useRef, lazy, Suspense } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport {\n  Box,\n  Typography,\n  Paper,\n  Button,\n  Stepper,\n  Step,\n  StepLabel,\n  StepContent,\n  CircularProgress,\n  Alert,\n  Card,\n  CardContent,\n  Grid,\n  Divider,\n  List,\n  ListItem,\n  ListItemIcon,\n  ListItemText,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Stack,\n  Avatar,\n  Container,\n  Skeleton,\n  AlertTitle,\n} from \"@mui/material\";\nimport {\n  Camera,\n  Check,\n  Face,\n  Info,\n  ViewArray,\n  SaveAlt,\n  ErrorOutline,\n  CheckCircleOutline,\n  ArrowBack,\n  HelpOutline,\n  CameraAlt,\n  Person,\n  Replay,\n  FaceRetouchingNatural,\n} from \"@mui/icons-material\";\nimport { getCurrentUser } from \"../redux/slices/authSlice\";\nimport { loadModels, detectFace } from \"../utils/faceUtils\";\n\n// Lazy load Webcam to reduce initial bundle size\nconst Webcam = lazy(() => import(\"react-webcam\"));\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Improved video constraints for better mobile compatibility\nconst videoConstraints = {\n  width: { ideal: 640 },\n  height: { ideal: 480 },\n  facingMode: \"user\",\n};\n\nconst FaceRegistrationPage = () => {\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n  const {\n    user,\n    token,\n    isLoading: authLoading,\n  } = useSelector((state) => state.auth);\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null); // Keep if needed for drawing overlays\n\n  // --- State ---\n  const [modelsLoaded, setModelsLoaded] = useState(false);\n  const [modelLoadingError, setModelLoadingError] = useState(null);\n  const [cameraReady, setCameraReady] = useState(false);\n  const [capturedImages, setCapturedImages] = useState([]); // Array of { img: base64, descriptor: Float32Array }\n  const [isProcessing, setIsProcessing] = useState(false); // For capture or registration operations\n  const [registrationError, setRegistrationError] = useState(\"\");\n  const [registrationSuccess, setRegistrationSuccess] = useState(false);\n  const [activeStep, setActiveStep] = useState(0);\n  const [showHelpDialog, setShowHelpDialog] = useState(false);\n\n  // New state to manage registration flow based on existing data\n  const [allowRegistration, setAllowRegistration] = useState(false);\n  const [checkingFaceStatus, setCheckingFaceStatus] = useState(true); // Initially check status\n  const [hasFaceRegistered, setHasFaceRegistered] = useState(false);\n\n  // --- Effects ---\n\n  // 1. Check initial face registration status when user data is available\n  useEffect(() => {\n    if (!authLoading && user) {\n      setHasFaceRegistered(!!user.face_registered); // Set based on user data\n      if (!user.face_registered) {\n        setAllowRegistration(true); // Allow registration if no face data\n      }\n      setCheckingFaceStatus(false); // Finished checking\n    }\n    // Consider adding dependency on token if needed for re-fetching user\n  }, [user, authLoading]);\n\n  // 2. Load face models when registration is allowed and needed (Step 1)\n  useEffect(() => {\n    const initModels = async () => {\n      // Only load if registration is allowed, we are on the capture step (index 1), and models aren't loaded yet\n      if (\n        allowRegistration &&\n        activeStep === 1 &&\n        !modelsLoaded &&\n        !modelLoadingError\n      ) {\n        setIsProcessing(true); // Use general processing state\n        setModelLoadingError(null); // Reset previous error\n        try {\n          console.log(\"Loading face models...\");\n          await loadModels();\n          setModelsLoaded(true);\n          console.log(\"Models loaded successfully.\");\n          // enqueueSnackbar(\"Đã tải mô hình nhận diện khuôn mặt\", { variant: \"success\" });\n        } catch (error) {\n          console.error(\"Error loading face models:\", error);\n          setModelLoadingError(\n            \"Không thể tải mô hình nhận diện. Vui lòng tải lại trang hoặc thử lại.\"\n          );\n          enqueueSnackbar(\"Lỗi tải mô hình nhận diện\", { variant: \"error\" });\n        } finally {\n          setIsProcessing(false);\n        }\n      }\n    };\n    initModels();\n  }, [\n    allowRegistration,\n    activeStep,\n    modelsLoaded,\n    modelLoadingError,\n    enqueueSnackbar,\n  ]);\n\n  // 3. Monitor camera readiness (using callback now)\n  const handleUserMedia = () => {\n    console.log(\"Camera is ready.\");\n    setCameraReady(true);\n  };\n\n  const handleUserMediaError = (error) => {\n    console.error(\"Camera error:\", error);\n    setCameraReady(false);\n    enqueueSnackbar(\n      \"Không thể truy cập camera. Vui lòng cấp quyền và thử lại.\",\n      { variant: \"error\" }\n    );\n    // Maybe move to a specific error step or show alert directly\n    if (activeStep === 1) {\n      // If error happens during capture step\n      setRegistrationError(\"Lỗi camera. Kiểm tra quyền truy cập.\");\n    }\n  };\n\n  // --- Actions ---\n\n  const handleAllowReRegistration = () => {\n    setAllowRegistration(true);\n    setHasFaceRegistered(false); // Treat as if not registered for the UI flow\n    handleReset(); // Reset steps and captured data\n  };\n\n  const handleNext = () => {\n    setActiveStep((prev) => prev + 1);\n  };\n\n  const handleBack = () => {\n    setRegistrationError(\"\"); // Clear error when moving back\n    setActiveStep((prev) => prev - 1);\n  };\n\n  const handleReset = () => {\n    setCapturedImages([]);\n    setActiveStep(0);\n    setRegistrationError(\"\");\n    setRegistrationSuccess(false);\n    setIsProcessing(false);\n    setModelsLoaded(false); // Reset models loaded state if needed, depends on desired behavior\n    setModelLoadingError(null);\n    setCameraReady(false);\n    // Do NOT reset allowRegistration or hasFaceRegistered here unless intended\n  };\n\n  const captureImage = async () => {\n    if (!webcamRef.current || !cameraReady || isProcessing) {\n      enqueueSnackbar(\"Camera chưa sẵn sàng hoặc đang xử lý\", {\n        variant: \"warning\",\n      });\n      return;\n    }\n    if (!modelsLoaded) {\n      enqueueSnackbar(\"Mô hình nhận diện chưa tải xong\", {\n        variant: \"warning\",\n      });\n      return;\n    }\n\n    setIsProcessing(true);\n    setRegistrationError(\"\"); // Clear previous error\n\n    try {\n      const imageSrc = webcamRef.current.getScreenshot({\n        width: 640,\n        height: 480,\n      }); // Match constraints if possible\n      if (!imageSrc) {\n        throw new Error(\"Không thể chụp ảnh từ webcam.\");\n      }\n\n      // Perform face detection\n      const detections = await detectFace(imageSrc); // detectFace should return descriptor\n\n      if (!detections || !detections.descriptor) {\n        enqueueSnackbar(\n          \"Không phát hiện được khuôn mặt rõ ràng. Hãy thử lại.\",\n          { variant: \"warning\" }\n        );\n        setIsProcessing(false);\n        return;\n      }\n\n      // Store image and descriptor\n      const newImageData = {\n        img: imageSrc,\n        descriptor: Array.from(detections.descriptor), // Ensure descriptor is serializable\n      };\n      setCapturedImages((prev) => [...prev, newImageData]);\n\n      enqueueSnackbar(`Đã chụp ảnh ${capturedImages.length + 1}/5`, {\n        variant: \"success\",\n        autoHideDuration: 1500,\n      });\n\n      // Auto-advance to next step if 5 images are captured\n      if (capturedImages.length + 1 >= 5) {\n        handleNext();\n      }\n    } catch (error) {\n      console.error(\"Lỗi khi chụp hoặc xử lý ảnh:\", error);\n      enqueueSnackbar(\"Lỗi khi chụp ảnh. Vui lòng thử lại.\", {\n        variant: \"error\",\n      });\n      setRegistrationError(\"Đã xảy ra lỗi trong quá trình chụp ảnh.\");\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const submitRegistration = async () => {\n    if (capturedImages.length < 5 || isProcessing) {\n      enqueueSnackbar(\"Cần đủ 5 ảnh để đăng ký.\", { variant: \"warning\" });\n      return;\n    }\n\n    setIsProcessing(true);\n    setRegistrationError(\"\");\n    setRegistrationSuccess(false);\n\n    try {\n      const faceData = {\n        // Only send descriptors, server might not need full images if storage is a concern\n        descriptors: capturedImages.map((img) => img.descriptor),\n        // Optional: include base64 images if server requires them\n        // images: capturedImages.map(img => img.img)\n      };\n\n      console.log(\"Submitting registration data...\");\n      const response = await axios.post(\n        `${API_URL}/face-recognition/register`, // Ensure endpoint is correct\n        faceData,\n        {\n          headers: {\n            Authorization: `Bearer ${token}`,\n            \"Content-Type\": \"application/json\",\n          },\n        }\n      );\n\n      if (response.data.success) {\n        console.log(\"Registration successful:\", response.data);\n        enqueueSnackbar(\"Đăng ký khuôn mặt thành công!\", {\n          variant: \"success\",\n        });\n        setRegistrationSuccess(true);\n        dispatch(getCurrentUser()); // Refresh user data to update face_registered status\n        handleNext(); // Move to final step\n      } else {\n        throw new Error(\n          response.data.message || \"Đăng ký không thành công từ server.\"\n        );\n      }\n    } catch (error) {\n      console.error(\"Lỗi đăng ký khuôn mặt:\", error);\n      const errMsg =\n        error.response?.data?.message ||\n        error.message ||\n        \"Lỗi không xác định khi đăng ký.\";\n      setRegistrationError(`Đăng ký thất bại: ${errMsg}`);\n      enqueueSnackbar(`Đăng ký thất bại: ${errMsg}`, { variant: \"error\" });\n      // Consider moving back to the capture step or allowing retry on the summary step\n      // setActiveStep(2); // Stay on summary step to show error\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const navigateToProfile = () => {\n    navigate(\"/profile\"); // Or student dashboard\n  };\n\n  const steps = [\n    // Step 0: Introduction / Instructions\n    {\n      label: \"Giới thiệu\",\n      content: (\n        <Box>\n          <Typography variant=\"h6\" gutterBottom>\n            Chào mừng đến với đăng ký khuôn mặt\n          </Typography>\n          <Typography paragraph>\n            Quá trình này giúp hệ thống nhận diện bạn để điểm danh. Vui lòng làm\n            theo các bước sau:\n          </Typography>\n          <List dense>\n            <ListItem>\n              <ListItemIcon>\n                <Info fontSize=\"small\" />\n              </ListItemIcon>\n              <ListItemText primary=\"Đảm bảo bạn đang ở nơi có đủ ánh sáng.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <Face fontSize=\"small\" />\n              </ListItemIcon>\n              <ListItemText primary=\"Giữ khuôn mặt thẳng, nhìn trực diện vào camera.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <ViewArray fontSize=\"small\" />\n              </ListItemIcon>\n              <ListItemText primary=\"Hệ thống sẽ yêu cầu bạn chụp 5 ảnh.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <CameraAlt fontSize=\"small\" />\n              </ListItemIcon>\n              <ListItemText primary=\"Nhấn nút 'Chụp ảnh' khi bạn đã sẵn sàng ở mỗi lần chụp.\" />\n            </ListItem>\n          </List>\n          {registrationError && ( // Show general errors here too if needed\n            <Alert severity=\"error\" sx={{ mt: 2 }}>\n              {registrationError}\n            </Alert>\n          )}\n        </Box>\n      ),\n    },\n    // Step 1: Camera Setup & Capture\n    {\n      label: \"Chụp ảnh\",\n      content: (\n        <Box sx={{ textAlign: \"center\" }}>\n          {modelLoadingError && (\n            <Alert severity=\"error\" sx={{ mb: 2 }}>\n              {modelLoadingError}\n            </Alert>\n          )}\n          <Typography variant=\"h6\" gutterBottom>\n            Chụp {capturedImages.length}/5 ảnh\n          </Typography>\n          <Typography variant=\"body2\" color=\"textSecondary\" gutterBottom>\n            Giữ yên và nhìn thẳng vào camera. Nhấn nút khi sẵn sàng.\n          </Typography>\n          <Paper\n            elevation={3}\n            sx={{\n              position: \"relative\",\n              width: \"100%\", // Make it responsive\n              maxWidth: \"480px\", // Max width for the camera view\n              aspectRatio: \"4 / 3\", // Maintain aspect ratio\n              margin: \"16px auto\",\n              overflow: \"hidden\",\n              bgcolor: \"grey.300\", // Background color while loading\n            }}\n          >\n            <Suspense\n              fallback={\n                <CircularProgress\n                  sx={{\n                    position: \"absolute\",\n                    top: \"50%\",\n                    left: \"50%\",\n                    transform: \"translate(-50%, -50%)\",\n                  }}\n                />\n              }\n            >\n              <Webcam\n                audio={false}\n                ref={webcamRef}\n                screenshotFormat=\"image/jpeg\"\n                videoConstraints={videoConstraints}\n                onUserMedia={handleUserMedia}\n                onUserMediaError={handleUserMediaError}\n                style={{\n                  display: \"block\", // Ensure it takes block space\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\", // Cover the container\n                }}\n              />\n            </Suspense>\n            {/* Optional: Canvas for drawing face detection box */}\n            {/* <canvas ref={canvasRef} style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%' }} /> */}\n            {!cameraReady && !modelLoadingError && (\n              <Box\n                sx={{\n                  position: \"absolute\",\n                  top: \"50%\",\n                  left: \"50%\",\n                  transform: \"translate(-50%, -50%)\",\n                  textAlign: \"center\",\n                }}\n              >\n                <CircularProgress />\n                <Typography>Đang khởi động camera...</Typography>\n              </Box>\n            )}\n          </Paper>\n\n          <Button\n            variant=\"contained\"\n            color=\"primary\"\n            startIcon={<CameraAlt />}\n            onClick={captureImage}\n            disabled={\n              !cameraReady ||\n              isProcessing ||\n              capturedImages.length >= 5 ||\n              !modelsLoaded ||\n              !!modelLoadingError\n            }\n            sx={{ mt: 2, mb: 1 }}\n          >\n            {isProcessing ? (\n              <CircularProgress size={24} />\n            ) : (\n              `Chụp ảnh (${capturedImages.length}/5)`\n            )}\n          </Button>\n\n          {/* Display captured image previews */}\n          {capturedImages.length > 0 && (\n            <Box\n              sx={{\n                mt: 2,\n                display: \"flex\",\n                justifyContent: \"center\",\n                gap: 1,\n                flexWrap: \"wrap\",\n              }}\n            >\n              {capturedImages.map((imgData, index) => (\n                <Avatar\n                  key={index}\n                  src={imgData.img}\n                  sx={{ width: 56, height: 56 }}\n                />\n              ))}\n              {/* Add placeholders if needed */}\n              {[...Array(Math.max(0, 5 - capturedImages.length))].map(\n                (_, i) => (\n                  <Avatar\n                    key={`placeholder-${i}`}\n                    sx={{ width: 56, height: 56, bgcolor: \"grey.200\" }}\n                  >\n                    <Person />\n                  </Avatar>\n                )\n              )}\n            </Box>\n          )}\n          {registrationError && ( // Show capture specific errors\n            <Alert severity=\"error\" sx={{ mt: 2 }}>\n              {registrationError}\n            </Alert>\n          )}\n        </Box>\n      ),\n    },\n    // Step 2: Confirmation / Summary\n    {\n      label: \"Xác nhận\",\n      content: (\n        <Box sx={{ textAlign: \"center\" }}>\n          <Typography variant=\"h6\" gutterBottom>\n            Xem lại và Xác nhận\n          </Typography>\n          <Typography paragraph>\n            Bạn đã chụp đủ 5 ảnh. Xem lại các ảnh dưới đây. Nếu hài lòng, nhấn\n            \"Đăng ký\".\n          </Typography>\n          <Box\n            sx={{\n              display: \"flex\",\n              justifyContent: \"center\",\n              gap: 1,\n              flexWrap: \"wrap\",\n              mb: 3,\n            }}\n          >\n            {capturedImages.map((imgData, index) => (\n              <Avatar\n                key={index}\n                src={imgData.img}\n                sx={{ width: 80, height: 80 }}\n              />\n            ))}\n          </Box>\n\n          {registrationError && (\n            <Alert severity=\"error\" sx={{ mb: 2 }}>\n              {registrationError}\n            </Alert>\n          )}\n\n          <Button\n            variant=\"contained\"\n            color=\"success\" // Use success color for final action\n            startIcon={<SaveAlt />}\n            onClick={submitRegistration}\n            disabled={isProcessing || capturedImages.length < 5}\n            sx={{ mt: 1, mb: 1 }}\n          >\n            {isProcessing ? (\n              <CircularProgress size={24} />\n            ) : (\n              \"Đăng ký khuôn mặt\"\n            )}\n          </Button>\n        </Box>\n      ),\n    },\n    // Step 3: Completion\n    {\n      label: \"Hoàn thành\",\n      content: (\n        <Box sx={{ textAlign: \"center\", p: 2 }}>\n          {registrationSuccess ? (\n            <>\n              <CheckCircleOutline\n                color=\"success\"\n                sx={{ fontSize: 60, mb: 2 }}\n              />\n              <Typography variant=\"h5\" gutterBottom>\n                Đăng ký thành công!\n              </Typography>\n              <Typography paragraph>\n                Dữ liệu khuôn mặt của bạn đã được lưu. Bạn có thể sử dụng tính\n                năng điểm danh bằng khuôn mặt.\n              </Typography>\n              <Button variant=\"contained\" onClick={navigateToProfile}>\n                Về trang cá nhân\n              </Button>\n            </>\n          ) : (\n            <>\n              <ErrorOutline color=\"error\" sx={{ fontSize: 60, mb: 2 }} />\n              <Typography variant=\"h5\" gutterBottom>\n                Đăng ký thất bại\n              </Typography>\n              <Typography paragraph color=\"error\">\n                {registrationError ||\n                  \"Đã có lỗi xảy ra trong quá trình đăng ký.\"}\n              </Typography>\n              <Button variant=\"outlined\" onClick={handleReset}>\n                Thử lại từ đầu\n              </Button>\n            </>\n          )}\n        </Box>\n      ),\n    },\n  ];\n\n  // --- Render Logic ---\n\n  // Loading state for initial check\n  if (checkingFaceStatus || authLoading) {\n    return (\n      <Container maxWidth=\"sm\" sx={{ textAlign: \"center\", mt: 5 }}>\n        <CircularProgress />\n        <Typography sx={{ mt: 2 }}>\n          Đang kiểm tra trạng thái đăng ký...\n        </Typography>\n      </Container>\n    );\n  }\n\n  // If face is already registered and registration is not explicitly allowed (re-register)\n  if (hasFaceRegistered && !allowRegistration) {\n    return (\n      <Container maxWidth=\"sm\" sx={{ mt: 4 }}>\n        <Paper elevation={3} sx={{ p: 4, textAlign: \"center\" }}>\n          <FaceRetouchingNatural color=\"success\" sx={{ fontSize: 60, mb: 2 }} />\n          <Typography variant=\"h5\" gutterBottom>\n            Đã có dữ liệu khuôn mặt\n          </Typography>\n          <Typography paragraph color=\"text.secondary\">\n            Hệ thống đã ghi nhận dữ liệu khuôn mặt của bạn. Bạn có thể sử dụng\n            các tính năng liên quan.\n          </Typography>\n          <Stack\n            direction=\"row\"\n            spacing={2}\n            justifyContent=\"center\"\n            sx={{ mt: 3 }}\n          >\n            <Button\n              variant=\"contained\"\n              onClick={navigateToProfile}\n              startIcon={<Person />}\n            >\n              Xem hồ sơ\n            </Button>\n            <Button\n              variant=\"outlined\"\n              onClick={handleAllowReRegistration}\n              startIcon={<Replay />}\n            >\n              Đăng ký lại\n            </Button>\n          </Stack>\n        </Paper>\n      </Container>\n    );\n  }\n\n  // Main Registration Stepper UI\n  return (\n    <Container maxWidth=\"md\" sx={{ mt: 4, mb: 4 }}>\n      <Paper elevation={3} sx={{ p: { xs: 2, sm: 3 } }}>\n        <Stack\n          direction=\"row\"\n          justifyContent=\"space-between\"\n          alignItems=\"center\"\n          mb={2}\n        >\n          <Typography variant=\"h4\" component=\"h1\">\n            Đăng ký khuôn mặt\n          </Typography>\n          <Button\n            startIcon={<HelpOutline />}\n            onClick={() => setShowHelpDialog(true)}\n            size=\"small\"\n          >\n            Trợ giúp\n          </Button>\n        </Stack>\n        <Divider sx={{ mb: 3 }} />\n\n        {/* --- Stepper --- */}\n        <Stepper activeStep={activeStep} orientation=\"vertical\">\n          {steps.map((step, index) => (\n            <Step key={step.label} expanded={true}>\n              {\" \"}\n              {/* Keep all steps expanded visually */}\n              <StepLabel\n                icon={\n                  index === activeStep ? (\n                    <CircularProgress size={24} />\n                  ) : index < activeStep ? (\n                    <Check />\n                  ) : (\n                    index + 1\n                  )\n                } // Custom icon logic might be better\n                // optional={ index === 2 ? ( <Typography variant=\"caption\">Bước cuối</Typography> ) : null }\n              >\n                <Typography variant={activeStep === index ? \"h6\" : \"body1\"}>\n                  {step.label}\n                </Typography>\n              </StepLabel>\n              <StepContent TransitionProps={{ unmountOnExit: false }}>\n                {\" \"}\n                {/* Keep content mounted */}\n                <Box sx={{ mb: 2, mt: 1, pl: { xs: 0, sm: 1 } }}>\n                  {\" \"}\n                  {/* Adjust padding */}\n                  {step.content}\n                  {/* Navigation Buttons within Step Content */}\n                  {/* Only show buttons if not on the final success/fail step */}\n                  {activeStep !== steps.length - 1 && (\n                    <Box sx={{ mt: 3, mb: 1 }}>\n                      <Button\n                        variant=\"contained\"\n                        onClick={handleNext}\n                        disabled={\n                          (index === 1 && capturedImages.length < 5) ||\n                          (index === 2 && !registrationSuccess) ||\n                          isProcessing\n                        } // Disable next based on step logic\n                        sx={{ mr: 1 }}\n                      >\n                        {index === steps.length - 2 ? \"Hoàn thành\" : \"Tiếp tục\"}\n                      </Button>\n                      <Button\n                        disabled={index === 0 || isProcessing}\n                        onClick={handleBack}\n                      >\n                        Quay lại\n                      </Button>\n                      {/* Add Reset button on early steps if needed */}\n                      {index > 0 && index < steps.length - 1 && (\n                        <Button\n                          onClick={handleReset}\n                          sx={{ ml: 2 }}\n                          color=\"warning\"\n                        >\n                          Bắt đầu lại\n                        </Button>\n                      )}\n                    </Box>\n                  )}\n                </Box>\n              </StepContent>\n            </Step>\n          ))}\n        </Stepper>\n\n        {/* --- Overall Reset/Completion Actions --- */}\n        {/* (Moved navigation inside StepContent, but keep final actions if needed) */}\n        {/* Example: If final step is reached but allows going back */}\n        {/* {activeStep === steps.length && registrationSuccess && (\n             <Paper square elevation={0} sx={{ p: 3, mt: 2, textAlign: 'center' }}>\n             <Typography>Đăng ký hoàn tất!</Typography>\n             <Button onClick={navigateToProfile} sx={{ mt: 1 }}>\n                 Về trang cá nhân\n             </Button>\n             </Paper>\n         )} */}\n      </Paper>\n\n      {/* Help Dialog */}\n      <Dialog open={showHelpDialog} onClose={() => setShowHelpDialog(false)}>\n        <DialogTitle>Hướng dẫn Đăng ký Khuôn mặt</DialogTitle>\n        <DialogContent>\n          <List dense>\n            <ListItem>\n              <ListItemIcon>\n                <Info />\n              </ListItemIcon>\n              <ListItemText primary=\"Mục đích: Đăng ký dữ liệu khuôn mặt để hệ thống có thể nhận diện bạn.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <CameraAlt />\n              </ListItemIcon>\n              <ListItemText primary=\"Chuẩn bị: Ngồi ở nơi đủ sáng, không đeo kính râm hoặc khẩu trang.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <Face />\n              </ListItemIcon>\n              <ListItemText primary=\"Chụp ảnh: Giữ khuôn mặt ổn định, nhìn thẳng camera. Hệ thống cần 5 ảnh.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <Check />\n              </ListItemIcon>\n              <ListItemText primary=\"Hoàn thành: Sau khi chụp đủ ảnh, nhấn 'Đăng ký'. Nếu thành công, bạn sẽ nhận được thông báo.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <ErrorOutline />\n              </ListItemIcon>\n              <ListItemText primary=\"Lỗi: Nếu không nhận diện được khuôn mặt, hãy thử lại ở góc độ hoặc ánh sáng khác. Nếu lỗi tiếp diễn, liên hệ hỗ trợ.\" />\n            </ListItem>\n            <ListItem>\n              <ListItemIcon>\n                <Replay />\n              </ListItemIcon>\n              <ListItemText primary=\"Đăng ký lại: Nếu muốn cập nhật ảnh khuôn mặt, bạn có thể chọn 'Đăng ký lại' từ màn hình thông báo.\" />\n            </ListItem>\n          </List>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setShowHelpDialog(false)}>Đóng</Button>\n        </DialogActions>\n      </Dialog>\n    </Container>\n  );\n};\n\n// Wrapper for lazy loading Webcam\nconst FaceRegistrationPageWithSuspense = () => (\n  <Suspense\n    fallback={\n      <Container maxWidth=\"sm\" sx={{ textAlign: \"center\", mt: 5 }}>\n        <CircularProgress />\n        <Typography sx={{ mt: 2 }}>Đang tải thành phần...</Typography>\n      </Container>\n    }\n  >\n    <FaceRegistrationPage />\n  </Suspense>\n);\n\nexport default FaceRegistrationPageWithSuspense; // Export the wrapper\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\GoogleRedirectPage.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport { useDispatch } from \"react-redux\";\nimport { useLocation, useNavigate } from \"react-router-dom\";\nimport { Container, Box, Typography, CircularProgress, Paper } from \"@mui/material\";\nimport { setCredentials } from \"../redux/slices/authSlice\";\nimport axios from \"axios\";\nimport LoadingScreen from \"../components/LoadingScreen\";\n\n// Thay thế import từ file config bằng định nghĩa trực tiếp\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\nconst GoogleRedirectPage = () => {\n  _s();\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const location = useLocation();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  useEffect(() => {\n    const fetchUserData = async () => {\n      try {\n        const params = new URLSearchParams(location.search);\n        const token = params.get(\"token\");\n        if (!token) {\n          throw new Error(\"Không nhận được token xác thực\");\n        }\n\n        // Thiết lập token vào header cho tất cả các request\n        axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\n\n        // Lấy thông tin người dùng - Sửa đường dẫn API\n        const response = await axios.get(`${API_URL}/auth/me`);\n        const userData = response.data;\n\n        // Lưu token và thông tin user vào Redux store\n        dispatch(setCredentials({\n          token,\n          user: userData\n        }));\n\n        // Kiểm tra trạng thái người dùng và chuyển hướng tương ứng\n        if (!userData.full_name || !userData.role) {\n          // Cần hoàn thành đăng ký\n          navigate(\"/complete-registration\");\n        } else if (userData.status === \"pending\" || userData.status === \"rejected\") {\n          // Tài khoản đang chờ phê duyệt hoặc bị từ chối\n          navigate(\"/pending-approval\");\n        } else if (userData.status === \"approved\") {\n          // Tài khoản đã được phê duyệt\n          navigate(\"/dashboard\");\n        } else {\n          // Mặc định chuyển hướng đến dashboard\n          navigate(\"/dashboard\");\n        }\n      } catch (err) {\n        console.error(\"Lỗi khi xử lý đăng nhập Google:\", err);\n        setError(err.message || \"Đã xảy ra lỗi khi xử lý đăng nhập Google\");\n        setLoading(false);\n      }\n    };\n    fetchUserData();\n  }, [dispatch, location.search, navigate]);\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex flex-col items-center justify-center min-h-screen\",\n      children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n        className: \"text-2xl font-bold text-red-600 mb-4\",\n        children: \"L\\u1ED7i \\u0111\\u0103ng nh\\u1EADp\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-gray-700\",\n        children: error\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate(\"/login\"),\n        className: \"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\",\n        children: \"Quay l\\u1EA1i trang \\u0111\\u0103ng nh\\u1EADp\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(LoadingScreen, {\n    message: \"\\u0110ang x\\u1EED l\\xFD \\u0111\\u0103ng nh\\u1EADp Google...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 92,\n    columnNumber: 10\n  }, this);\n};\n_s(GoogleRedirectPage, \"3aNaU2C/QV3T/KcK75ny2FJARsU=\", false, function () {\n  return [useDispatch, useNavigate, useLocation];\n});\n_c = GoogleRedirectPage;\nexport default GoogleRedirectPage;\nvar _c;\n$RefreshReg$(_c, \"GoogleRedirectPage\");","map":{"version":3,"names":["React","useEffect","useState","useDispatch","useLocation","useNavigate","Container","Box","Typography","CircularProgress","Paper","setCredentials","axios","LoadingScreen","jsxDEV","_jsxDEV","API_URL","process","env","REACT_APP_API_URL","GoogleRedirectPage","_s","dispatch","navigate","location","loading","setLoading","error","setError","fetchUserData","params","URLSearchParams","search","token","get","Error","defaults","headers","common","response","userData","data","user","full_name","role","status","err","console","message","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/GoogleRedirectPage.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { useLocation, useNavigate } from \"react-router-dom\";\r\nimport {\r\n  Container,\r\n  Box,\r\n  Typography,\r\n  CircularProgress,\r\n  Paper,\r\n} from \"@mui/material\";\r\nimport { setCredentials } from \"../redux/slices/authSlice\";\r\nimport axios from \"axios\";\r\nimport LoadingScreen from \"../components/LoadingScreen\";\r\n\r\n// Thay thế import từ file config bằng định nghĩa trực tiếp\r\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\r\n\r\nconst GoogleRedirectPage = () => {\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState(null);\r\n\r\n  useEffect(() => {\r\n    const fetchUserData = async () => {\r\n      try {\r\n        const params = new URLSearchParams(location.search);\r\n        const token = params.get(\"token\");\r\n\r\n        if (!token) {\r\n          throw new Error(\"Không nhận được token xác thực\");\r\n        }\r\n\r\n        // Thiết lập token vào header cho tất cả các request\r\n        axios.defaults.headers.common[\"Authorization\"] = `Bearer ${token}`;\r\n\r\n        // Lấy thông tin người dùng - Sửa đường dẫn API\r\n        const response = await axios.get(`${API_URL}/auth/me`);\r\n        const userData = response.data;\r\n\r\n        // Lưu token và thông tin user vào Redux store\r\n        dispatch(\r\n          setCredentials({\r\n            token,\r\n            user: userData,\r\n          })\r\n        );\r\n\r\n        // Kiểm tra trạng thái người dùng và chuyển hướng tương ứng\r\n        if (!userData.full_name || !userData.role) {\r\n          // Cần hoàn thành đăng ký\r\n          navigate(\"/complete-registration\");\r\n        } else if (\r\n          userData.status === \"pending\" ||\r\n          userData.status === \"rejected\"\r\n        ) {\r\n          // Tài khoản đang chờ phê duyệt hoặc bị từ chối\r\n          navigate(\"/pending-approval\");\r\n        } else if (userData.status === \"approved\") {\r\n          // Tài khoản đã được phê duyệt\r\n          navigate(\"/dashboard\");\r\n        } else {\r\n          // Mặc định chuyển hướng đến dashboard\r\n          navigate(\"/dashboard\");\r\n        }\r\n      } catch (err) {\r\n        console.error(\"Lỗi khi xử lý đăng nhập Google:\", err);\r\n        setError(err.message || \"Đã xảy ra lỗi khi xử lý đăng nhập Google\");\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchUserData();\r\n  }, [dispatch, location.search, navigate]);\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"flex flex-col items-center justify-center min-h-screen\">\r\n        <h1 className=\"text-2xl font-bold text-red-600 mb-4\">Lỗi đăng nhập</h1>\r\n        <p className=\"text-gray-700\">{error}</p>\r\n        <button\r\n          onClick={() => navigate(\"/login\")}\r\n          className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\"\r\n        >\r\n          Quay lại trang đăng nhập\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return <LoadingScreen message=\"Đang xử lý đăng nhập Google...\" />;\r\n};\r\n\r\nexport default GoogleRedirectPage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
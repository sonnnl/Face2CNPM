{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\teacher\\\\AttendancePage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, lazy, Suspense, useCallback } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport { Box, Typography, Card, CardContent, Grid, Paper, Button, Divider, CircularProgress, List, ListItem, ListItemAvatar, ListItemText, Avatar, Chip, Dialog, DialogTitle, DialogContent, DialogActions, TextField, FormControl, InputLabel, Select, MenuItem, IconButton, Alert, AlertTitle, Tooltip, Stepper, Step, StepLabel, StepContent } from \"@mui/material\";\nimport { CameraAlt, Check, Close, Edit, Refresh, Save, VerifiedUser, HourglassEmpty, ArrowBack, Info, VideocamOff, PlayCircleOutline, StopCircleOutlined, Visibility, VisibilityOff } from \"@mui/icons-material\";\nimport { setModelLoaded as setFaceRecModelLoaded,\n// Rename to avoid conflict\nsetCameraReady as setFaceRecCameraReady,\n// Rename to avoid conflict\nsetDetectedFaces, setRecognizedStudents, clearRecognitionState, getClassFaceFeatures,\n// Correct thunk action name\nverifyAttendance, manualAttendance } from \"../../redux/slices/faceRecognitionSlice\"; // Fixed relative import path\n\n// Lazy load Webcam\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Webcam = /*#__PURE__*/lazy(_c = () => import(\"react-webcam\"));\n_c2 = Webcam;\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (faceapi.nets.tinyFaceDetector.isLoaded && faceapi.nets.faceLandmark68Net.isLoaded && faceapi.nets.faceRecognitionNet.isLoaded\n    // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null\n    });\n    await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\n      variant: \"success\"\n    });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = student => {\n  var _student$faceFeatures, _student$faceFeatures2;\n  if (!student || !((_student$faceFeatures = student.faceFeatures) !== null && _student$faceFeatures !== void 0 && _student$faceFeatures.descriptors) && !student.faceDescriptors) {\n    return [];\n  }\n  const descriptors = [];\n  const rawDescriptors = ((_student$faceFeatures2 = student.faceFeatures) === null || _student$faceFeatures2 === void 0 ? void 0 : _student$faceFeatures2.descriptors) || student.faceDescriptors || [];\n  const findDescriptors = data => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every(n => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n  findDescriptors(rawDescriptors);\n  return descriptors.filter(d => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  _s();\n  var _classInfo$students, _classInfo$students2;\n  const {\n    classId,\n    sessionId\n  } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\"\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const {\n    token\n  } = useSelector(state => state.auth);\n\n  // Access faceRecognition state directly\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents,\n    // Assuming slice holds the relevant class students\n    isProcessing,\n    error: faceRecError // Get error state\n  } = useSelector(state => state.faceRecognition);\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([axios.get(`${API_URL}/classes/teaching/${classId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        })]);\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          // Capture the return value indicating success/failure\n          const modelsLoadedSuccessfully = await loadFaceRecognitionModels(dispatch, enqueueSnackbar);\n          // Check if model loading failed using the return value\n          if (!modelsLoadedSuccessfully) {\n            // Use the return value here\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n          // No need to check isModelLoaded from state again here\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if ((loadedSessionInfo === null || loadedSessionInfo === void 0 ? void 0 : loadedSessionInfo.status) !== \"completed\" && isModelLoaded) {\n          await dispatch(getClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        var _error$response, _error$response$data;\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, {\n          variant: \"error\"\n        });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      var _webcamRef$current, _webcamRef$current$vi, _webcamRef$current$vi2;\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      (_webcamRef$current = webcamRef.current) === null || _webcamRef$current === void 0 ? void 0 : (_webcamRef$current$vi = _webcamRef$current.video) === null || _webcamRef$current$vi === void 0 ? void 0 : (_webcamRef$current$vi2 = _webcamRef$current$vi.srcObject) === null || _webcamRef$current$vi2 === void 0 ? void 0 : _webcamRef$current$vi2.getTracks().forEach(track => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(stream => {\n    console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n    dispatch(setFaceRecCameraReady(true));\n    setComponentError(null); // Clear camera errors\n  }, [dispatch]);\n  const handleUserMediaError = useCallback(error => {\n    console.error(\"Lỗi khi truy cập camera:\", error);\n    const errMsg = `Không thể truy cập camera: ${error.name === \"NotAllowedError\" ? \"Bạn chưa cấp quyền truy cập camera\" : error.name === \"NotFoundError\" ? \"Không tìm thấy thiết bị camera\" : error.message || \"Lỗi không xác định\"}`;\n    enqueueSnackbar(errMsg, {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecCameraReady(false));\n    setComponentError(errMsg);\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback((detections, recognizedData = []) => {\n    var _webcamRef$current2;\n    if (!canvasRef.current || !((_webcamRef$current2 = webcamRef.current) !== null && _webcamRef$current2 !== void 0 && _webcamRef$current2.video)) return;\n    const video = webcamRef.current.video;\n    const canvas = canvasRef.current;\n    const displaySize = {\n      width: video.videoWidth,\n      height: video.videoHeight\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n    const resizedDetections = faceapi.resizeResults(detections, displaySize);\n    const ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    resizedDetections.forEach((detection, i) => {\n      // Validate detection and box before drawing\n      if (!detection || !detection.detection || !detection.detection.box) {\n        console.warn(\"Skipping drawing for invalid detection object:\", detection);\n        return; // Skip this detection\n      }\n      const box = detection.detection.box;\n\n      // Further validate box properties\n      if (box.x == null || box.y == null || box.width == null || box.height == null || box.width <= 0 || box.height <= 0) {\n        console.warn(\"Skipping drawing for invalid box properties:\", box);\n        return; // Skip this detection\n      }\n      const landmarks = detection.landmarks;\n      const recognized = recognizedData.find(rec => rec.detectionIndex === i); // Match recognition result\n\n      // Draw box\n      const boxColor = recognized ? recognized.confidence > CONFIDENCE_THRESHOLD ? \"#4CAF50\" : \"#FFC107\" : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n      ctx.strokeStyle = boxColor;\n      ctx.lineWidth = 2;\n      ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n      // Draw label background\n      const label = recognized ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)` : \"Đang nhận diện...\";\n      const textWidth = ctx.measureText(label).width;\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n      ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n      // Draw label text\n      ctx.fillStyle = \"#FFFFFF\";\n      ctx.font = \"14px Arial\";\n      ctx.fillText(label, box.x + 5, box.y - 5);\n\n      // Draw landmarks if enabled\n      if (showLandmarks && landmarks) {\n        faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n      }\n    });\n  }, [showLandmarks]); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(async (recognize = true) => {\n    var _webcamRef$current3;\n    if (!isCameraReady || !((_webcamRef$current3 = webcamRef.current) !== null && _webcamRef$current3 !== void 0 && _webcamRef$current3.video) || webcamRef.current.video.readyState !== 4 || !isModelLoaded) {\n      return null; // Return null if detection can't proceed\n    }\n    const video = webcamRef.current.video;\n    try {\n      let faceData;\n      if (recognize) {\n        // Detect faces, landmarks, and descriptors for recognition\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks().withFaceDescriptors();\n      } else {\n        // Only detect faces and landmarks (for drawing)\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks();\n      }\n      dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n      if (!faceData || faceData.length === 0) {\n        // Clear canvas if no faces detected\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        }\n        dispatch(setRecognizedStudents([])); // Clear recognized students\n        return null;\n      }\n\n      // --- Recognition Logic (if recognize === true) ---\n      let recognizedData = [];\n      if (recognize && classStudents && classStudents.length > 0) {\n        const labeledDescriptors = classStudents.map(student => {\n          const descriptors = extractStudentDescriptors(student);\n          if (descriptors.length > 0) {\n            return new faceapi.LabeledFaceDescriptors(student._id, descriptors); // Use student ID as label\n          }\n          return null;\n        }).filter(ld => ld !== null); // Filter out students with no descriptors\n\n        if (labeledDescriptors.length > 0) {\n          const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, RECOGNITION_THRESHOLD);\n          recognizedData = faceData.map((fd, index) => {\n            const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n            const student = classStudents.find(s => s._id === bestMatch.label); // Find student by ID label\n            return {\n              detectionIndex: index,\n              // Link recognition to detection\n              studentId: student === null || student === void 0 ? void 0 : student._id,\n              name: (student === null || student === void 0 ? void 0 : student.full_name) || \"Không rõ\",\n              confidence: 1 - bestMatch.distance,\n              // Convert distance to confidence-like score\n              isUnknown: bestMatch.label === \"unknown\"\n            };\n          }).filter(r => !r.isUnknown); // Filter out unknown matches\n\n          dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n        } else {\n          dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n        }\n      }\n\n      // Draw landmarks and boxes with recognition info\n      drawLandmarks(faceData, recognizedData);\n      return {\n        detections: faceData,\n        recognized: recognizedData\n      }; // Return both detection and recognition results\n    } catch (error) {\n      console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n      enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n        variant: \"error\"\n      });\n      // Clear canvas on error\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n      dispatch(setDetectedFaces([]));\n      dispatch(setRecognizedStudents([]));\n      return null;\n    }\n  }, [isCameraReady, isModelLoaded, classStudents, drawLandmarks, dispatch, enqueueSnackbar]);\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort((a, b) => b.confidence - a.confidence)[0];\n      enqueueSnackbar(`Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(1)}%)`, {\n        variant: \"info\"\n      });\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence >= CONFIDENCE_THRESHOLD) {\n        var _result$detections$to;\n        // Find the corresponding descriptor\n        const descriptor = (_result$detections$to = result.detections[topMatch.detectionIndex]) === null || _result$detections$to === void 0 ? void 0 : _result$detections$to.descriptor;\n        if (descriptor) {\n          handleMarkAttendance(topMatch.studentId, topMatch.confidence, descriptor);\n        } else {\n          console.warn(\"Không tìm thấy descriptor cho top match\", topMatch);\n          enqueueSnackbar(\"Lỗi: Không thể lấy đặc trưng khuôn mặt để điểm danh.\", {\n            variant: \"warning\"\n          });\n        }\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\", {\n        variant: \"warning\"\n      });\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", {\n        variant: \"warning\"\n      });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = student => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({\n      status: \"present\",\n      note: \"\"\n    }); // Reset form\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change\n  const handleManualAttendanceChange = e => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n    try {\n      const result = await dispatch(manualAttendance({\n        sessionId,\n        studentId: selectedStudent._id,\n        status: manualAttendanceData.status,\n        note: manualAttendanceData.note\n      })).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id;\n          return ((_log$student_id = log.student_id) === null || _log$student_id === void 0 ? void 0 : _log$student_id._id) === selectedStudent._id;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: selectedStudent\n        }; // Use the selected student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh thủ công cho ${selectedStudent.full_name}`, {\n        variant: \"success\"\n      });\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(async (studentId, confidence, faceDescriptor) => {\n    if (!studentId || isProcessing) return;\n\n    // Check if student already marked present\n    const isAlreadyPresent = attendanceLogs.some(log => {\n      var _log$student_id2;\n      return ((_log$student_id2 = log.student_id) === null || _log$student_id2 === void 0 ? void 0 : _log$student_id2._id) === studentId && log.status === \"present\";\n    });\n    if (isAlreadyPresent) {\n      // console.log(`Student ${studentId} already marked present.`);\n      return; // Don't mark again if already present\n    }\n    const student = classStudents.find(s => s._id === studentId);\n    if (!student) {\n      console.warn(\"Student not found for marking attendance:\", studentId);\n      return;\n    }\n\n    // Capture image for proof (optional, but good practice)\n    let imageBase64 = null;\n    try {\n      if (webcamRef.current) {\n        imageBase64 = webcamRef.current.getScreenshot({\n          width: 320,\n          height: 240\n        }); // Smaller screenshot\n      }\n    } catch (screenshotError) {\n      console.error(\"Error taking screenshot:\", screenshotError);\n      // Proceed without image if screenshot fails\n    }\n    try {\n      const result = await dispatch(verifyAttendance({\n        sessionId,\n        studentId,\n        faceDescriptor,\n        // Pass the received descriptor\n        confidence,\n        imageBase64,\n        recognized: true // Mark as recognized by the system\n      })).unwrap();\n\n      // Update local attendance logs\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id3;\n          return ((_log$student_id3 = log.student_id) === null || _log$student_id3 === void 0 ? void 0 : _log$student_id3._id) === studentId;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: student\n        }; // Use the found student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n        variant: \"success\"\n      });\n    } catch (error) {\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  }, [dispatch, sessionId, classStudents, attendanceLogs, isProcessing, enqueueSnackbar]); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (!isCameraReady || !isModelLoaded || !classStudents || classStudents.length === 0) {\n      enqueueSnackbar(\"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\", {\n        variant: \"warning\"\n      });\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach(rec => {\n          // Check if confidence meets or exceeds the threshold\n          if (rec.confidence >= CONFIDENCE_THRESHOLD && rec.studentId) {\n            var _result$detections$re;\n            // Find the corresponding descriptor\n            const descriptor = (_result$detections$re = result.detections[rec.detectionIndex]) === null || _result$detections$re === void 0 ? void 0 : _result$detections$re.descriptor;\n            if (descriptor) {\n              handleMarkAttendance(rec.studentId, rec.confidence, descriptor); // Attempt to mark attendance\n            } else {\n              console.warn(\"Không tìm thấy descriptor cho recognized student trong auto mode\", rec);\n            }\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [isCameraReady, isModelLoaded, classStudents, detectAndRecognizeFaces, handleMarkAttendance, enqueueSnackbar]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      // Lấy danh sách sinh viên vắng mặt từ UI trước khi kết thúc phiên\n      const absentStudentIds = absentStudents.map(student => student._id);\n      enqueueSnackbar(\"Đang kết thúc phiên...\", {\n        variant: \"info\"\n      });\n\n      // Gửi cả trạng thái và danh sách sinh viên vắng mặt\n      await axios.put(`${API_URL}/attendance/sessions/${sessionId}`, {\n        status: \"completed\",\n        students_absent: absentStudentIds // Thêm danh sách sinh viên vắng mặt\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", {\n        variant: \"success\"\n      });\n      setSessionInfo(prev => ({\n        ...prev,\n        status: \"completed\"\n      })); // Update local state\n      stopAutoAttendance(); // Stop auto mode if running\n      // Optionally navigate back after a delay\n      // setTimeout(() => navigate(`/teacher/classes/${classId}`), 1000);\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || \"Lỗi khi kết thúc phiên\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", {\n        variant: \"info\"\n      });\n      const [logsRes, sessionRes] = await Promise.all([axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      })]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", {\n        variant: \"success\"\n      });\n    } catch (error) {\n      var _error$response3, _error$response3$data;\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || \"Lỗi khi làm mới dữ liệu\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const toggleLandmarks = () => {\n    setShowLandmarks(prev => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(log => log.status === \"present\");\n  const absentStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students = classInfo.students) === null || _classInfo$students === void 0 ? void 0 : _classInfo$students.filter(student => !attendanceLogs.some(log => {\n    var _log$student_id4;\n    return ((_log$student_id4 = log.student_id) === null || _log$student_id4 === void 0 ? void 0 : _log$student_id4._id) === student._id && (log.status === \"present\" || log.status === \"late\");\n  }) // Consider late as not absent\n  )) || [];\n  const totalStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students2 = classInfo.students) === null || _classInfo$students2 === void 0 ? void 0 : _classInfo$students2.length) || 0;\n  const sessionCompleted = (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      minHeight: \"80vh\",\n      children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 882,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        sx: {\n          ml: 2\n        },\n        children: \"\\u0110ang t\\u1EA3i d\\u1EEF li\\u1EC7u \\u0111i\\u1EC3m danh...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 883,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 876,\n      columnNumber: 7\n    }, this);\n  }\n  if (componentError && !isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 3\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        action: /*#__PURE__*/_jsxDEV(Button, {\n          color: \"inherit\",\n          size: \"small\",\n          onClick: () => window.location.reload(),\n          children: \"T\\u1EA3i l\\u1EA1i trang\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 894,\n          columnNumber: 13\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(AlertTitle, {\n          children: \"\\u0110\\xE3 x\\u1EA3y ra l\\u1ED7i\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 903,\n          columnNumber: 11\n        }, this), componentError]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 891,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 890,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      p: {\n        xs: 1,\n        sm: 2,\n        md: 3\n      }\n    },\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      mb: 2.5,\n      pb: 2,\n      borderBottom: \"1px solid #eaeaea\",\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          fontWeight: 500,\n          children: [\"\\u0110i\\u1EC3m Danh - \", classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 922,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          color: \"textSecondary\",\n          children: [\"Bu\\u1ED5i \", sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.session_number, \" -\", \" \", sessionInfo !== null && sessionInfo !== void 0 && sessionInfo.date ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\") : \"N/A\", /*#__PURE__*/_jsxDEV(Chip, {\n            label: (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) || \"N/A\",\n            color: sessionCompleted ? \"default\" : \"success\",\n            size: \"small\",\n            sx: {\n              ml: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 930,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 925,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 921,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        startIcon: /*#__PURE__*/_jsxDEV(ArrowBack, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 940,\n          columnNumber: 22\n        }, this),\n        onClick: () => navigate(`/teacher/classes/${classId}`),\n        children: \"Quay l\\u1EA1i l\\u1EDBp\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 938,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 913,\n      columnNumber: 7\n    }, this), sessionCompleted && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      sx: {\n        mb: 2\n      },\n      children: \"Phi\\xEAn \\u0111i\\u1EC3m danh n\\xE0y \\u0111\\xE3 k\\u1EBFt th\\xFAc. B\\u1EA1n ch\\u1EC9 c\\xF3 th\\u1EC3 xem l\\u1EA1i k\\u1EBFt qu\\u1EA3.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 948,\n      columnNumber: 9\n    }, this), faceRecError && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"warning\",\n      sx: {\n        mb: 2\n      },\n      children: [\"L\\u1ED7i t\\u1EEB h\\u1EC7 th\\u1ED1ng nh\\u1EADn di\\u1EC7n: \", faceRecError]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 954,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 3,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 8,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3,\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(CardContent, {\n            sx: {\n              bgcolor: \"#f8f9fa\",\n              borderBottom: \"1px solid #eaeaea\",\n              p: 2\n            },\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 500,\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(CameraAlt, {\n                  sx: {\n                    mr: 1,\n                    color: \"primary.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 981,\n                  columnNumber: 19\n                }, this), \" Camera\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 975,\n                columnNumber: 17\n              }, this), !sessionCompleted && isModelLoaded &&\n              /*#__PURE__*/\n              // Show controls only if session active and model loaded\n              _jsxDEV(Box, {\n                children: [/*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: isAutoMode ? \"Dừng chế độ tự động\" : \"Bắt đầu chế độ tự động\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: isAutoMode ? stopAutoAttendance : startAutoAttendance,\n                    color: isAutoMode ? \"error\" : \"primary\",\n                    disabled: !isCameraReady,\n                    children: isAutoMode ? /*#__PURE__*/_jsxDEV(StopCircleOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1003,\n                      columnNumber: 29\n                    }, this) : /*#__PURE__*/_jsxDEV(PlayCircleOutline, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1005,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 993,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 986,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: toggleLandmarks,\n                    color: \"secondary\",\n                    disabled: !isCameraReady || isAutoMode,\n                    children: showLandmarks ? /*#__PURE__*/_jsxDEV(VisibilityOff, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1017,\n                      columnNumber: 44\n                    }, this) : /*#__PURE__*/_jsxDEV(Visibility, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1017,\n                      columnNumber: 64\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1012,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1009,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 985,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 970,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 963,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              position: \"relative\",\n              width: \"100%\",\n              aspectRatio: \"640 / 480\",\n              backgroundColor: \"#000\",\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\"\n            },\n            children: [!isModelLoaded && !sessionCompleted ? /*#__PURE__*/_jsxDEV(Box, {\n              textAlign: \"center\",\n              color: \"white\",\n              children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1039,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                children: \"\\u0110ang t\\u1EA3i m\\xF4 h\\xECnh nh\\u1EADn di\\u1EC7n...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1040,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1038,\n              columnNumber: 17\n            }, this) : !sessionCompleted ? /*#__PURE__*/_jsxDEV(Suspense, {\n              fallback: /*#__PURE__*/_jsxDEV(Box, {\n                textAlign: \"center\",\n                color: \"white\",\n                children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                  color: \"inherit\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1046,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  children: \"\\u0110ang kh\\u1EDFi t\\u1EA1o camera...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1047,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1045,\n                columnNumber: 21\n              }, this),\n              children: /*#__PURE__*/_jsxDEV(Webcam, {\n                audio: false,\n                ref: webcamRef,\n                screenshotFormat: \"image/jpeg\",\n                width: \"100%\",\n                height: \"100%\",\n                videoConstraints: {\n                  width: 640,\n                  height: 480,\n                  facingMode: \"user\"\n                },\n                style: {\n                  display: \"block\",\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\"\n                },\n                onUserMedia: handleUserMedia,\n                onUserMediaError: handleUserMediaError\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1051,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1043,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n              color: \"white\",\n              children: \"Phi\\xEAn \\u0111\\xE3 k\\u1EBFt th\\xFAc\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1076,\n              columnNumber: 17\n            }, this) // Placeholder if session completed\n            , /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              style: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                zIndex: 10\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1080,\n              columnNumber: 15\n            }, this), (!isCameraReady || (componentError === null || componentError === void 0 ? void 0 : componentError.includes(\"camera\"))) && !sessionCompleted && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                backgroundColor: \"rgba(0,0,0,0.7)\",\n                display: \"flex\",\n                flexDirection: \"column\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                color: \"white\",\n                zIndex: 20\n              },\n              children: [/*#__PURE__*/_jsxDEV(VideocamOff, {\n                sx: {\n                  fontSize: 60,\n                  mb: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1111,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Camera kh\\xF4ng kh\\u1EA3 d\\u1EE5ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1112,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mt: 1,\n                  px: 2,\n                  textAlign: \"center\"\n                },\n                children: componentError || \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1113,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                color: \"inherit\",\n                sx: {\n                  mt: 2\n                },\n                onClick: () => window.location.reload(),\n                children: \"Th\\u1EED l\\u1EA1i\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1120,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1095,\n              columnNumber: 19\n            }, this), isAutoMode && isCameraReady && /*#__PURE__*/_jsxDEV(Chip, {\n              label: \"\\u0110ang t\\u1EF1 \\u0111\\u1ED9ng \\u0111i\\u1EC3m danh\",\n              color: \"success\",\n              size: \"small\",\n              sx: {\n                position: \"absolute\",\n                bottom: 10,\n                right: 10,\n                zIndex: 15\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1132,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1026,\n            columnNumber: 13\n          }, this), !sessionCompleted && isCameraReady && isModelLoaded && /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            p: 2,\n            bgcolor: \"#f8f9fa\",\n            borderTop: \"1px solid #eaeaea\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              onClick: handleManualCapture,\n              startIcon: isProcessing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1160,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1162,\n                columnNumber: 23\n              }, this),\n              disabled: isProcessing || isAutoMode,\n              children: \"Ch\\u1EE5p & Nh\\u1EADn di\\u1EC7n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1155,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"secondary\",\n              onClick: completeSession,\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1173,\n                columnNumber: 30\n              }, this),\n              disabled: isProcessing,\n              children: \"K\\u1EBFt th\\xFAc phi\\xEAn\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1169,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1148,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 962,\n          columnNumber: 11\n        }, this), recognizedStudents.length > 0 && !isAutoMode && /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mt: 2,\n            borderRadius: \"10px\",\n            boxShadow: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              fontWeight: \"500\",\n              mb: 1,\n              children: \"\\u0110\\xE3 nh\\u1EADn di\\u1EC7n g\\u1EA7n \\u0111\\xE2y\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1186,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacing: 1,\n              children: recognizedStudents.slice(0, 4).map((rec, index // Show max 4\n              ) => /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 6,\n                sm: 3,\n                children: /*#__PURE__*/_jsxDEV(Paper, {\n                  elevation: 0,\n                  sx: {\n                    p: 1,\n                    textAlign: \"center\",\n                    border: \"1px solid #eee\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"caption\",\n                    display: \"block\",\n                    noWrap: true,\n                    children: rec.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1209,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Chip, {\n                    label: `${(rec.confidence * 100).toFixed(0)}%`,\n                    size: \"small\",\n                    color: rec.confidence > CONFIDENCE_THRESHOLD ? \"success\" : \"warning\",\n                    sx: {\n                      mt: 0.5\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1212,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1201,\n                  columnNumber: 25\n                }, this)\n              }, `${rec.studentId}-${index}`, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1195,\n                columnNumber: 23\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1189,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1185,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1184,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 961,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 4,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mb: 3,\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(Check, {\n                  sx: {\n                    mr: 1,\n                    color: \"success.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1244,\n                  columnNumber: 19\n                }, this), \" C\\xF3 m\\u1EB7t (\", presentStudents.length, \"/\", totalStudents, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1243,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                title: \"L\\xE0m m\\u1EDBi danh s\\xE1ch\",\n                children: /*#__PURE__*/_jsxDEV(IconButton, {\n                  size: \"small\",\n                  onClick: refreshAttendanceLogs,\n                  disabled: isProcessing,\n                  children: /*#__PURE__*/_jsxDEV(Refresh, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1253,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1248,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1247,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1237,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1257,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: presentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                align: \"center\",\n                sx: {\n                  py: 2\n                },\n                children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 c\\xF3 m\\u1EB7t.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1260,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(List, {\n                dense: true,\n                children: presentStudents.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)) // Sort by time desc\n                .map(log => {\n                  var _log$student_id5;\n                  return (\n                    /*#__PURE__*/\n                    // Simplified ListItem for debugging\n                    _jsxDEV(ListItem, {\n                      children: /*#__PURE__*/_jsxDEV(ListItemText, {\n                        primary: ((_log$student_id5 = log.student_id) === null || _log$student_id5 === void 0 ? void 0 : _log$student_id5.full_name) || `Log ID: ${log._id} (Tên bị thiếu)`,\n                        secondary: `Trạng thái: ${log.status} - ${new Date(log.timestamp).toLocaleTimeString(\"vi-VN\")}`\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1277,\n                        columnNumber: 27\n                      }, this)\n                    }, log._id, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1276,\n                      columnNumber: 25\n                    }, this)\n                  );\n                })\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1269,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1258,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1236,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1235,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h6\",\n              display: \"flex\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Close, {\n                sx: {\n                  mr: 1,\n                  color: \"error.main\"\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1303,\n                columnNumber: 17\n              }, this), \" V\\u1EAFng m\\u1EB7t (\", absentStudents.length, \"/\", totalStudents, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1297,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1306,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: absentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                align: \"center\",\n                sx: {\n                  py: 2\n                },\n                children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 c\\xF3 m\\u1EB7t.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1309,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(List, {\n                dense: true,\n                children: absentStudents.map(student =>\n                /*#__PURE__*/\n                // Keep absent list detailed for now\n                _jsxDEV(ListItem, {\n                  disablePadding: true,\n                  sx: {\n                    mb: 0.5\n                  },\n                  secondaryAction: !sessionCompleted ? /*#__PURE__*/_jsxDEV(Tooltip, {\n                    title: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\",\n                    children: /*#__PURE__*/_jsxDEV(IconButton, {\n                      edge: \"end\",\n                      size: \"small\",\n                      onClick: () => openManualAttendanceDialog(student),\n                      disabled: isProcessing,\n                      children: /*#__PURE__*/_jsxDEV(Edit, {\n                        fontSize: \"small\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1336,\n                        columnNumber: 33\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1328,\n                      columnNumber: 31\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1327,\n                    columnNumber: 29\n                  }, this) : null,\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    variant: \"outlined\",\n                    sx: {\n                      width: \"100%\",\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      p: 0.5,\n                      borderRadius: \"4px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                      sx: {\n                        minWidth: 45\n                      },\n                      children: /*#__PURE__*/_jsxDEV(Avatar, {\n                        alt: student.full_name,\n                        src: student.avatar_url,\n                        sx: {\n                          width: 32,\n                          height: 32\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1353,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1352,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                      primary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"body2\",\n                        noWrap: true,\n                        children: student.full_name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1361,\n                        columnNumber: 31\n                      }, this),\n                      secondary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"caption\",\n                        color: \"text.secondary\",\n                        children: student.student_code\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1366,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1359,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1342,\n                    columnNumber: 25\n                  }, this)\n                }, student._id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1321,\n                  columnNumber: 23\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1318,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1307,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1296,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1295,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1233,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 959,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: manualDialogOpen,\n      onClose: handleManualDialogClose,\n      maxWidth: \"xs\",\n      fullWidth: true,\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1392,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [selectedStudent && /*#__PURE__*/_jsxDEV(Box, {\n          display: \"flex\",\n          alignItems: \"center\",\n          mb: 2,\n          children: [/*#__PURE__*/_jsxDEV(Avatar, {\n            src: selectedStudent.avatar_url,\n            alt: selectedStudent.full_name,\n            sx: {\n              width: 48,\n              height: 48,\n              mr: 2\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1396,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              children: selectedStudent.full_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1402,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"body2\",\n              color: \"text.secondary\",\n              children: [\"MSSV: \", selectedStudent.student_code]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1405,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1401,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1395,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n          fullWidth: true,\n          margin: \"normal\",\n          children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n            children: \"Tr\\u1EA1ng th\\xE1i\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1412,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Select, {\n            name: \"status\",\n            value: manualAttendanceData.status,\n            onChange: handleManualAttendanceChange,\n            label: \"Tr\\u1EA1ng th\\xE1i\",\n            children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"present\",\n              children: \"C\\xF3 m\\u1EB7t\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1419,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"absent\",\n              children: \"V\\u1EAFng m\\u1EB7t\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1420,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"late\",\n              children: \"\\u0110i tr\\u1EC5\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1421,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n              value: \"early_leave\",\n              children: \"V\\u1EC1 s\\u1EDBm\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1422,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1413,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1411,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TextField, {\n          fullWidth: true,\n          margin: \"normal\",\n          name: \"note\",\n          label: \"Ghi ch\\xFA (t\\xF9y ch\\u1ECDn)\",\n          value: manualAttendanceData.note,\n          onChange: handleManualAttendanceChange,\n          multiline: true,\n          rows: 2\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1425,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1393,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualDialogClose,\n          children: \"H\\u1EE7y\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1437,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualAttendanceSubmit,\n          variant: \"contained\",\n          color: \"primary\",\n          disabled: isProcessing,\n          children: \"X\\xE1c nh\\u1EADn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1438,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1436,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1386,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 911,\n    columnNumber: 5\n  }, this);\n};\n_s(AttendancePage, \"ORIzqp/hsJvgl/xMWwFDwVJkKrg=\", false, function () {\n  return [useParams, useNavigate, useDispatch, useSnackbar, useSelector, useSelector];\n});\n_c3 = AttendancePage;\nexport default AttendancePage;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"Webcam$lazy\");\n$RefreshReg$(_c2, \"Webcam\");\n$RefreshReg$(_c3, \"AttendancePage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","lazy","Suspense","useCallback","useParams","useNavigate","useDispatch","useSelector","useSnackbar","axios","faceapi","Box","Typography","Card","CardContent","Grid","Paper","Button","Divider","CircularProgress","List","ListItem","ListItemAvatar","ListItemText","Avatar","Chip","Dialog","DialogTitle","DialogContent","DialogActions","TextField","FormControl","InputLabel","Select","MenuItem","IconButton","Alert","AlertTitle","Tooltip","Stepper","Step","StepLabel","StepContent","CameraAlt","Check","Close","Edit","Refresh","Save","VerifiedUser","HourglassEmpty","ArrowBack","Info","VideocamOff","PlayCircleOutline","StopCircleOutlined","Visibility","VisibilityOff","setModelLoaded","setFaceRecModelLoaded","setCameraReady","setFaceRecCameraReady","setDetectedFaces","setRecognizedStudents","clearRecognitionState","getClassFaceFeatures","verifyAttendance","manualAttendance","jsxDEV","_jsxDEV","Webcam","_c","_c2","API_URL","process","env","REACT_APP_API_URL","RECOGNITION_THRESHOLD","DETECTION_THRESHOLD","CONFIDENCE_THRESHOLD","AUTO_DETECT_INTERVAL","FACE_DETECTION_OPTIONS","TinyFaceDetectorOptions","scoreThreshold","inputSize","MODEL_URL","loadFaceRecognitionModels","dispatch","enqueueSnackbar","nets","tinyFaceDetector","isLoaded","faceLandmark68Net","faceRecognitionNet","variant","autoHideDuration","Promise","all","loadFromUri","error","console","extractStudentDescriptors","student","_student$faceFeatures","_student$faceFeatures2","faceFeatures","descriptors","faceDescriptors","rawDescriptors","findDescriptors","data","Array","isArray","length","every","n","push","Float32Array","forEach","Object","values","filter","d","AttendancePage","_s","_classInfo$students","_classInfo$students2","classId","sessionId","navigate","webcamRef","canvasRef","autoModeIntervalRef","landmarkIntervalRef","isLoading","setIsLoading","classInfo","setClassInfo","sessionInfo","setSessionInfo","attendanceLogs","setAttendanceLogs","isAutoMode","setIsAutoMode","showLandmarks","setShowLandmarks","manualDialogOpen","setManualDialogOpen","selectedStudent","setSelectedStudent","manualAttendanceData","setManualAttendanceData","status","note","componentError","setComponentError","token","state","auth","isModelLoaded","isCameraReady","detectedFaces","recognizedStudents","classStudents","isProcessing","faceRecError","faceRecognition","loadData","classRes","sessionRes","logsRes","get","headers","Authorization","loadedSessionInfo","modelsLoadedSuccessfully","Error","unwrap","_error$response","_error$response$data","errMsg","response","message","_webcamRef$current","_webcamRef$current$vi","_webcamRef$current$vi2","clearInterval","current","video","srcObject","getTracks","track","stop","startLandmarkDetection","stopLandmarkDetection","ctx","getContext","clearRect","width","height","handleUserMedia","stream","log","id","handleUserMediaError","name","drawLandmarks","detections","recognizedData","_webcamRef$current2","canvas","displaySize","videoWidth","videoHeight","matchDimensions","resizedDetections","resizeResults","detection","i","box","warn","x","y","landmarks","recognized","find","rec","detectionIndex","boxColor","confidence","strokeStyle","lineWidth","strokeRect","label","toFixed","textWidth","measureText","fillStyle","fillRect","font","fillText","draw","drawFaceLandmarks","detectAndRecognizeFaces","recognize","_webcamRef$current3","readyState","faceData","detectAllFaces","withFaceLandmarks","withFaceDescriptors","labeledDescriptors","map","LabeledFaceDescriptors","_id","ld","faceMatcher","FaceMatcher","fd","index","bestMatch","findBestMatch","descriptor","s","studentId","full_name","distance","isUnknown","r","handleManualCapture","result","topMatch","sort","a","b","_result$detections$to","handleMarkAttendance","openManualAttendanceDialog","handleManualDialogClose","handleManualAttendanceChange","e","target","value","handleManualAttendanceSubmit","prevLogs","existingLogIndex","findIndex","_log$student_id","student_id","newLog","updatedLogs","faceDescriptor","isAlreadyPresent","some","_log$student_id2","imageBase64","getScreenshot","screenshotError","_log$student_id3","startAutoAttendance","stopAutoAttendance","setInterval","_result$detections$re","completeSession","absentStudentIds","absentStudents","put","students_absent","prev","_error$response2","_error$response2$data","refreshAttendanceLogs","_error$response3","_error$response3$data","toggleLandmarks","presentStudents","students","_log$student_id4","totalStudents","sessionCompleted","display","justifyContent","alignItems","minHeight","children","fileName","_jsxFileName","lineNumber","columnNumber","sx","ml","p","severity","action","color","size","onClick","window","location","reload","xs","sm","md","mb","pb","borderBottom","fontWeight","class_name","session_number","date","Date","toLocaleDateString","startIcon","container","spacing","item","borderRadius","boxShadow","overflow","bgcolor","mr","title","disabled","position","aspectRatio","backgroundColor","textAlign","fallback","audio","ref","screenshotFormat","videoConstraints","facingMode","style","top","left","objectFit","onUserMedia","onUserMediaError","zIndex","includes","flexDirection","fontSize","mt","px","bottom","right","borderTop","slice","elevation","border","noWrap","maxHeight","pr","align","py","dense","timestamp","_log$student_id5","primary","secondary","toLocaleTimeString","disablePadding","secondaryAction","edge","minWidth","alt","src","avatar_url","student_code","open","onClose","maxWidth","fullWidth","margin","onChange","multiline","rows","_c3","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/teacher/AttendancePage.js"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useRef,\n  lazy,\n  Suspense,\n  useCallback,\n} from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport {\n  Box,\n  Typography,\n  Card,\n  CardContent,\n  Grid,\n  Paper,\n  Button,\n  Divider,\n  CircularProgress,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Avatar,\n  Chip,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  IconButton,\n  Alert,\n  AlertTitle,\n  Tooltip,\n  Stepper,\n  Step,\n  StepLabel,\n  StepContent,\n} from \"@mui/material\";\nimport {\n  CameraAlt,\n  Check,\n  Close,\n  Edit,\n  Refresh,\n  Save,\n  VerifiedUser,\n  HourglassEmpty,\n  ArrowBack,\n  Info,\n  VideocamOff,\n  PlayCircleOutline,\n  StopCircleOutlined,\n  Visibility,\n  VisibilityOff,\n} from \"@mui/icons-material\";\nimport {\n  setModelLoaded as setFaceRecModelLoaded, // Rename to avoid conflict\n  setCameraReady as setFaceRecCameraReady, // Rename to avoid conflict\n  setDetectedFaces,\n  setRecognizedStudents,\n  clearRecognitionState,\n  getClassFaceFeatures, // Correct thunk action name\n  verifyAttendance,\n  manualAttendance,\n} from \"../../redux/slices/faceRecognitionSlice\"; // Fixed relative import path\n\n// Lazy load Webcam\nconst Webcam = lazy(() => import(\"react-webcam\"));\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320,\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (\n      faceapi.nets.tinyFaceDetector.isLoaded &&\n      faceapi.nets.faceLandmark68Net.isLoaded &&\n      faceapi.nets.faceRecognitionNet.isLoaded\n      // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null,\n    });\n    await Promise.all([\n      faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\n      faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\n      faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\n    ]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", { variant: \"success\" });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", { variant: \"error\" });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = (student) => {\n  if (\n    !student ||\n    (!student.faceFeatures?.descriptors && !student.faceDescriptors)\n  ) {\n    return [];\n  }\n\n  const descriptors = [];\n  const rawDescriptors =\n    student.faceFeatures?.descriptors || student.faceDescriptors || [];\n\n  const findDescriptors = (data) => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every((n) => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n\n  findDescriptors(rawDescriptors);\n  return descriptors.filter((d) => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  const { classId, sessionId } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\",\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const { token } = useSelector((state) => state.auth);\n\n  // Access faceRecognition state directly\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents, // Assuming slice holds the relevant class students\n    isProcessing,\n    error: faceRecError, // Get error state\n  } = useSelector((state) => state.faceRecognition);\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([\n          axios.get(`${API_URL}/classes/teaching/${classId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n        ]);\n\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          // Capture the return value indicating success/failure\n          const modelsLoadedSuccessfully = await loadFaceRecognitionModels(\n            dispatch,\n            enqueueSnackbar\n          );\n          // Check if model loading failed using the return value\n          if (!modelsLoadedSuccessfully) {\n            // Use the return value here\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n          // No need to check isModelLoaded from state again here\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if (loadedSessionInfo?.status !== \"completed\" && isModelLoaded) {\n          await dispatch(getClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg =\n          error.response?.data?.message ||\n          error.message ||\n          \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, { variant: \"error\" });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      webcamRef.current?.video?.srcObject\n        ?.getTracks()\n        .forEach((track) => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(\n    (stream) => {\n      console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n      dispatch(setFaceRecCameraReady(true));\n      setComponentError(null); // Clear camera errors\n    },\n    [dispatch]\n  );\n\n  const handleUserMediaError = useCallback(\n    (error) => {\n      console.error(\"Lỗi khi truy cập camera:\", error);\n      const errMsg = `Không thể truy cập camera: ${\n        error.name === \"NotAllowedError\"\n          ? \"Bạn chưa cấp quyền truy cập camera\"\n          : error.name === \"NotFoundError\"\n          ? \"Không tìm thấy thiết bị camera\"\n          : error.message || \"Lỗi không xác định\"\n      }`;\n      enqueueSnackbar(errMsg, { variant: \"error\" });\n      dispatch(setFaceRecCameraReady(false));\n      setComponentError(errMsg);\n    },\n    [dispatch, enqueueSnackbar]\n  );\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback(\n    (detections, recognizedData = []) => {\n      if (!canvasRef.current || !webcamRef.current?.video) return;\n\n      const video = webcamRef.current.video;\n      const canvas = canvasRef.current;\n      const displaySize = {\n        width: video.videoWidth,\n        height: video.videoHeight,\n      };\n      faceapi.matchDimensions(canvas, displaySize);\n\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      resizedDetections.forEach((detection, i) => {\n        // Validate detection and box before drawing\n        if (!detection || !detection.detection || !detection.detection.box) {\n          console.warn(\n            \"Skipping drawing for invalid detection object:\",\n            detection\n          );\n          return; // Skip this detection\n        }\n\n        const box = detection.detection.box;\n\n        // Further validate box properties\n        if (\n          box.x == null ||\n          box.y == null ||\n          box.width == null ||\n          box.height == null ||\n          box.width <= 0 ||\n          box.height <= 0\n        ) {\n          console.warn(\"Skipping drawing for invalid box properties:\", box);\n          return; // Skip this detection\n        }\n\n        const landmarks = detection.landmarks;\n        const recognized = recognizedData.find(\n          (rec) => rec.detectionIndex === i\n        ); // Match recognition result\n\n        // Draw box\n        const boxColor = recognized\n          ? recognized.confidence > CONFIDENCE_THRESHOLD\n            ? \"#4CAF50\"\n            : \"#FFC107\"\n          : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n        ctx.strokeStyle = boxColor;\n        ctx.lineWidth = 2;\n        ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n        // Draw label background\n        const label = recognized\n          ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)`\n          : \"Đang nhận diện...\";\n        const textWidth = ctx.measureText(label).width;\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n        ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n        // Draw label text\n        ctx.fillStyle = \"#FFFFFF\";\n        ctx.font = \"14px Arial\";\n        ctx.fillText(label, box.x + 5, box.y - 5);\n\n        // Draw landmarks if enabled\n        if (showLandmarks && landmarks) {\n          faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n        }\n      });\n    },\n    [showLandmarks]\n  ); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(\n    async (recognize = true) => {\n      if (\n        !isCameraReady ||\n        !webcamRef.current?.video ||\n        webcamRef.current.video.readyState !== 4 ||\n        !isModelLoaded\n      ) {\n        return null; // Return null if detection can't proceed\n      }\n\n      const video = webcamRef.current.video;\n\n      try {\n        let faceData;\n        if (recognize) {\n          // Detect faces, landmarks, and descriptors for recognition\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks()\n            .withFaceDescriptors();\n        } else {\n          // Only detect faces and landmarks (for drawing)\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks();\n        }\n\n        dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n        if (!faceData || faceData.length === 0) {\n          // Clear canvas if no faces detected\n          if (canvasRef.current) {\n            const ctx = canvasRef.current.getContext(\"2d\");\n            ctx.clearRect(\n              0,\n              0,\n              canvasRef.current.width,\n              canvasRef.current.height\n            );\n          }\n          dispatch(setRecognizedStudents([])); // Clear recognized students\n          return null;\n        }\n\n        // --- Recognition Logic (if recognize === true) ---\n        let recognizedData = [];\n        if (recognize && classStudents && classStudents.length > 0) {\n          const labeledDescriptors = classStudents\n            .map((student) => {\n              const descriptors = extractStudentDescriptors(student);\n              if (descriptors.length > 0) {\n                return new faceapi.LabeledFaceDescriptors(\n                  student._id,\n                  descriptors\n                ); // Use student ID as label\n              }\n              return null;\n            })\n            .filter((ld) => ld !== null); // Filter out students with no descriptors\n\n          if (labeledDescriptors.length > 0) {\n            const faceMatcher = new faceapi.FaceMatcher(\n              labeledDescriptors,\n              RECOGNITION_THRESHOLD\n            );\n\n            recognizedData = faceData\n              .map((fd, index) => {\n                const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n                const student = classStudents.find(\n                  (s) => s._id === bestMatch.label\n                ); // Find student by ID label\n                return {\n                  detectionIndex: index, // Link recognition to detection\n                  studentId: student?._id,\n                  name: student?.full_name || \"Không rõ\",\n                  confidence: 1 - bestMatch.distance, // Convert distance to confidence-like score\n                  isUnknown: bestMatch.label === \"unknown\",\n                };\n              })\n              .filter((r) => !r.isUnknown); // Filter out unknown matches\n\n            dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n          } else {\n            dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n          }\n        }\n\n        // Draw landmarks and boxes with recognition info\n        drawLandmarks(faceData, recognizedData);\n\n        return { detections: faceData, recognized: recognizedData }; // Return both detection and recognition results\n      } catch (error) {\n        console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n        enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n          variant: \"error\",\n        });\n        // Clear canvas on error\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(\n            0,\n            0,\n            canvasRef.current.width,\n            canvasRef.current.height\n          );\n        }\n        dispatch(setDetectedFaces([]));\n        dispatch(setRecognizedStudents([]));\n        return null;\n      }\n    },\n    [\n      isCameraReady,\n      isModelLoaded,\n      classStudents,\n      drawLandmarks,\n      dispatch,\n      enqueueSnackbar,\n    ]\n  );\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort(\n        (a, b) => b.confidence - a.confidence\n      )[0];\n      enqueueSnackbar(\n        `Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(\n          1\n        )}%)`,\n        { variant: \"info\" }\n      );\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence >= CONFIDENCE_THRESHOLD) {\n        // Find the corresponding descriptor\n        const descriptor =\n          result.detections[topMatch.detectionIndex]?.descriptor;\n        if (descriptor) {\n          handleMarkAttendance(\n            topMatch.studentId,\n            topMatch.confidence,\n            descriptor\n          );\n        } else {\n          console.warn(\"Không tìm thấy descriptor cho top match\", topMatch);\n          enqueueSnackbar(\n            \"Lỗi: Không thể lấy đặc trưng khuôn mặt để điểm danh.\",\n            { variant: \"warning\" }\n          );\n        }\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\n        \"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\",\n        { variant: \"warning\" }\n      );\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", { variant: \"warning\" });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = (student) => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({ status: \"present\", note: \"\" }); // Reset form\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change\n  const handleManualAttendanceChange = (e) => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n\n    try {\n      const result = await dispatch(\n        manualAttendance({\n          sessionId,\n          studentId: selectedStudent._id,\n          status: manualAttendanceData.status,\n          note: manualAttendanceData.note,\n        })\n      ).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs((prevLogs) => {\n        const existingLogIndex = prevLogs.findIndex(\n          (log) => log.student_id?._id === selectedStudent._id\n        );\n        const newLog = { ...result.data, student_id: selectedStudent }; // Use the selected student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n\n      enqueueSnackbar(\n        `Đã điểm danh thủ công cho ${selectedStudent.full_name}`,\n        { variant: \"success\" }\n      );\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\",\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(\n    async (studentId, confidence, faceDescriptor) => {\n      if (!studentId || isProcessing) return;\n\n      // Check if student already marked present\n      const isAlreadyPresent = attendanceLogs.some(\n        (log) => log.student_id?._id === studentId && log.status === \"present\"\n      );\n      if (isAlreadyPresent) {\n        // console.log(`Student ${studentId} already marked present.`);\n        return; // Don't mark again if already present\n      }\n\n      const student = classStudents.find((s) => s._id === studentId);\n      if (!student) {\n        console.warn(\"Student not found for marking attendance:\", studentId);\n        return;\n      }\n\n      // Capture image for proof (optional, but good practice)\n      let imageBase64 = null;\n      try {\n        if (webcamRef.current) {\n          imageBase64 = webcamRef.current.getScreenshot({\n            width: 320,\n            height: 240,\n          }); // Smaller screenshot\n        }\n      } catch (screenshotError) {\n        console.error(\"Error taking screenshot:\", screenshotError);\n        // Proceed without image if screenshot fails\n      }\n\n      try {\n        const result = await dispatch(\n          verifyAttendance({\n            sessionId,\n            studentId,\n            faceDescriptor, // Pass the received descriptor\n            confidence,\n            imageBase64,\n            recognized: true, // Mark as recognized by the system\n          })\n        ).unwrap();\n\n        // Update local attendance logs\n        setAttendanceLogs((prevLogs) => {\n          const existingLogIndex = prevLogs.findIndex(\n            (log) => log.student_id?._id === studentId\n          );\n          const newLog = { ...result.data, student_id: student }; // Use the found student data\n          if (existingLogIndex > -1) {\n            const updatedLogs = [...prevLogs];\n            updatedLogs[existingLogIndex] = newLog;\n            return updatedLogs;\n          } else {\n            return [...prevLogs, newLog];\n          }\n        });\n\n        enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n          variant: \"success\",\n        });\n      } catch (error) {\n        console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n        enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n          variant: \"error\",\n        });\n      }\n    },\n    [\n      dispatch,\n      sessionId,\n      classStudents,\n      attendanceLogs,\n      isProcessing,\n      enqueueSnackbar,\n    ]\n  ); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (\n      !isCameraReady ||\n      !isModelLoaded ||\n      !classStudents ||\n      classStudents.length === 0\n    ) {\n      enqueueSnackbar(\n        \"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\",\n        { variant: \"warning\" }\n      );\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", { variant: \"info\" });\n\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach((rec) => {\n          // Check if confidence meets or exceeds the threshold\n          if (rec.confidence >= CONFIDENCE_THRESHOLD && rec.studentId) {\n            // Find the corresponding descriptor\n            const descriptor =\n              result.detections[rec.detectionIndex]?.descriptor;\n            if (descriptor) {\n              handleMarkAttendance(rec.studentId, rec.confidence, descriptor); // Attempt to mark attendance\n            } else {\n              console.warn(\n                \"Không tìm thấy descriptor cho recognized student trong auto mode\",\n                rec\n              );\n            }\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [\n    isCameraReady,\n    isModelLoaded,\n    classStudents,\n    detectAndRecognizeFaces,\n    handleMarkAttendance,\n    enqueueSnackbar,\n  ]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", { variant: \"info\" });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      // Lấy danh sách sinh viên vắng mặt từ UI trước khi kết thúc phiên\n      const absentStudentIds = absentStudents.map((student) => student._id);\n\n      enqueueSnackbar(\"Đang kết thúc phiên...\", { variant: \"info\" });\n\n      // Gửi cả trạng thái và danh sách sinh viên vắng mặt\n      await axios.put(\n        `${API_URL}/attendance/sessions/${sessionId}`,\n        {\n          status: \"completed\",\n          students_absent: absentStudentIds, // Thêm danh sách sinh viên vắng mặt\n        },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", { variant: \"success\" });\n      setSessionInfo((prev) => ({ ...prev, status: \"completed\" })); // Update local state\n      stopAutoAttendance(); // Stop auto mode if running\n      // Optionally navigate back after a delay\n      // setTimeout(() => navigate(`/teacher/classes/${classId}`), 1000);\n    } catch (error) {\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi kết thúc phiên\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", { variant: \"info\" });\n      const [logsRes, sessionRes] = await Promise.all([\n        axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n        axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n      ]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", { variant: \"success\" });\n    } catch (error) {\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi làm mới dữ liệu\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const toggleLandmarks = () => {\n    setShowLandmarks((prev) => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(\n    (log) => log.status === \"present\"\n  );\n  const absentStudents =\n    classInfo?.students?.filter(\n      (student) =>\n        !attendanceLogs.some(\n          (log) =>\n            log.student_id?._id === student._id &&\n            (log.status === \"present\" || log.status === \"late\")\n        ) // Consider late as not absent\n    ) || [];\n  const totalStudents = classInfo?.students?.length || 0;\n  const sessionCompleted = sessionInfo?.status === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return (\n      <Box\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        minHeight=\"80vh\"\n      >\n        <CircularProgress />\n        <Typography sx={{ ml: 2 }}>Đang tải dữ liệu điểm danh...</Typography>\n      </Box>\n    );\n  }\n\n  if (componentError && !isLoading) {\n    return (\n      <Box sx={{ p: 3 }}>\n        <Alert\n          severity=\"error\"\n          action={\n            <Button\n              color=\"inherit\"\n              size=\"small\"\n              onClick={() => window.location.reload()}\n            >\n              Tải lại trang\n            </Button>\n          }\n        >\n          <AlertTitle>Đã xảy ra lỗi</AlertTitle>\n          {componentError}\n        </Alert>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{ p: { xs: 1, sm: 2, md: 3 } }}>\n      {/* Header */}\n      <Box\n        display=\"flex\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        mb={2.5}\n        pb={2}\n        borderBottom=\"1px solid #eaeaea\"\n      >\n        <Box>\n          <Typography variant=\"h5\" fontWeight={500}>\n            Điểm Danh - {classInfo?.class_name}\n          </Typography>\n          <Typography variant=\"subtitle1\" color=\"textSecondary\">\n            Buổi {sessionInfo?.session_number} -{\" \"}\n            {sessionInfo?.date\n              ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\")\n              : \"N/A\"}\n            <Chip\n              label={sessionInfo?.status || \"N/A\"}\n              color={sessionCompleted ? \"default\" : \"success\"}\n              size=\"small\"\n              sx={{ ml: 1 }}\n            />\n          </Typography>\n        </Box>\n        <Button\n          variant=\"outlined\"\n          startIcon={<ArrowBack />}\n          onClick={() => navigate(`/teacher/classes/${classId}`)}\n        >\n          Quay lại lớp\n        </Button>\n      </Box>\n\n      {sessionCompleted && (\n        <Alert severity=\"info\" sx={{ mb: 2 }}>\n          Phiên điểm danh này đã kết thúc. Bạn chỉ có thể xem lại kết quả.\n        </Alert>\n      )}\n\n      {faceRecError && (\n        <Alert severity=\"warning\" sx={{ mb: 2 }}>\n          Lỗi từ hệ thống nhận diện: {faceRecError}\n        </Alert>\n      )}\n\n      <Grid container spacing={3}>\n        {/* Left Column: Camera and Controls */}\n        <Grid item xs={12} md={8}>\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3, overflow: \"hidden\" }}>\n            <CardContent\n              sx={{\n                bgcolor: \"#f8f9fa\",\n                borderBottom: \"1px solid #eaeaea\",\n                p: 2,\n              }}\n            >\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n              >\n                <Typography\n                  variant=\"h6\"\n                  fontWeight={500}\n                  display=\"flex\"\n                  alignItems=\"center\"\n                >\n                  <CameraAlt sx={{ mr: 1, color: \"primary.main\" }} /> Camera\n                </Typography>\n                {!sessionCompleted &&\n                  isModelLoaded && ( // Show controls only if session active and model loaded\n                    <Box>\n                      <Tooltip\n                        title={\n                          isAutoMode\n                            ? \"Dừng chế độ tự động\"\n                            : \"Bắt đầu chế độ tự động\"\n                        }\n                      >\n                        <IconButton\n                          onClick={\n                            isAutoMode\n                              ? stopAutoAttendance\n                              : startAutoAttendance\n                          }\n                          color={isAutoMode ? \"error\" : \"primary\"}\n                          disabled={!isCameraReady}\n                        >\n                          {isAutoMode ? (\n                            <StopCircleOutlined />\n                          ) : (\n                            <PlayCircleOutline />\n                          )}\n                        </IconButton>\n                      </Tooltip>\n                      <Tooltip\n                        title={showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\"}\n                      >\n                        <IconButton\n                          onClick={toggleLandmarks}\n                          color=\"secondary\"\n                          disabled={!isCameraReady || isAutoMode}\n                        >\n                          {showLandmarks ? <VisibilityOff /> : <Visibility />}\n                        </IconButton>\n                      </Tooltip>\n                    </Box>\n                  )}\n              </Box>\n            </CardContent>\n\n            {/* Camera Display Area */}\n            <Box\n              sx={{\n                position: \"relative\",\n                width: \"100%\",\n                aspectRatio: \"640 / 480\",\n                backgroundColor: \"#000\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              {!isModelLoaded && !sessionCompleted ? (\n                <Box textAlign=\"center\" color=\"white\">\n                  <CircularProgress color=\"inherit\" />\n                  <Typography>Đang tải mô hình nhận diện...</Typography>\n                </Box>\n              ) : !sessionCompleted ? (\n                <Suspense\n                  fallback={\n                    <Box textAlign=\"center\" color=\"white\">\n                      <CircularProgress color=\"inherit\" />\n                      <Typography>Đang khởi tạo camera...</Typography>\n                    </Box>\n                  }\n                >\n                  <Webcam\n                    audio={false}\n                    ref={webcamRef}\n                    screenshotFormat=\"image/jpeg\"\n                    width=\"100%\"\n                    height=\"100%\"\n                    videoConstraints={{\n                      width: 640,\n                      height: 480,\n                      facingMode: \"user\",\n                    }}\n                    style={{\n                      display: \"block\",\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      objectFit: \"cover\",\n                    }}\n                    onUserMedia={handleUserMedia}\n                    onUserMediaError={handleUserMediaError}\n                  />\n                </Suspense>\n              ) : (\n                <Typography color=\"white\">Phiên đã kết thúc</Typography> // Placeholder if session completed\n              )}\n\n              {/* Canvas for Overlays */}\n              <canvas\n                ref={canvasRef}\n                style={{\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  zIndex: 10,\n                }}\n              />\n\n              {/* Camera Error/Loading Overlay */}\n              {(!isCameraReady || componentError?.includes(\"camera\")) &&\n                !sessionCompleted && (\n                  <Box\n                    sx={{\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      backgroundColor: \"rgba(0,0,0,0.7)\",\n                      display: \"flex\",\n                      flexDirection: \"column\",\n                      justifyContent: \"center\",\n                      alignItems: \"center\",\n                      color: \"white\",\n                      zIndex: 20,\n                    }}\n                  >\n                    <VideocamOff sx={{ fontSize: 60, mb: 2 }} />\n                    <Typography variant=\"h6\">Camera không khả dụng</Typography>\n                    <Typography\n                      variant=\"body2\"\n                      sx={{ mt: 1, px: 2, textAlign: \"center\" }}\n                    >\n                      {componentError ||\n                        \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"}\n                    </Typography>\n                    <Button\n                      variant=\"outlined\"\n                      color=\"inherit\"\n                      sx={{ mt: 2 }}\n                      onClick={() => window.location.reload()}\n                    >\n                      Thử lại\n                    </Button>\n                  </Box>\n                )}\n              {/* Auto Mode Indicator */}\n              {isAutoMode && isCameraReady && (\n                <Chip\n                  label=\"Đang tự động điểm danh\"\n                  color=\"success\"\n                  size=\"small\"\n                  sx={{\n                    position: \"absolute\",\n                    bottom: 10,\n                    right: 10,\n                    zIndex: 15,\n                  }}\n                />\n              )}\n            </Box>\n\n            {/* Action Buttons */}\n            {!sessionCompleted && isCameraReady && isModelLoaded && (\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                p={2}\n                bgcolor=\"#f8f9fa\"\n                borderTop=\"1px solid #eaeaea\"\n              >\n                <Button\n                  variant=\"contained\"\n                  onClick={handleManualCapture}\n                  startIcon={\n                    isProcessing ? (\n                      <CircularProgress size={20} color=\"inherit\" />\n                    ) : (\n                      <CameraAlt />\n                    )\n                  }\n                  disabled={isProcessing || isAutoMode}\n                >\n                  Chụp & Nhận diện\n                </Button>\n                <Button\n                  variant=\"contained\"\n                  color=\"secondary\"\n                  onClick={completeSession}\n                  startIcon={<Save />}\n                  disabled={isProcessing}\n                >\n                  Kết thúc phiên\n                </Button>\n              </Box>\n            )}\n          </Card>\n\n          {/* Recognized Students Preview (Optional) */}\n          {recognizedStudents.length > 0 && !isAutoMode && (\n            <Card sx={{ mt: 2, borderRadius: \"10px\", boxShadow: 1 }}>\n              <CardContent>\n                <Typography variant=\"subtitle1\" fontWeight=\"500\" mb={1}>\n                  Đã nhận diện gần đây\n                </Typography>\n                <Grid container spacing={1}>\n                  {recognizedStudents.slice(0, 4).map(\n                    (\n                      rec,\n                      index // Show max 4\n                    ) => (\n                      <Grid\n                        item\n                        xs={6}\n                        sm={3}\n                        key={`${rec.studentId}-${index}`}\n                      >\n                        <Paper\n                          elevation={0}\n                          sx={{\n                            p: 1,\n                            textAlign: \"center\",\n                            border: \"1px solid #eee\",\n                          }}\n                        >\n                          <Typography variant=\"caption\" display=\"block\" noWrap>\n                            {rec.name}\n                          </Typography>\n                          <Chip\n                            label={`${(rec.confidence * 100).toFixed(0)}%`}\n                            size=\"small\"\n                            color={\n                              rec.confidence > CONFIDENCE_THRESHOLD\n                                ? \"success\"\n                                : \"warning\"\n                            }\n                            sx={{ mt: 0.5 }}\n                          />\n                        </Paper>\n                      </Grid>\n                    )\n                  )}\n                </Grid>\n              </CardContent>\n            </Card>\n          )}\n        </Grid>\n\n        {/* Right Column: Student Lists */}\n        <Grid item xs={12} md={4}>\n          {/* Present Students */}\n          <Card sx={{ mb: 3, borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Typography variant=\"h6\" display=\"flex\" alignItems=\"center\">\n                  <Check sx={{ mr: 1, color: \"success.main\" }} /> Có mặt (\n                  {presentStudents.length}/{totalStudents})\n                </Typography>\n                <Tooltip title=\"Làm mới danh sách\">\n                  <IconButton\n                    size=\"small\"\n                    onClick={refreshAttendanceLogs}\n                    disabled={isProcessing}\n                  >\n                    <Refresh />\n                  </IconButton>\n                </Tooltip>\n              </Box>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {presentStudents.length === 0 ? (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"textSecondary\"\n                    align=\"center\"\n                    sx={{ py: 2 }}\n                  >\n                    Tất cả sinh viên đã có mặt.\n                  </Typography>\n                ) : (\n                  <List dense>\n                    {presentStudents\n                      .sort(\n                        (a, b) => new Date(b.timestamp) - new Date(a.timestamp)\n                      ) // Sort by time desc\n                      .map((log) => (\n                        // Simplified ListItem for debugging\n                        <ListItem key={log._id}>\n                          <ListItemText\n                            primary={\n                              log.student_id?.full_name ||\n                              `Log ID: ${log._id} (Tên bị thiếu)`\n                            }\n                            secondary={`Trạng thái: ${log.status} - ${new Date(\n                              log.timestamp\n                            ).toLocaleTimeString(\"vi-VN\")}`}\n                          />\n                        </ListItem>\n                      ))}\n                  </List>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n\n          {/* Absent Students */}\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Typography\n                variant=\"h6\"\n                display=\"flex\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Close sx={{ mr: 1, color: \"error.main\" }} /> Vắng mặt (\n                {absentStudents.length}/{totalStudents})\n              </Typography>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {absentStudents.length === 0 ? (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"textSecondary\"\n                    align=\"center\"\n                    sx={{ py: 2 }}\n                  >\n                    Tất cả sinh viên đã có mặt.\n                  </Typography>\n                ) : (\n                  <List dense>\n                    {absentStudents.map((student) => (\n                      // Keep absent list detailed for now\n                      <ListItem\n                        key={student._id}\n                        disablePadding\n                        sx={{ mb: 0.5 }}\n                        secondaryAction={\n                          !sessionCompleted ? (\n                            <Tooltip title=\"Điểm danh thủ công\">\n                              <IconButton\n                                edge=\"end\"\n                                size=\"small\"\n                                onClick={() =>\n                                  openManualAttendanceDialog(student)\n                                }\n                                disabled={isProcessing}\n                              >\n                                <Edit fontSize=\"small\" />\n                              </IconButton>\n                            </Tooltip>\n                          ) : null\n                        }\n                      >\n                        <Paper\n                          variant=\"outlined\"\n                          sx={{\n                            width: \"100%\",\n                            display: \"flex\",\n                            alignItems: \"center\",\n                            p: 0.5,\n                            borderRadius: \"4px\",\n                          }}\n                        >\n                          <ListItemAvatar sx={{ minWidth: 45 }}>\n                            <Avatar\n                              alt={student.full_name}\n                              src={student.avatar_url}\n                              sx={{ width: 32, height: 32 }}\n                            />\n                          </ListItemAvatar>\n                          <ListItemText\n                            primary={\n                              <Typography variant=\"body2\" noWrap>\n                                {student.full_name}\n                              </Typography>\n                            }\n                            secondary={\n                              <Typography\n                                variant=\"caption\"\n                                color=\"text.secondary\"\n                              >\n                                {student.student_code}\n                              </Typography>\n                            }\n                          />\n                        </Paper>\n                      </ListItem>\n                    ))}\n                  </List>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n        </Grid>\n      </Grid>\n\n      {/* Manual Attendance Dialog */}\n      <Dialog\n        open={manualDialogOpen}\n        onClose={handleManualDialogClose}\n        maxWidth=\"xs\"\n        fullWidth\n      >\n        <DialogTitle>Điểm danh thủ công</DialogTitle>\n        <DialogContent>\n          {selectedStudent && (\n            <Box display=\"flex\" alignItems=\"center\" mb={2}>\n              <Avatar\n                src={selectedStudent.avatar_url}\n                alt={selectedStudent.full_name}\n                sx={{ width: 48, height: 48, mr: 2 }}\n              />\n              <Box>\n                <Typography variant=\"subtitle1\">\n                  {selectedStudent.full_name}\n                </Typography>\n                <Typography variant=\"body2\" color=\"text.secondary\">\n                  MSSV: {selectedStudent.student_code}\n                </Typography>\n              </Box>\n            </Box>\n          )}\n          <FormControl fullWidth margin=\"normal\">\n            <InputLabel>Trạng thái</InputLabel>\n            <Select\n              name=\"status\"\n              value={manualAttendanceData.status}\n              onChange={handleManualAttendanceChange}\n              label=\"Trạng thái\"\n            >\n              <MenuItem value=\"present\">Có mặt</MenuItem>\n              <MenuItem value=\"absent\">Vắng mặt</MenuItem>\n              <MenuItem value=\"late\">Đi trễ</MenuItem>\n              <MenuItem value=\"early_leave\">Về sớm</MenuItem>\n            </Select>\n          </FormControl>\n          <TextField\n            fullWidth\n            margin=\"normal\"\n            name=\"note\"\n            label=\"Ghi chú (tùy chọn)\"\n            value={manualAttendanceData.note}\n            onChange={handleManualAttendanceChange}\n            multiline\n            rows={2}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleManualDialogClose}>Hủy</Button>\n          <Button\n            onClick={handleManualAttendanceSubmit}\n            variant=\"contained\"\n            color=\"primary\"\n            disabled={isProcessing}\n          >\n            Xác nhận\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </Box>\n  );\n};\n\nexport default AttendancePage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
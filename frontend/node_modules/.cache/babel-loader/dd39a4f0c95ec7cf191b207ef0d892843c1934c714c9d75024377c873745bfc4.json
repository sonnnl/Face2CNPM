{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{useDispatch,useSelector}from\"react-redux\";import{useSnackbar}from\"notistack\";import axios from\"axios\";import{Box,Typography,Paper,Button,IconButton,TextField,Table,TableBody,TableCell,TableContainer,TableHead,TableRow,TablePagination,Dialog,DialogActions,DialogContent,DialogContentText,DialogTitle,Grid,Tooltip,CircularProgress,InputAdornment}from\"@mui/material\";import{Add,Delete,Edit,Search,Refresh}from\"@mui/icons-material\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API_URL=process.env.REACT_APP_API_URL||\"http://localhost:5000/api\";const DepartmentsPage=()=>{const dispatch=useDispatch();const{enqueueSnackbar}=useSnackbar();const{token}=useSelector(state=>state.auth);// State\nconst[departments,setDepartments]=useState([]);const[isLoading,setIsLoading]=useState(false);const[page,setPage]=useState(0);const[rowsPerPage,setRowsPerPage]=useState(10);const[totalCount,setTotalCount]=useState(0);const[searchTerm,setSearchTerm]=useState(\"\");// Dialog states\nconst[dialogOpen,setDialogOpen]=useState(false);const[dialogMode,setDialogMode]=useState(\"create\");const[formData,setFormData]=useState({name:\"\",code:\"\",description:\"\"});const[selectedDepartment,setSelectedDepartment]=useState(null);const[deleteDialogOpen,setDeleteDialogOpen]=useState(false);// Load data on mount and when pagination/search changes\nuseEffect(()=>{loadDepartments();},[page,rowsPerPage]);const loadDepartments=async()=>{try{setIsLoading(true);const response=await axios.get(`${API_URL}/departments?page=${page+1}&limit=${rowsPerPage}&search=${searchTerm}`,{headers:{Authorization:`Bearer ${token}`}});setDepartments(response.data.data||[]);setTotalCount(response.data.totalCount||0);setIsLoading(false);}catch(error){console.error(\"Lỗi khi tải danh sách khoa:\",error);enqueueSnackbar(\"Lỗi khi tải danh sách khoa\",{variant:\"error\"});setIsLoading(false);}};const handleSearch=()=>{setPage(0);loadDepartments();};const handleChangePage=(event,newPage)=>{setPage(newPage);};const handleChangeRowsPerPage=event=>{setRowsPerPage(parseInt(event.target.value,10));setPage(0);};// Dialog handlers\nconst openDialog=function(mode){let department=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;setDialogMode(mode);if(mode===\"edit\"&&department){setFormData({name:department.name,code:department.code,description:department.description||\"\"});setSelectedDepartment(department);}else{setFormData({name:\"\",code:\"\",description:\"\"});}setDialogOpen(true);};const handleFormChange=e=>{const{name,value}=e.target;setFormData({...formData,[name]:value});};const handleFormSubmit=async()=>{try{if(dialogMode===\"create\"){await axios.post(`${API_URL}/departments`,formData,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Tạo khoa mới thành công\",{variant:\"success\"});}else{await axios.put(`${API_URL}/departments/${selectedDepartment._id}`,formData,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Cập nhật khoa thành công\",{variant:\"success\"});}setDialogOpen(false);loadDepartments();}catch(error){var _error$response,_error$response$data;console.error(\"Lỗi khi thao tác với khoa:\",error);enqueueSnackbar(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.message)||\"Lỗi khi thao tác với khoa\",{variant:\"error\"});}};// Delete handlers\nconst openDeleteDialog=department=>{setSelectedDepartment(department);setDeleteDialogOpen(true);};const handleDeleteDepartment=async()=>{try{await axios.delete(`${API_URL}/departments/${selectedDepartment._id}`,{headers:{Authorization:`Bearer ${token}`}});enqueueSnackbar(\"Xóa khoa thành công\",{variant:\"success\"});setDeleteDialogOpen(false);loadDepartments();}catch(error){var _error$response2,_error$response2$data;console.error(\"Lỗi khi xóa khoa:\",error);enqueueSnackbar(((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||\"Lỗi khi xóa khoa\",{variant:\"error\"});}};return/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",gutterBottom:true,children:\"Qu\\u1EA3n l\\xFD khoa\"}),/*#__PURE__*/_jsx(Paper,{sx:{p:2,mb:3},children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",flexDirection:{xs:\"column\",sm:\"row\"},alignItems:{sm:\"center\"},justifyContent:\"space-between\",gap:2,children:[/*#__PURE__*/_jsxs(Box,{display:\"flex\",alignItems:\"center\",gap:1,flexGrow:1,children:[/*#__PURE__*/_jsx(TextField,{label:\"T\\xECm ki\\u1EBFm khoa\",variant:\"outlined\",size:\"small\",fullWidth:true,value:searchTerm,onChange:e=>setSearchTerm(e.target.value),onKeyPress:e=>e.key===\"Enter\"&&handleSearch(),InputProps:{startAdornment:/*#__PURE__*/_jsx(InputAdornment,{position:\"start\",children:/*#__PURE__*/_jsx(Search,{})})}}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleSearch,startIcon:/*#__PURE__*/_jsx(Search,{}),children:\"T\\xECm\"})]}),/*#__PURE__*/_jsxs(Box,{display:\"flex\",gap:2,children:[/*#__PURE__*/_jsx(Button,{variant:\"outlined\",startIcon:/*#__PURE__*/_jsx(Refresh,{}),onClick:loadDepartments,children:\"L\\xE0m m\\u1EDBi\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",startIcon:/*#__PURE__*/_jsx(Add,{}),onClick:()=>openDialog(\"create\"),children:\"Th\\xEAm khoa\"})]})]})}),/*#__PURE__*/_jsxs(TableContainer,{component:Paper,children:[/*#__PURE__*/_jsxs(Table,{sx:{minWidth:650},children:[/*#__PURE__*/_jsx(TableHead,{children:/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:\"T\\xEAn khoa\"}),/*#__PURE__*/_jsx(TableCell,{children:\"M\\xE3 khoa\"}),/*#__PURE__*/_jsx(TableCell,{children:\"M\\xF4 t\\u1EA3\"}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(TableBody,{children:isLoading?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:4,align:\"center\",children:/*#__PURE__*/_jsx(CircularProgress,{size:30})})}):departments.length===0?/*#__PURE__*/_jsx(TableRow,{children:/*#__PURE__*/_jsx(TableCell,{colSpan:4,align:\"center\",children:\"Kh\\xF4ng t\\xECm th\\u1EA5y khoa n\\xE0o\"})}):departments.map(department=>/*#__PURE__*/_jsxs(TableRow,{children:[/*#__PURE__*/_jsx(TableCell,{children:department.name}),/*#__PURE__*/_jsx(TableCell,{children:department.code}),/*#__PURE__*/_jsx(TableCell,{children:department.description}),/*#__PURE__*/_jsx(TableCell,{align:\"right\",children:/*#__PURE__*/_jsxs(Box,{display:\"flex\",justifyContent:\"flex-end\",children:[/*#__PURE__*/_jsx(Tooltip,{title:\"S\\u1EEDa khoa\",children:/*#__PURE__*/_jsx(IconButton,{color:\"primary\",onClick:()=>openDialog(\"edit\",department),children:/*#__PURE__*/_jsx(Edit,{})})}),/*#__PURE__*/_jsx(Tooltip,{title:\"X\\xF3a khoa\",children:/*#__PURE__*/_jsx(IconButton,{color:\"error\",onClick:()=>openDeleteDialog(department),children:/*#__PURE__*/_jsx(Delete,{})})})]})})]},department._id))})]}),/*#__PURE__*/_jsx(TablePagination,{rowsPerPageOptions:[5,10,25],component:\"div\",count:totalCount,rowsPerPage:rowsPerPage,page:page,onPageChange:handleChangePage,onRowsPerPageChange:handleChangeRowsPerPage,labelRowsPerPage:\"D\\xF2ng m\\u1ED7i trang:\",labelDisplayedRows:_ref=>{let{from,to,count}=_ref;return`${from}-${to} trên ${count}`;}})]}),/*#__PURE__*/_jsxs(Dialog,{open:dialogOpen,onClose:()=>setDialogOpen(false),maxWidth:\"sm\",fullWidth:true,children:[/*#__PURE__*/_jsx(DialogTitle,{children:dialogMode===\"create\"?\"Thêm khoa mới\":\"Sửa khoa\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,sx:{mt:1},children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{name:\"name\",label:\"T\\xEAn khoa\",fullWidth:true,required:true,value:formData.name,onChange:handleFormChange})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{name:\"code\",label:\"M\\xE3 khoa\",fullWidth:true,required:true,value:formData.code,onChange:handleFormChange})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(TextField,{name:\"description\",label:\"M\\xF4 t\\u1EA3\",fullWidth:true,multiline:true,rows:3,value:formData.description,onChange:handleFormChange})})]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDialogOpen(false),children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{onClick:handleFormSubmit,variant:\"contained\",color:\"primary\",disabled:!formData.name||!formData.code,children:dialogMode===\"create\"?\"Tạo mới\":\"Cập nhật\"})]})]}),/*#__PURE__*/_jsxs(Dialog,{open:deleteDialogOpen,onClose:()=>setDeleteDialogOpen(false),children:[/*#__PURE__*/_jsx(DialogTitle,{children:\"X\\xE1c nh\\u1EADn x\\xF3a khoa\"}),/*#__PURE__*/_jsx(DialogContent,{children:/*#__PURE__*/_jsxs(DialogContentText,{children:[\"B\\u1EA1n c\\xF3 ch\\u1EAFc ch\\u1EAFn mu\\u1ED1n x\\xF3a khoa \\\"\",selectedDepartment===null||selectedDepartment===void 0?void 0:selectedDepartment.name,\"\\\"? H\\xE0nh \\u0111\\u1ED9ng n\\xE0y kh\\xF4ng th\\u1EC3 ho\\xE0n t\\xE1c.\"]})}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:()=>setDeleteDialogOpen(false),children:\"H\\u1EE7y\"}),/*#__PURE__*/_jsx(Button,{onClick:handleDeleteDepartment,variant:\"contained\",color:\"error\",children:\"X\\xF3a\"})]})]})]});};export default DepartmentsPage;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}
{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\teacher\\\\AttendancePage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport { Box, Typography, Card, CardContent, Grid, Paper, Button, Divider, CircularProgress, List, ListItem, ListItemAvatar, ListItemText, Avatar, Chip, Dialog, DialogTitle, DialogContent, DialogActions, TextField, FormControl, InputLabel, Select, MenuItem, IconButton, Alert } from \"@mui/material\";\nimport { CameraAlt, Check, Close, Edit, Refresh, Save, VerifiedUser, HourglassEmpty } from \"@mui/icons-material\";\nimport Webcam from \"react-webcam\";\nimport * as faceapi from \"face-api.js\";\nimport { getClassFaceFeatures, verifyAttendance, manualAttendance, setModelLoaded, setCameraReady, setDetectedFaces, setRecognizedStudents, clearRecognitionState } from \"../../redux/slices/faceRecognitionSlice\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\nconst AttendancePage = () => {\n  _s();\n  const {\n    classId,\n    sessionId\n  } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const videoRef = useRef(null);\n  const [intervalId, setIntervalId] = useState(null);\n  const [showLandmark, setShowLandmark] = useState(false);\n  const [landmarkIntervalId, setLandmarkIntervalId] = useState(null);\n  const {\n    token\n  } = useSelector(state => state.auth);\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents,\n    isProcessing,\n    error\n  } = useSelector(state => state.faceRecognition);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isLoading, setIsLoading] = useState(true);\n  const [isRecognizing, setIsRecognizing] = useState(false);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\"\n  });\n\n  // Các hằng số cấu hình\n  const RECOGNITION_THRESHOLD = 0.5; // Ngưỡng nhận diện\n  const DETECTION_THRESHOLD = 0.3; // Giảm ngưỡng phát hiện khuôn mặt\n  const CONFIDENCE_THRESHOLD = 0.6; // Ngưỡng độ tin cậy để điểm danh\n  const AUTO_DETECT_INTERVAL = 1000; // Thời gian giữa các lần phát hiện (ms)\n  const ENABLE_DEBUG_LOGS = true; // Bật/tắt log gỡ lỗi\n\n  // Thêm state mới để theo dõi số lần thử lại camera\n  const [cameraRetryCount, setCameraRetryCount] = useState(0);\n  const [lastDetectionTime, setLastDetectionTime] = useState(null);\n\n  // Load class info, session info và models\n  useEffect(() => {\n    const loadInitialData = async () => {\n      try {\n        setIsLoading(true);\n\n        // Bắt đầu tải dữ liệu và models song song\n        const loadModelsPromise = !isModelLoaded ? loadFaceRecognitionModels() : Promise.resolve(true);\n\n        // Lấy thông tin lớp học\n        const classPromise = axios.get(`${API_URL}/classes/teaching/${classId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n\n        // Lấy thông tin phiên điểm danh\n        const sessionPromise = axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n\n        // Lấy danh sách điểm danh\n        const logsPromise = axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n\n        // Chờ tất cả API calls hoàn thành\n        const [classResponse, sessionResponse, logsResponse] = await Promise.all([classPromise, sessionPromise, logsPromise]);\n        setClassInfo(classResponse.data.data);\n        setSessionInfo(sessionResponse.data.data);\n        setAttendanceLogs(logsResponse.data.data);\n\n        // Lấy đặc trưng khuôn mặt của sinh viên trong lớp\n        console.log(\"[DEBUG] Bắt đầu lấy đặc trưng khuôn mặt của sinh viên, classId:\", classId);\n        try {\n          // Gọi API trực tiếp để kiểm tra\n          const faceDataResponse = await axios.get(`${API_URL}/face-recognition/class-features/${classId}`, {\n            headers: {\n              Authorization: `Bearer ${token}`\n            }\n          });\n          console.log(\"[DEBUG] API response raw:\", faceDataResponse);\n          console.log(\"[DEBUG] API response data:\", faceDataResponse.data);\n\n          // Vẫn sử dụng redux dispatch để đảm bảo tính nhất quán\n          const faceFeatureResult = await dispatch(getClassFaceFeatures(classId)).unwrap();\n\n          // Log toàn bộ result để debug\n          console.log(\"[DEBUG] Redux unwrapped result:\", faceFeatureResult);\n\n          // Kiểm tra xem có dữ liệu trả về không\n          if (faceFeatureResult) {\n            // Log dữ liệu để debug\n            console.log(\"[DEBUG] Bắt đầu phân tích dữ liệu khuôn mặt\");\n            console.log(\"[DEBUG] faceFeatureResult structure:\", JSON.stringify(faceFeatureResult, null, 2));\n            let studentsData = null;\n\n            // Kiểm tra các cấu trúc dữ liệu có thể có\n            if (Array.isArray(faceFeatureResult)) {\n              studentsData = faceFeatureResult;\n              console.log(`[DEBUG] Nhận được dữ liệu khuôn mặt dạng mảng: ${studentsData.length} sinh viên`);\n            } else if (faceFeatureResult.data && Array.isArray(faceFeatureResult.data)) {\n              studentsData = faceFeatureResult.data;\n              console.log(`[DEBUG] Nhận được dữ liệu khuôn mặt từ faceFeatureResult.data: ${studentsData.length} sinh viên`);\n            } else if (faceFeatureResult.students && Array.isArray(faceFeatureResult.students)) {\n              studentsData = faceFeatureResult.students;\n              console.log(`[DEBUG] Nhận được dữ liệu khuôn mặt từ faceFeatureResult.students: ${studentsData.length} sinh viên`);\n            }\n            if (studentsData && studentsData.length > 0) {\n              console.log(`[DEBUG] Phân tích dữ liệu khuôn mặt của ${studentsData.length} sinh viên`);\n\n              // Kiểm tra chi tiết dữ liệu khuôn mặt\n              let validDescriptorsCount = 0;\n              let invalidDescriptorsCount = 0;\n              studentsData.forEach(student => {\n                console.log(`[DEBUG] Kiểm tra sinh viên: ${student.full_name || \"Unknown\"}, ID: ${student._id}`);\n                console.log(`[DEBUG] Cấu trúc dữ liệu sinh viên:`, student);\n\n                // Kiểm tra nếu có faceFeatures\n                if (student.faceFeatures) {\n                  console.log(`[DEBUG] Sinh viên có dữ liệu faceFeatures`);\n\n                  // Kiểm tra nếu có descriptors\n                  const hasDescriptors = student.faceFeatures && student.faceFeatures.descriptors && Array.isArray(student.faceFeatures.descriptors) && student.faceFeatures.descriptors.length > 0;\n                  if (hasDescriptors) {\n                    console.log(`[DEBUG] Sinh viên có ${student.faceFeatures.descriptors.length} nhóm descriptors`);\n\n                    // Đếm số descriptor hợp lệ\n                    let validDescriptorsInStudent = 0;\n                    student.faceFeatures.descriptors.forEach((group, groupIndex) => {\n                      if (Array.isArray(group)) {\n                        group.forEach((descriptor, descIndex) => {\n                          if (Array.isArray(descriptor) && descriptor.length === 128) {\n                            validDescriptorsInStudent++;\n                          }\n                        });\n                      }\n                    });\n                    if (validDescriptorsInStudent > 0) {\n                      validDescriptorsCount++;\n                      console.log(`[DEBUG] Sinh viên ${student.full_name} có ${validDescriptorsInStudent} descriptor hợp lệ`);\n                    } else {\n                      invalidDescriptorsCount++;\n                      console.log(`[DEBUG] Sinh viên ${student.full_name} không có descriptor hợp lệ`);\n                    }\n                  } else {\n                    invalidDescriptorsCount++;\n                    console.log(`[DEBUG] Sinh viên ${student.full_name} không có descriptors`);\n                  }\n                } else {\n                  // Kiểm tra nếu có faceDescriptors (cấu trúc cũ)\n                  const hasOldDescriptors = student.faceDescriptors && Array.isArray(student.faceDescriptors) && student.faceDescriptors.length > 0;\n                  if (hasOldDescriptors) {\n                    console.log(`[DEBUG] Sinh viên có ${student.faceDescriptors.length} descriptors (dạng cũ)`);\n                    console.log(`[DEBUG] Chi tiết faceDescriptors:`, JSON.stringify(student.faceDescriptors, null, 2));\n\n                    // Thử các cách khác nhau để lấy descriptor\n                    if (typeof student.faceDescriptors[0] === \"object\") {\n                      // Nếu là object (không phải mảng), có thể nó là object có chứa descriptor\n                      console.log(`[DEBUG] Descriptor là object:`, student.faceDescriptors[0]);\n\n                      // Kiểm tra nếu descriptor nằm trong object.descriptors hoặc object.0\n                      if (student.faceDescriptors[0].descriptors && Array.isArray(student.faceDescriptors[0].descriptors)) {\n                        console.log(`[DEBUG] Tìm thấy descriptors trong object.descriptors`);\n                        // Sử dụng descriptors trong object\n                        const flatDescriptors = student.faceDescriptors[0].descriptors;\n                        const validOldDescriptors = flatDescriptors.filter(desc => Array.isArray(desc) && desc.length === 128).length;\n                        if (validOldDescriptors > 0) {\n                          validDescriptorsCount++;\n                          console.log(`[DEBUG] Sinh viên ${student.full_name} có ${validOldDescriptors} descriptor hợp lệ trong object.descriptors`);\n                        }\n                      } else {\n                        // Duyệt tất cả các thuộc tính của object để tìm mảng\n                        const foundArrays = [];\n                        Object.keys(student.faceDescriptors[0]).forEach(key => {\n                          const value = student.faceDescriptors[0][key];\n                          if (Array.isArray(value)) {\n                            console.log(`[DEBUG] Tìm thấy mảng trong thuộc tính ${key}, độ dài: ${value.length}`);\n                            foundArrays.push(value);\n                          }\n                        });\n\n                        // Kiểm tra các mảng tìm được\n                        if (foundArrays.length > 0) {\n                          // Ưu tiên mảng có 128 phần tử\n                          const potentialDescriptors = foundArrays.filter(arr => arr.length === 128);\n                          if (potentialDescriptors.length > 0) {\n                            validDescriptorsCount++;\n                            console.log(`[DEBUG] Sinh viên ${student.full_name} có descriptor hợp lệ trong thuộc tính object`);\n                          }\n                        }\n                      }\n                    } else {\n                      // Xử lý thông thường\n                      const validOldDescriptors = student.faceDescriptors.filter(desc => Array.isArray(desc) && desc.length === 128).length;\n                      if (validOldDescriptors > 0) {\n                        validDescriptorsCount++;\n                        console.log(`[DEBUG] Sinh viên ${student.full_name} có ${validOldDescriptors} descriptor hợp lệ (dạng cũ)`);\n                      } else {\n                        invalidDescriptorsCount++;\n                        console.log(`[DEBUG] Sinh viên ${student.full_name} không có descriptor hợp lệ (dạng cũ)`);\n                      }\n                    }\n                  } else {\n                    invalidDescriptorsCount++;\n                    console.log(`[DEBUG] Sinh viên ${student.full_name} không có dữ liệu khuôn mặt`);\n                  }\n                }\n              });\n              console.log(`[DEBUG] Tổng hợp: ${validDescriptorsCount} sinh viên có descriptor hợp lệ, ${invalidDescriptorsCount} sinh viên không có`);\n              if (validDescriptorsCount === 0) {\n                enqueueSnackbar(\"Không có sinh viên nào có dữ liệu khuôn mặt, vui lòng cập nhật dữ liệu\", {\n                  variant: \"warning\",\n                  autoHideDuration: 8000\n                });\n              }\n            } else {\n              console.log(\"[DEBUG] Không nhận được dữ liệu khuôn mặt từ API\");\n              enqueueSnackbar(\"Không thể tải dữ liệu nhận diện khuôn mặt\", {\n                variant: \"error\"\n              });\n            }\n          } else {\n            console.log(\"[DEBUG] Không nhận được dữ liệu khuôn mặt từ API (faceFeatureResult là null hoặc undefined)\");\n            enqueueSnackbar(\"Không thể tải dữ liệu nhận diện khuôn mặt\", {\n              variant: \"error\"\n            });\n          }\n        } catch (apiError) {\n          var _apiError$response;\n          console.error(\"[DEBUG] Lỗi khi gọi API lấy dữ liệu khuôn mặt:\", apiError);\n          console.log(\"[DEBUG] API error details:\", ((_apiError$response = apiError.response) === null || _apiError$response === void 0 ? void 0 : _apiError$response.data) || apiError.message);\n          enqueueSnackbar(\"Lỗi khi lấy dữ liệu khuôn mặt. Vui lòng kiểm tra API endpoint.\", {\n            variant: \"error\"\n          });\n        }\n\n        // Không chờ đợi model load xong mới hiển thị UI\n        setIsLoading(false);\n\n        // Model sẽ load song song\n        await loadModelsPromise;\n\n        // Thiết lập thời gian phát hiện ban đầu\n        setLastDetectionTime(Date.now());\n      } catch (error) {\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        enqueueSnackbar(\"Lỗi khi tải dữ liệu\", {\n          variant: \"error\"\n        });\n        setIsLoading(false);\n      }\n    };\n    loadInitialData();\n\n    // Clean up\n    return () => {\n      if (intervalId) {\n        clearInterval(intervalId);\n      }\n\n      // Dừng landmark interval nếu đang chạy\n      if (landmarkIntervalId) {\n        clearInterval(landmarkIntervalId);\n      }\n\n      // Dừng camera stream nếu đang chạy\n      if (webcamRef.current && webcamRef.current.video && webcamRef.current.video.srcObject) {\n        const tracks = webcamRef.current.video.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      }\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      }\n      dispatch(clearRecognitionState());\n\n      // Reset các state theo dõi camera\n      setCameraRetryCount(0);\n      setLastDetectionTime(null);\n    };\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded, intervalId, landmarkIntervalId]);\n\n  // Hàm khởi tạo camera trực tiếp - nút duy nhất cho camera\n  const initDirectCamera = async () => {\n    try {\n      // Tải model nhận diện và đảm bảo model đã sẵn sàng\n      if (!isModelLoaded || !faceapi.nets.ssdMobilenetv1.isLoaded) {\n        enqueueSnackbar(\"Đang tải các mô hình nhận diện...\", {\n          variant: \"info\"\n        });\n        const modelLoaded = await loadFaceRecognitionModels();\n        if (!modelLoaded) {\n          enqueueSnackbar(\"Không thể tải mô hình nhận diện, vui lòng thử lại\", {\n            variant: \"error\"\n          });\n          return;\n        }\n      }\n\n      // Dừng stream cũ nếu có\n      if (webcamRef.current && webcamRef.current.video && webcamRef.current.video.srcObject) {\n        const tracks = webcamRef.current.video.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      }\n      if (videoRef.current && videoRef.current.srcObject) {\n        const tracks = videoRef.current.srcObject.getTracks();\n        tracks.forEach(track => track.stop());\n      }\n\n      // Truy cập camera trực tiếp thông qua MediaDevices API\n      try {\n        // Thêm tùy chọn camera với nhiều độ phân giải\n        const constraints = {\n          video: {\n            width: {\n              ideal: 1280,\n              min: 640\n            },\n            height: {\n              ideal: 720,\n              min: 480\n            },\n            facingMode: \"user\",\n            frameRate: {\n              ideal: 30,\n              min: 15\n            }\n          },\n          audio: false\n        };\n        console.log(\"[DEBUG] Đang yêu cầu truy cập camera với tùy chọn:\", constraints);\n        const stream = await navigator.mediaDevices.getUserMedia(constraints);\n        console.log(\"Đã nhận được stream camera trực tiếp\", stream.id);\n\n        // Nếu đang sử dụng webcam component\n        if (webcamRef.current && webcamRef.current.video) {\n          webcamRef.current.video.srcObject = stream;\n\n          // Kiểm tra stream đã hoạt động chưa\n          webcamRef.current.video.onloadedmetadata = () => {\n            webcamRef.current.video.play().catch(err => {\n              console.error(\"Lỗi khi play video webcam:\", err);\n            });\n          };\n        }\n        // Hoặc nếu đang sử dụng video element\n        else if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n          videoRef.current.onloadedmetadata = () => {\n            videoRef.current.play().catch(err => console.error(\"Lỗi khi play video:\", err));\n          };\n        }\n\n        // Đánh dấu camera và model đã sẵn sàng\n        dispatch(setModelLoaded(true));\n        dispatch(setCameraReady(true));\n\n        // Khởi động thời gian phát hiện ban đầu\n        setLastDetectionTime(Date.now());\n        enqueueSnackbar(\"Đã kết nối camera thành công\", {\n          variant: \"success\"\n        });\n\n        // Bật hiển thị landmark sau khi camera khởi động\n        setTimeout(() => {\n          setShowLandmark(true);\n        }, 1000);\n\n        // Đặt lại số lần thử camera\n        setCameraRetryCount(0);\n        return true;\n      } catch (err) {\n        console.error(\"Lỗi truy cập camera:\", err);\n        enqueueSnackbar(`Không thể truy cập camera: ${err.message}`, {\n          variant: \"error\"\n        });\n\n        // Thử phương án thay thế nếu camera mặt trước thất bại\n        if (cameraRetryCount < 2) {\n          try {\n            console.log(\"[DEBUG] Thử sử dụng camera phương án thay thế\");\n            const altStream = await navigator.mediaDevices.getUserMedia({\n              video: true,\n              // Chỉ yêu cầu bất kỳ camera nào có sẵn\n              audio: false\n            });\n\n            // Xử lý stream mới\n            if (webcamRef.current && webcamRef.current.video) {\n              webcamRef.current.video.srcObject = altStream;\n            } else if (videoRef.current) {\n              videoRef.current.srcObject = altStream;\n              videoRef.current.onloadedmetadata = () => videoRef.current.play();\n            }\n            dispatch(setCameraReady(true));\n            setLastDetectionTime(Date.now());\n            enqueueSnackbar(\"Đã kết nối camera thay thế\", {\n              variant: \"success\"\n            });\n            return true;\n          } catch (altErr) {\n            console.error(\"Không thể sử dụng camera thay thế:\", altErr);\n          }\n        }\n        return false;\n      }\n    } catch (err) {\n      console.error(\"Lỗi khi khởi tạo camera trực tiếp:\", err);\n      enqueueSnackbar(`Lỗi: ${err.message}`, {\n        variant: \"error\"\n      });\n      return false;\n    }\n  };\n\n  // Thêm useEffect mới để tự động khởi động lại camera khi không phát hiện khuôn mặt trong thời gian dài\n  useEffect(() => {\n    // Không làm gì nếu không bật chế độ tự động\n    if (!isAutoMode || !isCameraReady) return;\n\n    // Thời gian tối đa không phát hiện khuôn mặt trước khi thử khởi động lại camera (20 giây)\n    const MAX_NO_DETECTION_TIME = 20000;\n\n    // Kiểm tra thời gian từ lần phát hiện cuối cùng\n    const checkDetectionTimeout = () => {\n      const now = Date.now();\n      if (lastDetectionTime && now - lastDetectionTime > MAX_NO_DETECTION_TIME) {\n        console.log(\"[DEBUG] Quá lâu không phát hiện khuôn mặt, thử khởi động lại camera\");\n\n        // Tăng số lần thử lại và khởi động lại camera nếu chưa quá 3 lần\n        if (cameraRetryCount < 3) {\n          setCameraRetryCount(prev => prev + 1);\n          initDirectCamera();\n          enqueueSnackbar(\"Đang thử khởi động lại camera...\", {\n            variant: \"info\"\n          });\n        } else if (cameraRetryCount === 3) {\n          // Sau 3 lần thử, đưa ra gợi ý chi tiết hơn\n          setCameraRetryCount(prev => prev + 1);\n          enqueueSnackbar(\"Kiểm tra lại camera và ánh sáng. Có thể cần cấp lại quyền camera.\", {\n            variant: \"warning\",\n            autoHideDuration: 8000\n          });\n        }\n      }\n    };\n\n    // Thiết lập interval kiểm tra\n    const checkInterval = setInterval(checkDetectionTimeout, 10000);\n    return () => {\n      clearInterval(checkInterval);\n    };\n  }, [isAutoMode, isCameraReady, lastDetectionTime, cameraRetryCount, enqueueSnackbar, initDirectCamera]);\n\n  // Load các mô hình nhận diện khuôn mặt\n  const loadFaceRecognitionModels = async () => {\n    try {\n      const MODEL_URL = \"/models\";\n      console.log(\"Bắt đầu tải models từ:\", MODEL_URL);\n\n      // Thêm SsdMobilenetv1 vào danh sách models cần tải\n      const modelPromises = [faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL), faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL) // Thêm model SSD MobileNet\n      ];\n\n      // Kiểm tra xem các models đã được tải chưa\n      const modelStatuses = [faceapi.nets.tinyFaceDetector.isLoaded, faceapi.nets.faceLandmark68Net.isLoaded, faceapi.nets.faceRecognitionNet.isLoaded, faceapi.nets.ssdMobilenetv1.isLoaded // Kiểm tra SSD MobileNet đã tải chưa\n      ];\n      if (modelStatuses.every(status => status)) {\n        console.log(\"Các models đã được tải từ trước\");\n        dispatch(setModelLoaded(true));\n        return true;\n      }\n      await Promise.all(modelPromises);\n      console.log(\"Đã tải xong models thành công\");\n      dispatch(setModelLoaded(true));\n      enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\n        variant: \"success\"\n      });\n      return true;\n    } catch (error) {\n      console.error(\"Lỗi khi tải mô hình:\", error);\n      enqueueSnackbar(\"Không thể tải mô hình nhận diện\", {\n        variant: \"error\"\n      });\n      return false;\n    }\n  };\n\n  // Hàm kiểm tra và đảm bảo camera hoạt động\n  const ensureCameraIsWorking = () => {\n    var _webcamRef$current;\n    // Kiểm tra nếu camera chưa hoạt động và đã thử khởi động\n    if (!isCameraReady && cameraRetryCount === 0) {\n      console.log(\"[DEBUG] Camera chưa sẵn sàng, thử khởi động\");\n      setCameraRetryCount(1);\n      initDirectCamera();\n      return false;\n    }\n\n    // Kiểm tra stream của camera\n    const videoElement = isAutoMode ? videoRef.current : (_webcamRef$current = webcamRef.current) === null || _webcamRef$current === void 0 ? void 0 : _webcamRef$current.video;\n    if (!videoElement || !videoElement.srcObject || videoElement.readyState !== 4) {\n      console.log(\"[DEBUG] Video stream không hoạt động, thử khởi động lại camera\");\n      if (cameraRetryCount < 3) {\n        setCameraRetryCount(prev => prev + 1);\n        initDirectCamera();\n        return false;\n      }\n    }\n    return true;\n  };\n\n  // Cập nhật hàm handleDetectFaces để kiểm tra camera trước\n  const handleDetectFaces = async () => {\n    try {\n      var _webcamRef$current2;\n      // Đảm bảo camera hoạt động\n      if (!ensureCameraIsWorking()) {\n        return [];\n      }\n\n      // Kiểm tra model đã tải chưa\n      if (!isModelLoaded || !faceapi.nets.ssdMobilenetv1.isLoaded) {\n        console.warn(\"Model SSD MobileNet chưa được tải, đang thử tải lại...\");\n        await loadFaceRecognitionModels();\n        if (!faceapi.nets.ssdMobilenetv1.isLoaded) {\n          enqueueSnackbar(\"Model nhận dạng chưa sẵn sàng, vui lòng thử lại\", {\n            variant: \"warning\"\n          });\n          return [];\n        }\n      }\n\n      // Lấy dữ liệu video\n      const videoElement = isAutoMode ? videoRef.current : (_webcamRef$current2 = webcamRef.current) === null || _webcamRef$current2 === void 0 ? void 0 : _webcamRef$current2.video;\n      if (!videoElement || !canvasRef.current) return [];\n\n      // Kiểm tra trạng thái video stream\n      if (videoElement.readyState !== 4) {\n        console.warn(\"Video element không sẵn sàng, đang đợi...\");\n        return [];\n      }\n\n      // Lấy kích thước của video\n      const displaySize = {\n        width: videoElement.videoWidth || videoElement.width || 640,\n        height: videoElement.videoHeight || videoElement.height || 480\n      };\n\n      // Thử phát hiện với cả hai mô hình\n      let detections = [];\n\n      // Thử với SSD MobileNet trước (độ chính xác cao hơn)\n      try {\n        detections = await faceapi.detectAllFaces(videoElement, new faceapi.SsdMobilenetv1Options({\n          minConfidence: DETECTION_THRESHOLD\n        })).withFaceLandmarks().withFaceDescriptors();\n      } catch (err) {\n        console.warn(\"Lỗi khi sử dụng SSD MobileNet:\", err);\n      }\n\n      // Nếu không phát hiện được, thử với TinyFaceDetector\n      if (!detections || detections.length === 0) {\n        try {\n          detections = await faceapi.detectAllFaces(videoElement, new faceapi.TinyFaceDetectorOptions({\n            inputSize: 320,\n            scoreThreshold: DETECTION_THRESHOLD - 0.05 // Giảm ngưỡng thêm nữa\n          })).withFaceLandmarks().withFaceDescriptors();\n        } catch (err) {\n          console.warn(\"Lỗi khi sử dụng TinyFaceDetector:\", err);\n        }\n      }\n      if (!detections || detections.length === 0) {\n        if (ENABLE_DEBUG_LOGS) {\n          console.log(\"[DEBUG] Không phát hiện khuôn mặt - kiểm tra ánh sáng và vị trí\", new Date().toLocaleTimeString());\n        }\n\n        // Xóa canvas nếu không có phát hiện\n        const canvasElement = canvasRef.current;\n        if (canvasElement) {\n          const ctx = canvasElement.getContext(\"2d\");\n          ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n\n          // Vẽ hướng dẫn khi không có khuôn mặt\n          ctx.font = \"18px Arial\";\n          ctx.fillStyle = \"white\";\n          ctx.strokeStyle = \"black\";\n          ctx.lineWidth = 3;\n          const text = \"Không phát hiện khuôn mặt - Điều chỉnh vị trí và ánh sáng\";\n          const x = canvasElement.width / 2 - 180;\n          const y = canvasElement.height / 2;\n          ctx.strokeText(text, x, y);\n          ctx.fillText(text, x, y);\n        }\n        return [];\n      }\n\n      // Đã phát hiện khuôn mặt, cập nhật thời gian\n      setLastDetectionTime(Date.now());\n      // Reset biến đếm thử lại\n      if (cameraRetryCount > 0) {\n        setCameraRetryCount(0);\n      }\n      if (ENABLE_DEBUG_LOGS) {\n        console.log(`[DEBUG] Phát hiện ${detections.length} khuôn mặt`, new Date().toLocaleTimeString());\n      }\n\n      // Điều chỉnh kích thước phát hiện để phù hợp với kích thước hiển thị\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n\n      // Cập nhật state\n      dispatch(setDetectedFaces(resizedDetections));\n\n      // Tạo FaceMatcher từ dữ liệu sinh viên\n      const labeledDescriptors = classStudents.filter(student => {\n        // Kiểm tra nếu có faceFeatures\n        if (student.faceFeatures && student.faceFeatures.descriptors && Array.isArray(student.faceFeatures.descriptors) && student.faceFeatures.descriptors.length > 0) {\n          return true;\n        }\n\n        // Kiểm tra nếu có faceDescriptors (cấu trúc cũ)\n        if (student.faceDescriptors && Array.isArray(student.faceDescriptors) && student.faceDescriptors.length > 0) {\n          return true;\n        }\n        return false;\n      }).map(student => {\n        try {\n          const allDescriptors = [];\n\n          // Xử lý cấu trúc faceFeatures.descriptors\n          if (student.faceFeatures && student.faceFeatures.descriptors && Array.isArray(student.faceFeatures.descriptors)) {\n            // Áp dụng cho cấu trúc dữ liệu mới: student.faceFeatures.descriptors là mảng các mảng descriptor\n            student.faceFeatures.descriptors.forEach(descriptorGroup => {\n              if (Array.isArray(descriptorGroup) && descriptorGroup.length > 0) {\n                // Chuyển từng descriptor thành Float32Array\n                descriptorGroup.forEach(descriptor => {\n                  if (Array.isArray(descriptor) && descriptor.length === 128) {\n                    allDescriptors.push(new Float32Array(descriptor));\n                  }\n                });\n              }\n            });\n          }\n\n          // Xử lý cấu trúc faceDescriptors (cũ)\n          if (student.faceDescriptors && Array.isArray(student.faceDescriptors) && student.faceDescriptors.length > 0) {\n            if (typeof student.faceDescriptors[0] === \"object\") {\n              // Nếu là object, kiểm tra nếu có descriptors bên trong\n              if (student.faceDescriptors[0].descriptors && Array.isArray(student.faceDescriptors[0].descriptors)) {\n                // Xử lý descriptors bên trong object\n                student.faceDescriptors[0].descriptors.forEach(descriptor => {\n                  if (Array.isArray(descriptor) && descriptor.length === 128) {\n                    allDescriptors.push(new Float32Array(descriptor));\n                  }\n                });\n              } else {\n                // Duyệt các thuộc tính của object\n                Object.keys(student.faceDescriptors[0]).forEach(key => {\n                  const value = student.faceDescriptors[0][key];\n                  if (Array.isArray(value) && value.length === 128) {\n                    allDescriptors.push(new Float32Array(value));\n                  }\n                });\n              }\n            } else {\n              // Xử lý thông thường\n              student.faceDescriptors.forEach(descriptor => {\n                if (Array.isArray(descriptor) && descriptor.length === 128) {\n                  allDescriptors.push(new Float32Array(descriptor));\n                }\n              });\n            }\n          }\n          if (allDescriptors.length === 0) {\n            console.log(`[DEBUG] Không thể tạo descriptor cho sinh viên ${student.full_name}`);\n            return null;\n          }\n          console.log(`[DEBUG] Đã tạo ${allDescriptors.length} descriptors cho sinh viên ${student.full_name}`);\n          return new faceapi.LabeledFaceDescriptors(student._id, allDescriptors);\n        } catch (err) {\n          console.error(`Lỗi khi xử lý descriptor của sinh viên ${student._id}:`, err);\n          return null;\n        }\n      }).filter(Boolean); // Lọc bỏ các giá trị null\n\n      // Tạo faceMatcher nếu có dữ liệu\n      if (labeledDescriptors.length === 0) {\n        console.warn(\"Không có dữ liệu khuôn mặt hợp lệ của sinh viên\");\n        return resizedDetections;\n      }\n      console.log(`[DEBUG] Tạo FaceMatcher với ${labeledDescriptors.length} sinh viên`);\n\n      // Tạo faceMatcher với descriptor đã được xác thực\n      const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, RECOGNITION_THRESHOLD);\n\n      // Vẽ lên canvas nếu có khuôn mặt\n      const canvasElement = canvasRef.current;\n      // Đặt kích thước canvas chính xác bằng với kích thước thực của video\n      canvasElement.width = displaySize.width;\n      canvasElement.height = displaySize.height;\n\n      // Đảm bảo đồng bộ kích thước canvas với video\n      faceapi.matchDimensions(canvasElement, displaySize);\n      const ctx = canvasElement.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);\n\n      // Vẽ các phát hiện lên canvas\n      resizedDetections.forEach(detection => {\n        try {\n          if (detection.descriptor && detection.descriptor.length === 128) {\n            const bestMatch = faceMatcher.findBestMatch(detection.descriptor);\n            const {\n              label,\n              distance\n            } = bestMatch;\n\n            // Kiểm tra nếu match với một sinh viên\n            if (label !== \"unknown\") {\n              // Tìm sinh viên trong danh sách\n              const student = classStudents.find(s => s._id === label);\n              if (student) {\n                // Cập nhật thông tin nhận diện cho sinh viên\n                const studentId = student._id;\n                const confidence = 1 - distance;\n\n                // Đánh dấu sinh viên đã điểm danh nếu đủ độ tin cậy\n                if (confidence >= CONFIDENCE_THRESHOLD) {\n                  handleMarkAttendance(studentId, confidence);\n                }\n\n                // Vẽ hộp và tên sinh viên\n                const drawBox = new faceapi.draw.DrawBox(detection.detection.box, {\n                  label: `${student.full_name} (${Math.round(confidence * 100)}%)`,\n                  boxColor: confidence >= CONFIDENCE_THRESHOLD ? \"green\" : \"orange\"\n                });\n                drawBox.draw(canvasElement);\n              }\n            } else {\n              // Không nhận diện được sinh viên\n              const drawBox = new faceapi.draw.DrawBox(detection.detection.box, {\n                label: \"Unknown\",\n                boxColor: \"red\"\n              });\n              drawBox.draw(canvasElement);\n            }\n          } else {\n            // Nếu descriptor không hợp lệ hoặc độ dài không đúng\n            console.warn(\"Phát hiện descriptor không hợp lệ\", detection.descriptor ? detection.descriptor.length : \"không có descriptor\");\n\n            // Không có descriptor\n            const drawBox = new faceapi.draw.DrawBox(detection.detection.box, {\n              label: \"Đang phân tích...\",\n              boxColor: \"blue\"\n            });\n            drawBox.draw(canvasElement);\n          }\n        } catch (err) {\n          console.error(\"Lỗi khi xử lý detection:\", err);\n        }\n\n        // Vẽ landmarks nếu đã bật\n        if (showLandmark && detection.landmarks) {\n          faceapi.draw.drawFaceLandmarks(canvasElement, detection);\n        }\n      });\n      return resizedDetections;\n    } catch (error) {\n      console.error(\"Lỗi phát hiện khuôn mặt:\", error);\n      enqueueSnackbar(\"Lỗi khi phát hiện khuôn mặt. Thử lại sau.\", {\n        variant: \"error\"\n      });\n      return [];\n    }\n  };\n\n  // Điểm danh thủ công\n  const openManualAttendanceDialog = student => {\n    setSelectedStudent(student);\n    setManualAttendanceData({\n      status: \"present\",\n      note: \"\"\n    });\n    setManualDialogOpen(true);\n  };\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n  };\n  const handleManualAttendanceChange = e => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value\n    });\n  };\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent) return;\n    try {\n      const result = await dispatch(manualAttendance({\n        sessionId,\n        studentId: selectedStudent._id,\n        status: manualAttendanceData.status,\n        note: manualAttendanceData.note\n      })).unwrap();\n\n      // Cập nhật logs điểm danh\n      if (result && result.data) {\n        const updatedLogs = attendanceLogs.filter(log => log.student_id._id !== selectedStudent._id);\n        updatedLogs.push({\n          ...result.data,\n          student_id: selectedStudent\n        });\n        setAttendanceLogs(updatedLogs);\n      }\n      enqueueSnackbar(\"Điểm danh thủ công thành công\", {\n        variant: \"success\"\n      });\n      handleManualDialogClose();\n\n      // Cập nhật lại thông tin phiên điểm danh\n      const sessionResponse = await axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setSessionInfo(sessionResponse.data.data);\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(\"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Đánh dấu điểm danh từ nhận diện khuôn mặt\n  const markAttendance = async (studentId, faceDescriptor, confidence, imageBase64) => {\n    try {\n      const result = await dispatch(verifyAttendance({\n        sessionId,\n        studentId,\n        faceDescriptor,\n        confidence,\n        imageBase64\n      })).unwrap();\n\n      // Cập nhật logs điểm danh\n      if (result && result.data) {\n        const student = classStudents.find(s => s._id === studentId);\n        if (student) {\n          const updatedLogs = attendanceLogs.filter(log => log.student_id._id !== studentId);\n          updatedLogs.push({\n            ...result.data,\n            student_id: student\n          });\n          setAttendanceLogs(updatedLogs);\n          enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n            variant: \"success\"\n          });\n        }\n      }\n\n      // Cập nhật lại thông tin phiên điểm danh\n      const sessionResponse = await axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setSessionInfo(sessionResponse.data.data);\n      return true;\n    } catch (error) {\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n      enqueueSnackbar(\"Lỗi khi xác nhận điểm danh\", {\n        variant: \"error\"\n      });\n      return false;\n    }\n  };\n\n  // Kết thúc phiên điểm danh\n  const completeSession = async () => {\n    try {\n      await axios.put(`${API_URL}/attendance/sessions/${sessionId}`, {\n        status: \"completed\"\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", {\n        variant: \"success\"\n      });\n      navigate(`/teacher/classes/${classId}`);\n    } catch (error) {\n      console.error(\"Lỗi khi kết thúc phiên điểm danh:\", error);\n      enqueueSnackbar(\"Lỗi khi kết thúc phiên điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Làm mới danh sách điểm danh\n  const refreshAttendanceLogs = async () => {\n    try {\n      const logsResponse = await axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setAttendanceLogs(logsResponse.data.data);\n      const sessionResponse = await axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      setSessionInfo(sessionResponse.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu điểm danh\", {\n        variant: \"success\"\n      });\n    } catch (error) {\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(\"Lỗi khi làm mới dữ liệu\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Chụp ảnh và nhận diện thủ công\n  const captureAndRecognize = async () => {\n    await handleDetectFaces();\n  };\n\n  // Xử lý đánh dấu sinh viên điểm danh\n  const handleMarkAttendance = async (studentId, confidence) => {\n    // Kiểm tra xem sinh viên đã được điểm danh chưa\n    const isAlreadyAttended = attendanceLogs.some(log => log.student_id._id === studentId && log.status === \"present\");\n    if (isAlreadyAttended) {\n      if (ENABLE_DEBUG_LOGS) {\n        console.log(`[DEBUG] Sinh viên ${studentId} đã được điểm danh trước đó`);\n      }\n      return;\n    }\n    try {\n      var _webcamRef$current3;\n      // Lấy dữ liệu video\n      const videoElement = isAutoMode ? videoRef.current : (_webcamRef$current3 = webcamRef.current) === null || _webcamRef$current3 === void 0 ? void 0 : _webcamRef$current3.video;\n      if (!videoElement) return;\n\n      // Tạo ảnh chụp từ video element\n      let imageBase64 = null;\n\n      // Nếu sử dụng webcam component\n      if (!isAutoMode && webcamRef.current) {\n        imageBase64 = webcamRef.current.getScreenshot();\n      }\n      // Nếu sử dụng video element trực tiếp\n      else if (isAutoMode) {\n        const canvas = document.createElement(\"canvas\");\n        canvas.width = videoElement.videoWidth;\n        canvas.height = videoElement.videoHeight;\n        const ctx = canvas.getContext(\"2d\");\n        ctx.drawImage(videoElement, 0, 0);\n        imageBase64 = canvas.toDataURL(\"image/jpeg\");\n      }\n\n      // Tìm sinh viên đã được phát hiện\n      const student = classStudents.find(s => s._id === studentId);\n      if (!student) {\n        console.error(`Không tìm thấy sinh viên với ID ${studentId}`);\n        return;\n      }\n\n      // Lấy descriptor mới nhất từ sinh viên\n      let descriptor = null;\n\n      // Kiểm tra và lấy descriptor từ các cấu trúc khác nhau\n      if (student.faceFeatures && student.faceFeatures.descriptors && Array.isArray(student.faceFeatures.descriptors) && student.faceFeatures.descriptors.length > 0) {\n        // Lấy từ cấu trúc mới\n        if (Array.isArray(student.faceFeatures.descriptors[0])) {\n          descriptor = student.faceFeatures.descriptors[0];\n        } else if (Array.isArray(student.faceFeatures.descriptors[0][0])) {\n          descriptor = student.faceFeatures.descriptors[0][0];\n        }\n      } else if (student.faceDescriptors && Array.isArray(student.faceDescriptors) && student.faceDescriptors.length > 0) {\n        // Lấy từ cấu trúc cũ\n        if (typeof student.faceDescriptors[0] === \"object\") {\n          if (student.faceDescriptors[0].descriptors && Array.isArray(student.faceDescriptors[0].descriptors) && student.faceDescriptors[0].descriptors.length > 0) {\n            descriptor = student.faceDescriptors[0].descriptors[0];\n          } else {\n            // Tìm mảng 128 phần tử đầu tiên trong object\n            Object.keys(student.faceDescriptors[0]).forEach(key => {\n              const value = student.faceDescriptors[0][key];\n              if (!descriptor && Array.isArray(value) && value.length === 128) {\n                descriptor = value;\n              }\n            });\n          }\n        } else if (Array.isArray(student.faceDescriptors[0]) && student.faceDescriptors[0].length === 128) {\n          descriptor = student.faceDescriptors[0];\n        }\n      }\n\n      // Gọi API điểm danh\n      if (ENABLE_DEBUG_LOGS) {\n        console.log(`[DEBUG] Đánh dấu điểm danh cho ${student.full_name} với độ tin cậy ${confidence.toFixed(2)}`);\n      }\n\n      // Gọi hàm điểm danh\n      await markAttendance(studentId, descriptor, confidence, imageBase64);\n    } catch (error) {\n      console.error(\"Lỗi khi đánh dấu điểm danh:\", error);\n    }\n  };\n\n  // Bật/tắt hiển thị landmark trên khuôn mặt\n  const toggleLandmarkDetection = () => {\n    const newState = !showLandmark;\n    setShowLandmark(newState);\n\n    // Vẽ lại detection với landmark mới nếu có khuôn mặt\n    if (detectedFaces && detectedFaces.length > 0) {\n      handleDetectFaces();\n    }\n  };\n\n  // Thêm hàm debug để kiểm tra cấu trúc dữ liệu khuôn mặt\n  const debugFaceFeatures = () => {\n    if (!classStudents || classStudents.length === 0) {\n      console.log(\"[DEBUG] Không có sinh viên nào để kiểm tra dữ liệu khuôn mặt\");\n      return;\n    }\n    classStudents.forEach((student, index) => {\n      console.log(`[DEBUG] Sinh viên #${index + 1}: ${student.full_name}`);\n\n      // Kiểm tra dữ liệu faceFeatures\n      if (student.faceFeatures) {\n        console.log(`  - Có dữ liệu faceFeatures`);\n\n        // Kiểm tra descriptors\n        if (student.faceFeatures.descriptors) {\n          console.log(`  - Có descriptors: ${student.faceFeatures.descriptors.length} nhóm`);\n          student.faceFeatures.descriptors.forEach((group, groupIndex) => {\n            if (Array.isArray(group)) {\n              console.log(`    - Nhóm #${groupIndex + 1}: ${group.length} descriptors`);\n              group.forEach((descriptor, descIndex) => {\n                if (Array.isArray(descriptor)) {\n                  console.log(`      - Descriptor #${descIndex + 1}: ${descriptor.length} phần tử`);\n                } else {\n                  console.log(`      - Descriptor #${descIndex + 1}: Không phải mảng`);\n                }\n              });\n            } else {\n              console.log(`    - Nhóm #${groupIndex + 1}: Không phải mảng`);\n            }\n          });\n        } else {\n          console.log(`  - Không có dữ liệu descriptors`);\n        }\n      } else {\n        console.log(`  - Không có dữ liệu faceFeatures`);\n      }\n\n      // Kiểm tra dữ liệu cũ (faceDescriptors)\n      if (student.faceDescriptors) {\n        console.log(`  - Có dữ liệu faceDescriptors (cấu trúc cũ): ${student.faceDescriptors.length} descriptors`);\n      }\n    });\n  };\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      minHeight: \"60vh\",\n      children: /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1468,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1462,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Lấy danh sách sinh viên vắng mặt\n  const getAbsentStudents = () => {\n    if (!classInfo || !sessionInfo) return [];\n    const presentStudentIds = attendanceLogs.filter(log => log.status === \"present\").map(log => log.student_id._id);\n    return classInfo.students.filter(student => !presentStudentIds.includes(student._id));\n  };\n  const absentStudents = getAbsentStudents();\n\n  // Điểm danh thủ công trong chế độ đơn giản\n  const showStudentList = () => {\n    if (!classInfo) return;\n\n    // Hiển thị danh sách sinh viên để điểm danh thủ công\n    const absentStudents = getAbsentStudents();\n    if (absentStudents.length === 0) {\n      enqueueSnackbar(\"Tất cả sinh viên đã được điểm danh\", {\n        variant: \"success\"\n      });\n      return;\n    }\n\n    // Hiển thị dialog chọn sinh viên để điểm danh\n    if (absentStudents.length > 0 && absentStudents[0]) {\n      openManualAttendanceDialog(absentStudents[0]);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    children: [/*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h5\",\n      gutterBottom: true,\n      children: [\"\\u0110i\\u1EC3m Danh - \", classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1509,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"subtitle1\",\n      color: \"textSecondary\",\n      gutterBottom: true,\n      children: [\"Bu\\u1ED5i \", sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.session_number, \" -\", \" \", new Date(sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.date).toLocaleDateString(\"vi-VN\")]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1512,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 3,\n      mt: 1,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 8,\n        children: /*#__PURE__*/_jsxDEV(Card, {\n          children: [/*#__PURE__*/_jsxDEV(CardContent, {\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 2,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Camera nh\\u1EADn di\\u1EC7n\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1527,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                children: [/*#__PURE__*/_jsxDEV(Chip, {\n                  label: isAutoMode ? \"Tự động đang bật\" : \"Tự động đang tắt\",\n                  color: isAutoMode ? \"success\" : \"default\",\n                  sx: {\n                    mr: 1\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1529,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outlined\",\n                  color: isAutoMode ? \"error\" : \"primary\",\n                  onClick: isAutoMode ? () => {\n                    // Dừng tự động\n                    if (intervalId) {\n                      clearInterval(intervalId);\n                      setIntervalId(null);\n                    }\n                    setIsAutoMode(false);\n                    enqueueSnackbar(\"Đã tắt chế độ tự động điểm danh\", {\n                      variant: \"info\"\n                    });\n                  } : () => {\n                    // Bắt đầu tự động\n                    if (intervalId) {\n                      clearInterval(intervalId);\n                    }\n                    // Khởi tạo thời gian phát hiện ban đầu\n                    setLastDetectionTime(Date.now());\n                    const id = setInterval(() => {\n                      handleDetectFaces();\n                    }, AUTO_DETECT_INTERVAL);\n                    setIntervalId(id);\n                    setIsAutoMode(true);\n                    enqueueSnackbar(\"Đã bật chế độ tự động điểm danh\", {\n                      variant: \"info\"\n                    });\n                  },\n                  children: isAutoMode ? \"Tắt tự động\" : \"Bật tự động\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1534,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1528,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1521,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1520,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Paper, {\n            elevation: 3,\n            sx: {\n              position: \"relative\",\n              width: \"100%\",\n              height: \"400px\",\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\",\n              overflow: \"hidden\",\n              mb: 2\n            },\n            children: isCameraReady ? /*#__PURE__*/_jsxDEV(_Fragment, {\n              children: [isAutoMode ?\n              /*#__PURE__*/\n              // Sử dụng video element trực tiếp thay vì Webcam component\n              _jsxDEV(\"video\", {\n                ref: videoRef,\n                style: {\n                  position: \"absolute\",\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\"\n                },\n                autoPlay: true,\n                playsInline: true,\n                muted: true\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1591,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(Webcam, {\n                audio: false,\n                ref: webcamRef,\n                screenshotFormat: \"image/jpeg\",\n                width: 640,\n                height: 480,\n                videoConstraints: {\n                  width: 640,\n                  height: 480,\n                  facingMode: \"user\"\n                },\n                style: {\n                  position: \"absolute\",\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\"\n                },\n                onUserMedia: stream => {\n                  console.log(\"Camera đã được cấp quyền và khởi tạo\", stream.id);\n                  // Đảm bảo readyState được kiểm tra khi stream đã sẵn sàng\n                  setTimeout(() => {\n                    if (webcamRef.current && webcamRef.current.video) {\n                      console.log(\"Stream ready, readyState=\", webcamRef.current.video.readyState);\n                      dispatch(setCameraReady(true));\n                      // Đặt thời gian phát hiện ban đầu\n                      setLastDetectionTime(Date.now());\n                    }\n                  }, 500);\n                },\n                onUserMediaError: err => {\n                  console.error(\"Lỗi khi truy cập camera:\", err);\n                  enqueueSnackbar(`Không thể truy cập camera: ${err.name === \"NotAllowedError\" ? \"Bạn chưa cấp quyền truy cập camera\" : err.name === \"NotFoundError\" ? \"Không tìm thấy thiết bị camera\" : err.message || \"Lỗi không xác định\"}`, {\n                    variant: \"error\"\n                  });\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1604,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(\"canvas\", {\n                ref: canvasRef,\n                style: {\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\",\n                  zIndex: 10\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1657,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true) : /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              flexDirection: \"column\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 50\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1672,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                mt: 2,\n                children: \"\\u0110ang kh\\u1EDFi t\\u1EA1o camera...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1673,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"caption\",\n                color: \"text.secondary\",\n                sx: {\n                  mt: 1\n                },\n                children: isModelLoaded ? \"Chờ kết nối camera - Hãy đảm bảo bạn đã cấp quyền camera\" : \"Đang tải mô hình nhận diện khuôn mặt\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1674,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mt: 2,\n                  display: \"flex\",\n                  flexDirection: \"column\",\n                  alignItems: \"center\",\n                  gap: 1\n                },\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"contained\",\n                  color: \"primary\",\n                  size: \"small\",\n                  onClick: initDirectCamera,\n                  children: \"Kh\\u1EDFi \\u0111\\u1ED9ng camera tr\\u1EF1c ti\\u1EBFp\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1693,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outlined\",\n                  color: \"secondary\",\n                  size: \"small\",\n                  onClick: () => {\n                    setIsAutoMode(true);\n                    // Khởi tạo thời gian phát hiện ban đầu\n                    setLastDetectionTime(Date.now());\n                    const id = setInterval(() => {\n                      handleDetectFaces();\n                    }, AUTO_DETECT_INTERVAL);\n                    setIntervalId(id);\n                    enqueueSnackbar(\"Đã bật tự động điểm danh\", {\n                      variant: \"info\"\n                    });\n                  },\n                  children: \"B\\u1EAFt \\u0111\\u1EA7u t\\u1EF1 \\u0111\\u1ED9ng \\u0111i\\u1EC3m danh\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1702,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outlined\",\n                  color: \"warning\",\n                  size: \"small\",\n                  onClick: showStudentList,\n                  children: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1722,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Alert, {\n                  severity: \"info\",\n                  sx: {\n                    mt: 2,\n                    maxWidth: 300\n                  },\n                  children: [\"N\\u1EBFu camera kh\\xF4ng ho\\u1EA1t \\u0111\\u1ED9ng, vui l\\xF2ng th\\u1EED:\", /*#__PURE__*/_jsxDEV(\"ul\", {\n                    style: {\n                      margin: \"8px 0\",\n                      paddingLeft: \"20px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(\"li\", {\n                      children: \"Ki\\u1EC3m tra quy\\u1EC1n camera tr\\xEAn tr\\xECnh duy\\u1EC7t\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1734,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n                      children: \"L\\xE0m m\\u1EDBi trang v\\xE0 th\\u1EED l\\u1EA1i\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1735,\n                      columnNumber: 25\n                    }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n                      children: \"\\u0110\\u1EA3m b\\u1EA3o kh\\xF4ng c\\xF3 \\u1EE9ng d\\u1EE5ng kh\\xE1c \\u0111ang s\\u1EED d\\u1EE5ng camera\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1736,\n                      columnNumber: 25\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1733,\n                    columnNumber: 23\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1731,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1684,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1671,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1574,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"outlined\",\n              onClick: captureAndRecognize,\n              startIcon: /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1750,\n                columnNumber: 28\n              }, this),\n              disabled: !isCameraReady || isRecognizing || isAutoMode,\n              children: isRecognizing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 24,\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1754,\n                columnNumber: 19\n              }, this) : \"Chụp & Nhận diện\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1747,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              children: [isCameraReady && /*#__PURE__*/_jsxDEV(_Fragment, {\n                children: [/*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outlined\",\n                  color: showLandmark ? \"success\" : \"info\",\n                  onClick: toggleLandmarkDetection,\n                  sx: {\n                    mr: 1\n                  },\n                  children: showLandmark ? \"Tắt Landmark\" : \"Hiện Landmark\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1763,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(Button, {\n                  variant: \"outlined\",\n                  color: isAutoMode ? \"error\" : \"primary\",\n                  onClick: () => {\n                    // Dừng tự động\n                    if (intervalId) {\n                      clearInterval(intervalId);\n                      setIntervalId(null);\n                    }\n                    setIsAutoMode(false);\n                    enqueueSnackbar(\"Đã tắt chế độ tự động điểm danh\", {\n                      variant: \"info\"\n                    });\n                  },\n                  sx: {\n                    mr: 1\n                  },\n                  children: isAutoMode ? \"Tắt tự động\" : \"Bật tự động\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1772,\n                  columnNumber: 21\n                }, this)]\n              }, void 0, true), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"contained\",\n                color: \"primary\",\n                onClick: completeSession,\n                startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1797,\n                  columnNumber: 30\n                }, this),\n                disabled: (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) === \"completed\",\n                children: \"K\\u1EBFt th\\xFAc phi\\xEAn\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1793,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1760,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1746,\n            columnNumber: 13\n          }, this), recognizedStudents.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n            mt: 2,\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              gutterBottom: true,\n              children: [\"\\u0110\\xE3 nh\\u1EADn di\\u1EC7n (\", recognizedStudents.length, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1807,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacing: 1,\n              children: recognizedStudents.map((student, index) => /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 6,\n                sm: 4,\n                children: /*#__PURE__*/_jsxDEV(Paper, {\n                  elevation: 2,\n                  sx: {\n                    p: 1,\n                    display: \"flex\",\n                    flexDirection: \"column\",\n                    alignItems: \"center\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"body2\",\n                    noWrap: true,\n                    children: student.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1822,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"caption\",\n                    color: \"textSecondary\",\n                    children: [Math.round(student.confidence * 100), \"% match\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1825,\n                    columnNumber: 25\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    size: \"small\",\n                    variant: \"outlined\",\n                    color: \"primary\",\n                    sx: {\n                      mt: 1\n                    },\n                    onClick: () => handleMarkAttendance(student.studentId, student.confidence),\n                    children: [/*#__PURE__*/_jsxDEV(Check, {\n                      fontSize: \"small\",\n                      sx: {\n                        mr: 0.5\n                      }\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1840,\n                      columnNumber: 27\n                    }, this), \"\\u0110i\\u1EC3m danh\"]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1828,\n                    columnNumber: 25\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1813,\n                  columnNumber: 23\n                }, this)\n              }, index, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1812,\n                columnNumber: 21\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1810,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1806,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1519,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1518,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 4,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mb: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 2,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: [\"C\\xF3 m\\u1EB7t (\", attendanceLogs.filter(log => log.status === \"present\").length, \"/\", classInfo === null || classInfo === void 0 ? void 0 : classInfo.students.length, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1861,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(IconButton, {\n                size: \"small\",\n                onClick: refreshAttendanceLogs,\n                children: /*#__PURE__*/_jsxDEV(Refresh, {}, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1870,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1869,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1855,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(List, {\n              dense: true,\n              children: [attendanceLogs.filter(log => log.status === \"present\").sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)).map(log => /*#__PURE__*/_jsxDEV(ListItem, {\n                secondaryAction: /*#__PURE__*/_jsxDEV(Chip, {\n                  size: \"small\",\n                  icon: log.recognized ? /*#__PURE__*/_jsxDEV(VerifiedUser, {\n                    fontSize: \"small\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1886,\n                    columnNumber: 31\n                  }, this) : null,\n                  label: log.recognized ? \"Tự động\" : \"Thủ công\",\n                  color: log.recognized ? \"success\" : \"primary\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1882,\n                  columnNumber: 25\n                }, this),\n                children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                  children: /*#__PURE__*/_jsxDEV(Avatar, {\n                    alt: log.student_id.full_name,\n                    src: log.student_id.avatar_url\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1895,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1894,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                  primary: log.student_id.full_name,\n                  secondary: `${new Date(log.timestamp).toLocaleTimeString(\"vi-VN\")}`\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1900,\n                  columnNumber: 23\n                }, this)]\n              }, log._id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1879,\n                columnNumber: 21\n              }, this)), attendanceLogs.filter(log => log.status === \"present\").length === 0 && /*#__PURE__*/_jsxDEV(ListItem, {\n                children: /*#__PURE__*/_jsxDEV(ListItemText, {\n                  primary: \"Ch\\u01B0a c\\xF3 sinh vi\\xEAn n\\xE0o \\u0111i\\u1EC3m danh\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1912,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1911,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1874,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1854,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1853,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Card, {\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h6\",\n              gutterBottom: true,\n              children: [\"V\\u1EAFng m\\u1EB7t (\", absentStudents.length, \"/\", classInfo === null || classInfo === void 0 ? void 0 : classInfo.students.length, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1921,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(List, {\n              dense: true,\n              children: [absentStudents.map(student => /*#__PURE__*/_jsxDEV(ListItem, {\n                secondaryAction: /*#__PURE__*/_jsxDEV(IconButton, {\n                  edge: \"end\",\n                  onClick: () => openManualAttendanceDialog(student),\n                  children: /*#__PURE__*/_jsxDEV(Edit, {\n                    fontSize: \"small\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1934,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1930,\n                  columnNumber: 23\n                }, this),\n                children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                  children: /*#__PURE__*/_jsxDEV(Avatar, {\n                    alt: student.full_name,\n                    src: student.avatar_url\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1939,\n                    columnNumber: 23\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1938,\n                  columnNumber: 21\n                }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                  primary: student.full_name,\n                  secondary: student.student_code\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1944,\n                  columnNumber: 21\n                }, this)]\n              }, student._id, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1927,\n                columnNumber: 19\n              }, this)), absentStudents.length === 0 && /*#__PURE__*/_jsxDEV(ListItem, {\n                children: /*#__PURE__*/_jsxDEV(ListItemText, {\n                  primary: \"Kh\\xF4ng c\\xF3 sinh vi\\xEAn n\\xE0o v\\u1EAFng m\\u1EB7t\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1953,\n                  columnNumber: 21\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1952,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1925,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1920,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1919,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1852,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1517,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: manualDialogOpen,\n      onClose: handleManualDialogClose,\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1964,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: /*#__PURE__*/_jsxDEV(Box, {\n          sx: {\n            p: 1\n          },\n          children: [/*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"subtitle1\",\n            gutterBottom: true,\n            children: [selectedStudent === null || selectedStudent === void 0 ? void 0 : selectedStudent.full_name, \" (\", selectedStudent === null || selectedStudent === void 0 ? void 0 : selectedStudent.student_code, \")\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1967,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(FormControl, {\n            fullWidth: true,\n            margin: \"normal\",\n            children: [/*#__PURE__*/_jsxDEV(InputLabel, {\n              children: \"Tr\\u1EA1ng th\\xE1i\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1972,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Select, {\n              name: \"status\",\n              value: manualAttendanceData.status,\n              onChange: handleManualAttendanceChange,\n              label: \"Tr\\u1EA1ng th\\xE1i\",\n              children: [/*#__PURE__*/_jsxDEV(MenuItem, {\n                value: \"present\",\n                children: \"C\\xF3 m\\u1EB7t\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1979,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n                value: \"absent\",\n                children: \"V\\u1EAFng m\\u1EB7t\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1980,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n                value: \"late\",\n                children: \"\\u0110i tr\\u1EC5\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1981,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(MenuItem, {\n                value: \"early_leave\",\n                children: \"V\\u1EC1 s\\u1EDBm\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1982,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1973,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1971,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextField, {\n            fullWidth: true,\n            margin: \"normal\",\n            name: \"note\",\n            label: \"Ghi ch\\xFA\",\n            value: manualAttendanceData.note,\n            onChange: handleManualAttendanceChange,\n            multiline: true,\n            rows: 2\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 1986,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 1966,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1965,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualDialogClose,\n          children: \"H\\u1EE7y\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1999,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualAttendanceSubmit,\n          variant: \"contained\",\n          children: \"X\\xE1c nh\\u1EADn\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 2000,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1998,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1963,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 1508,\n    columnNumber: 5\n  }, this);\n};\n_s(AttendancePage, \"yZIALv0P3rMmS2vno41KPOgqt38=\", false, function () {\n  return [useParams, useNavigate, useDispatch, useSnackbar, useSelector, useSelector];\n});\n_c = AttendancePage;\nexport default AttendancePage;\nvar _c;\n$RefreshReg$(_c, \"AttendancePage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useParams","useNavigate","useDispatch","useSelector","useSnackbar","Box","Typography","Card","CardContent","Grid","Paper","Button","Divider","CircularProgress","List","ListItem","ListItemAvatar","ListItemText","Avatar","Chip","Dialog","DialogTitle","DialogContent","DialogActions","TextField","FormControl","InputLabel","Select","MenuItem","IconButton","Alert","CameraAlt","Check","Close","Edit","Refresh","Save","VerifiedUser","HourglassEmpty","Webcam","faceapi","getClassFaceFeatures","verifyAttendance","manualAttendance","setModelLoaded","setCameraReady","setDetectedFaces","setRecognizedStudents","clearRecognitionState","axios","jsxDEV","_jsxDEV","Fragment","_Fragment","API_URL","process","env","REACT_APP_API_URL","AttendancePage","_s","classId","sessionId","navigate","dispatch","enqueueSnackbar","webcamRef","canvasRef","videoRef","intervalId","setIntervalId","showLandmark","setShowLandmark","landmarkIntervalId","setLandmarkIntervalId","token","state","auth","isModelLoaded","isCameraReady","detectedFaces","recognizedStudents","classStudents","isProcessing","error","faceRecognition","classInfo","setClassInfo","sessionInfo","setSessionInfo","attendanceLogs","setAttendanceLogs","isLoading","setIsLoading","isRecognizing","setIsRecognizing","isAutoMode","setIsAutoMode","selectedStudent","setSelectedStudent","manualDialogOpen","setManualDialogOpen","manualAttendanceData","setManualAttendanceData","status","note","RECOGNITION_THRESHOLD","DETECTION_THRESHOLD","CONFIDENCE_THRESHOLD","AUTO_DETECT_INTERVAL","ENABLE_DEBUG_LOGS","cameraRetryCount","setCameraRetryCount","lastDetectionTime","setLastDetectionTime","loadInitialData","loadModelsPromise","loadFaceRecognitionModels","Promise","resolve","classPromise","get","headers","Authorization","sessionPromise","logsPromise","classResponse","sessionResponse","logsResponse","all","data","console","log","faceDataResponse","faceFeatureResult","unwrap","JSON","stringify","studentsData","Array","isArray","length","students","validDescriptorsCount","invalidDescriptorsCount","forEach","student","full_name","_id","faceFeatures","hasDescriptors","descriptors","validDescriptorsInStudent","group","groupIndex","descriptor","descIndex","hasOldDescriptors","faceDescriptors","flatDescriptors","validOldDescriptors","filter","desc","foundArrays","Object","keys","key","value","push","potentialDescriptors","arr","variant","autoHideDuration","apiError","_apiError$response","response","message","Date","now","clearInterval","current","video","srcObject","tracks","getTracks","track","stop","initDirectCamera","nets","ssdMobilenetv1","isLoaded","modelLoaded","constraints","width","ideal","min","height","facingMode","frameRate","audio","stream","navigator","mediaDevices","getUserMedia","id","onloadedmetadata","play","catch","err","setTimeout","altStream","altErr","MAX_NO_DETECTION_TIME","checkDetectionTimeout","prev","checkInterval","setInterval","MODEL_URL","modelPromises","tinyFaceDetector","loadFromUri","faceLandmark68Net","faceRecognitionNet","modelStatuses","every","ensureCameraIsWorking","_webcamRef$current","videoElement","readyState","handleDetectFaces","_webcamRef$current2","warn","displaySize","videoWidth","videoHeight","detections","detectAllFaces","SsdMobilenetv1Options","minConfidence","withFaceLandmarks","withFaceDescriptors","TinyFaceDetectorOptions","inputSize","scoreThreshold","toLocaleTimeString","canvasElement","ctx","getContext","clearRect","font","fillStyle","strokeStyle","lineWidth","text","x","y","strokeText","fillText","resizedDetections","resizeResults","labeledDescriptors","map","allDescriptors","descriptorGroup","Float32Array","LabeledFaceDescriptors","Boolean","faceMatcher","FaceMatcher","matchDimensions","detection","bestMatch","findBestMatch","label","distance","find","s","studentId","confidence","handleMarkAttendance","drawBox","draw","DrawBox","box","Math","round","boxColor","landmarks","drawFaceLandmarks","openManualAttendanceDialog","handleManualDialogClose","handleManualAttendanceChange","e","target","name","handleManualAttendanceSubmit","result","updatedLogs","student_id","markAttendance","faceDescriptor","imageBase64","completeSession","put","refreshAttendanceLogs","captureAndRecognize","isAlreadyAttended","some","_webcamRef$current3","getScreenshot","canvas","document","createElement","drawImage","toDataURL","toFixed","toggleLandmarkDetection","newState","debugFaceFeatures","index","display","justifyContent","alignItems","minHeight","children","fileName","_jsxFileName","lineNumber","columnNumber","getAbsentStudents","presentStudentIds","includes","absentStudents","showStudentList","gutterBottom","class_name","color","session_number","date","toLocaleDateString","container","spacing","mt","item","xs","md","mb","sx","mr","onClick","elevation","position","overflow","ref","style","objectFit","autoPlay","playsInline","muted","screenshotFormat","videoConstraints","onUserMedia","onUserMediaError","top","left","zIndex","flexDirection","size","gap","severity","maxWidth","margin","paddingLeft","startIcon","disabled","sm","p","noWrap","fontSize","dense","sort","a","b","timestamp","secondaryAction","icon","recognized","alt","src","avatar_url","primary","secondary","edge","student_code","open","onClose","fullWidth","onChange","multiline","rows","_c","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/teacher/AttendancePage.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport { useParams, useNavigate } from \"react-router-dom\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useSnackbar } from \"notistack\";\r\nimport {\r\n  Box,\r\n  Typography,\r\n  Card,\r\n  CardContent,\r\n  Grid,\r\n  Paper,\r\n  Button,\r\n  Divider,\r\n  CircularProgress,\r\n  List,\r\n  ListItem,\r\n  ListItemAvatar,\r\n  ListItemText,\r\n  Avatar,\r\n  Chip,\r\n  Dialog,\r\n  DialogTitle,\r\n  DialogContent,\r\n  DialogActions,\r\n  TextField,\r\n  FormControl,\r\n  InputLabel,\r\n  Select,\r\n  MenuItem,\r\n  IconButton,\r\n  Alert,\r\n} from \"@mui/material\";\r\nimport {\r\n  CameraAlt,\r\n  Check,\r\n  Close,\r\n  Edit,\r\n  Refresh,\r\n  Save,\r\n  VerifiedUser,\r\n  HourglassEmpty,\r\n} from \"@mui/icons-material\";\r\nimport Webcam from \"react-webcam\";\r\nimport * as faceapi from \"face-api.js\";\r\nimport {\r\n  getClassFaceFeatures,\r\n  verifyAttendance,\r\n  manualAttendance,\r\n  setModelLoaded,\r\n  setCameraReady,\r\n  setDetectedFaces,\r\n  setRecognizedStudents,\r\n  clearRecognitionState,\r\n} from \"../../redux/slices/faceRecognitionSlice\";\r\nimport axios from \"axios\";\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\r\n\r\nconst AttendancePage = () => {\r\n  const { classId, sessionId } = useParams();\r\n  const navigate = useNavigate();\r\n  const dispatch = useDispatch();\r\n  const { enqueueSnackbar } = useSnackbar();\r\n\r\n  const webcamRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const videoRef = useRef(null);\r\n  const [intervalId, setIntervalId] = useState(null);\r\n  const [showLandmark, setShowLandmark] = useState(false);\r\n  const [landmarkIntervalId, setLandmarkIntervalId] = useState(null);\r\n\r\n  const { token } = useSelector((state) => state.auth);\r\n  const {\r\n    isModelLoaded,\r\n    isCameraReady,\r\n    detectedFaces,\r\n    recognizedStudents,\r\n    classStudents,\r\n    isProcessing,\r\n    error,\r\n  } = useSelector((state) => state.faceRecognition);\r\n\r\n  const [classInfo, setClassInfo] = useState(null);\r\n  const [sessionInfo, setSessionInfo] = useState(null);\r\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [isRecognizing, setIsRecognizing] = useState(false);\r\n  const [isAutoMode, setIsAutoMode] = useState(false);\r\n  const [selectedStudent, setSelectedStudent] = useState(null);\r\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\r\n  const [manualAttendanceData, setManualAttendanceData] = useState({\r\n    status: \"present\",\r\n    note: \"\",\r\n  });\r\n\r\n  // Các hằng số cấu hình\r\n  const RECOGNITION_THRESHOLD = 0.5; // Ngưỡng nhận diện\r\n  const DETECTION_THRESHOLD = 0.3; // Giảm ngưỡng phát hiện khuôn mặt\r\n  const CONFIDENCE_THRESHOLD = 0.6; // Ngưỡng độ tin cậy để điểm danh\r\n  const AUTO_DETECT_INTERVAL = 1000; // Thời gian giữa các lần phát hiện (ms)\r\n  const ENABLE_DEBUG_LOGS = true; // Bật/tắt log gỡ lỗi\r\n\r\n  // Thêm state mới để theo dõi số lần thử lại camera\r\n  const [cameraRetryCount, setCameraRetryCount] = useState(0);\r\n  const [lastDetectionTime, setLastDetectionTime] = useState(null);\r\n\r\n  // Load class info, session info và models\r\n  useEffect(() => {\r\n    const loadInitialData = async () => {\r\n      try {\r\n        setIsLoading(true);\r\n\r\n        // Bắt đầu tải dữ liệu và models song song\r\n        const loadModelsPromise = !isModelLoaded\r\n          ? loadFaceRecognitionModels()\r\n          : Promise.resolve(true);\r\n\r\n        // Lấy thông tin lớp học\r\n        const classPromise = axios.get(\r\n          `${API_URL}/classes/teaching/${classId}`,\r\n          {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          }\r\n        );\r\n\r\n        // Lấy thông tin phiên điểm danh\r\n        const sessionPromise = axios.get(\r\n          `${API_URL}/attendance/sessions/${sessionId}`,\r\n          {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          }\r\n        );\r\n\r\n        // Lấy danh sách điểm danh\r\n        const logsPromise = axios.get(\r\n          `${API_URL}/attendance/logs/${sessionId}`,\r\n          {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          }\r\n        );\r\n\r\n        // Chờ tất cả API calls hoàn thành\r\n        const [classResponse, sessionResponse, logsResponse] =\r\n          await Promise.all([classPromise, sessionPromise, logsPromise]);\r\n\r\n        setClassInfo(classResponse.data.data);\r\n        setSessionInfo(sessionResponse.data.data);\r\n        setAttendanceLogs(logsResponse.data.data);\r\n\r\n        // Lấy đặc trưng khuôn mặt của sinh viên trong lớp\r\n        console.log(\r\n          \"[DEBUG] Bắt đầu lấy đặc trưng khuôn mặt của sinh viên, classId:\",\r\n          classId\r\n        );\r\n\r\n        try {\r\n          // Gọi API trực tiếp để kiểm tra\r\n          const faceDataResponse = await axios.get(\r\n            `${API_URL}/face-recognition/class-features/${classId}`,\r\n            {\r\n              headers: { Authorization: `Bearer ${token}` },\r\n            }\r\n          );\r\n\r\n          console.log(\"[DEBUG] API response raw:\", faceDataResponse);\r\n          console.log(\"[DEBUG] API response data:\", faceDataResponse.data);\r\n\r\n          // Vẫn sử dụng redux dispatch để đảm bảo tính nhất quán\r\n          const faceFeatureResult = await dispatch(\r\n            getClassFaceFeatures(classId)\r\n          ).unwrap();\r\n\r\n          // Log toàn bộ result để debug\r\n          console.log(\"[DEBUG] Redux unwrapped result:\", faceFeatureResult);\r\n\r\n          // Kiểm tra xem có dữ liệu trả về không\r\n          if (faceFeatureResult) {\r\n            // Log dữ liệu để debug\r\n            console.log(\"[DEBUG] Bắt đầu phân tích dữ liệu khuôn mặt\");\r\n            console.log(\r\n              \"[DEBUG] faceFeatureResult structure:\",\r\n              JSON.stringify(faceFeatureResult, null, 2)\r\n            );\r\n\r\n            let studentsData = null;\r\n\r\n            // Kiểm tra các cấu trúc dữ liệu có thể có\r\n            if (Array.isArray(faceFeatureResult)) {\r\n              studentsData = faceFeatureResult;\r\n              console.log(\r\n                `[DEBUG] Nhận được dữ liệu khuôn mặt dạng mảng: ${studentsData.length} sinh viên`\r\n              );\r\n            } else if (\r\n              faceFeatureResult.data &&\r\n              Array.isArray(faceFeatureResult.data)\r\n            ) {\r\n              studentsData = faceFeatureResult.data;\r\n              console.log(\r\n                `[DEBUG] Nhận được dữ liệu khuôn mặt từ faceFeatureResult.data: ${studentsData.length} sinh viên`\r\n              );\r\n            } else if (\r\n              faceFeatureResult.students &&\r\n              Array.isArray(faceFeatureResult.students)\r\n            ) {\r\n              studentsData = faceFeatureResult.students;\r\n              console.log(\r\n                `[DEBUG] Nhận được dữ liệu khuôn mặt từ faceFeatureResult.students: ${studentsData.length} sinh viên`\r\n              );\r\n            }\r\n\r\n            if (studentsData && studentsData.length > 0) {\r\n              console.log(\r\n                `[DEBUG] Phân tích dữ liệu khuôn mặt của ${studentsData.length} sinh viên`\r\n              );\r\n\r\n              // Kiểm tra chi tiết dữ liệu khuôn mặt\r\n              let validDescriptorsCount = 0;\r\n              let invalidDescriptorsCount = 0;\r\n\r\n              studentsData.forEach((student) => {\r\n                console.log(\r\n                  `[DEBUG] Kiểm tra sinh viên: ${\r\n                    student.full_name || \"Unknown\"\r\n                  }, ID: ${student._id}`\r\n                );\r\n                console.log(`[DEBUG] Cấu trúc dữ liệu sinh viên:`, student);\r\n\r\n                // Kiểm tra nếu có faceFeatures\r\n                if (student.faceFeatures) {\r\n                  console.log(`[DEBUG] Sinh viên có dữ liệu faceFeatures`);\r\n\r\n                  // Kiểm tra nếu có descriptors\r\n                  const hasDescriptors =\r\n                    student.faceFeatures &&\r\n                    student.faceFeatures.descriptors &&\r\n                    Array.isArray(student.faceFeatures.descriptors) &&\r\n                    student.faceFeatures.descriptors.length > 0;\r\n\r\n                  if (hasDescriptors) {\r\n                    console.log(\r\n                      `[DEBUG] Sinh viên có ${student.faceFeatures.descriptors.length} nhóm descriptors`\r\n                    );\r\n\r\n                    // Đếm số descriptor hợp lệ\r\n                    let validDescriptorsInStudent = 0;\r\n\r\n                    student.faceFeatures.descriptors.forEach(\r\n                      (group, groupIndex) => {\r\n                        if (Array.isArray(group)) {\r\n                          group.forEach((descriptor, descIndex) => {\r\n                            if (\r\n                              Array.isArray(descriptor) &&\r\n                              descriptor.length === 128\r\n                            ) {\r\n                              validDescriptorsInStudent++;\r\n                            }\r\n                          });\r\n                        }\r\n                      }\r\n                    );\r\n\r\n                    if (validDescriptorsInStudent > 0) {\r\n                      validDescriptorsCount++;\r\n                      console.log(\r\n                        `[DEBUG] Sinh viên ${student.full_name} có ${validDescriptorsInStudent} descriptor hợp lệ`\r\n                      );\r\n                    } else {\r\n                      invalidDescriptorsCount++;\r\n                      console.log(\r\n                        `[DEBUG] Sinh viên ${student.full_name} không có descriptor hợp lệ`\r\n                      );\r\n                    }\r\n                  } else {\r\n                    invalidDescriptorsCount++;\r\n                    console.log(\r\n                      `[DEBUG] Sinh viên ${student.full_name} không có descriptors`\r\n                    );\r\n                  }\r\n                } else {\r\n                  // Kiểm tra nếu có faceDescriptors (cấu trúc cũ)\r\n                  const hasOldDescriptors =\r\n                    student.faceDescriptors &&\r\n                    Array.isArray(student.faceDescriptors) &&\r\n                    student.faceDescriptors.length > 0;\r\n\r\n                  if (hasOldDescriptors) {\r\n                    console.log(\r\n                      `[DEBUG] Sinh viên có ${student.faceDescriptors.length} descriptors (dạng cũ)`\r\n                    );\r\n                    console.log(\r\n                      `[DEBUG] Chi tiết faceDescriptors:`,\r\n                      JSON.stringify(student.faceDescriptors, null, 2)\r\n                    );\r\n\r\n                    // Thử các cách khác nhau để lấy descriptor\r\n                    if (typeof student.faceDescriptors[0] === \"object\") {\r\n                      // Nếu là object (không phải mảng), có thể nó là object có chứa descriptor\r\n                      console.log(\r\n                        `[DEBUG] Descriptor là object:`,\r\n                        student.faceDescriptors[0]\r\n                      );\r\n\r\n                      // Kiểm tra nếu descriptor nằm trong object.descriptors hoặc object.0\r\n                      if (\r\n                        student.faceDescriptors[0].descriptors &&\r\n                        Array.isArray(student.faceDescriptors[0].descriptors)\r\n                      ) {\r\n                        console.log(\r\n                          `[DEBUG] Tìm thấy descriptors trong object.descriptors`\r\n                        );\r\n                        // Sử dụng descriptors trong object\r\n                        const flatDescriptors =\r\n                          student.faceDescriptors[0].descriptors;\r\n\r\n                        const validOldDescriptors = flatDescriptors.filter(\r\n                          (desc) => Array.isArray(desc) && desc.length === 128\r\n                        ).length;\r\n\r\n                        if (validOldDescriptors > 0) {\r\n                          validDescriptorsCount++;\r\n                          console.log(\r\n                            `[DEBUG] Sinh viên ${student.full_name} có ${validOldDescriptors} descriptor hợp lệ trong object.descriptors`\r\n                          );\r\n                        }\r\n                      } else {\r\n                        // Duyệt tất cả các thuộc tính của object để tìm mảng\r\n                        const foundArrays = [];\r\n                        Object.keys(student.faceDescriptors[0]).forEach(\r\n                          (key) => {\r\n                            const value = student.faceDescriptors[0][key];\r\n                            if (Array.isArray(value)) {\r\n                              console.log(\r\n                                `[DEBUG] Tìm thấy mảng trong thuộc tính ${key}, độ dài: ${value.length}`\r\n                              );\r\n                              foundArrays.push(value);\r\n                            }\r\n                          }\r\n                        );\r\n\r\n                        // Kiểm tra các mảng tìm được\r\n                        if (foundArrays.length > 0) {\r\n                          // Ưu tiên mảng có 128 phần tử\r\n                          const potentialDescriptors = foundArrays.filter(\r\n                            (arr) => arr.length === 128\r\n                          );\r\n                          if (potentialDescriptors.length > 0) {\r\n                            validDescriptorsCount++;\r\n                            console.log(\r\n                              `[DEBUG] Sinh viên ${student.full_name} có descriptor hợp lệ trong thuộc tính object`\r\n                            );\r\n                          }\r\n                        }\r\n                      }\r\n                    } else {\r\n                      // Xử lý thông thường\r\n                      const validOldDescriptors =\r\n                        student.faceDescriptors.filter(\r\n                          (desc) => Array.isArray(desc) && desc.length === 128\r\n                        ).length;\r\n\r\n                      if (validOldDescriptors > 0) {\r\n                        validDescriptorsCount++;\r\n                        console.log(\r\n                          `[DEBUG] Sinh viên ${student.full_name} có ${validOldDescriptors} descriptor hợp lệ (dạng cũ)`\r\n                        );\r\n                      } else {\r\n                        invalidDescriptorsCount++;\r\n                        console.log(\r\n                          `[DEBUG] Sinh viên ${student.full_name} không có descriptor hợp lệ (dạng cũ)`\r\n                        );\r\n                      }\r\n                    }\r\n                  } else {\r\n                    invalidDescriptorsCount++;\r\n                    console.log(\r\n                      `[DEBUG] Sinh viên ${student.full_name} không có dữ liệu khuôn mặt`\r\n                    );\r\n                  }\r\n                }\r\n              });\r\n\r\n              console.log(\r\n                `[DEBUG] Tổng hợp: ${validDescriptorsCount} sinh viên có descriptor hợp lệ, ${invalidDescriptorsCount} sinh viên không có`\r\n              );\r\n\r\n              if (validDescriptorsCount === 0) {\r\n                enqueueSnackbar(\r\n                  \"Không có sinh viên nào có dữ liệu khuôn mặt, vui lòng cập nhật dữ liệu\",\r\n                  {\r\n                    variant: \"warning\",\r\n                    autoHideDuration: 8000,\r\n                  }\r\n                );\r\n              }\r\n            } else {\r\n              console.log(\"[DEBUG] Không nhận được dữ liệu khuôn mặt từ API\");\r\n              enqueueSnackbar(\"Không thể tải dữ liệu nhận diện khuôn mặt\", {\r\n                variant: \"error\",\r\n              });\r\n            }\r\n          } else {\r\n            console.log(\r\n              \"[DEBUG] Không nhận được dữ liệu khuôn mặt từ API (faceFeatureResult là null hoặc undefined)\"\r\n            );\r\n            enqueueSnackbar(\"Không thể tải dữ liệu nhận diện khuôn mặt\", {\r\n              variant: \"error\",\r\n            });\r\n          }\r\n        } catch (apiError) {\r\n          console.error(\r\n            \"[DEBUG] Lỗi khi gọi API lấy dữ liệu khuôn mặt:\",\r\n            apiError\r\n          );\r\n          console.log(\r\n            \"[DEBUG] API error details:\",\r\n            apiError.response?.data || apiError.message\r\n          );\r\n          enqueueSnackbar(\r\n            \"Lỗi khi lấy dữ liệu khuôn mặt. Vui lòng kiểm tra API endpoint.\",\r\n            {\r\n              variant: \"error\",\r\n            }\r\n          );\r\n        }\r\n\r\n        // Không chờ đợi model load xong mới hiển thị UI\r\n        setIsLoading(false);\r\n\r\n        // Model sẽ load song song\r\n        await loadModelsPromise;\r\n\r\n        // Thiết lập thời gian phát hiện ban đầu\r\n        setLastDetectionTime(Date.now());\r\n      } catch (error) {\r\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\r\n        enqueueSnackbar(\"Lỗi khi tải dữ liệu\", { variant: \"error\" });\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    loadInitialData();\r\n\r\n    // Clean up\r\n    return () => {\r\n      if (intervalId) {\r\n        clearInterval(intervalId);\r\n      }\r\n\r\n      // Dừng landmark interval nếu đang chạy\r\n      if (landmarkIntervalId) {\r\n        clearInterval(landmarkIntervalId);\r\n      }\r\n\r\n      // Dừng camera stream nếu đang chạy\r\n      if (\r\n        webcamRef.current &&\r\n        webcamRef.current.video &&\r\n        webcamRef.current.video.srcObject\r\n      ) {\r\n        const tracks = webcamRef.current.video.srcObject.getTracks();\r\n        tracks.forEach((track) => track.stop());\r\n      }\r\n\r\n      if (videoRef.current && videoRef.current.srcObject) {\r\n        const tracks = videoRef.current.srcObject.getTracks();\r\n        tracks.forEach((track) => track.stop());\r\n      }\r\n\r\n      dispatch(clearRecognitionState());\r\n\r\n      // Reset các state theo dõi camera\r\n      setCameraRetryCount(0);\r\n      setLastDetectionTime(null);\r\n    };\r\n  }, [\r\n    classId,\r\n    sessionId,\r\n    token,\r\n    dispatch,\r\n    enqueueSnackbar,\r\n    isModelLoaded,\r\n    intervalId,\r\n    landmarkIntervalId,\r\n  ]);\r\n\r\n  // Hàm khởi tạo camera trực tiếp - nút duy nhất cho camera\r\n  const initDirectCamera = async () => {\r\n    try {\r\n      // Tải model nhận diện và đảm bảo model đã sẵn sàng\r\n      if (!isModelLoaded || !faceapi.nets.ssdMobilenetv1.isLoaded) {\r\n        enqueueSnackbar(\"Đang tải các mô hình nhận diện...\", {\r\n          variant: \"info\",\r\n        });\r\n        const modelLoaded = await loadFaceRecognitionModels();\r\n\r\n        if (!modelLoaded) {\r\n          enqueueSnackbar(\"Không thể tải mô hình nhận diện, vui lòng thử lại\", {\r\n            variant: \"error\",\r\n          });\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Dừng stream cũ nếu có\r\n      if (\r\n        webcamRef.current &&\r\n        webcamRef.current.video &&\r\n        webcamRef.current.video.srcObject\r\n      ) {\r\n        const tracks = webcamRef.current.video.srcObject.getTracks();\r\n        tracks.forEach((track) => track.stop());\r\n      }\r\n\r\n      if (videoRef.current && videoRef.current.srcObject) {\r\n        const tracks = videoRef.current.srcObject.getTracks();\r\n        tracks.forEach((track) => track.stop());\r\n      }\r\n\r\n      // Truy cập camera trực tiếp thông qua MediaDevices API\r\n      try {\r\n        // Thêm tùy chọn camera với nhiều độ phân giải\r\n        const constraints = {\r\n          video: {\r\n            width: { ideal: 1280, min: 640 },\r\n            height: { ideal: 720, min: 480 },\r\n            facingMode: \"user\",\r\n            frameRate: { ideal: 30, min: 15 },\r\n          },\r\n          audio: false,\r\n        };\r\n\r\n        console.log(\r\n          \"[DEBUG] Đang yêu cầu truy cập camera với tùy chọn:\",\r\n          constraints\r\n        );\r\n\r\n        const stream = await navigator.mediaDevices.getUserMedia(constraints);\r\n\r\n        console.log(\"Đã nhận được stream camera trực tiếp\", stream.id);\r\n\r\n        // Nếu đang sử dụng webcam component\r\n        if (webcamRef.current && webcamRef.current.video) {\r\n          webcamRef.current.video.srcObject = stream;\r\n\r\n          // Kiểm tra stream đã hoạt động chưa\r\n          webcamRef.current.video.onloadedmetadata = () => {\r\n            webcamRef.current.video.play().catch((err) => {\r\n              console.error(\"Lỗi khi play video webcam:\", err);\r\n            });\r\n          };\r\n        }\r\n        // Hoặc nếu đang sử dụng video element\r\n        else if (videoRef.current) {\r\n          videoRef.current.srcObject = stream;\r\n          videoRef.current.onloadedmetadata = () => {\r\n            videoRef.current\r\n              .play()\r\n              .catch((err) => console.error(\"Lỗi khi play video:\", err));\r\n          };\r\n        }\r\n\r\n        // Đánh dấu camera và model đã sẵn sàng\r\n        dispatch(setModelLoaded(true));\r\n        dispatch(setCameraReady(true));\r\n\r\n        // Khởi động thời gian phát hiện ban đầu\r\n        setLastDetectionTime(Date.now());\r\n\r\n        enqueueSnackbar(\"Đã kết nối camera thành công\", {\r\n          variant: \"success\",\r\n        });\r\n\r\n        // Bật hiển thị landmark sau khi camera khởi động\r\n        setTimeout(() => {\r\n          setShowLandmark(true);\r\n        }, 1000);\r\n\r\n        // Đặt lại số lần thử camera\r\n        setCameraRetryCount(0);\r\n\r\n        return true;\r\n      } catch (err) {\r\n        console.error(\"Lỗi truy cập camera:\", err);\r\n        enqueueSnackbar(`Không thể truy cập camera: ${err.message}`, {\r\n          variant: \"error\",\r\n        });\r\n\r\n        // Thử phương án thay thế nếu camera mặt trước thất bại\r\n        if (cameraRetryCount < 2) {\r\n          try {\r\n            console.log(\"[DEBUG] Thử sử dụng camera phương án thay thế\");\r\n            const altStream = await navigator.mediaDevices.getUserMedia({\r\n              video: true, // Chỉ yêu cầu bất kỳ camera nào có sẵn\r\n              audio: false,\r\n            });\r\n\r\n            // Xử lý stream mới\r\n            if (webcamRef.current && webcamRef.current.video) {\r\n              webcamRef.current.video.srcObject = altStream;\r\n            } else if (videoRef.current) {\r\n              videoRef.current.srcObject = altStream;\r\n              videoRef.current.onloadedmetadata = () => videoRef.current.play();\r\n            }\r\n\r\n            dispatch(setCameraReady(true));\r\n            setLastDetectionTime(Date.now());\r\n            enqueueSnackbar(\"Đã kết nối camera thay thế\", {\r\n              variant: \"success\",\r\n            });\r\n            return true;\r\n          } catch (altErr) {\r\n            console.error(\"Không thể sử dụng camera thay thế:\", altErr);\r\n          }\r\n        }\r\n\r\n        return false;\r\n      }\r\n    } catch (err) {\r\n      console.error(\"Lỗi khi khởi tạo camera trực tiếp:\", err);\r\n      enqueueSnackbar(`Lỗi: ${err.message}`, { variant: \"error\" });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Thêm useEffect mới để tự động khởi động lại camera khi không phát hiện khuôn mặt trong thời gian dài\r\n  useEffect(() => {\r\n    // Không làm gì nếu không bật chế độ tự động\r\n    if (!isAutoMode || !isCameraReady) return;\r\n\r\n    // Thời gian tối đa không phát hiện khuôn mặt trước khi thử khởi động lại camera (20 giây)\r\n    const MAX_NO_DETECTION_TIME = 20000;\r\n\r\n    // Kiểm tra thời gian từ lần phát hiện cuối cùng\r\n    const checkDetectionTimeout = () => {\r\n      const now = Date.now();\r\n\r\n      if (\r\n        lastDetectionTime &&\r\n        now - lastDetectionTime > MAX_NO_DETECTION_TIME\r\n      ) {\r\n        console.log(\r\n          \"[DEBUG] Quá lâu không phát hiện khuôn mặt, thử khởi động lại camera\"\r\n        );\r\n\r\n        // Tăng số lần thử lại và khởi động lại camera nếu chưa quá 3 lần\r\n        if (cameraRetryCount < 3) {\r\n          setCameraRetryCount((prev) => prev + 1);\r\n          initDirectCamera();\r\n          enqueueSnackbar(\"Đang thử khởi động lại camera...\", {\r\n            variant: \"info\",\r\n          });\r\n        } else if (cameraRetryCount === 3) {\r\n          // Sau 3 lần thử, đưa ra gợi ý chi tiết hơn\r\n          setCameraRetryCount((prev) => prev + 1);\r\n          enqueueSnackbar(\r\n            \"Kiểm tra lại camera và ánh sáng. Có thể cần cấp lại quyền camera.\",\r\n            { variant: \"warning\", autoHideDuration: 8000 }\r\n          );\r\n        }\r\n      }\r\n    };\r\n\r\n    // Thiết lập interval kiểm tra\r\n    const checkInterval = setInterval(checkDetectionTimeout, 10000);\r\n\r\n    return () => {\r\n      clearInterval(checkInterval);\r\n    };\r\n  }, [\r\n    isAutoMode,\r\n    isCameraReady,\r\n    lastDetectionTime,\r\n    cameraRetryCount,\r\n    enqueueSnackbar,\r\n    initDirectCamera,\r\n  ]);\r\n\r\n  // Load các mô hình nhận diện khuôn mặt\r\n  const loadFaceRecognitionModels = async () => {\r\n    try {\r\n      const MODEL_URL = \"/models\";\r\n      console.log(\"Bắt đầu tải models từ:\", MODEL_URL);\r\n\r\n      // Thêm SsdMobilenetv1 vào danh sách models cần tải\r\n      const modelPromises = [\r\n        faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\r\n        faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\r\n        faceapi.nets.ssdMobilenetv1.loadFromUri(MODEL_URL), // Thêm model SSD MobileNet\r\n      ];\r\n\r\n      // Kiểm tra xem các models đã được tải chưa\r\n      const modelStatuses = [\r\n        faceapi.nets.tinyFaceDetector.isLoaded,\r\n        faceapi.nets.faceLandmark68Net.isLoaded,\r\n        faceapi.nets.faceRecognitionNet.isLoaded,\r\n        faceapi.nets.ssdMobilenetv1.isLoaded, // Kiểm tra SSD MobileNet đã tải chưa\r\n      ];\r\n\r\n      if (modelStatuses.every((status) => status)) {\r\n        console.log(\"Các models đã được tải từ trước\");\r\n        dispatch(setModelLoaded(true));\r\n        return true;\r\n      }\r\n\r\n      await Promise.all(modelPromises);\r\n\r\n      console.log(\"Đã tải xong models thành công\");\r\n      dispatch(setModelLoaded(true));\r\n      enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\r\n        variant: \"success\",\r\n      });\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Lỗi khi tải mô hình:\", error);\r\n      enqueueSnackbar(\"Không thể tải mô hình nhận diện\", { variant: \"error\" });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Hàm kiểm tra và đảm bảo camera hoạt động\r\n  const ensureCameraIsWorking = () => {\r\n    // Kiểm tra nếu camera chưa hoạt động và đã thử khởi động\r\n    if (!isCameraReady && cameraRetryCount === 0) {\r\n      console.log(\"[DEBUG] Camera chưa sẵn sàng, thử khởi động\");\r\n      setCameraRetryCount(1);\r\n      initDirectCamera();\r\n      return false;\r\n    }\r\n\r\n    // Kiểm tra stream của camera\r\n    const videoElement = isAutoMode\r\n      ? videoRef.current\r\n      : webcamRef.current?.video;\r\n\r\n    if (\r\n      !videoElement ||\r\n      !videoElement.srcObject ||\r\n      videoElement.readyState !== 4\r\n    ) {\r\n      console.log(\r\n        \"[DEBUG] Video stream không hoạt động, thử khởi động lại camera\"\r\n      );\r\n      if (cameraRetryCount < 3) {\r\n        setCameraRetryCount((prev) => prev + 1);\r\n        initDirectCamera();\r\n        return false;\r\n      }\r\n    }\r\n\r\n    return true;\r\n  };\r\n\r\n  // Cập nhật hàm handleDetectFaces để kiểm tra camera trước\r\n  const handleDetectFaces = async () => {\r\n    try {\r\n      // Đảm bảo camera hoạt động\r\n      if (!ensureCameraIsWorking()) {\r\n        return [];\r\n      }\r\n\r\n      // Kiểm tra model đã tải chưa\r\n      if (!isModelLoaded || !faceapi.nets.ssdMobilenetv1.isLoaded) {\r\n        console.warn(\"Model SSD MobileNet chưa được tải, đang thử tải lại...\");\r\n        await loadFaceRecognitionModels();\r\n\r\n        if (!faceapi.nets.ssdMobilenetv1.isLoaded) {\r\n          enqueueSnackbar(\"Model nhận dạng chưa sẵn sàng, vui lòng thử lại\", {\r\n            variant: \"warning\",\r\n          });\r\n          return [];\r\n        }\r\n      }\r\n\r\n      // Lấy dữ liệu video\r\n      const videoElement = isAutoMode\r\n        ? videoRef.current\r\n        : webcamRef.current?.video;\r\n      if (!videoElement || !canvasRef.current) return [];\r\n\r\n      // Kiểm tra trạng thái video stream\r\n      if (videoElement.readyState !== 4) {\r\n        console.warn(\"Video element không sẵn sàng, đang đợi...\");\r\n        return [];\r\n      }\r\n\r\n      // Lấy kích thước của video\r\n      const displaySize = {\r\n        width: videoElement.videoWidth || videoElement.width || 640,\r\n        height: videoElement.videoHeight || videoElement.height || 480,\r\n      };\r\n\r\n      // Thử phát hiện với cả hai mô hình\r\n      let detections = [];\r\n\r\n      // Thử với SSD MobileNet trước (độ chính xác cao hơn)\r\n      try {\r\n        detections = await faceapi\r\n          .detectAllFaces(\r\n            videoElement,\r\n            new faceapi.SsdMobilenetv1Options({\r\n              minConfidence: DETECTION_THRESHOLD,\r\n            })\r\n          )\r\n          .withFaceLandmarks()\r\n          .withFaceDescriptors();\r\n      } catch (err) {\r\n        console.warn(\"Lỗi khi sử dụng SSD MobileNet:\", err);\r\n      }\r\n\r\n      // Nếu không phát hiện được, thử với TinyFaceDetector\r\n      if (!detections || detections.length === 0) {\r\n        try {\r\n          detections = await faceapi\r\n            .detectAllFaces(\r\n              videoElement,\r\n              new faceapi.TinyFaceDetectorOptions({\r\n                inputSize: 320,\r\n                scoreThreshold: DETECTION_THRESHOLD - 0.05, // Giảm ngưỡng thêm nữa\r\n              })\r\n            )\r\n            .withFaceLandmarks()\r\n            .withFaceDescriptors();\r\n        } catch (err) {\r\n          console.warn(\"Lỗi khi sử dụng TinyFaceDetector:\", err);\r\n        }\r\n      }\r\n\r\n      if (!detections || detections.length === 0) {\r\n        if (ENABLE_DEBUG_LOGS) {\r\n          console.log(\r\n            \"[DEBUG] Không phát hiện khuôn mặt - kiểm tra ánh sáng và vị trí\",\r\n            new Date().toLocaleTimeString()\r\n          );\r\n        }\r\n\r\n        // Xóa canvas nếu không có phát hiện\r\n        const canvasElement = canvasRef.current;\r\n        if (canvasElement) {\r\n          const ctx = canvasElement.getContext(\"2d\");\r\n          ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);\r\n\r\n          // Vẽ hướng dẫn khi không có khuôn mặt\r\n          ctx.font = \"18px Arial\";\r\n          ctx.fillStyle = \"white\";\r\n          ctx.strokeStyle = \"black\";\r\n          ctx.lineWidth = 3;\r\n          const text =\r\n            \"Không phát hiện khuôn mặt - Điều chỉnh vị trí và ánh sáng\";\r\n          const x = canvasElement.width / 2 - 180;\r\n          const y = canvasElement.height / 2;\r\n          ctx.strokeText(text, x, y);\r\n          ctx.fillText(text, x, y);\r\n        }\r\n\r\n        return [];\r\n      }\r\n\r\n      // Đã phát hiện khuôn mặt, cập nhật thời gian\r\n      setLastDetectionTime(Date.now());\r\n      // Reset biến đếm thử lại\r\n      if (cameraRetryCount > 0) {\r\n        setCameraRetryCount(0);\r\n      }\r\n\r\n      if (ENABLE_DEBUG_LOGS) {\r\n        console.log(\r\n          `[DEBUG] Phát hiện ${detections.length} khuôn mặt`,\r\n          new Date().toLocaleTimeString()\r\n        );\r\n      }\r\n\r\n      // Điều chỉnh kích thước phát hiện để phù hợp với kích thước hiển thị\r\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\r\n\r\n      // Cập nhật state\r\n      dispatch(setDetectedFaces(resizedDetections));\r\n\r\n      // Tạo FaceMatcher từ dữ liệu sinh viên\r\n      const labeledDescriptors = classStudents\r\n        .filter((student) => {\r\n          // Kiểm tra nếu có faceFeatures\r\n          if (\r\n            student.faceFeatures &&\r\n            student.faceFeatures.descriptors &&\r\n            Array.isArray(student.faceFeatures.descriptors) &&\r\n            student.faceFeatures.descriptors.length > 0\r\n          ) {\r\n            return true;\r\n          }\r\n\r\n          // Kiểm tra nếu có faceDescriptors (cấu trúc cũ)\r\n          if (\r\n            student.faceDescriptors &&\r\n            Array.isArray(student.faceDescriptors) &&\r\n            student.faceDescriptors.length > 0\r\n          ) {\r\n            return true;\r\n          }\r\n\r\n          return false;\r\n        })\r\n        .map((student) => {\r\n          try {\r\n            const allDescriptors = [];\r\n\r\n            // Xử lý cấu trúc faceFeatures.descriptors\r\n            if (\r\n              student.faceFeatures &&\r\n              student.faceFeatures.descriptors &&\r\n              Array.isArray(student.faceFeatures.descriptors)\r\n            ) {\r\n              // Áp dụng cho cấu trúc dữ liệu mới: student.faceFeatures.descriptors là mảng các mảng descriptor\r\n              student.faceFeatures.descriptors.forEach((descriptorGroup) => {\r\n                if (\r\n                  Array.isArray(descriptorGroup) &&\r\n                  descriptorGroup.length > 0\r\n                ) {\r\n                  // Chuyển từng descriptor thành Float32Array\r\n                  descriptorGroup.forEach((descriptor) => {\r\n                    if (\r\n                      Array.isArray(descriptor) &&\r\n                      descriptor.length === 128\r\n                    ) {\r\n                      allDescriptors.push(new Float32Array(descriptor));\r\n                    }\r\n                  });\r\n                }\r\n              });\r\n            }\r\n\r\n            // Xử lý cấu trúc faceDescriptors (cũ)\r\n            if (\r\n              student.faceDescriptors &&\r\n              Array.isArray(student.faceDescriptors) &&\r\n              student.faceDescriptors.length > 0\r\n            ) {\r\n              if (typeof student.faceDescriptors[0] === \"object\") {\r\n                // Nếu là object, kiểm tra nếu có descriptors bên trong\r\n                if (\r\n                  student.faceDescriptors[0].descriptors &&\r\n                  Array.isArray(student.faceDescriptors[0].descriptors)\r\n                ) {\r\n                  // Xử lý descriptors bên trong object\r\n                  student.faceDescriptors[0].descriptors.forEach(\r\n                    (descriptor) => {\r\n                      if (\r\n                        Array.isArray(descriptor) &&\r\n                        descriptor.length === 128\r\n                      ) {\r\n                        allDescriptors.push(new Float32Array(descriptor));\r\n                      }\r\n                    }\r\n                  );\r\n                } else {\r\n                  // Duyệt các thuộc tính của object\r\n                  Object.keys(student.faceDescriptors[0]).forEach((key) => {\r\n                    const value = student.faceDescriptors[0][key];\r\n                    if (Array.isArray(value) && value.length === 128) {\r\n                      allDescriptors.push(new Float32Array(value));\r\n                    }\r\n                  });\r\n                }\r\n              } else {\r\n                // Xử lý thông thường\r\n                student.faceDescriptors.forEach((descriptor) => {\r\n                  if (Array.isArray(descriptor) && descriptor.length === 128) {\r\n                    allDescriptors.push(new Float32Array(descriptor));\r\n                  }\r\n                });\r\n              }\r\n            }\r\n\r\n            if (allDescriptors.length === 0) {\r\n              console.log(\r\n                `[DEBUG] Không thể tạo descriptor cho sinh viên ${student.full_name}`\r\n              );\r\n              return null;\r\n            }\r\n\r\n            console.log(\r\n              `[DEBUG] Đã tạo ${allDescriptors.length} descriptors cho sinh viên ${student.full_name}`\r\n            );\r\n            return new faceapi.LabeledFaceDescriptors(\r\n              student._id,\r\n              allDescriptors\r\n            );\r\n          } catch (err) {\r\n            console.error(\r\n              `Lỗi khi xử lý descriptor của sinh viên ${student._id}:`,\r\n              err\r\n            );\r\n            return null;\r\n          }\r\n        })\r\n        .filter(Boolean); // Lọc bỏ các giá trị null\r\n\r\n      // Tạo faceMatcher nếu có dữ liệu\r\n      if (labeledDescriptors.length === 0) {\r\n        console.warn(\"Không có dữ liệu khuôn mặt hợp lệ của sinh viên\");\r\n        return resizedDetections;\r\n      }\r\n\r\n      console.log(\r\n        `[DEBUG] Tạo FaceMatcher với ${labeledDescriptors.length} sinh viên`\r\n      );\r\n\r\n      // Tạo faceMatcher với descriptor đã được xác thực\r\n      const faceMatcher = new faceapi.FaceMatcher(\r\n        labeledDescriptors,\r\n        RECOGNITION_THRESHOLD\r\n      );\r\n\r\n      // Vẽ lên canvas nếu có khuôn mặt\r\n      const canvasElement = canvasRef.current;\r\n      // Đặt kích thước canvas chính xác bằng với kích thước thực của video\r\n      canvasElement.width = displaySize.width;\r\n      canvasElement.height = displaySize.height;\r\n\r\n      // Đảm bảo đồng bộ kích thước canvas với video\r\n      faceapi.matchDimensions(canvasElement, displaySize);\r\n\r\n      const ctx = canvasElement.getContext(\"2d\");\r\n      ctx.clearRect(0, 0, canvasElement.width, canvasElement.height);\r\n\r\n      // Vẽ các phát hiện lên canvas\r\n      resizedDetections.forEach((detection) => {\r\n        try {\r\n          if (detection.descriptor && detection.descriptor.length === 128) {\r\n            const bestMatch = faceMatcher.findBestMatch(detection.descriptor);\r\n            const { label, distance } = bestMatch;\r\n\r\n            // Kiểm tra nếu match với một sinh viên\r\n            if (label !== \"unknown\") {\r\n              // Tìm sinh viên trong danh sách\r\n              const student = classStudents.find((s) => s._id === label);\r\n              if (student) {\r\n                // Cập nhật thông tin nhận diện cho sinh viên\r\n                const studentId = student._id;\r\n                const confidence = 1 - distance;\r\n\r\n                // Đánh dấu sinh viên đã điểm danh nếu đủ độ tin cậy\r\n                if (confidence >= CONFIDENCE_THRESHOLD) {\r\n                  handleMarkAttendance(studentId, confidence);\r\n                }\r\n\r\n                // Vẽ hộp và tên sinh viên\r\n                const drawBox = new faceapi.draw.DrawBox(\r\n                  detection.detection.box,\r\n                  {\r\n                    label: `${student.full_name} (${Math.round(\r\n                      confidence * 100\r\n                    )}%)`,\r\n                    boxColor:\r\n                      confidence >= CONFIDENCE_THRESHOLD ? \"green\" : \"orange\",\r\n                  }\r\n                );\r\n                drawBox.draw(canvasElement);\r\n              }\r\n            } else {\r\n              // Không nhận diện được sinh viên\r\n              const drawBox = new faceapi.draw.DrawBox(\r\n                detection.detection.box,\r\n                {\r\n                  label: \"Unknown\",\r\n                  boxColor: \"red\",\r\n                }\r\n              );\r\n              drawBox.draw(canvasElement);\r\n            }\r\n          } else {\r\n            // Nếu descriptor không hợp lệ hoặc độ dài không đúng\r\n            console.warn(\r\n              \"Phát hiện descriptor không hợp lệ\",\r\n              detection.descriptor\r\n                ? detection.descriptor.length\r\n                : \"không có descriptor\"\r\n            );\r\n\r\n            // Không có descriptor\r\n            const drawBox = new faceapi.draw.DrawBox(detection.detection.box, {\r\n              label: \"Đang phân tích...\",\r\n              boxColor: \"blue\",\r\n            });\r\n            drawBox.draw(canvasElement);\r\n          }\r\n        } catch (err) {\r\n          console.error(\"Lỗi khi xử lý detection:\", err);\r\n        }\r\n\r\n        // Vẽ landmarks nếu đã bật\r\n        if (showLandmark && detection.landmarks) {\r\n          faceapi.draw.drawFaceLandmarks(canvasElement, detection);\r\n        }\r\n      });\r\n\r\n      return resizedDetections;\r\n    } catch (error) {\r\n      console.error(\"Lỗi phát hiện khuôn mặt:\", error);\r\n      enqueueSnackbar(\"Lỗi khi phát hiện khuôn mặt. Thử lại sau.\", {\r\n        variant: \"error\",\r\n      });\r\n      return [];\r\n    }\r\n  };\r\n\r\n  // Điểm danh thủ công\r\n  const openManualAttendanceDialog = (student) => {\r\n    setSelectedStudent(student);\r\n    setManualAttendanceData({\r\n      status: \"present\",\r\n      note: \"\",\r\n    });\r\n    setManualDialogOpen(true);\r\n  };\r\n\r\n  const handleManualDialogClose = () => {\r\n    setManualDialogOpen(false);\r\n  };\r\n\r\n  const handleManualAttendanceChange = (e) => {\r\n    setManualAttendanceData({\r\n      ...manualAttendanceData,\r\n      [e.target.name]: e.target.value,\r\n    });\r\n  };\r\n\r\n  const handleManualAttendanceSubmit = async () => {\r\n    if (!selectedStudent) return;\r\n\r\n    try {\r\n      const result = await dispatch(\r\n        manualAttendance({\r\n          sessionId,\r\n          studentId: selectedStudent._id,\r\n          status: manualAttendanceData.status,\r\n          note: manualAttendanceData.note,\r\n        })\r\n      ).unwrap();\r\n\r\n      // Cập nhật logs điểm danh\r\n      if (result && result.data) {\r\n        const updatedLogs = attendanceLogs.filter(\r\n          (log) => log.student_id._id !== selectedStudent._id\r\n        );\r\n\r\n        updatedLogs.push({\r\n          ...result.data,\r\n          student_id: selectedStudent,\r\n        });\r\n\r\n        setAttendanceLogs(updatedLogs);\r\n      }\r\n\r\n      enqueueSnackbar(\"Điểm danh thủ công thành công\", { variant: \"success\" });\r\n      handleManualDialogClose();\r\n\r\n      // Cập nhật lại thông tin phiên điểm danh\r\n      const sessionResponse = await axios.get(\r\n        `${API_URL}/attendance/sessions/${sessionId}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      setSessionInfo(sessionResponse.data.data);\r\n    } catch (error) {\r\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\r\n      enqueueSnackbar(\"Lỗi khi điểm danh thủ công\", { variant: \"error\" });\r\n    }\r\n  };\r\n\r\n  // Đánh dấu điểm danh từ nhận diện khuôn mặt\r\n  const markAttendance = async (\r\n    studentId,\r\n    faceDescriptor,\r\n    confidence,\r\n    imageBase64\r\n  ) => {\r\n    try {\r\n      const result = await dispatch(\r\n        verifyAttendance({\r\n          sessionId,\r\n          studentId,\r\n          faceDescriptor,\r\n          confidence,\r\n          imageBase64,\r\n        })\r\n      ).unwrap();\r\n\r\n      // Cập nhật logs điểm danh\r\n      if (result && result.data) {\r\n        const student = classStudents.find((s) => s._id === studentId);\r\n\r\n        if (student) {\r\n          const updatedLogs = attendanceLogs.filter(\r\n            (log) => log.student_id._id !== studentId\r\n          );\r\n\r\n          updatedLogs.push({\r\n            ...result.data,\r\n            student_id: student,\r\n          });\r\n\r\n          setAttendanceLogs(updatedLogs);\r\n\r\n          enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\r\n            variant: \"success\",\r\n          });\r\n        }\r\n      }\r\n\r\n      // Cập nhật lại thông tin phiên điểm danh\r\n      const sessionResponse = await axios.get(\r\n        `${API_URL}/attendance/sessions/${sessionId}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      setSessionInfo(sessionResponse.data.data);\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\r\n      enqueueSnackbar(\"Lỗi khi xác nhận điểm danh\", { variant: \"error\" });\r\n      return false;\r\n    }\r\n  };\r\n\r\n  // Kết thúc phiên điểm danh\r\n  const completeSession = async () => {\r\n    try {\r\n      await axios.put(\r\n        `${API_URL}/attendance/sessions/${sessionId}`,\r\n        { status: \"completed\" },\r\n        { headers: { Authorization: `Bearer ${token}` } }\r\n      );\r\n\r\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", { variant: \"success\" });\r\n      navigate(`/teacher/classes/${classId}`);\r\n    } catch (error) {\r\n      console.error(\"Lỗi khi kết thúc phiên điểm danh:\", error);\r\n      enqueueSnackbar(\"Lỗi khi kết thúc phiên điểm danh\", { variant: \"error\" });\r\n    }\r\n  };\r\n\r\n  // Làm mới danh sách điểm danh\r\n  const refreshAttendanceLogs = async () => {\r\n    try {\r\n      const logsResponse = await axios.get(\r\n        `${API_URL}/attendance/logs/${sessionId}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      setAttendanceLogs(logsResponse.data.data);\r\n\r\n      const sessionResponse = await axios.get(\r\n        `${API_URL}/attendance/sessions/${sessionId}`,\r\n        {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        }\r\n      );\r\n      setSessionInfo(sessionResponse.data.data);\r\n\r\n      enqueueSnackbar(\"Đã làm mới dữ liệu điểm danh\", { variant: \"success\" });\r\n    } catch (error) {\r\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\r\n      enqueueSnackbar(\"Lỗi khi làm mới dữ liệu\", { variant: \"error\" });\r\n    }\r\n  };\r\n\r\n  // Chụp ảnh và nhận diện thủ công\r\n  const captureAndRecognize = async () => {\r\n    await handleDetectFaces();\r\n  };\r\n\r\n  // Xử lý đánh dấu sinh viên điểm danh\r\n  const handleMarkAttendance = async (studentId, confidence) => {\r\n    // Kiểm tra xem sinh viên đã được điểm danh chưa\r\n    const isAlreadyAttended = attendanceLogs.some(\r\n      (log) => log.student_id._id === studentId && log.status === \"present\"\r\n    );\r\n\r\n    if (isAlreadyAttended) {\r\n      if (ENABLE_DEBUG_LOGS) {\r\n        console.log(\r\n          `[DEBUG] Sinh viên ${studentId} đã được điểm danh trước đó`\r\n        );\r\n      }\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Lấy dữ liệu video\r\n      const videoElement = isAutoMode\r\n        ? videoRef.current\r\n        : webcamRef.current?.video;\r\n\r\n      if (!videoElement) return;\r\n\r\n      // Tạo ảnh chụp từ video element\r\n      let imageBase64 = null;\r\n\r\n      // Nếu sử dụng webcam component\r\n      if (!isAutoMode && webcamRef.current) {\r\n        imageBase64 = webcamRef.current.getScreenshot();\r\n      }\r\n      // Nếu sử dụng video element trực tiếp\r\n      else if (isAutoMode) {\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.width = videoElement.videoWidth;\r\n        canvas.height = videoElement.videoHeight;\r\n        const ctx = canvas.getContext(\"2d\");\r\n        ctx.drawImage(videoElement, 0, 0);\r\n        imageBase64 = canvas.toDataURL(\"image/jpeg\");\r\n      }\r\n\r\n      // Tìm sinh viên đã được phát hiện\r\n      const student = classStudents.find((s) => s._id === studentId);\r\n\r\n      if (!student) {\r\n        console.error(`Không tìm thấy sinh viên với ID ${studentId}`);\r\n        return;\r\n      }\r\n\r\n      // Lấy descriptor mới nhất từ sinh viên\r\n      let descriptor = null;\r\n\r\n      // Kiểm tra và lấy descriptor từ các cấu trúc khác nhau\r\n      if (\r\n        student.faceFeatures &&\r\n        student.faceFeatures.descriptors &&\r\n        Array.isArray(student.faceFeatures.descriptors) &&\r\n        student.faceFeatures.descriptors.length > 0\r\n      ) {\r\n        // Lấy từ cấu trúc mới\r\n        if (Array.isArray(student.faceFeatures.descriptors[0])) {\r\n          descriptor = student.faceFeatures.descriptors[0];\r\n        } else if (Array.isArray(student.faceFeatures.descriptors[0][0])) {\r\n          descriptor = student.faceFeatures.descriptors[0][0];\r\n        }\r\n      } else if (\r\n        student.faceDescriptors &&\r\n        Array.isArray(student.faceDescriptors) &&\r\n        student.faceDescriptors.length > 0\r\n      ) {\r\n        // Lấy từ cấu trúc cũ\r\n        if (typeof student.faceDescriptors[0] === \"object\") {\r\n          if (\r\n            student.faceDescriptors[0].descriptors &&\r\n            Array.isArray(student.faceDescriptors[0].descriptors) &&\r\n            student.faceDescriptors[0].descriptors.length > 0\r\n          ) {\r\n            descriptor = student.faceDescriptors[0].descriptors[0];\r\n          } else {\r\n            // Tìm mảng 128 phần tử đầu tiên trong object\r\n            Object.keys(student.faceDescriptors[0]).forEach((key) => {\r\n              const value = student.faceDescriptors[0][key];\r\n              if (!descriptor && Array.isArray(value) && value.length === 128) {\r\n                descriptor = value;\r\n              }\r\n            });\r\n          }\r\n        } else if (\r\n          Array.isArray(student.faceDescriptors[0]) &&\r\n          student.faceDescriptors[0].length === 128\r\n        ) {\r\n          descriptor = student.faceDescriptors[0];\r\n        }\r\n      }\r\n\r\n      // Gọi API điểm danh\r\n      if (ENABLE_DEBUG_LOGS) {\r\n        console.log(\r\n          `[DEBUG] Đánh dấu điểm danh cho ${\r\n            student.full_name\r\n          } với độ tin cậy ${confidence.toFixed(2)}`\r\n        );\r\n      }\r\n\r\n      // Gọi hàm điểm danh\r\n      await markAttendance(studentId, descriptor, confidence, imageBase64);\r\n    } catch (error) {\r\n      console.error(\"Lỗi khi đánh dấu điểm danh:\", error);\r\n    }\r\n  };\r\n\r\n  // Bật/tắt hiển thị landmark trên khuôn mặt\r\n  const toggleLandmarkDetection = () => {\r\n    const newState = !showLandmark;\r\n    setShowLandmark(newState);\r\n\r\n    // Vẽ lại detection với landmark mới nếu có khuôn mặt\r\n    if (detectedFaces && detectedFaces.length > 0) {\r\n      handleDetectFaces();\r\n    }\r\n  };\r\n\r\n  // Thêm hàm debug để kiểm tra cấu trúc dữ liệu khuôn mặt\r\n  const debugFaceFeatures = () => {\r\n    if (!classStudents || classStudents.length === 0) {\r\n      console.log(\r\n        \"[DEBUG] Không có sinh viên nào để kiểm tra dữ liệu khuôn mặt\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    classStudents.forEach((student, index) => {\r\n      console.log(`[DEBUG] Sinh viên #${index + 1}: ${student.full_name}`);\r\n\r\n      // Kiểm tra dữ liệu faceFeatures\r\n      if (student.faceFeatures) {\r\n        console.log(`  - Có dữ liệu faceFeatures`);\r\n\r\n        // Kiểm tra descriptors\r\n        if (student.faceFeatures.descriptors) {\r\n          console.log(\r\n            `  - Có descriptors: ${student.faceFeatures.descriptors.length} nhóm`\r\n          );\r\n\r\n          student.faceFeatures.descriptors.forEach((group, groupIndex) => {\r\n            if (Array.isArray(group)) {\r\n              console.log(\r\n                `    - Nhóm #${groupIndex + 1}: ${group.length} descriptors`\r\n              );\r\n\r\n              group.forEach((descriptor, descIndex) => {\r\n                if (Array.isArray(descriptor)) {\r\n                  console.log(\r\n                    `      - Descriptor #${descIndex + 1}: ${\r\n                      descriptor.length\r\n                    } phần tử`\r\n                  );\r\n                } else {\r\n                  console.log(\r\n                    `      - Descriptor #${descIndex + 1}: Không phải mảng`\r\n                  );\r\n                }\r\n              });\r\n            } else {\r\n              console.log(`    - Nhóm #${groupIndex + 1}: Không phải mảng`);\r\n            }\r\n          });\r\n        } else {\r\n          console.log(`  - Không có dữ liệu descriptors`);\r\n        }\r\n      } else {\r\n        console.log(`  - Không có dữ liệu faceFeatures`);\r\n      }\r\n\r\n      // Kiểm tra dữ liệu cũ (faceDescriptors)\r\n      if (student.faceDescriptors) {\r\n        console.log(\r\n          `  - Có dữ liệu faceDescriptors (cấu trúc cũ): ${student.faceDescriptors.length} descriptors`\r\n        );\r\n      }\r\n    });\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <Box\r\n        display=\"flex\"\r\n        justifyContent=\"center\"\r\n        alignItems=\"center\"\r\n        minHeight=\"60vh\"\r\n      >\r\n        <CircularProgress />\r\n      </Box>\r\n    );\r\n  }\r\n\r\n  // Lấy danh sách sinh viên vắng mặt\r\n  const getAbsentStudents = () => {\r\n    if (!classInfo || !sessionInfo) return [];\r\n\r\n    const presentStudentIds = attendanceLogs\r\n      .filter((log) => log.status === \"present\")\r\n      .map((log) => log.student_id._id);\r\n\r\n    return classInfo.students.filter(\r\n      (student) => !presentStudentIds.includes(student._id)\r\n    );\r\n  };\r\n\r\n  const absentStudents = getAbsentStudents();\r\n\r\n  // Điểm danh thủ công trong chế độ đơn giản\r\n  const showStudentList = () => {\r\n    if (!classInfo) return;\r\n\r\n    // Hiển thị danh sách sinh viên để điểm danh thủ công\r\n    const absentStudents = getAbsentStudents();\r\n    if (absentStudents.length === 0) {\r\n      enqueueSnackbar(\"Tất cả sinh viên đã được điểm danh\", {\r\n        variant: \"success\",\r\n      });\r\n      return;\r\n    }\r\n\r\n    // Hiển thị dialog chọn sinh viên để điểm danh\r\n    if (absentStudents.length > 0 && absentStudents[0]) {\r\n      openManualAttendanceDialog(absentStudents[0]);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Box>\r\n      <Typography variant=\"h5\" gutterBottom>\r\n        Điểm Danh - {classInfo?.class_name}\r\n      </Typography>\r\n      <Typography variant=\"subtitle1\" color=\"textSecondary\" gutterBottom>\r\n        Buổi {sessionInfo?.session_number} -{\" \"}\r\n        {new Date(sessionInfo?.date).toLocaleDateString(\"vi-VN\")}\r\n      </Typography>\r\n\r\n      <Grid container spacing={3} mt={1}>\r\n        <Grid item xs={12} md={8}>\r\n          <Card>\r\n            <CardContent>\r\n              <Box\r\n                display=\"flex\"\r\n                justifyContent=\"space-between\"\r\n                alignItems=\"center\"\r\n                mb={2}\r\n              >\r\n                <Typography variant=\"h6\">Camera nhận diện</Typography>\r\n                <Box>\r\n                  <Chip\r\n                    label={isAutoMode ? \"Tự động đang bật\" : \"Tự động đang tắt\"}\r\n                    color={isAutoMode ? \"success\" : \"default\"}\r\n                    sx={{ mr: 1 }}\r\n                  />\r\n                  <Button\r\n                    variant=\"outlined\"\r\n                    color={isAutoMode ? \"error\" : \"primary\"}\r\n                    onClick={\r\n                      isAutoMode\r\n                        ? () => {\r\n                            // Dừng tự động\r\n                            if (intervalId) {\r\n                              clearInterval(intervalId);\r\n                              setIntervalId(null);\r\n                            }\r\n                            setIsAutoMode(false);\r\n                            enqueueSnackbar(\"Đã tắt chế độ tự động điểm danh\", {\r\n                              variant: \"info\",\r\n                            });\r\n                          }\r\n                        : () => {\r\n                            // Bắt đầu tự động\r\n                            if (intervalId) {\r\n                              clearInterval(intervalId);\r\n                            }\r\n                            // Khởi tạo thời gian phát hiện ban đầu\r\n                            setLastDetectionTime(Date.now());\r\n                            const id = setInterval(() => {\r\n                              handleDetectFaces();\r\n                            }, AUTO_DETECT_INTERVAL);\r\n                            setIntervalId(id);\r\n                            setIsAutoMode(true);\r\n                            enqueueSnackbar(\"Đã bật chế độ tự động điểm danh\", {\r\n                              variant: \"info\",\r\n                            });\r\n                          }\r\n                    }\r\n                  >\r\n                    {isAutoMode ? \"Tắt tự động\" : \"Bật tự động\"}\r\n                  </Button>\r\n                </Box>\r\n              </Box>\r\n            </CardContent>\r\n\r\n            <Paper\r\n              elevation={3}\r\n              sx={{\r\n                position: \"relative\",\r\n                width: \"100%\",\r\n                height: \"400px\",\r\n                display: \"flex\",\r\n                justifyContent: \"center\",\r\n                alignItems: \"center\",\r\n                overflow: \"hidden\",\r\n                mb: 2,\r\n              }}\r\n            >\r\n              {isCameraReady ? (\r\n                <>\r\n                  {isAutoMode ? (\r\n                    // Sử dụng video element trực tiếp thay vì Webcam component\r\n                    <video\r\n                      ref={videoRef}\r\n                      style={{\r\n                        position: \"absolute\",\r\n                        width: \"100%\",\r\n                        height: \"100%\",\r\n                        objectFit: \"cover\",\r\n                      }}\r\n                      autoPlay\r\n                      playsInline\r\n                      muted\r\n                    />\r\n                  ) : (\r\n                    <Webcam\r\n                      audio={false}\r\n                      ref={webcamRef}\r\n                      screenshotFormat=\"image/jpeg\"\r\n                      width={640}\r\n                      height={480}\r\n                      videoConstraints={{\r\n                        width: 640,\r\n                        height: 480,\r\n                        facingMode: \"user\",\r\n                      }}\r\n                      style={{\r\n                        position: \"absolute\",\r\n                        width: \"100%\",\r\n                        height: \"100%\",\r\n                        objectFit: \"cover\",\r\n                      }}\r\n                      onUserMedia={(stream) => {\r\n                        console.log(\r\n                          \"Camera đã được cấp quyền và khởi tạo\",\r\n                          stream.id\r\n                        );\r\n                        // Đảm bảo readyState được kiểm tra khi stream đã sẵn sàng\r\n                        setTimeout(() => {\r\n                          if (webcamRef.current && webcamRef.current.video) {\r\n                            console.log(\r\n                              \"Stream ready, readyState=\",\r\n                              webcamRef.current.video.readyState\r\n                            );\r\n                            dispatch(setCameraReady(true));\r\n                            // Đặt thời gian phát hiện ban đầu\r\n                            setLastDetectionTime(Date.now());\r\n                          }\r\n                        }, 500);\r\n                      }}\r\n                      onUserMediaError={(err) => {\r\n                        console.error(\"Lỗi khi truy cập camera:\", err);\r\n                        enqueueSnackbar(\r\n                          `Không thể truy cập camera: ${\r\n                            err.name === \"NotAllowedError\"\r\n                              ? \"Bạn chưa cấp quyền truy cập camera\"\r\n                              : err.name === \"NotFoundError\"\r\n                              ? \"Không tìm thấy thiết bị camera\"\r\n                              : err.message || \"Lỗi không xác định\"\r\n                          }`,\r\n                          {\r\n                            variant: \"error\",\r\n                          }\r\n                        );\r\n                      }}\r\n                    />\r\n                  )}\r\n                  {/* Canvas hiển thị ở cả hai chế độ */}\r\n                  <canvas\r\n                    ref={canvasRef}\r\n                    style={{\r\n                      position: \"absolute\",\r\n                      top: 0,\r\n                      left: 0,\r\n                      width: \"100%\",\r\n                      height: \"100%\",\r\n                      objectFit: \"cover\",\r\n                      zIndex: 10,\r\n                    }}\r\n                  />\r\n                </>\r\n              ) : (\r\n                <Box display=\"flex\" flexDirection=\"column\" alignItems=\"center\">\r\n                  <CircularProgress size={50} />\r\n                  <Typography mt={2}>Đang khởi tạo camera...</Typography>\r\n                  <Typography\r\n                    variant=\"caption\"\r\n                    color=\"text.secondary\"\r\n                    sx={{ mt: 1 }}\r\n                  >\r\n                    {isModelLoaded\r\n                      ? \"Chờ kết nối camera - Hãy đảm bảo bạn đã cấp quyền camera\"\r\n                      : \"Đang tải mô hình nhận diện khuôn mặt\"}\r\n                  </Typography>\r\n\r\n                  <Box\r\n                    sx={{\r\n                      mt: 2,\r\n                      display: \"flex\",\r\n                      flexDirection: \"column\",\r\n                      alignItems: \"center\",\r\n                      gap: 1,\r\n                    }}\r\n                  >\r\n                    <Button\r\n                      variant=\"contained\"\r\n                      color=\"primary\"\r\n                      size=\"small\"\r\n                      onClick={initDirectCamera}\r\n                    >\r\n                      Khởi động camera trực tiếp\r\n                    </Button>\r\n\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      color=\"secondary\"\r\n                      size=\"small\"\r\n                      onClick={() => {\r\n                        setIsAutoMode(true);\r\n                        // Khởi tạo thời gian phát hiện ban đầu\r\n                        setLastDetectionTime(Date.now());\r\n                        const id = setInterval(() => {\r\n                          handleDetectFaces();\r\n                        }, AUTO_DETECT_INTERVAL);\r\n                        setIntervalId(id);\r\n                        enqueueSnackbar(\"Đã bật tự động điểm danh\", {\r\n                          variant: \"info\",\r\n                        });\r\n                      }}\r\n                    >\r\n                      Bắt đầu tự động điểm danh\r\n                    </Button>\r\n\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      color=\"warning\"\r\n                      size=\"small\"\r\n                      onClick={showStudentList}\r\n                    >\r\n                      Điểm danh thủ công\r\n                    </Button>\r\n\r\n                    <Alert severity=\"info\" sx={{ mt: 2, maxWidth: 300 }}>\r\n                      Nếu camera không hoạt động, vui lòng thử:\r\n                      <ul style={{ margin: \"8px 0\", paddingLeft: \"20px\" }}>\r\n                        <li>Kiểm tra quyền camera trên trình duyệt</li>\r\n                        <li>Làm mới trang và thử lại</li>\r\n                        <li>\r\n                          Đảm bảo không có ứng dụng khác đang sử dụng camera\r\n                        </li>\r\n                      </ul>\r\n                    </Alert>\r\n                  </Box>\r\n                </Box>\r\n              )}\r\n            </Paper>\r\n\r\n            <Box display=\"flex\" justifyContent=\"space-between\">\r\n              <Button\r\n                variant=\"outlined\"\r\n                onClick={captureAndRecognize}\r\n                startIcon={<CameraAlt />}\r\n                disabled={!isCameraReady || isRecognizing || isAutoMode}\r\n              >\r\n                {isRecognizing ? (\r\n                  <CircularProgress size={24} color=\"inherit\" />\r\n                ) : (\r\n                  \"Chụp & Nhận diện\"\r\n                )}\r\n              </Button>\r\n\r\n              <Box>\r\n                {isCameraReady && (\r\n                  <>\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      color={showLandmark ? \"success\" : \"info\"}\r\n                      onClick={toggleLandmarkDetection}\r\n                      sx={{ mr: 1 }}\r\n                    >\r\n                      {showLandmark ? \"Tắt Landmark\" : \"Hiện Landmark\"}\r\n                    </Button>\r\n\r\n                    <Button\r\n                      variant=\"outlined\"\r\n                      color={isAutoMode ? \"error\" : \"primary\"}\r\n                      onClick={() => {\r\n                        // Dừng tự động\r\n                        if (intervalId) {\r\n                          clearInterval(intervalId);\r\n                          setIntervalId(null);\r\n                        }\r\n                        setIsAutoMode(false);\r\n                        enqueueSnackbar(\"Đã tắt chế độ tự động điểm danh\", {\r\n                          variant: \"info\",\r\n                        });\r\n                      }}\r\n                      sx={{ mr: 1 }}\r\n                    >\r\n                      {isAutoMode ? \"Tắt tự động\" : \"Bật tự động\"}\r\n                    </Button>\r\n                  </>\r\n                )}\r\n\r\n                <Button\r\n                  variant=\"contained\"\r\n                  color=\"primary\"\r\n                  onClick={completeSession}\r\n                  startIcon={<Save />}\r\n                  disabled={sessionInfo?.status === \"completed\"}\r\n                >\r\n                  Kết thúc phiên\r\n                </Button>\r\n              </Box>\r\n            </Box>\r\n\r\n            {recognizedStudents.length > 0 && (\r\n              <Box mt={2}>\r\n                <Typography variant=\"subtitle1\" gutterBottom>\r\n                  Đã nhận diện ({recognizedStudents.length})\r\n                </Typography>\r\n                <Grid container spacing={1}>\r\n                  {recognizedStudents.map((student, index) => (\r\n                    <Grid item xs={6} sm={4} key={index}>\r\n                      <Paper\r\n                        elevation={2}\r\n                        sx={{\r\n                          p: 1,\r\n                          display: \"flex\",\r\n                          flexDirection: \"column\",\r\n                          alignItems: \"center\",\r\n                        }}\r\n                      >\r\n                        <Typography variant=\"body2\" noWrap>\r\n                          {student.name}\r\n                        </Typography>\r\n                        <Typography variant=\"caption\" color=\"textSecondary\">\r\n                          {Math.round(student.confidence * 100)}% match\r\n                        </Typography>\r\n                        <Button\r\n                          size=\"small\"\r\n                          variant=\"outlined\"\r\n                          color=\"primary\"\r\n                          sx={{ mt: 1 }}\r\n                          onClick={() =>\r\n                            handleMarkAttendance(\r\n                              student.studentId,\r\n                              student.confidence\r\n                            )\r\n                          }\r\n                        >\r\n                          <Check fontSize=\"small\" sx={{ mr: 0.5 }} />\r\n                          Điểm danh\r\n                        </Button>\r\n                      </Paper>\r\n                    </Grid>\r\n                  ))}\r\n                </Grid>\r\n              </Box>\r\n            )}\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs={12} md={4}>\r\n          <Card sx={{ mb: 3 }}>\r\n            <CardContent>\r\n              <Box\r\n                display=\"flex\"\r\n                justifyContent=\"space-between\"\r\n                alignItems=\"center\"\r\n                mb={2}\r\n              >\r\n                <Typography variant=\"h6\">\r\n                  Có mặt (\r\n                  {\r\n                    attendanceLogs.filter((log) => log.status === \"present\")\r\n                      .length\r\n                  }\r\n                  /{classInfo?.students.length})\r\n                </Typography>\r\n                <IconButton size=\"small\" onClick={refreshAttendanceLogs}>\r\n                  <Refresh />\r\n                </IconButton>\r\n              </Box>\r\n\r\n              <List dense>\r\n                {attendanceLogs\r\n                  .filter((log) => log.status === \"present\")\r\n                  .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp))\r\n                  .map((log) => (\r\n                    <ListItem\r\n                      key={log._id}\r\n                      secondaryAction={\r\n                        <Chip\r\n                          size=\"small\"\r\n                          icon={\r\n                            log.recognized ? (\r\n                              <VerifiedUser fontSize=\"small\" />\r\n                            ) : null\r\n                          }\r\n                          label={log.recognized ? \"Tự động\" : \"Thủ công\"}\r\n                          color={log.recognized ? \"success\" : \"primary\"}\r\n                        />\r\n                      }\r\n                    >\r\n                      <ListItemAvatar>\r\n                        <Avatar\r\n                          alt={log.student_id.full_name}\r\n                          src={log.student_id.avatar_url}\r\n                        />\r\n                      </ListItemAvatar>\r\n                      <ListItemText\r\n                        primary={log.student_id.full_name}\r\n                        secondary={`${new Date(\r\n                          log.timestamp\r\n                        ).toLocaleTimeString(\"vi-VN\")}`}\r\n                      />\r\n                    </ListItem>\r\n                  ))}\r\n\r\n                {attendanceLogs.filter((log) => log.status === \"present\")\r\n                  .length === 0 && (\r\n                  <ListItem>\r\n                    <ListItemText primary=\"Chưa có sinh viên nào điểm danh\" />\r\n                  </ListItem>\r\n                )}\r\n              </List>\r\n            </CardContent>\r\n          </Card>\r\n\r\n          <Card>\r\n            <CardContent>\r\n              <Typography variant=\"h6\" gutterBottom>\r\n                Vắng mặt ({absentStudents.length}/{classInfo?.students.length})\r\n              </Typography>\r\n\r\n              <List dense>\r\n                {absentStudents.map((student) => (\r\n                  <ListItem\r\n                    key={student._id}\r\n                    secondaryAction={\r\n                      <IconButton\r\n                        edge=\"end\"\r\n                        onClick={() => openManualAttendanceDialog(student)}\r\n                      >\r\n                        <Edit fontSize=\"small\" />\r\n                      </IconButton>\r\n                    }\r\n                  >\r\n                    <ListItemAvatar>\r\n                      <Avatar\r\n                        alt={student.full_name}\r\n                        src={student.avatar_url}\r\n                      />\r\n                    </ListItemAvatar>\r\n                    <ListItemText\r\n                      primary={student.full_name}\r\n                      secondary={student.student_code}\r\n                    />\r\n                  </ListItem>\r\n                ))}\r\n\r\n                {absentStudents.length === 0 && (\r\n                  <ListItem>\r\n                    <ListItemText primary=\"Không có sinh viên nào vắng mặt\" />\r\n                  </ListItem>\r\n                )}\r\n              </List>\r\n            </CardContent>\r\n          </Card>\r\n        </Grid>\r\n      </Grid>\r\n\r\n      {/* Dialog điểm danh thủ công */}\r\n      <Dialog open={manualDialogOpen} onClose={handleManualDialogClose}>\r\n        <DialogTitle>Điểm danh thủ công</DialogTitle>\r\n        <DialogContent>\r\n          <Box sx={{ p: 1 }}>\r\n            <Typography variant=\"subtitle1\" gutterBottom>\r\n              {selectedStudent?.full_name} ({selectedStudent?.student_code})\r\n            </Typography>\r\n\r\n            <FormControl fullWidth margin=\"normal\">\r\n              <InputLabel>Trạng thái</InputLabel>\r\n              <Select\r\n                name=\"status\"\r\n                value={manualAttendanceData.status}\r\n                onChange={handleManualAttendanceChange}\r\n                label=\"Trạng thái\"\r\n              >\r\n                <MenuItem value=\"present\">Có mặt</MenuItem>\r\n                <MenuItem value=\"absent\">Vắng mặt</MenuItem>\r\n                <MenuItem value=\"late\">Đi trễ</MenuItem>\r\n                <MenuItem value=\"early_leave\">Về sớm</MenuItem>\r\n              </Select>\r\n            </FormControl>\r\n\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              name=\"note\"\r\n              label=\"Ghi chú\"\r\n              value={manualAttendanceData.note}\r\n              onChange={handleManualAttendanceChange}\r\n              multiline\r\n              rows={2}\r\n            />\r\n          </Box>\r\n        </DialogContent>\r\n        <DialogActions>\r\n          <Button onClick={handleManualDialogClose}>Hủy</Button>\r\n          <Button onClick={handleManualAttendanceSubmit} variant=\"contained\">\r\n            Xác nhận\r\n          </Button>\r\n        </DialogActions>\r\n      </Dialog>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default AttendancePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}
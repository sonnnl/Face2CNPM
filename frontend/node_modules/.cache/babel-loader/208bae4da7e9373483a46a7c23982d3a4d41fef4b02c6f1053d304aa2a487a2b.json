{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\kasiz\\\\Documents\\\\Studying\\\\FaceReg\\\\frontend\\\\src\\\\pages\\\\teacher\\\\AttendancePage.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, lazy, Suspense, useCallback } from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport { Box, Typography, Card, CardContent, Grid, Paper, Button, Divider, CircularProgress, List, ListItem, ListItemAvatar, ListItemText, Avatar, Chip, Dialog, DialogTitle, DialogContent, DialogActions, TextField, FormControl, InputLabel, Select, MenuItem, IconButton, Alert, AlertTitle, Tooltip, Stepper, Step, StepLabel, StepContent } from \"@mui/material\";\nimport { CameraAlt, Check, Close, Edit, Refresh, Save, VerifiedUser, HourglassEmpty, ArrowBack, Info, VideocamOff, PlayCircleOutline, StopCircleOutlined, Visibility, VisibilityOff } from \"@mui/icons-material\";\nimport { setModelLoaded as setFaceRecModelLoaded,\n// Rename to avoid conflict\nsetCameraReady as setFaceRecCameraReady,\n// Rename to avoid conflict\nsetDetectedFaces, setRecognizedStudents, clearRecognitionState, getClassFaceFeatures,\n// Correct thunk action name\nverifyAttendance, manualAttendance } from \"../../redux/slices/faceRecognitionSlice\"; // Fixed relative import path\n\n// Lazy load Webcam\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst Webcam = /*#__PURE__*/lazy(_c = () => import(\"react-webcam\"));\n_c2 = Webcam;\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (faceapi.nets.tinyFaceDetector.isLoaded && faceapi.nets.faceLandmark68Net.isLoaded && faceapi.nets.faceRecognitionNet.isLoaded\n    // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null\n    });\n    await Promise.all([faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL), faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL), faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL)]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", {\n      variant: \"success\"\n    });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = student => {\n  var _student$faceFeatures, _student$faceFeatures2;\n  if (!student || !((_student$faceFeatures = student.faceFeatures) !== null && _student$faceFeatures !== void 0 && _student$faceFeatures.descriptors) && !student.faceDescriptors) {\n    return [];\n  }\n  const descriptors = [];\n  const rawDescriptors = ((_student$faceFeatures2 = student.faceFeatures) === null || _student$faceFeatures2 === void 0 ? void 0 : _student$faceFeatures2.descriptors) || student.faceDescriptors || [];\n  const findDescriptors = data => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every(n => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n  findDescriptors(rawDescriptors);\n  return descriptors.filter(d => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  _s();\n  var _classInfo$students, _classInfo$students2;\n  const {\n    classId,\n    sessionId\n  } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const {\n    enqueueSnackbar\n  } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\"\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const {\n    token\n  } = useSelector(state => state.auth);\n\n  // Access faceRecognition state directly\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents,\n    // Assuming slice holds the relevant class students\n    isProcessing,\n    error: faceRecError // Get error state\n  } = useSelector(state => state.faceRecognition);\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([axios.get(`${API_URL}/classes/teaching/${classId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        }), axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        })]);\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          // Capture the return value indicating success/failure\n          const modelsLoadedSuccessfully = await loadFaceRecognitionModels(dispatch, enqueueSnackbar);\n          // Check if model loading failed using the return value\n          if (!modelsLoadedSuccessfully) {\n            // Use the return value here\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n          // No need to check isModelLoaded from state again here\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if ((loadedSessionInfo === null || loadedSessionInfo === void 0 ? void 0 : loadedSessionInfo.status) !== \"completed\" && isModelLoaded) {\n          await dispatch(getClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        var _error$response, _error$response$data;\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg = ((_error$response = error.response) === null || _error$response === void 0 ? void 0 : (_error$response$data = _error$response.data) === null || _error$response$data === void 0 ? void 0 : _error$response$data.message) || error.message || \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, {\n          variant: \"error\"\n        });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      var _webcamRef$current, _webcamRef$current$vi, _webcamRef$current$vi2;\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      (_webcamRef$current = webcamRef.current) === null || _webcamRef$current === void 0 ? void 0 : (_webcamRef$current$vi = _webcamRef$current.video) === null || _webcamRef$current$vi === void 0 ? void 0 : (_webcamRef$current$vi2 = _webcamRef$current$vi.srcObject) === null || _webcamRef$current$vi2 === void 0 ? void 0 : _webcamRef$current$vi2.getTracks().forEach(track => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(stream => {\n    console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n    dispatch(setFaceRecCameraReady(true));\n    setComponentError(null); // Clear camera errors\n  }, [dispatch]);\n  const handleUserMediaError = useCallback(error => {\n    console.error(\"Lỗi khi truy cập camera:\", error);\n    const errMsg = `Không thể truy cập camera: ${error.name === \"NotAllowedError\" ? \"Bạn chưa cấp quyền truy cập camera\" : error.name === \"NotFoundError\" ? \"Không tìm thấy thiết bị camera\" : error.message || \"Lỗi không xác định\"}`;\n    enqueueSnackbar(errMsg, {\n      variant: \"error\"\n    });\n    dispatch(setFaceRecCameraReady(false));\n    setComponentError(errMsg);\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback((detections, recognizedData = []) => {\n    var _webcamRef$current2;\n    if (!canvasRef.current || !((_webcamRef$current2 = webcamRef.current) !== null && _webcamRef$current2 !== void 0 && _webcamRef$current2.video)) return;\n    const video = webcamRef.current.video;\n    const canvas = canvasRef.current;\n    const displaySize = {\n      width: video.videoWidth,\n      height: video.videoHeight\n    };\n    faceapi.matchDimensions(canvas, displaySize);\n    const resizedDetections = faceapi.resizeResults(detections, displaySize);\n    const ctx = canvas.getContext(\"2d\");\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    resizedDetections.forEach((detection, i) => {\n      const box = detection.detection.box;\n      const landmarks = detection.landmarks;\n      const recognized = recognizedData.find(rec => rec.detectionIndex === i); // Match recognition result\n\n      // Draw box\n      const boxColor = recognized ? recognized.confidence > CONFIDENCE_THRESHOLD ? \"#4CAF50\" : \"#FFC107\" : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n      ctx.strokeStyle = boxColor;\n      ctx.lineWidth = 2;\n      ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n      // Draw label background\n      const label = recognized ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)` : \"Đang nhận diện...\";\n      const textWidth = ctx.measureText(label).width;\n      ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n      ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n      // Draw label text\n      ctx.fillStyle = \"#FFFFFF\";\n      ctx.font = \"14px Arial\";\n      ctx.fillText(label, box.x + 5, box.y - 5);\n\n      // Draw landmarks if enabled\n      if (showLandmarks && landmarks) {\n        faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n      }\n    });\n  }, [showLandmarks]); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(async (recognize = true) => {\n    var _webcamRef$current3;\n    if (!isCameraReady || !((_webcamRef$current3 = webcamRef.current) !== null && _webcamRef$current3 !== void 0 && _webcamRef$current3.video) || webcamRef.current.video.readyState !== 4 || !isModelLoaded) {\n      return null; // Return null if detection can't proceed\n    }\n    const video = webcamRef.current.video;\n    try {\n      let faceData;\n      if (recognize) {\n        // Detect faces, landmarks, and descriptors for recognition\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks().withFaceDescriptors();\n      } else {\n        // Only detect faces and landmarks (for drawing)\n        faceData = await faceapi.detectAllFaces(video, FACE_DETECTION_OPTIONS).withFaceLandmarks();\n      }\n      dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n      if (!faceData || faceData.length === 0) {\n        // Clear canvas if no faces detected\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n        }\n        dispatch(setRecognizedStudents([])); // Clear recognized students\n        return null;\n      }\n\n      // --- Recognition Logic (if recognize === true) ---\n      let recognizedData = [];\n      if (recognize && classStudents && classStudents.length > 0) {\n        const labeledDescriptors = classStudents.map(student => {\n          const descriptors = extractStudentDescriptors(student);\n          if (descriptors.length > 0) {\n            return new faceapi.LabeledFaceDescriptors(student._id, descriptors); // Use student ID as label\n          }\n          return null;\n        }).filter(ld => ld !== null); // Filter out students with no descriptors\n\n        if (labeledDescriptors.length > 0) {\n          const faceMatcher = new faceapi.FaceMatcher(labeledDescriptors, RECOGNITION_THRESHOLD);\n          recognizedData = faceData.map((fd, index) => {\n            const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n            const student = classStudents.find(s => s._id === bestMatch.label); // Find student by ID label\n            return {\n              detectionIndex: index,\n              // Link recognition to detection\n              studentId: student === null || student === void 0 ? void 0 : student._id,\n              name: (student === null || student === void 0 ? void 0 : student.full_name) || \"Không rõ\",\n              confidence: 1 - bestMatch.distance,\n              // Convert distance to confidence-like score\n              isUnknown: bestMatch.label === \"unknown\"\n            };\n          }).filter(r => !r.isUnknown); // Filter out unknown matches\n\n          dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n        } else {\n          dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n        }\n      }\n\n      // Draw landmarks and boxes with recognition info\n      drawLandmarks(faceData, recognizedData);\n      return {\n        detections: faceData,\n        recognized: recognizedData\n      }; // Return both detection and recognition results\n    } catch (error) {\n      console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n      enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n        variant: \"error\"\n      });\n      // Clear canvas on error\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n      dispatch(setDetectedFaces([]));\n      dispatch(setRecognizedStudents([]));\n      return null;\n    }\n  }, [isCameraReady, isModelLoaded, classStudents, drawLandmarks, dispatch, enqueueSnackbar]);\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort((a, b) => b.confidence - a.confidence)[0];\n      enqueueSnackbar(`Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(1)}%)`, {\n        variant: \"info\"\n      });\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence > CONFIDENCE_THRESHOLD) {\n        handleMarkAttendance(topMatch.studentId, topMatch.confidence);\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\", {\n        variant: \"warning\"\n      });\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", {\n        variant: \"warning\"\n      });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = student => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({\n      status: \"present\",\n      note: \"\"\n    }); // Reset form\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change\n  const handleManualAttendanceChange = e => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n    try {\n      const result = await dispatch(manualAttendance({\n        sessionId,\n        studentId: selectedStudent._id,\n        status: manualAttendanceData.status,\n        note: manualAttendanceData.note\n      })).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id;\n          return ((_log$student_id = log.student_id) === null || _log$student_id === void 0 ? void 0 : _log$student_id._id) === selectedStudent._id;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: selectedStudent\n        }; // Use the selected student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh thủ công cho ${selectedStudent.full_name}`, {\n        variant: \"success\"\n      });\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\"\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(async (studentId, confidence) => {\n    if (!studentId || isProcessing) return;\n\n    // Check if student already marked present\n    const isAlreadyPresent = attendanceLogs.some(log => {\n      var _log$student_id2;\n      return ((_log$student_id2 = log.student_id) === null || _log$student_id2 === void 0 ? void 0 : _log$student_id2._id) === studentId && log.status === \"present\";\n    });\n    if (isAlreadyPresent) {\n      // console.log(`Student ${studentId} already marked present.`);\n      return; // Don't mark again if already present\n    }\n    const student = classStudents.find(s => s._id === studentId);\n    if (!student) {\n      console.warn(\"Student not found for marking attendance:\", studentId);\n      return;\n    }\n\n    // Capture image for proof (optional, but good practice)\n    let imageBase64 = null;\n    try {\n      if (webcamRef.current) {\n        imageBase64 = webcamRef.current.getScreenshot({\n          width: 320,\n          height: 240\n        }); // Smaller screenshot\n      }\n    } catch (screenshotError) {\n      console.error(\"Error taking screenshot:\", screenshotError);\n      // Proceed without image if screenshot fails\n    }\n    try {\n      const result = await dispatch(verifyAttendance({\n        sessionId,\n        studentId,\n        // faceDescriptor: null, // Descriptor not strictly needed for verification API if confidence is high\n        confidence,\n        imageBase64,\n        recognized: true // Mark as recognized by the system\n      })).unwrap();\n\n      // Update local attendance logs\n      setAttendanceLogs(prevLogs => {\n        const existingLogIndex = prevLogs.findIndex(log => {\n          var _log$student_id3;\n          return ((_log$student_id3 = log.student_id) === null || _log$student_id3 === void 0 ? void 0 : _log$student_id3._id) === studentId;\n        });\n        const newLog = {\n          ...result.data,\n          student_id: student\n        }; // Use the found student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n      enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n        variant: \"success\"\n      });\n    } catch (error) {\n      console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n        variant: \"error\"\n      });\n    }\n  }, [dispatch, sessionId, classStudents, attendanceLogs, isProcessing, enqueueSnackbar]); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (!isCameraReady || !isModelLoaded || !classStudents || classStudents.length === 0) {\n      enqueueSnackbar(\"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\", {\n        variant: \"warning\"\n      });\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach(rec => {\n          if (rec.confidence > CONFIDENCE_THRESHOLD && rec.studentId) {\n            handleMarkAttendance(rec.studentId, rec.confidence); // Attempt to mark attendance\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [isCameraReady, isModelLoaded, classStudents, detectAndRecognizeFaces, handleMarkAttendance, enqueueSnackbar]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", {\n      variant: \"info\"\n    });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang kết thúc phiên...\", {\n        variant: \"info\"\n      });\n      await axios.put(`${API_URL}/attendance/sessions/${sessionId}`, {\n        status: \"completed\"\n      }, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", {\n        variant: \"success\"\n      });\n      setSessionInfo(prev => ({\n        ...prev,\n        status: \"completed\"\n      })); // Update local state\n      stopAutoAttendance(); // Stop auto mode if running\n      // Optionally navigate back after a delay\n      // setTimeout(() => navigate(`/teacher/classes/${classId}`), 1000);\n    } catch (error) {\n      var _error$response2, _error$response2$data;\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(((_error$response2 = error.response) === null || _error$response2 === void 0 ? void 0 : (_error$response2$data = _error$response2.data) === null || _error$response2$data === void 0 ? void 0 : _error$response2$data.message) || \"Lỗi khi kết thúc phiên\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", {\n        variant: \"info\"\n      });\n      const [logsRes, sessionRes] = await Promise.all([axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      }), axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      })]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", {\n        variant: \"success\"\n      });\n    } catch (error) {\n      var _error$response3, _error$response3$data;\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(((_error$response3 = error.response) === null || _error$response3 === void 0 ? void 0 : (_error$response3$data = _error$response3.data) === null || _error$response3$data === void 0 ? void 0 : _error$response3$data.message) || \"Lỗi khi làm mới dữ liệu\", {\n        variant: \"error\"\n      });\n    }\n  };\n  const toggleLandmarks = () => {\n    setShowLandmarks(prev => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(log => log.status === \"present\");\n  const absentStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students = classInfo.students) === null || _classInfo$students === void 0 ? void 0 : _classInfo$students.filter(student => !attendanceLogs.some(log => {\n    var _log$student_id4;\n    return ((_log$student_id4 = log.student_id) === null || _log$student_id4 === void 0 ? void 0 : _log$student_id4._id) === student._id && (log.status === \"present\" || log.status === \"late\");\n  }) // Consider late as not absent\n  )) || [];\n  const totalStudents = (classInfo === null || classInfo === void 0 ? void 0 : (_classInfo$students2 = classInfo.students) === null || _classInfo$students2 === void 0 ? void 0 : _classInfo$students2.length) || 0;\n  const sessionCompleted = (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"center\",\n      alignItems: \"center\",\n      minHeight: \"80vh\",\n      children: [/*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 824,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        sx: {\n          ml: 2\n        },\n        children: \"\\u0110ang t\\u1EA3i d\\u1EEF li\\u1EC7u \\u0111i\\u1EC3m danh...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 825,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 818,\n      columnNumber: 7\n    }, this);\n  }\n  if (componentError && !isLoading) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 3\n      },\n      children: /*#__PURE__*/_jsxDEV(Alert, {\n        severity: \"error\",\n        action: /*#__PURE__*/_jsxDEV(Button, {\n          color: \"inherit\",\n          size: \"small\",\n          onClick: () => window.location.reload(),\n          children: \"T\\u1EA3i l\\u1EA1i trang\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 836,\n          columnNumber: 13\n        }, this),\n        children: [/*#__PURE__*/_jsxDEV(AlertTitle, {\n          children: \"\\u0110\\xE3 x\\u1EA3y ra l\\u1ED7i\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 845,\n          columnNumber: 11\n        }, this), componentError]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 833,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 832,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      p: {\n        xs: 1,\n        sm: 2,\n        md: 3\n      }\n    },\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      display: \"flex\",\n      justifyContent: \"space-between\",\n      alignItems: \"center\",\n      mb: 2.5,\n      pb: 2,\n      borderBottom: \"1px solid #eaeaea\",\n      children: [/*#__PURE__*/_jsxDEV(Box, {\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h5\",\n          fontWeight: 500,\n          children: [\"\\u0110i\\u1EC3m Danh - \", classInfo === null || classInfo === void 0 ? void 0 : classInfo.class_name]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 864,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"subtitle1\",\n          color: \"textSecondary\",\n          children: [\"Bu\\u1ED5i \", sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.session_number, \" -\", \" \", sessionInfo !== null && sessionInfo !== void 0 && sessionInfo.date ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\") : \"N/A\", /*#__PURE__*/_jsxDEV(Chip, {\n            label: (sessionInfo === null || sessionInfo === void 0 ? void 0 : sessionInfo.status) || \"N/A\",\n            color: sessionCompleted ? \"default\" : \"success\",\n            size: \"small\",\n            sx: {\n              ml: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 872,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 867,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 863,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        startIcon: /*#__PURE__*/_jsxDEV(ArrowBack, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 882,\n          columnNumber: 22\n        }, this),\n        onClick: () => navigate(`/teacher/classes/${classId}`),\n        children: \"Quay l\\u1EA1i l\\u1EDBp\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 880,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 855,\n      columnNumber: 7\n    }, this), sessionCompleted && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"info\",\n      sx: {\n        mb: 2\n      },\n      children: \"Phi\\xEAn \\u0111i\\u1EC3m danh n\\xE0y \\u0111\\xE3 k\\u1EBFt th\\xFAc. B\\u1EA1n ch\\u1EC9 c\\xF3 th\\u1EC3 xem l\\u1EA1i k\\u1EBFt qu\\u1EA3.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 890,\n      columnNumber: 9\n    }, this), faceRecError && /*#__PURE__*/_jsxDEV(Alert, {\n      severity: \"warning\",\n      sx: {\n        mb: 2\n      },\n      children: [\"L\\u1ED7i t\\u1EEB h\\u1EC7 th\\u1ED1ng nh\\u1EADn di\\u1EC7n: \", faceRecError]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 896,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Grid, {\n      container: true,\n      spacing: 3,\n      children: [/*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 8,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3,\n            overflow: \"hidden\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(CardContent, {\n            sx: {\n              bgcolor: \"#f8f9fa\",\n              borderBottom: \"1px solid #eaeaea\",\n              p: 2\n            },\n            children: /*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                fontWeight: 500,\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(CameraAlt, {\n                  sx: {\n                    mr: 1,\n                    color: \"primary.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 923,\n                  columnNumber: 19\n                }, this), \" Camera\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 917,\n                columnNumber: 17\n              }, this), !sessionCompleted && isModelLoaded &&\n              /*#__PURE__*/\n              // Show controls only if session active and model loaded\n              _jsxDEV(Box, {\n                children: [/*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: isAutoMode ? \"Dừng chế độ tự động\" : \"Bắt đầu chế độ tự động\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: isAutoMode ? stopAutoAttendance : startAutoAttendance,\n                    color: isAutoMode ? \"error\" : \"primary\",\n                    disabled: !isCameraReady,\n                    children: isAutoMode ? /*#__PURE__*/_jsxDEV(StopCircleOutlined, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 945,\n                      columnNumber: 29\n                    }, this) : /*#__PURE__*/_jsxDEV(PlayCircleOutline, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 947,\n                      columnNumber: 29\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 935,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 928,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                  title: showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\",\n                  children: /*#__PURE__*/_jsxDEV(IconButton, {\n                    onClick: toggleLandmarks,\n                    color: \"secondary\",\n                    disabled: !isCameraReady || isAutoMode,\n                    children: showLandmarks ? /*#__PURE__*/_jsxDEV(VisibilityOff, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 959,\n                      columnNumber: 44\n                    }, this) : /*#__PURE__*/_jsxDEV(Visibility, {}, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 959,\n                      columnNumber: 64\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 954,\n                    columnNumber: 25\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 951,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 927,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 912,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 905,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              position: \"relative\",\n              width: \"100%\",\n              aspectRatio: \"640 / 480\",\n              backgroundColor: \"#000\",\n              display: \"flex\",\n              justifyContent: \"center\",\n              alignItems: \"center\"\n            },\n            children: [!isModelLoaded && !sessionCompleted ? /*#__PURE__*/_jsxDEV(Box, {\n              textAlign: \"center\",\n              color: \"white\",\n              children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 981,\n                columnNumber: 19\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                children: \"\\u0110ang t\\u1EA3i m\\xF4 h\\xECnh nh\\u1EADn di\\u1EC7n...\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 982,\n                columnNumber: 19\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 980,\n              columnNumber: 17\n            }, this) : !sessionCompleted ? /*#__PURE__*/_jsxDEV(Suspense, {\n              fallback: /*#__PURE__*/_jsxDEV(Box, {\n                textAlign: \"center\",\n                color: \"white\",\n                children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n                  color: \"inherit\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 988,\n                  columnNumber: 23\n                }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                  children: \"\\u0110ang kh\\u1EDFi t\\u1EA1o camera...\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 989,\n                  columnNumber: 23\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 987,\n                columnNumber: 21\n              }, this),\n              children: /*#__PURE__*/_jsxDEV(Webcam, {\n                audio: false,\n                ref: webcamRef,\n                screenshotFormat: \"image/jpeg\",\n                width: \"100%\",\n                height: \"100%\",\n                videoConstraints: {\n                  width: 640,\n                  height: 480,\n                  facingMode: \"user\"\n                },\n                style: {\n                  display: \"block\",\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  objectFit: \"cover\"\n                },\n                onUserMedia: handleUserMedia,\n                onUserMediaError: handleUserMediaError\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 993,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 985,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(Typography, {\n              color: \"white\",\n              children: \"Phi\\xEAn \\u0111\\xE3 k\\u1EBFt th\\xFAc\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1018,\n              columnNumber: 17\n            }, this) // Placeholder if session completed\n            , /*#__PURE__*/_jsxDEV(\"canvas\", {\n              ref: canvasRef,\n              style: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                zIndex: 10\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1022,\n              columnNumber: 15\n            }, this), (!isCameraReady || (componentError === null || componentError === void 0 ? void 0 : componentError.includes(\"camera\"))) && !sessionCompleted && /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                position: \"absolute\",\n                top: 0,\n                left: 0,\n                width: \"100%\",\n                height: \"100%\",\n                backgroundColor: \"rgba(0,0,0,0.7)\",\n                display: \"flex\",\n                flexDirection: \"column\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n                color: \"white\",\n                zIndex: 20\n              },\n              children: [/*#__PURE__*/_jsxDEV(VideocamOff, {\n                sx: {\n                  fontSize: 60,\n                  mb: 2\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1053,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                children: \"Camera kh\\xF4ng kh\\u1EA3 d\\u1EE5ng\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1054,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mt: 1,\n                  px: 2,\n                  textAlign: \"center\"\n                },\n                children: componentError || \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1055,\n                columnNumber: 21\n              }, this), /*#__PURE__*/_jsxDEV(Button, {\n                variant: \"outlined\",\n                color: \"inherit\",\n                sx: {\n                  mt: 2\n                },\n                onClick: () => window.location.reload(),\n                children: \"Th\\u1EED l\\u1EA1i\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1062,\n                columnNumber: 21\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1037,\n              columnNumber: 19\n            }, this), isAutoMode && isCameraReady && /*#__PURE__*/_jsxDEV(Chip, {\n              label: \"\\u0110ang t\\u1EF1 \\u0111\\u1ED9ng \\u0111i\\u1EC3m danh\",\n              color: \"success\",\n              size: \"small\",\n              sx: {\n                position: \"absolute\",\n                bottom: 10,\n                right: 10,\n                zIndex: 15\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1074,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 968,\n            columnNumber: 13\n          }, this), !sessionCompleted && isCameraReady && isModelLoaded && /*#__PURE__*/_jsxDEV(Box, {\n            display: \"flex\",\n            justifyContent: \"space-between\",\n            p: 2,\n            bgcolor: \"#f8f9fa\",\n            borderTop: \"1px solid #eaeaea\",\n            children: [/*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              onClick: handleManualCapture,\n              startIcon: isProcessing ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n                size: 20,\n                color: \"inherit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1102,\n                columnNumber: 23\n              }, this) : /*#__PURE__*/_jsxDEV(CameraAlt, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1104,\n                columnNumber: 23\n              }, this),\n              disabled: isProcessing || isAutoMode,\n              children: \"Ch\\u1EE5p & Nh\\u1EADn di\\u1EC7n\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1097,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Button, {\n              variant: \"contained\",\n              color: \"secondary\",\n              onClick: completeSession,\n              startIcon: /*#__PURE__*/_jsxDEV(Save, {}, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1115,\n                columnNumber: 30\n              }, this),\n              disabled: isProcessing,\n              children: \"K\\u1EBFt th\\xFAc phi\\xEAn\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1111,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1090,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 904,\n          columnNumber: 11\n        }, this), recognizedStudents.length > 0 && !isAutoMode && /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mt: 2,\n            borderRadius: \"10px\",\n            boxShadow: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"subtitle1\",\n              fontWeight: \"500\",\n              mb: 1,\n              children: \"\\u0110\\xE3 nh\\u1EADn di\\u1EC7n g\\u1EA7n \\u0111\\xE2y\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1128,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(Grid, {\n              container: true,\n              spacing: 1,\n              children: recognizedStudents.slice(0, 4).map((rec, index // Show max 4\n              ) => /*#__PURE__*/_jsxDEV(Grid, {\n                item: true,\n                xs: 6,\n                sm: 3,\n                children: /*#__PURE__*/_jsxDEV(Paper, {\n                  elevation: 0,\n                  sx: {\n                    p: 1,\n                    textAlign: \"center\",\n                    border: \"1px solid #eee\"\n                  },\n                  children: [/*#__PURE__*/_jsxDEV(Typography, {\n                    variant: \"caption\",\n                    display: \"block\",\n                    noWrap: true,\n                    children: rec.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1151,\n                    columnNumber: 27\n                  }, this), /*#__PURE__*/_jsxDEV(Chip, {\n                    label: `${(rec.confidence * 100).toFixed(0)}%`,\n                    size: \"small\",\n                    color: rec.confidence > CONFIDENCE_THRESHOLD ? \"success\" : \"warning\",\n                    sx: {\n                      mt: 0.5\n                    }\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1154,\n                    columnNumber: 27\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1143,\n                  columnNumber: 25\n                }, this)\n              }, `${rec.studentId}-${index}`, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1137,\n                columnNumber: 23\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1131,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1127,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1126,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 903,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Grid, {\n        item: true,\n        xs: 12,\n        md: 4,\n        children: [/*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            mb: 3,\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Box, {\n              display: \"flex\",\n              justifyContent: \"space-between\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"h6\",\n                display: \"flex\",\n                alignItems: \"center\",\n                children: [/*#__PURE__*/_jsxDEV(Check, {\n                  sx: {\n                    mr: 1,\n                    color: \"success.main\"\n                  }\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1186,\n                  columnNumber: 19\n                }, this), \" C\\xF3 m\\u1EB7t (\", presentStudents.length, \"/\", totalStudents, \")\"]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 1185,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(Tooltip, {\n                title: \"L\\xE0m m\\u1EDBi danh s\\xE1ch\",\n                children: /*#__PURE__*/_jsxDEV(IconButton, {\n                  size: \"small\",\n                  onClick: refreshAttendanceLogs,\n                  disabled: isProcessing,\n                  children: /*#__PURE__*/_jsxDEV(Refresh, {}, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1195,\n                    columnNumber: 21\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1190,\n                  columnNumber: 19\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1189,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1179,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1199,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: presentStudents.map(student => /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                children: student.full_name\n              }, student._id, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1202,\n                columnNumber: 19\n              }, this))\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1200,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1178,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1177,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Card, {\n          sx: {\n            borderRadius: \"10px\",\n            boxShadow: 3\n          },\n          children: /*#__PURE__*/_jsxDEV(CardContent, {\n            children: [/*#__PURE__*/_jsxDEV(Typography, {\n              variant: \"h6\",\n              display: \"flex\",\n              alignItems: \"center\",\n              mb: 1,\n              children: [/*#__PURE__*/_jsxDEV(Close, {\n                sx: {\n                  mr: 1,\n                  color: \"error.main\"\n                }\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1219,\n                columnNumber: 17\n              }, this), \" V\\u1EAFng m\\u1EB7t (\", absentStudents.length, \"/\", totalStudents, \")\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 1213,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Divider, {\n              sx: {\n                mb: 1\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1222,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                maxHeight: \"300px\",\n                overflow: \"auto\",\n                pr: 1\n              },\n              children: absentStudents.length === 0 ? /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                color: \"textSecondary\",\n                align: \"center\",\n                sx: {\n                  py: 2\n                },\n                children: \"T\\u1EA5t c\\u1EA3 sinh vi\\xEAn \\u0111\\xE3 c\\xF3 m\\u1EB7t.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1225,\n                columnNumber: 19\n              }, this) : /*#__PURE__*/_jsxDEV(List, {\n                dense: true,\n                children: absentStudents.map(student => /*#__PURE__*/_jsxDEV(ListItem, {\n                  disablePadding: true,\n                  sx: {\n                    mb: 0.5\n                  },\n                  secondaryAction: !sessionCompleted ? /*#__PURE__*/_jsxDEV(Tooltip, {\n                    title: \"\\u0110i\\u1EC3m danh th\\u1EE7 c\\xF4ng\",\n                    children: /*#__PURE__*/_jsxDEV(IconButton, {\n                      edge: \"end\",\n                      size: \"small\",\n                      onClick: () => openManualAttendanceDialog(student),\n                      disabled: isProcessing,\n                      children: /*#__PURE__*/_jsxDEV(Edit, {\n                        fontSize: \"small\"\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1251,\n                        columnNumber: 33\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1243,\n                      columnNumber: 31\n                    }, this)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1242,\n                    columnNumber: 29\n                  }, this) : null,\n                  children: /*#__PURE__*/_jsxDEV(Paper, {\n                    variant: \"outlined\",\n                    sx: {\n                      width: \"100%\",\n                      display: \"flex\",\n                      alignItems: \"center\",\n                      p: 0.5,\n                      borderRadius: \"4px\"\n                    },\n                    children: [/*#__PURE__*/_jsxDEV(ListItemAvatar, {\n                      sx: {\n                        minWidth: 45\n                      },\n                      children: /*#__PURE__*/_jsxDEV(Avatar, {\n                        alt: student.full_name,\n                        src: student.avatar_url,\n                        sx: {\n                          width: 32,\n                          height: 32\n                        }\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1268,\n                        columnNumber: 29\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1267,\n                      columnNumber: 27\n                    }, this), /*#__PURE__*/_jsxDEV(ListItemText, {\n                      primary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"body2\",\n                        noWrap: true,\n                        children: student.full_name\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1276,\n                        columnNumber: 31\n                      }, this),\n                      secondary: /*#__PURE__*/_jsxDEV(Typography, {\n                        variant: \"caption\",\n                        color: \"text.secondary\",\n                        children: student.student_code\n                      }, void 0, false, {\n                        fileName: _jsxFileName,\n                        lineNumber: 1281,\n                        columnNumber: 31\n                      }, this)\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 1274,\n                      columnNumber: 27\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 1257,\n                    columnNumber: 25\n                  }, this)\n                }, student._id, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 1236,\n                  columnNumber: 23\n                }, this))\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 1234,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 1223,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 1212,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1211,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1175,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 901,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Dialog, {\n      open: manualDialogOpen,\n      onClose: handleManualDialogClose,\n      maxWidth: \"xs\",\n      fullWidth: true,\n      children: [/*#__PURE__*/_jsxDEV(DialogTitle, {\n        children: \"\\u0110i\\u1EC3m Danh Th\\u1EE7 C\\xF4ng\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1307,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogContent, {\n        children: [/*#__PURE__*/_jsxDEV(TextField, {\n          label: \"Tr\\u1EA1ng Th\\xE1i\",\n          name: \"status\",\n          value: manualAttendanceData.status,\n          onChange: handleManualAttendanceChange,\n          fullWidth: true\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1309,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(TextField, {\n          label: \"Ghi Ch\\xFA\",\n          name: \"note\",\n          value: manualAttendanceData.note,\n          onChange: handleManualAttendanceChange,\n          fullWidth: true,\n          multiline: true,\n          rows: 4\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1316,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1308,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(DialogActions, {\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualDialogClose,\n          children: \"H\\u1EE7y\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1327,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          onClick: handleManualAttendanceSubmit,\n          children: \"L\\u01B0u\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1328,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1326,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1301,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 853,\n    columnNumber: 5\n  }, this);\n};\n_s(AttendancePage, \"ORIzqp/hsJvgl/xMWwFDwVJkKrg=\", false, function () {\n  return [useParams, useNavigate, useDispatch, useSnackbar, useSelector, useSelector];\n});\n_c3 = AttendancePage;\nexport default AttendancePage;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"Webcam$lazy\");\n$RefreshReg$(_c2, \"Webcam\");\n$RefreshReg$(_c3, \"AttendancePage\");","map":{"version":3,"names":["React","useState","useEffect","useRef","lazy","Suspense","useCallback","useParams","useNavigate","useDispatch","useSelector","useSnackbar","axios","faceapi","Box","Typography","Card","CardContent","Grid","Paper","Button","Divider","CircularProgress","List","ListItem","ListItemAvatar","ListItemText","Avatar","Chip","Dialog","DialogTitle","DialogContent","DialogActions","TextField","FormControl","InputLabel","Select","MenuItem","IconButton","Alert","AlertTitle","Tooltip","Stepper","Step","StepLabel","StepContent","CameraAlt","Check","Close","Edit","Refresh","Save","VerifiedUser","HourglassEmpty","ArrowBack","Info","VideocamOff","PlayCircleOutline","StopCircleOutlined","Visibility","VisibilityOff","setModelLoaded","setFaceRecModelLoaded","setCameraReady","setFaceRecCameraReady","setDetectedFaces","setRecognizedStudents","clearRecognitionState","getClassFaceFeatures","verifyAttendance","manualAttendance","jsxDEV","_jsxDEV","Webcam","_c","_c2","API_URL","process","env","REACT_APP_API_URL","RECOGNITION_THRESHOLD","DETECTION_THRESHOLD","CONFIDENCE_THRESHOLD","AUTO_DETECT_INTERVAL","FACE_DETECTION_OPTIONS","TinyFaceDetectorOptions","scoreThreshold","inputSize","MODEL_URL","loadFaceRecognitionModels","dispatch","enqueueSnackbar","nets","tinyFaceDetector","isLoaded","faceLandmark68Net","faceRecognitionNet","variant","autoHideDuration","Promise","all","loadFromUri","error","console","extractStudentDescriptors","student","_student$faceFeatures","_student$faceFeatures2","faceFeatures","descriptors","faceDescriptors","rawDescriptors","findDescriptors","data","Array","isArray","length","every","n","push","Float32Array","forEach","Object","values","filter","d","AttendancePage","_s","_classInfo$students","_classInfo$students2","classId","sessionId","navigate","webcamRef","canvasRef","autoModeIntervalRef","landmarkIntervalRef","isLoading","setIsLoading","classInfo","setClassInfo","sessionInfo","setSessionInfo","attendanceLogs","setAttendanceLogs","isAutoMode","setIsAutoMode","showLandmarks","setShowLandmarks","manualDialogOpen","setManualDialogOpen","selectedStudent","setSelectedStudent","manualAttendanceData","setManualAttendanceData","status","note","componentError","setComponentError","token","state","auth","isModelLoaded","isCameraReady","detectedFaces","recognizedStudents","classStudents","isProcessing","faceRecError","faceRecognition","loadData","classRes","sessionRes","logsRes","get","headers","Authorization","loadedSessionInfo","modelsLoadedSuccessfully","Error","unwrap","_error$response","_error$response$data","errMsg","response","message","_webcamRef$current","_webcamRef$current$vi","_webcamRef$current$vi2","clearInterval","current","video","srcObject","getTracks","track","stop","startLandmarkDetection","stopLandmarkDetection","ctx","getContext","clearRect","width","height","handleUserMedia","stream","log","id","handleUserMediaError","name","drawLandmarks","detections","recognizedData","_webcamRef$current2","canvas","displaySize","videoWidth","videoHeight","matchDimensions","resizedDetections","resizeResults","detection","i","box","landmarks","recognized","find","rec","detectionIndex","boxColor","confidence","strokeStyle","lineWidth","strokeRect","x","y","label","toFixed","textWidth","measureText","fillStyle","fillRect","font","fillText","draw","drawFaceLandmarks","detectAndRecognizeFaces","recognize","_webcamRef$current3","readyState","faceData","detectAllFaces","withFaceLandmarks","withFaceDescriptors","labeledDescriptors","map","LabeledFaceDescriptors","_id","ld","faceMatcher","FaceMatcher","fd","index","bestMatch","findBestMatch","descriptor","s","studentId","full_name","distance","isUnknown","r","handleManualCapture","result","topMatch","sort","a","b","handleMarkAttendance","openManualAttendanceDialog","handleManualDialogClose","handleManualAttendanceChange","e","target","value","handleManualAttendanceSubmit","prevLogs","existingLogIndex","findIndex","_log$student_id","student_id","newLog","updatedLogs","isAlreadyPresent","some","_log$student_id2","warn","imageBase64","getScreenshot","screenshotError","_log$student_id3","startAutoAttendance","stopAutoAttendance","setInterval","completeSession","put","prev","_error$response2","_error$response2$data","refreshAttendanceLogs","_error$response3","_error$response3$data","toggleLandmarks","presentStudents","absentStudents","students","_log$student_id4","totalStudents","sessionCompleted","display","justifyContent","alignItems","minHeight","children","fileName","_jsxFileName","lineNumber","columnNumber","sx","ml","p","severity","action","color","size","onClick","window","location","reload","xs","sm","md","mb","pb","borderBottom","fontWeight","class_name","session_number","date","Date","toLocaleDateString","startIcon","container","spacing","item","borderRadius","boxShadow","overflow","bgcolor","mr","title","disabled","position","aspectRatio","backgroundColor","textAlign","fallback","audio","ref","screenshotFormat","videoConstraints","facingMode","style","top","left","objectFit","onUserMedia","onUserMediaError","zIndex","includes","flexDirection","fontSize","mt","px","bottom","right","borderTop","slice","elevation","border","noWrap","maxHeight","pr","align","py","dense","disablePadding","secondaryAction","edge","minWidth","alt","src","avatar_url","primary","secondary","student_code","open","onClose","maxWidth","fullWidth","onChange","multiline","rows","_c3","$RefreshReg$"],"sources":["C:/Users/kasiz/Documents/Studying/FaceReg/frontend/src/pages/teacher/AttendancePage.js"],"sourcesContent":["import React, {\n  useState,\n  useEffect,\n  useRef,\n  lazy,\n  Suspense,\n  useCallback,\n} from \"react\";\nimport { useParams, useNavigate } from \"react-router-dom\";\nimport { useDispatch, useSelector } from \"react-redux\";\nimport { useSnackbar } from \"notistack\";\nimport axios from \"axios\";\nimport * as faceapi from \"face-api.js\";\nimport {\n  Box,\n  Typography,\n  Card,\n  CardContent,\n  Grid,\n  Paper,\n  Button,\n  Divider,\n  CircularProgress,\n  List,\n  ListItem,\n  ListItemAvatar,\n  ListItemText,\n  Avatar,\n  Chip,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  TextField,\n  FormControl,\n  InputLabel,\n  Select,\n  MenuItem,\n  IconButton,\n  Alert,\n  AlertTitle,\n  Tooltip,\n  Stepper,\n  Step,\n  StepLabel,\n  StepContent,\n} from \"@mui/material\";\nimport {\n  CameraAlt,\n  Check,\n  Close,\n  Edit,\n  Refresh,\n  Save,\n  VerifiedUser,\n  HourglassEmpty,\n  ArrowBack,\n  Info,\n  VideocamOff,\n  PlayCircleOutline,\n  StopCircleOutlined,\n  Visibility,\n  VisibilityOff,\n} from \"@mui/icons-material\";\nimport {\n  setModelLoaded as setFaceRecModelLoaded, // Rename to avoid conflict\n  setCameraReady as setFaceRecCameraReady, // Rename to avoid conflict\n  setDetectedFaces,\n  setRecognizedStudents,\n  clearRecognitionState,\n  getClassFaceFeatures, // Correct thunk action name\n  verifyAttendance,\n  manualAttendance,\n} from \"../../redux/slices/faceRecognitionSlice\"; // Fixed relative import path\n\n// Lazy load Webcam\nconst Webcam = lazy(() => import(\"react-webcam\"));\n\nconst API_URL = process.env.REACT_APP_API_URL || \"http://localhost:5000/api\";\n\n// Configuration Constants\nconst RECOGNITION_THRESHOLD = 0.45;\nconst DETECTION_THRESHOLD = 0.5;\nconst CONFIDENCE_THRESHOLD = 0.6; // Confidence threshold for automatic attendance\nconst AUTO_DETECT_INTERVAL = 1500; // Increased interval for potentially better performance\nconst FACE_DETECTION_OPTIONS = new faceapi.TinyFaceDetectorOptions({\n  scoreThreshold: DETECTION_THRESHOLD,\n  inputSize: 320,\n});\nconst MODEL_URL = \"/models\"; // Ensure models are in the public folder\n\n// --- Helper Functions ---\n\n// Function to load face recognition models\nconst loadFaceRecognitionModels = async (dispatch, enqueueSnackbar) => {\n  try {\n    // Check if models are already loaded (using face-api internal state)\n    if (\n      faceapi.nets.tinyFaceDetector.isLoaded &&\n      faceapi.nets.faceLandmark68Net.isLoaded &&\n      faceapi.nets.faceRecognitionNet.isLoaded\n      // Removed ssdMobilenetv1 check as TinyFaceDetector is preferred\n    ) {\n      dispatch(setFaceRecModelLoaded(true));\n      return true;\n    }\n\n    enqueueSnackbar(\"Đang tải mô hình nhận diện...\", {\n      variant: \"info\",\n      autoHideDuration: null,\n    });\n    await Promise.all([\n      faceapi.nets.tinyFaceDetector.loadFromUri(MODEL_URL),\n      faceapi.nets.faceLandmark68Net.loadFromUri(MODEL_URL),\n      faceapi.nets.faceRecognitionNet.loadFromUri(MODEL_URL),\n    ]);\n    dispatch(setFaceRecModelLoaded(true));\n    enqueueSnackbar(\"Tải mô hình nhận diện thành công\", { variant: \"success\" });\n    return true;\n  } catch (error) {\n    console.error(\"Lỗi khi tải mô hình:\", error);\n    enqueueSnackbar(\"Không thể tải mô hình nhận diện\", { variant: \"error\" });\n    dispatch(setFaceRecModelLoaded(false)); // Ensure state reflects failure\n    return false;\n  }\n};\n\n// Function to extract face descriptors from student data\nconst extractStudentDescriptors = (student) => {\n  if (\n    !student ||\n    (!student.faceFeatures?.descriptors && !student.faceDescriptors)\n  ) {\n    return [];\n  }\n\n  const descriptors = [];\n  const rawDescriptors =\n    student.faceFeatures?.descriptors || student.faceDescriptors || [];\n\n  const findDescriptors = (data) => {\n    if (!data) return;\n    if (Array.isArray(data)) {\n      if (data.length === 128 && data.every((n) => typeof n === \"number\")) {\n        descriptors.push(new Float32Array(data)); // Convert to Float32Array\n      } else {\n        data.forEach(findDescriptors); // Recursively search nested arrays\n      }\n    } else if (typeof data === \"object\" && data !== null) {\n      // Handle potential object structures if necessary (though less common for raw descriptors)\n      Object.values(data).forEach(findDescriptors);\n    }\n  };\n\n  findDescriptors(rawDescriptors);\n  return descriptors.filter((d) => d.length === 128); // Final validation\n};\n\n// --- React Component ---\n\nconst AttendancePage = () => {\n  const { classId, sessionId } = useParams();\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n  const { enqueueSnackbar } = useSnackbar();\n\n  // Refs\n  const webcamRef = useRef(null);\n  const canvasRef = useRef(null);\n  const autoModeIntervalRef = useRef(null);\n  const landmarkIntervalRef = useRef(null);\n\n  // Component State\n  const [isLoading, setIsLoading] = useState(true);\n  const [classInfo, setClassInfo] = useState(null);\n  const [sessionInfo, setSessionInfo] = useState(null);\n  const [attendanceLogs, setAttendanceLogs] = useState([]);\n  const [isAutoMode, setIsAutoMode] = useState(false);\n  const [showLandmarks, setShowLandmarks] = useState(true);\n  const [manualDialogOpen, setManualDialogOpen] = useState(false);\n  const [selectedStudent, setSelectedStudent] = useState(null);\n  const [manualAttendanceData, setManualAttendanceData] = useState({\n    status: \"present\",\n    note: \"\",\n  });\n  const [componentError, setComponentError] = useState(null); // For non-API errors\n\n  // Redux State\n  const { token } = useSelector((state) => state.auth);\n\n  // Access faceRecognition state directly\n  const {\n    isModelLoaded,\n    isCameraReady,\n    detectedFaces,\n    recognizedStudents,\n    classStudents, // Assuming slice holds the relevant class students\n    isProcessing,\n    error: faceRecError, // Get error state\n  } = useSelector((state) => state.faceRecognition);\n\n  // --- Effects ---\n\n  // Load initial data: class, session, logs, models, features\n  useEffect(() => {\n    const loadData = async () => {\n      setIsLoading(true);\n      setComponentError(null); // Clear previous errors\n      try {\n        // Fetch class, session, and log data in parallel\n        const [classRes, sessionRes, logsRes] = await Promise.all([\n          axios.get(`${API_URL}/classes/teaching/${classId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n          axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n            headers: { Authorization: `Bearer ${token}` },\n          }),\n        ]);\n\n        const loadedSessionInfo = sessionRes.data.data;\n        setClassInfo(classRes.data.data);\n        setSessionInfo(loadedSessionInfo);\n        setAttendanceLogs(logsRes.data.data);\n\n        // Load models if not already loaded\n        if (!isModelLoaded) {\n          // Capture the return value indicating success/failure\n          const modelsLoadedSuccessfully = await loadFaceRecognitionModels(\n            dispatch,\n            enqueueSnackbar\n          );\n          // Check if model loading failed using the return value\n          if (!modelsLoadedSuccessfully) {\n            // Use the return value here\n            throw new Error(\"Failed to load face recognition models.\");\n          }\n          // No need to check isModelLoaded from state again here\n        }\n\n        // Fetch face features only if session is not completed and models are loaded\n        if (loadedSessionInfo?.status !== \"completed\" && isModelLoaded) {\n          await dispatch(getClassFaceFeatures(classId)).unwrap();\n        }\n      } catch (error) {\n        console.error(\"Lỗi khi tải dữ liệu:\", error);\n        const errMsg =\n          error.response?.data?.message ||\n          error.message ||\n          \"Lỗi khi tải dữ liệu\";\n        enqueueSnackbar(errMsg, { variant: \"error\" });\n        setComponentError(errMsg); // Set component-level error for UI display\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    loadData();\n\n    // Cleanup function\n    return () => {\n      dispatch(clearRecognitionState()); // Clear face-rec state on unmount\n      clearInterval(autoModeIntervalRef.current);\n      clearInterval(landmarkIntervalRef.current);\n      // Stop camera stream if active\n      webcamRef.current?.video?.srcObject\n        ?.getTracks()\n        .forEach((track) => track.stop());\n    };\n    // Ensure isModelLoaded is a dependency to refetch features if model loads later\n  }, [classId, sessionId, token, dispatch, enqueueSnackbar, isModelLoaded]);\n\n  // Effect to start/stop landmark detection interval\n  useEffect(() => {\n    if (isCameraReady && showLandmarks && !isAutoMode) {\n      // Only draw landmarks in manual mode when enabled\n      startLandmarkDetection();\n    } else {\n      stopLandmarkDetection();\n      // Clear canvas when landmarks are off or in auto mode\n      if (canvasRef.current) {\n        const ctx = canvasRef.current.getContext(\"2d\");\n        ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n      }\n    }\n    // Cleanup interval on change\n    return () => stopLandmarkDetection();\n  }, [isCameraReady, showLandmarks, isAutoMode]); // Dependencies\n\n  // --- Camera Handling ---\n\n  const handleUserMedia = useCallback(\n    (stream) => {\n      console.log(\"Camera đã được cấp quyền và khởi tạo:\", stream.id);\n      dispatch(setFaceRecCameraReady(true));\n      setComponentError(null); // Clear camera errors\n    },\n    [dispatch]\n  );\n\n  const handleUserMediaError = useCallback(\n    (error) => {\n      console.error(\"Lỗi khi truy cập camera:\", error);\n      const errMsg = `Không thể truy cập camera: ${\n        error.name === \"NotAllowedError\"\n          ? \"Bạn chưa cấp quyền truy cập camera\"\n          : error.name === \"NotFoundError\"\n          ? \"Không tìm thấy thiết bị camera\"\n          : error.message || \"Lỗi không xác định\"\n      }`;\n      enqueueSnackbar(errMsg, { variant: \"error\" });\n      dispatch(setFaceRecCameraReady(false));\n      setComponentError(errMsg);\n    },\n    [dispatch, enqueueSnackbar]\n  );\n\n  // --- Face Detection & Recognition Logic ---\n\n  const drawLandmarks = useCallback(\n    (detections, recognizedData = []) => {\n      if (!canvasRef.current || !webcamRef.current?.video) return;\n\n      const video = webcamRef.current.video;\n      const canvas = canvasRef.current;\n      const displaySize = {\n        width: video.videoWidth,\n        height: video.videoHeight,\n      };\n      faceapi.matchDimensions(canvas, displaySize);\n\n      const resizedDetections = faceapi.resizeResults(detections, displaySize);\n      const ctx = canvas.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n      resizedDetections.forEach((detection, i) => {\n        const box = detection.detection.box;\n        const landmarks = detection.landmarks;\n        const recognized = recognizedData.find(\n          (rec) => rec.detectionIndex === i\n        ); // Match recognition result\n\n        // Draw box\n        const boxColor = recognized\n          ? recognized.confidence > CONFIDENCE_THRESHOLD\n            ? \"#4CAF50\"\n            : \"#FFC107\"\n          : \"#2196F3\"; // Green if high confidence, Yellow if medium, Blue if just detected\n        ctx.strokeStyle = boxColor;\n        ctx.lineWidth = 2;\n        ctx.strokeRect(box.x, box.y, box.width, box.height);\n\n        // Draw label background\n        const label = recognized\n          ? `${recognized.name} (${(recognized.confidence * 100).toFixed(1)}%)`\n          : \"Đang nhận diện...\";\n        const textWidth = ctx.measureText(label).width;\n        ctx.fillStyle = \"rgba(0, 0, 0, 0.7)\";\n        ctx.fillRect(box.x, box.y - 20, textWidth + 10, 20);\n\n        // Draw label text\n        ctx.fillStyle = \"#FFFFFF\";\n        ctx.font = \"14px Arial\";\n        ctx.fillText(label, box.x + 5, box.y - 5);\n\n        // Draw landmarks if enabled\n        if (showLandmarks && landmarks) {\n          faceapi.draw.drawFaceLandmarks(canvas, resizedDetections); // Use face-api's drawing utility\n        }\n      });\n    },\n    [showLandmarks]\n  ); // Dependency on showLandmarks\n\n  const detectAndRecognizeFaces = useCallback(\n    async (recognize = true) => {\n      if (\n        !isCameraReady ||\n        !webcamRef.current?.video ||\n        webcamRef.current.video.readyState !== 4 ||\n        !isModelLoaded\n      ) {\n        return null; // Return null if detection can't proceed\n      }\n\n      const video = webcamRef.current.video;\n\n      try {\n        let faceData;\n        if (recognize) {\n          // Detect faces, landmarks, and descriptors for recognition\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks()\n            .withFaceDescriptors();\n        } else {\n          // Only detect faces and landmarks (for drawing)\n          faceData = await faceapi\n            .detectAllFaces(video, FACE_DETECTION_OPTIONS)\n            .withFaceLandmarks();\n        }\n\n        dispatch(setDetectedFaces(faceData)); // Update detected faces in Redux\n\n        if (!faceData || faceData.length === 0) {\n          // Clear canvas if no faces detected\n          if (canvasRef.current) {\n            const ctx = canvasRef.current.getContext(\"2d\");\n            ctx.clearRect(\n              0,\n              0,\n              canvasRef.current.width,\n              canvasRef.current.height\n            );\n          }\n          dispatch(setRecognizedStudents([])); // Clear recognized students\n          return null;\n        }\n\n        // --- Recognition Logic (if recognize === true) ---\n        let recognizedData = [];\n        if (recognize && classStudents && classStudents.length > 0) {\n          const labeledDescriptors = classStudents\n            .map((student) => {\n              const descriptors = extractStudentDescriptors(student);\n              if (descriptors.length > 0) {\n                return new faceapi.LabeledFaceDescriptors(\n                  student._id,\n                  descriptors\n                ); // Use student ID as label\n              }\n              return null;\n            })\n            .filter((ld) => ld !== null); // Filter out students with no descriptors\n\n          if (labeledDescriptors.length > 0) {\n            const faceMatcher = new faceapi.FaceMatcher(\n              labeledDescriptors,\n              RECOGNITION_THRESHOLD\n            );\n\n            recognizedData = faceData\n              .map((fd, index) => {\n                const bestMatch = faceMatcher.findBestMatch(fd.descriptor);\n                const student = classStudents.find(\n                  (s) => s._id === bestMatch.label\n                ); // Find student by ID label\n                return {\n                  detectionIndex: index, // Link recognition to detection\n                  studentId: student?._id,\n                  name: student?.full_name || \"Không rõ\",\n                  confidence: 1 - bestMatch.distance, // Convert distance to confidence-like score\n                  isUnknown: bestMatch.label === \"unknown\",\n                };\n              })\n              .filter((r) => !r.isUnknown); // Filter out unknown matches\n\n            dispatch(setRecognizedStudents(recognizedData)); // Update recognized students in Redux\n          } else {\n            dispatch(setRecognizedStudents([])); // Clear if no labeled descriptors\n          }\n        }\n\n        // Draw landmarks and boxes with recognition info\n        drawLandmarks(faceData, recognizedData);\n\n        return { detections: faceData, recognized: recognizedData }; // Return both detection and recognition results\n      } catch (error) {\n        console.error(\"Lỗi khi phát hiện/nhận diện khuôn mặt:\", error);\n        enqueueSnackbar(\"Lỗi trong quá trình xử lý khuôn mặt\", {\n          variant: \"error\",\n        });\n        // Clear canvas on error\n        if (canvasRef.current) {\n          const ctx = canvasRef.current.getContext(\"2d\");\n          ctx.clearRect(\n            0,\n            0,\n            canvasRef.current.width,\n            canvasRef.current.height\n          );\n        }\n        dispatch(setDetectedFaces([]));\n        dispatch(setRecognizedStudents([]));\n        return null;\n      }\n    },\n    [\n      isCameraReady,\n      isModelLoaded,\n      classStudents,\n      drawLandmarks,\n      dispatch,\n      enqueueSnackbar,\n    ]\n  );\n\n  // --- Manual Actions ---\n\n  // Handle manual capture & recognize button click\n  const handleManualCapture = async () => {\n    if (isProcessing) return; // Prevent multiple clicks\n\n    const result = await detectAndRecognizeFaces(true); // Perform full detection and recognition\n\n    if (result && result.recognized.length > 0) {\n      const topMatch = result.recognized.sort(\n        (a, b) => b.confidence - a.confidence\n      )[0];\n      enqueueSnackbar(\n        `Đã nhận diện: ${topMatch.name} (${(topMatch.confidence * 100).toFixed(\n          1\n        )}%)`,\n        { variant: \"info\" }\n      );\n      // Optionally, automatically mark attendance if confidence is high enough\n      if (topMatch.confidence > CONFIDENCE_THRESHOLD) {\n        handleMarkAttendance(topMatch.studentId, topMatch.confidence);\n      }\n    } else if (result && result.detections.length > 0) {\n      enqueueSnackbar(\n        \"Phát hiện khuôn mặt nhưng không nhận diện được sinh viên nào\",\n        { variant: \"warning\" }\n      );\n    } else {\n      enqueueSnackbar(\"Không phát hiện khuôn mặt nào\", { variant: \"warning\" });\n    }\n  };\n\n  // Open manual attendance dialog\n  const openManualAttendanceDialog = (student) => {\n    if (!student) return;\n    setSelectedStudent(student);\n    setManualAttendanceData({ status: \"present\", note: \"\" }); // Reset form\n    setManualDialogOpen(true);\n  };\n\n  // Close manual attendance dialog\n  const handleManualDialogClose = () => {\n    setManualDialogOpen(false);\n    setSelectedStudent(null);\n  };\n\n  // Handle manual attendance form change\n  const handleManualAttendanceChange = (e) => {\n    setManualAttendanceData({\n      ...manualAttendanceData,\n      [e.target.name]: e.target.value,\n    });\n  };\n\n  // Handle manual attendance submission\n  const handleManualAttendanceSubmit = async () => {\n    if (!selectedStudent || isProcessing) return;\n\n    try {\n      const result = await dispatch(\n        manualAttendance({\n          sessionId,\n          studentId: selectedStudent._id,\n          status: manualAttendanceData.status,\n          note: manualAttendanceData.note,\n        })\n      ).unwrap();\n\n      // Update local attendance logs immediately for better UX\n      setAttendanceLogs((prevLogs) => {\n        const existingLogIndex = prevLogs.findIndex(\n          (log) => log.student_id?._id === selectedStudent._id\n        );\n        const newLog = { ...result.data, student_id: selectedStudent }; // Use the selected student data\n        if (existingLogIndex > -1) {\n          const updatedLogs = [...prevLogs];\n          updatedLogs[existingLogIndex] = newLog;\n          return updatedLogs;\n        } else {\n          return [...prevLogs, newLog];\n        }\n      });\n\n      enqueueSnackbar(\n        `Đã điểm danh thủ công cho ${selectedStudent.full_name}`,\n        { variant: \"success\" }\n      );\n      handleManualDialogClose();\n      // Optionally refetch session info if needed\n      // fetchSessionInfo();\n    } catch (error) {\n      console.error(\"Lỗi khi điểm danh thủ công:\", error);\n      enqueueSnackbar(error.message || \"Lỗi khi điểm danh thủ công\", {\n        variant: \"error\",\n      });\n    }\n  };\n\n  // Mark attendance (used by both manual and auto modes)\n  const handleMarkAttendance = useCallback(\n    async (studentId, confidence) => {\n      if (!studentId || isProcessing) return;\n\n      // Check if student already marked present\n      const isAlreadyPresent = attendanceLogs.some(\n        (log) => log.student_id?._id === studentId && log.status === \"present\"\n      );\n      if (isAlreadyPresent) {\n        // console.log(`Student ${studentId} already marked present.`);\n        return; // Don't mark again if already present\n      }\n\n      const student = classStudents.find((s) => s._id === studentId);\n      if (!student) {\n        console.warn(\"Student not found for marking attendance:\", studentId);\n        return;\n      }\n\n      // Capture image for proof (optional, but good practice)\n      let imageBase64 = null;\n      try {\n        if (webcamRef.current) {\n          imageBase64 = webcamRef.current.getScreenshot({\n            width: 320,\n            height: 240,\n          }); // Smaller screenshot\n        }\n      } catch (screenshotError) {\n        console.error(\"Error taking screenshot:\", screenshotError);\n        // Proceed without image if screenshot fails\n      }\n\n      try {\n        const result = await dispatch(\n          verifyAttendance({\n            sessionId,\n            studentId,\n            // faceDescriptor: null, // Descriptor not strictly needed for verification API if confidence is high\n            confidence,\n            imageBase64,\n            recognized: true, // Mark as recognized by the system\n          })\n        ).unwrap();\n\n        // Update local attendance logs\n        setAttendanceLogs((prevLogs) => {\n          const existingLogIndex = prevLogs.findIndex(\n            (log) => log.student_id?._id === studentId\n          );\n          const newLog = { ...result.data, student_id: student }; // Use the found student data\n          if (existingLogIndex > -1) {\n            const updatedLogs = [...prevLogs];\n            updatedLogs[existingLogIndex] = newLog;\n            return updatedLogs;\n          } else {\n            return [...prevLogs, newLog];\n          }\n        });\n\n        enqueueSnackbar(`Đã điểm danh cho ${student.full_name}`, {\n          variant: \"success\",\n        });\n      } catch (error) {\n        console.error(\"Lỗi khi xác nhận điểm danh:\", error);\n        enqueueSnackbar(error.message || \"Lỗi khi xác nhận điểm danh\", {\n          variant: \"error\",\n        });\n      }\n    },\n    [\n      dispatch,\n      sessionId,\n      classStudents,\n      attendanceLogs,\n      isProcessing,\n      enqueueSnackbar,\n    ]\n  ); // Added dependencies\n\n  // --- Auto Mode ---\n\n  const startAutoAttendance = useCallback(() => {\n    if (\n      !isCameraReady ||\n      !isModelLoaded ||\n      !classStudents ||\n      classStudents.length === 0\n    ) {\n      enqueueSnackbar(\n        \"Camera, mô hình, hoặc danh sách sinh viên chưa sẵn sàng cho chế độ tự động.\",\n        { variant: \"warning\" }\n      );\n      return;\n    }\n    stopAutoAttendance(); // Clear any existing interval first\n    setIsAutoMode(true);\n    enqueueSnackbar(\"Bật chế độ tự động điểm danh\", { variant: \"info\" });\n\n    autoModeIntervalRef.current = setInterval(async () => {\n      const result = await detectAndRecognizeFaces(true); // Detect and recognize\n\n      if (result && result.recognized.length > 0) {\n        // Process recognized students\n        result.recognized.forEach((rec) => {\n          if (rec.confidence > CONFIDENCE_THRESHOLD && rec.studentId) {\n            handleMarkAttendance(rec.studentId, rec.confidence); // Attempt to mark attendance\n          }\n        });\n      }\n    }, AUTO_DETECT_INTERVAL);\n  }, [\n    isCameraReady,\n    isModelLoaded,\n    classStudents,\n    detectAndRecognizeFaces,\n    handleMarkAttendance,\n    enqueueSnackbar,\n  ]); // Added dependencies\n\n  const stopAutoAttendance = useCallback(() => {\n    clearInterval(autoModeIntervalRef.current);\n    autoModeIntervalRef.current = null;\n    setIsAutoMode(false);\n    dispatch(setRecognizedStudents([])); // Clear recognized students when stopping auto mode\n    // Clear canvas\n    if (canvasRef.current) {\n      const ctx = canvasRef.current.getContext(\"2d\");\n      ctx.clearRect(0, 0, canvasRef.current.width, canvasRef.current.height);\n    }\n    enqueueSnackbar(\"Tắt chế độ tự động điểm danh\", { variant: \"info\" });\n  }, [dispatch, enqueueSnackbar]);\n\n  // --- Landmark Detection Interval ---\n  const startLandmarkDetection = useCallback(() => {\n    stopLandmarkDetection(); // Clear existing interval\n    landmarkIntervalRef.current = setInterval(async () => {\n      // Only detect, don't recognize fully to save resources\n      await detectAndRecognizeFaces(false);\n    }, 100); // Detect landmarks frequently for smooth drawing\n  }, [detectAndRecognizeFaces]); // Dependency\n\n  const stopLandmarkDetection = useCallback(() => {\n    clearInterval(landmarkIntervalRef.current);\n    landmarkIntervalRef.current = null;\n  }, []);\n\n  // --- Other Actions ---\n\n  const completeSession = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang kết thúc phiên...\", { variant: \"info\" });\n      await axios.put(\n        `${API_URL}/attendance/sessions/${sessionId}`,\n        { status: \"completed\" },\n        { headers: { Authorization: `Bearer ${token}` } }\n      );\n      enqueueSnackbar(\"Phiên điểm danh đã kết thúc\", { variant: \"success\" });\n      setSessionInfo((prev) => ({ ...prev, status: \"completed\" })); // Update local state\n      stopAutoAttendance(); // Stop auto mode if running\n      // Optionally navigate back after a delay\n      // setTimeout(() => navigate(`/teacher/classes/${classId}`), 1000);\n    } catch (error) {\n      console.error(\"Lỗi khi kết thúc phiên:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi kết thúc phiên\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const refreshAttendanceLogs = async () => {\n    if (isProcessing) return;\n    try {\n      enqueueSnackbar(\"Đang làm mới dữ liệu...\", { variant: \"info\" });\n      const [logsRes, sessionRes] = await Promise.all([\n        axios.get(`${API_URL}/attendance/logs/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n        axios.get(`${API_URL}/attendance/sessions/${sessionId}`, {\n          headers: { Authorization: `Bearer ${token}` },\n        }),\n      ]);\n      setAttendanceLogs(logsRes.data.data);\n      setSessionInfo(sessionRes.data.data);\n      enqueueSnackbar(\"Đã làm mới dữ liệu\", { variant: \"success\" });\n    } catch (error) {\n      console.error(\"Lỗi khi làm mới dữ liệu:\", error);\n      enqueueSnackbar(\n        error.response?.data?.message || \"Lỗi khi làm mới dữ liệu\",\n        { variant: \"error\" }\n      );\n    }\n  };\n\n  const toggleLandmarks = () => {\n    setShowLandmarks((prev) => !prev);\n  };\n\n  // --- Derived State ---\n  const presentStudents = attendanceLogs.filter(\n    (log) => log.status === \"present\"\n  );\n  const absentStudents =\n    classInfo?.students?.filter(\n      (student) =>\n        !attendanceLogs.some(\n          (log) =>\n            log.student_id?._id === student._id &&\n            (log.status === \"present\" || log.status === \"late\")\n        ) // Consider late as not absent\n    ) || [];\n  const totalStudents = classInfo?.students?.length || 0;\n  const sessionCompleted = sessionInfo?.status === \"completed\";\n\n  // --- Render Logic ---\n\n  if (isLoading) {\n    return (\n      <Box\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        minHeight=\"80vh\"\n      >\n        <CircularProgress />\n        <Typography sx={{ ml: 2 }}>Đang tải dữ liệu điểm danh...</Typography>\n      </Box>\n    );\n  }\n\n  if (componentError && !isLoading) {\n    return (\n      <Box sx={{ p: 3 }}>\n        <Alert\n          severity=\"error\"\n          action={\n            <Button\n              color=\"inherit\"\n              size=\"small\"\n              onClick={() => window.location.reload()}\n            >\n              Tải lại trang\n            </Button>\n          }\n        >\n          <AlertTitle>Đã xảy ra lỗi</AlertTitle>\n          {componentError}\n        </Alert>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{ p: { xs: 1, sm: 2, md: 3 } }}>\n      {/* Header */}\n      <Box\n        display=\"flex\"\n        justifyContent=\"space-between\"\n        alignItems=\"center\"\n        mb={2.5}\n        pb={2}\n        borderBottom=\"1px solid #eaeaea\"\n      >\n        <Box>\n          <Typography variant=\"h5\" fontWeight={500}>\n            Điểm Danh - {classInfo?.class_name}\n          </Typography>\n          <Typography variant=\"subtitle1\" color=\"textSecondary\">\n            Buổi {sessionInfo?.session_number} -{\" \"}\n            {sessionInfo?.date\n              ? new Date(sessionInfo.date).toLocaleDateString(\"vi-VN\")\n              : \"N/A\"}\n            <Chip\n              label={sessionInfo?.status || \"N/A\"}\n              color={sessionCompleted ? \"default\" : \"success\"}\n              size=\"small\"\n              sx={{ ml: 1 }}\n            />\n          </Typography>\n        </Box>\n        <Button\n          variant=\"outlined\"\n          startIcon={<ArrowBack />}\n          onClick={() => navigate(`/teacher/classes/${classId}`)}\n        >\n          Quay lại lớp\n        </Button>\n      </Box>\n\n      {sessionCompleted && (\n        <Alert severity=\"info\" sx={{ mb: 2 }}>\n          Phiên điểm danh này đã kết thúc. Bạn chỉ có thể xem lại kết quả.\n        </Alert>\n      )}\n\n      {faceRecError && (\n        <Alert severity=\"warning\" sx={{ mb: 2 }}>\n          Lỗi từ hệ thống nhận diện: {faceRecError}\n        </Alert>\n      )}\n\n      <Grid container spacing={3}>\n        {/* Left Column: Camera and Controls */}\n        <Grid item xs={12} md={8}>\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3, overflow: \"hidden\" }}>\n            <CardContent\n              sx={{\n                bgcolor: \"#f8f9fa\",\n                borderBottom: \"1px solid #eaeaea\",\n                p: 2,\n              }}\n            >\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n              >\n                <Typography\n                  variant=\"h6\"\n                  fontWeight={500}\n                  display=\"flex\"\n                  alignItems=\"center\"\n                >\n                  <CameraAlt sx={{ mr: 1, color: \"primary.main\" }} /> Camera\n                </Typography>\n                {!sessionCompleted &&\n                  isModelLoaded && ( // Show controls only if session active and model loaded\n                    <Box>\n                      <Tooltip\n                        title={\n                          isAutoMode\n                            ? \"Dừng chế độ tự động\"\n                            : \"Bắt đầu chế độ tự động\"\n                        }\n                      >\n                        <IconButton\n                          onClick={\n                            isAutoMode\n                              ? stopAutoAttendance\n                              : startAutoAttendance\n                          }\n                          color={isAutoMode ? \"error\" : \"primary\"}\n                          disabled={!isCameraReady}\n                        >\n                          {isAutoMode ? (\n                            <StopCircleOutlined />\n                          ) : (\n                            <PlayCircleOutline />\n                          )}\n                        </IconButton>\n                      </Tooltip>\n                      <Tooltip\n                        title={showLandmarks ? \"Ẩn Landmark\" : \"Hiện Landmark\"}\n                      >\n                        <IconButton\n                          onClick={toggleLandmarks}\n                          color=\"secondary\"\n                          disabled={!isCameraReady || isAutoMode}\n                        >\n                          {showLandmarks ? <VisibilityOff /> : <Visibility />}\n                        </IconButton>\n                      </Tooltip>\n                    </Box>\n                  )}\n              </Box>\n            </CardContent>\n\n            {/* Camera Display Area */}\n            <Box\n              sx={{\n                position: \"relative\",\n                width: \"100%\",\n                aspectRatio: \"640 / 480\",\n                backgroundColor: \"#000\",\n                display: \"flex\",\n                justifyContent: \"center\",\n                alignItems: \"center\",\n              }}\n            >\n              {!isModelLoaded && !sessionCompleted ? (\n                <Box textAlign=\"center\" color=\"white\">\n                  <CircularProgress color=\"inherit\" />\n                  <Typography>Đang tải mô hình nhận diện...</Typography>\n                </Box>\n              ) : !sessionCompleted ? (\n                <Suspense\n                  fallback={\n                    <Box textAlign=\"center\" color=\"white\">\n                      <CircularProgress color=\"inherit\" />\n                      <Typography>Đang khởi tạo camera...</Typography>\n                    </Box>\n                  }\n                >\n                  <Webcam\n                    audio={false}\n                    ref={webcamRef}\n                    screenshotFormat=\"image/jpeg\"\n                    width=\"100%\"\n                    height=\"100%\"\n                    videoConstraints={{\n                      width: 640,\n                      height: 480,\n                      facingMode: \"user\",\n                    }}\n                    style={{\n                      display: \"block\",\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      objectFit: \"cover\",\n                    }}\n                    onUserMedia={handleUserMedia}\n                    onUserMediaError={handleUserMediaError}\n                  />\n                </Suspense>\n              ) : (\n                <Typography color=\"white\">Phiên đã kết thúc</Typography> // Placeholder if session completed\n              )}\n\n              {/* Canvas for Overlays */}\n              <canvas\n                ref={canvasRef}\n                style={{\n                  position: \"absolute\",\n                  top: 0,\n                  left: 0,\n                  width: \"100%\",\n                  height: \"100%\",\n                  zIndex: 10,\n                }}\n              />\n\n              {/* Camera Error/Loading Overlay */}\n              {(!isCameraReady || componentError?.includes(\"camera\")) &&\n                !sessionCompleted && (\n                  <Box\n                    sx={{\n                      position: \"absolute\",\n                      top: 0,\n                      left: 0,\n                      width: \"100%\",\n                      height: \"100%\",\n                      backgroundColor: \"rgba(0,0,0,0.7)\",\n                      display: \"flex\",\n                      flexDirection: \"column\",\n                      justifyContent: \"center\",\n                      alignItems: \"center\",\n                      color: \"white\",\n                      zIndex: 20,\n                    }}\n                  >\n                    <VideocamOff sx={{ fontSize: 60, mb: 2 }} />\n                    <Typography variant=\"h6\">Camera không khả dụng</Typography>\n                    <Typography\n                      variant=\"body2\"\n                      sx={{ mt: 1, px: 2, textAlign: \"center\" }}\n                    >\n                      {componentError ||\n                        \"Không thể kết nối camera. Vui lòng kiểm tra quyền truy cập và thiết bị.\"}\n                    </Typography>\n                    <Button\n                      variant=\"outlined\"\n                      color=\"inherit\"\n                      sx={{ mt: 2 }}\n                      onClick={() => window.location.reload()}\n                    >\n                      Thử lại\n                    </Button>\n                  </Box>\n                )}\n              {/* Auto Mode Indicator */}\n              {isAutoMode && isCameraReady && (\n                <Chip\n                  label=\"Đang tự động điểm danh\"\n                  color=\"success\"\n                  size=\"small\"\n                  sx={{\n                    position: \"absolute\",\n                    bottom: 10,\n                    right: 10,\n                    zIndex: 15,\n                  }}\n                />\n              )}\n            </Box>\n\n            {/* Action Buttons */}\n            {!sessionCompleted && isCameraReady && isModelLoaded && (\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                p={2}\n                bgcolor=\"#f8f9fa\"\n                borderTop=\"1px solid #eaeaea\"\n              >\n                <Button\n                  variant=\"contained\"\n                  onClick={handleManualCapture}\n                  startIcon={\n                    isProcessing ? (\n                      <CircularProgress size={20} color=\"inherit\" />\n                    ) : (\n                      <CameraAlt />\n                    )\n                  }\n                  disabled={isProcessing || isAutoMode}\n                >\n                  Chụp & Nhận diện\n                </Button>\n                <Button\n                  variant=\"contained\"\n                  color=\"secondary\"\n                  onClick={completeSession}\n                  startIcon={<Save />}\n                  disabled={isProcessing}\n                >\n                  Kết thúc phiên\n                </Button>\n              </Box>\n            )}\n          </Card>\n\n          {/* Recognized Students Preview (Optional) */}\n          {recognizedStudents.length > 0 && !isAutoMode && (\n            <Card sx={{ mt: 2, borderRadius: \"10px\", boxShadow: 1 }}>\n              <CardContent>\n                <Typography variant=\"subtitle1\" fontWeight=\"500\" mb={1}>\n                  Đã nhận diện gần đây\n                </Typography>\n                <Grid container spacing={1}>\n                  {recognizedStudents.slice(0, 4).map(\n                    (\n                      rec,\n                      index // Show max 4\n                    ) => (\n                      <Grid\n                        item\n                        xs={6}\n                        sm={3}\n                        key={`${rec.studentId}-${index}`}\n                      >\n                        <Paper\n                          elevation={0}\n                          sx={{\n                            p: 1,\n                            textAlign: \"center\",\n                            border: \"1px solid #eee\",\n                          }}\n                        >\n                          <Typography variant=\"caption\" display=\"block\" noWrap>\n                            {rec.name}\n                          </Typography>\n                          <Chip\n                            label={`${(rec.confidence * 100).toFixed(0)}%`}\n                            size=\"small\"\n                            color={\n                              rec.confidence > CONFIDENCE_THRESHOLD\n                                ? \"success\"\n                                : \"warning\"\n                            }\n                            sx={{ mt: 0.5 }}\n                          />\n                        </Paper>\n                      </Grid>\n                    )\n                  )}\n                </Grid>\n              </CardContent>\n            </Card>\n          )}\n        </Grid>\n\n        {/* Right Column: Student Lists */}\n        <Grid item xs={12} md={4}>\n          {/* Present Students */}\n          <Card sx={{ mb: 3, borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Box\n                display=\"flex\"\n                justifyContent=\"space-between\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Typography variant=\"h6\" display=\"flex\" alignItems=\"center\">\n                  <Check sx={{ mr: 1, color: \"success.main\" }} /> Có mặt (\n                  {presentStudents.length}/{totalStudents})\n                </Typography>\n                <Tooltip title=\"Làm mới danh sách\">\n                  <IconButton\n                    size=\"small\"\n                    onClick={refreshAttendanceLogs}\n                    disabled={isProcessing}\n                  >\n                    <Refresh />\n                  </IconButton>\n                </Tooltip>\n              </Box>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {presentStudents.map((student) => (\n                  <Typography key={student._id} variant=\"body2\">\n                    {student.full_name}\n                  </Typography>\n                ))}\n              </Box>\n            </CardContent>\n          </Card>\n\n          {/* Absent Students */}\n          <Card sx={{ borderRadius: \"10px\", boxShadow: 3 }}>\n            <CardContent>\n              <Typography\n                variant=\"h6\"\n                display=\"flex\"\n                alignItems=\"center\"\n                mb={1}\n              >\n                <Close sx={{ mr: 1, color: \"error.main\" }} /> Vắng mặt (\n                {absentStudents.length}/{totalStudents})\n              </Typography>\n              <Divider sx={{ mb: 1 }} />\n              <Box sx={{ maxHeight: \"300px\", overflow: \"auto\", pr: 1 }}>\n                {absentStudents.length === 0 ? (\n                  <Typography\n                    variant=\"body2\"\n                    color=\"textSecondary\"\n                    align=\"center\"\n                    sx={{ py: 2 }}\n                  >\n                    Tất cả sinh viên đã có mặt.\n                  </Typography>\n                ) : (\n                  <List dense>\n                    {absentStudents.map((student) => (\n                      <ListItem\n                        key={student._id}\n                        disablePadding\n                        sx={{ mb: 0.5 }}\n                        secondaryAction={\n                          !sessionCompleted ? (\n                            <Tooltip title=\"Điểm danh thủ công\">\n                              <IconButton\n                                edge=\"end\"\n                                size=\"small\"\n                                onClick={() =>\n                                  openManualAttendanceDialog(student)\n                                }\n                                disabled={isProcessing}\n                              >\n                                <Edit fontSize=\"small\" />\n                              </IconButton>\n                            </Tooltip>\n                          ) : null\n                        }\n                      >\n                        <Paper\n                          variant=\"outlined\"\n                          sx={{\n                            width: \"100%\",\n                            display: \"flex\",\n                            alignItems: \"center\",\n                            p: 0.5,\n                            borderRadius: \"4px\",\n                          }}\n                        >\n                          <ListItemAvatar sx={{ minWidth: 45 }}>\n                            <Avatar\n                              alt={student.full_name}\n                              src={student.avatar_url}\n                              sx={{ width: 32, height: 32 }}\n                            />\n                          </ListItemAvatar>\n                          <ListItemText\n                            primary={\n                              <Typography variant=\"body2\" noWrap>\n                                {student.full_name}\n                              </Typography>\n                            }\n                            secondary={\n                              <Typography\n                                variant=\"caption\"\n                                color=\"text.secondary\"\n                              >\n                                {student.student_code}\n                              </Typography>\n                            }\n                          />\n                        </Paper>\n                      </ListItem>\n                    ))}\n                  </List>\n                )}\n              </Box>\n            </CardContent>\n          </Card>\n        </Grid>\n      </Grid>\n\n      {/* Manual Attendance Dialog */}\n      <Dialog\n        open={manualDialogOpen}\n        onClose={handleManualDialogClose}\n        maxWidth=\"xs\"\n        fullWidth\n      >\n        <DialogTitle>Điểm Danh Thủ Công</DialogTitle>\n        <DialogContent>\n          <TextField\n            label=\"Trạng Thái\"\n            name=\"status\"\n            value={manualAttendanceData.status}\n            onChange={handleManualAttendanceChange}\n            fullWidth\n          />\n          <TextField\n            label=\"Ghi Chú\"\n            name=\"note\"\n            value={manualAttendanceData.note}\n            onChange={handleManualAttendanceChange}\n            fullWidth\n            multiline\n            rows={4}\n          />\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={handleManualDialogClose}>Hủy</Button>\n          <Button onClick={handleManualAttendanceSubmit}>Lưu</Button>\n        </DialogActions>\n      </Dialog>\n    </Box>\n  );\n};\n\nexport default AttendancePage;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}